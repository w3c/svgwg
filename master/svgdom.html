<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional+edit//EN" "xhtml1-transitional+edit.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:edit="http://xmlns.grorg.org/SVGT12NG/">
<head>
  <title>SVG Document Object Model (DOM)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport"           content="width=device-width, initial-scale=1, shrink-to-fit=no"/>

  <!-- Style sheets for local dev. Will be standardized in processing.
  Add attribute data-keep="" to any extra stylesheet link you do not want removed
  (or use <style>), and include it before here. -->
  <link rel="stylesheet" href="style/svg.css" type="text/css" />
  <link rel="stylesheet" href="style/W3C-ED.css" type="text/css" />
</head>
<body>

<h1>SVG Document Object Model (DOM)</h1>

<p class="normativity"><strong>This appendix is normative.</strong></p>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Improve the DOM.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2011/10/27-svg-irc#T18-35-49">We will generally improve the SVG DOM for SVG 2.</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>Help authors use the SVG DOM by making it less Java-oriented.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Cameron (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3273">ACTION-3273</a>)</td>
    </tr>
    <tr>
      <th>Note:</th>
      <td>See <a href="http://www.w3.org/Graphics/SVG/WG/wiki/SVG_2_DOM">SVG 2 DOM</a> Wiki page.</td>
    </tr>
  </table>
</div>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Improve the SVG path DOM APIs.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2011/10/27-svg-irc#T18-23-23">We will improve the SVG path DOM APIs in SVG 2.</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>Clean up SVGPathSegList interface, and possibly share an API with Canvas.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Cameron (no action)</td>
    </tr>
  </table>
</div>

<h2 id="SVGDOMOverview">SVG DOM overview</h2>

<p>Conforming <a>SVG viewers</a> or <a>SVG interpreters</a>
that support <a>script execution</a>
must implement SVG DOM interfaces as defined throughout this specification,
with the specific requirements and dependencies listed in this section.
</p>

<p class="ready-for-wider-review">The SVG DOM is defined in terms of <a href="https://heycam.github.io/webidl/">Web IDL</a>
interfaces. All IDL fragments in this specification must be interpreted as
required for <a href="https://heycam.github.io/webidl/#dfn-conforming-set-of-idl-fragments">conforming IDL fragments</a>,
as described in the Web IDL specification. [<a href="refs.html#ref-webidl">WebIDL</a>]</p>

<p>The SVG DOM builds upon a number of DOM specifications.  In particular:</p>

<ul>
  <li>The SVG DOM requires, at a minimum, complete support for
  <a href="https://www.w3.org/TR/dom/">DOM4</a>;
  SVG software should implement
  the <a href="https://dom.spec.whatwg.org/">latest DOM standard</a> 
  wherever possible
  [<a href="refs.html#ref-dom">DOM</a>]</li>

  <li>The SVG DOM requires support for relevant aspects of 
  <a href="https://www.w3.org/TR/uievents/">UI Events</a> ([<a href="refs.html#ref-uievents">uievents</a>]).
  (For the specific features from UI Events that are required, see
  see <a href="svgdom.html#RelationshipWithUIEVENTS">Relationship with UI Events</a>.)</li>

  <li>The SVG DOM requires, at a minimum, complete
  support for all interfaces from
  <a href="https://www.w3.org/TR/DOM-Level-2-Style/Overview.html">DOM Level 2 Style</a>
  ([<a href="refs.html#ref-dom-level-2-style">dom-level-2-style</a>])
  that have not been dropped in the
  <a href="https://drafts.csswg.org/cssom/">CSS Object Model (CSSOM)</a> specification.
  SVG software should implement the latest version of
  <a href="https://drafts.csswg.org/cssom/">CSS Object Model (CSSOM)</a>
  wherever possible
  ([<a href="refs.html#ref-cssom-1">cssom-1</a>])
  </li>

  <li>The SVG DOM requires complete support for
  <a href="http://www.w3.org/TR/2014/CR-geometry-1-20141125/">Geometry Interfaces Module Level 1</a>
  ([<a href="refs.html#ref-geometry-1">geometry-1</a>]).
  </li>
</ul>

<p>Many SVG DOM properties <a>reflect</a> a content attribute
on the corresponding element, e.g.
the <a>SVGAnimatedLength</a> <a>SVGRectElement::ry</a> in an
<a>SVGRectElement</a>.
This relationship is live, and values must be synchronized
(following the rules in <a href="types.html#TermReflect">DOM interfaces for reflecting SVG attributes</a>)
when either the attribute or its reflected property is modified.
</p>

<p>
If the attribute hasn't been specified explicitly in the document markup,
the reflected object is nonetheless intialized upon access,
to the attribute's inital value.
If the attribute's initial value is <span class="attr-value">(none)</span>,
the object is initialized as defined in
<a href="#SVGObjectInitialization">Reflecting an empty initial value</a>.
This newly constructed object does not generate an attribute on the element until
it is modified for the first time. Modifications made to the corresponding
attribute are immediately reflected in the object.</p>

<p class="example">If <code>lineElement.x1.baseVal</code> is accessed
(where <code>lineElement</code> is an instance of <a>SVGLineElement</a>)
and the <a>'line/x1'</a> attribute was not specified in the document, the
returned <a>SVGLength</a> object would represent the value <span class="attr-value">0 user units</span>,
because the initial value for the attribute is <span class="attr-value">0</span>.</p>

<h3 id="SVGObjectInitialization">Reflecting an empty initial value</h3>

<p>
When initializing an SVG DOM attribute that <a>reflects</a> a null or empty initial value,
then the property must be initialized according to its data type,
as defined in this section.
This occurs only if there is no explicit value for the reflected content attribute,
and the initial value in the attribute's definition table is <span class="attr-value">(none)</span>.
</p>

<p>
If an interface is not listed below that means
that the object initialization shall be done using the values for the
objects that the interface contains, e.g.,
an <a>SVGAnimatedString</a> consists of two <span class="DOMInterfaceName">DOMString</span> members,
while a <a>DOMRect</a> consists of many <span class="DOMInterfaceName">double</span>s.</p>

<dl id="SVGObjectInitValues">
  <dt class="DOMInterfaceName">DOMString</dt>
  <dd>Initialized as the empty string (<span class="attr-value">""</span>).</dd>

  <dt class="DOMInterfaceName">float</dt>
  <dt class="DOMInterfaceName">long</dt>
  <dt class="DOMInterfaceName">short</dt>
  <dt>Any other <a href="https://heycam.github.io/webidl/#dfn-numeric-type">numeric type</a> defined in WebIDL</dt>
  <dd>Initialized as <span class="attr-value">0</span>.</dd>

  <dt class="DOMInterfaceName">boolean</dt>
  <dd>Initialized as <span class="attr-value">false</span>.</dd>

  <dt class="DOMInterfaceName"><a>SVGLength</a></dt>
  <dd>Initialized as <span class="attr-value">0 user units</span>
  (<a href="types.html#__svg__SVGLength__SVG_LENGTHTYPE_NUMBER">SVG_LENGTHTYPE_NUMBER</a>).</dd>

  <dt class="DOMInterfaceName"><a>SVGLengthList</a></dt>
  <dt class="DOMInterfaceName"><a>SVGNumberList</a></dt>
  <dt class="DOMInterfaceName"><a>SVGPointList</a></dt>
  <dt class="DOMInterfaceName"><a>SVGStringList</a></dt>
  <dt class="DOMInterfaceName"><a>SVGTransformList</a></dt>
  <dd>Initialized as the empty list.</dd>

  <dt class="DOMInterfaceName"><a>SVGAngle</a></dt>
  <dd>Initialized as <span class="attr-value">0 in unspecified units</span>
  (<a href="types.html#__svg__SVGAngle__SVG_ANGLETYPE_UNSPECIFIED">SVG_ANGLETYPE_UNSPECIFIED</a>).</dd>

  <dt class="DOMInterfaceName"><a>SVGZoomAndPan</a></dt>
  <dd>Initialized as <span class="attr-value">0</span>
  (<a href="types.html#__svg__SVGZoomAndPan__SVG_ZOOMANDPAN_UNKNOWN">SVG_ZOOMANDPAN_UNKNOWN</a>).</dd>

  <dt class="DOMInterfaceName"><a>SVGPreserveAspectRatio</a></dt>
  <dd>Initialized as <span class="attr-value">'xMidYMid meet'</span>.</dd>
</dl>

<p class="example">If <code>textElement.dx.baseVal</code> is accessed
(where <code>textElement</code> is an instance of <a>SVGTextElement</a>)
and the <a>'text/dx'</a> attribute was not specified in the document, the
returned <a>SVGLengthList</a> object would be empty.</p>

<h2 id="ElementsInTheSVGDOM">Elements in the SVG DOM</h2>

<p>Any SVG software that is required to support the SVG DOM
must enhance the DOM elements created for <a>SVG document fragments</a>
as follows:
</p>

<ul>
<li>
<p>Every <a>Element</a> object that corresponds to a supported SVG element (that is,
an element with namespace URI "http://www.w3.org/2000/svg" and a
local name that is one of the elements defined in this specification
or another specification implemented by the software)
must also implement the DOM interface identified in the element definition.
</p>
</li>
<li>
<p>
Elements in the SVG namespace whose local name does not match an element
defined in any specification supported by the software
should instead implement the <a>SVGUnknownElement</a> interface and
must nonetheless implement the <a>SVGElement</a> interface.
</p>
</li>
</ul>

<p class="issue">The <a>SVGUnknownElement</a> interface is "at risk".</p>

<p class="example">
In <a href="shapes.html#RectElement">The <span class="element-name">'rect'</span> element</a>,
the <a>SVGRectElement</a> interface is identified.  This means that every
<a>Element</a> object whose namespace URI is "http://www.w3.org/2000/svg"
and whose local name is "rect" must also implement <a>SVGRectElement</a>.</p>

<h2 id="SVGDOMNamingConventions">Naming conventions</h2>

<p>The SVG DOM follows similar naming conventions to HTML and DOM standards
([<a href="refs.html#ref-html">HTML</a>], [<a href="refs.html#ref-dom">DOM</a>]).</p>

<p>All names are defined as one or more English words
concatenated together to form a single string. Property or
method names start with the initial keyword in lowercase, and
each subsequent word starts with a capital letter. For example,
a property that returns document meta information such as the
date the file was created might be named "fileDateCreated".</p>

<p>Interface names defined in this specification nearly all start with "SVG".
Interfaces that represent the DOM <a>Element</a> object
for an SVG-namespaced element follow the format
<code>SVG<i>ElementName</i>Element</code>, where <code><i>ElementName</i></code>
is the element's tag name with the initial letter capitalized.
So <a>SVGRadialGradientElement</a> is the interface for an <a>'radialGradient'</a> element.
</p>

<p class="note">
An exception to this casing convention is <a>SVGSVGElement</a>,
in which the entire tag name is capitalized.
</p>

<h2 id="RelationshipWithUIEVENTS">Relationship with UI Events</h2>

<p>The SVG DOM supports select all interfaces defined in, and
all the event types from, 
<a href="https://www.w3.org/TR/uievents/">UI Events</a>
([<a href="refs.html#ref-uievents">uievents</a>]).</p>

<ul>
  <li>
    The following event types are triggered due to state
    changes in animations. (The definitions for these events
    can be found in the description of the <a>TimeEvent</a> interface.)
    <ul>
      <li><a href="interact.html#BeginEvent">beginEvent</a></li>
      <li><a href="interact.html#EndEvent">endEvent</a></li>
      <li><a href="interact.html#RepeatEvent">repeatEvent</a></li>
    </ul>
  </li>
</ul>

<p id="EventListeners">While event listeners can be registered using an
<code>addEventListener</code> call on any element in the DOM,
the use of <a href="interact.html#EventAttributes">event attributes</a>
on elements where those attributes are disallowed will not result in their
being invoked if the relevant event is dispatched to the element.
For example, if the <a>'onclick'</a> attribute were specified on
a <a>'title'</a> element, its contents would never be run in
response to a <span class='attr-value'>click</span> event:</p>

<pre class='example'><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg">
  <title onclick="alert('Hello')">Invalid event attribute</title>
  <script>
    // Find the 'title' element.
    var title = document.getElementsByTagNameNS("http://www.w3.org/2000/svg", "title")[0];

    // Create and initialize a 'click' event.
    var event = document.createEvent("MouseEvent");
    event.initMouseEvent("click", true, false, this, 1, 0, 0, 0, 0, false,
                         false, false, false, 0, null);

    // Dispatch the event to the 'title' element.  Since onclick="" is not
    // allowed on 'title', the alert will not show.
    title.dispatchEvent(event);
  </script>
</svg>
]]></pre>

<p>See the <a href='attindex.html'>Attribute Index</a> for details on
which elements a given event attribute is allowed to be specified on.</p>

<p>Implementors may view the setting of event attributes as the
creation and registration of an <a>EventListener</a> on the
<a>EventTarget</a>.  Such event listeners are invoked only for
the "bubbling" and "at target" phases, as if false were specified
for the <code>useCapture</code> argument to <code>addEventListener</code>.
This <a>EventListener</a> behaves in the same manner as any other
which may be registered on the <a>EventTarget</a>.</p>

<p>If the attribute representing the event listener is changed,
this may be viewed as the removal of the previously registered
<a>EventListener</a> and the registration of a new one. Futhermore, no
specification is made as to the order in which event attributes
will receive the event with regards to the other EventListeners
on the <a>EventTarget</a>.</p>

<p>In ECMAScript, one way to establish an event listener is to
define a function and pass that function to the <code>addEventListener</code> method:</p>

<pre>
function myAction1(evt) {
  // process the event
}
// ... later ...
myElement.addEventListener("click", myAction1, false)
</pre>

<p>In ECMAScript, the character data content of an
<a href="interact.html">event attribute</a> becomes
the definition of the ECMAScript function which gets invoked in
response to the event. As with all registered ECMAScript event
listener functions, this function receives an <a>Event</a> object as a
parameter, and the name of the Event object is
<strong>evt</strong>. For example, it is possible to write:</p>

<pre><![CDATA[
<rect onclick="MyClickHandler(evt)" .../>
]]></pre>

<p>which will pass the <a>Event</a> object <strong>evt</strong> into
function <code>MyClickHandler</code>.</p>

<h2 id="InvalidValues">Invalid values</h2>

<p>If a script sets a <a>reflected</a> DOM attribute
to an <a>invalid value</a> for the content attribute (e.g.,
a negative number for an attribute that requires a non-negative
number or an out-of-range value for an enumeration), unless
this specification indicates otherwise, no exception shall be
raised on setting, but the given document fragment shall become
technically <em>in error</em> as described in
<a href="conform.html#ErrorProcessing">Error processing</a>.</p>

<p class="issue">
  Many browsers currently throw errors for out-of-range enumeration values,
  or explicitly setting an enumeration to the UNKNOWN value.
  See <a href="https://github.com/w3c/svgwg/issues/547">Should setting an enum IDL to an invalid value throw an error?</a> on GitHub for discussion.
</p>

</body>
</html>
