<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional+edit//EN" "xhtml1-transitional+edit.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:edit="http://xmlns.grorg.org/SVGT12NG/">
<head>
  <title>Scripting</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link rel="stylesheet"           title="Default"               type="text/css" media="screen" href="style/default_svg.css"/>
  <link rel="alternate stylesheet" title="No issues/annotations" type="text/css" media="screen" href="style/default_no_issues.css"/>
  <!--
  <link rel="alternate stylesheet" title="CSS3 Unmodified"       type="text/css" media="screen" href="style/default.css"/>
  <link rel="alternate stylesheet" title="SVG 1.1"               type="text/css" media="screen" href="style/svg-style.css"/>
  -->
  <!-- W3C style sheet will be added here during processing. -->
</head>
<body>

<h1>Scripting</h1>

<h2 id="ScriptElement">The <span class="element-name">'script'</span> element</h2>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Consider allowing async/defer on <a>'script'</a>.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2012/01/05-svg-irc#T21-07-03">SVG 2 will allow async/defer on <span class="element-name">'script'</span>.</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>To align with HTML.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Cameron (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3280">ACTION-3280</a>)</td>
    </tr>
  </table>
</div>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Incorporate SVG Tiny 1.2 script processing model.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2012/03/08-svg-irc#T21-09-09">SVG 2 will define how inline scriptable content will be processed, in a compatible way to HTML5</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>To have consistent script running behavior across HTML and SVG.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Cameron (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3282">ACTION-3282</a>)</td>
    </tr>
  </table>
</div>

<p>A <a>'script'</a> element is equivalent to the <a>'script'</a> element in
HTML and thus is the place for scripts (e.g., ECMAScript). Any functions
defined within any <a>'script'</a> element have a "global" scope across the
entire current document.</p>

<p id="ExampleScript01"><span class="example-ref">Example script01</span>
defines a function <code>circle_click</code> which is called by the
<a>'onclick'</a> event attribute on the <a>'circle'</a> element. The drawing
below on the left is the initial image. The drawing below on the right shows
the result after clicking on the circle.</p>

<p id="ScriptElementExecution">Before attempting to execute the <a>'script'</a>
element the resolved media type value for <a>'script/type'</a> must be inspected.
If the <a>SVG user agent</a> does not support the scripting language then the
<a>'script'</a> element must not be executed.</p>

<pre class="xml"><![CDATA[
<?xml version="1.0" standalone="no"?>
<svg width="6cm" height="5cm" viewBox="0 0 600 500"
     xmlns="http://www.w3.org/2000/svg">
  <desc>Example script01 - invoke an ECMAScript function from an onclick event
  </desc>
  <!-- ECMAScript to change the radius with each click -->
  <script type="application/ecmascript"> ]]>&lt;![CDATA[<![CDATA[
    function circle_click(evt) {
      var circle = evt.target;
      var currentRadius = circle.getAttribute("r");
      if (currentRadius == 100)
        circle.setAttribute("r", currentRadius*2);
      else
        circle.setAttribute("r", currentRadius*0.5);
    }
  ]]>]]&gt;<![CDATA[ </script>

  <!-- Outline the drawing area with a blue line -->
  <rect x="1" y="1" width="598" height="498" fill="none" stroke="blue"/>

  <!-- Act on each click event -->
  <circle onclick="circle_click(evt)" cx="300" cy="225" r="100"
          fill="red"/>

  <text x="300" y="480"
        font-family="Verdana" font-size="35" text-anchor="middle">

    Click on circle to change its size
  </text>
</svg>
]]></pre>

<!--
  It would be good to replace this markup with an <edit:example>, but that
  currently doesn't support multiple images like this example needs.
  -->
<table >
  <caption>Example script01</caption>
  <tbody>
    <tr>
      <td><img alt="Example script01 — invoke an ECMAScript function from an onclick event — before first click" src="images/script/script01.png"/>&nbsp;<img alt="Example script01 — invoke an ECMAScript function from an onclick event — after first click" src="images/script/script01-AfterClick.png"/></td>
    </tr>
  </tbody>
</table>
<p class="view-as-svg"><a href="images/script/script01.svg">View this example as SVG (SVG-enabled browsers only)</a></p>


<edit:elementsummary name='script'/>

<p><em>Attribute definitions:</em></p>

<dl class="attrdef-list">
  <dt>
    <table class="propdef attrdef">
      <tr>
        <th>Name</th>
        <th>Value</th>
        <th>Lacuna value</th>
        <th>Animatable</th>
      </tr>
      <tr>
        <td><dfn data-dfn-type="element-attr" data-dfn-for="script" id="ScriptElementCrossoriginAttribute">crossorigin</dfn></td>
        <td>[ anonymous | use-credentials ]</td>
        <td>anonymous</td>
        <td>yes</td>
      </tr>
    </table>
  </dt>
  <dd>
    <p>The crossorigin attribute is a <a>CORS settings attribute</a>, and unless otherwise specified follows the same processing rules as in html [<a href="refs.html#ref-HTML">HTML</a>].</p>
  </dd>
  <dt>
    <table class="propdef attrdef">
      <tr>
        <th>Name</th>
        <th>Value</th>
        <th>Lacuna value</th>
        <th>Animatable</th>
      </tr>
      <tr>
        <td><dfn id="ScriptElementTypeAttribute">type</dfn></td>
        <td>(see below)</td>
        <td>application/ecmascript</td>
        <td>no</td>
      </tr>
    </table>
  </dt>
  <dd>
    Identifies the scripting language for the given <a>'script'</a> element. The value
    must be a valid media type, per
    <a href="http://www.ietf.org/rfc/rfc2046.txt">Multipurpose Internet Mail Extensions
    (MIME) Part Two</a> [<a href="refs.html#ref-RFC2046">RFC2046</a>].
    If a <a>'script/type'</a> is not provided, then the default scripting
    language assumed is ECMAScript, as if processed with the
    <span class="attr-name">'application/ecmascript'</span> media type.
  </dd>
  <dt>
    <table class="propdef attrdef">
      <tr>
        <th>Name</th>
        <th>Value</th>
        <th>Lacuna value</th>
        <th>Animatable</th>
      </tr>
      <tr>
        <td><dfn id="ScriptElementHrefAttribute">href</dfn></td>
        <td>URL <a href="types.html#attribute-url" class="syntax">[URL]</a></td>
        <td>(none)</td>
        <td>no</td>
      </tr>
    </table>
  </dt>
  <dd>
    An <a href="linking.html#URLReference">URL reference</a> to an external
    resource containing the script code.
    Refer to the common handling defined for <a
    href="linking.html#linkRefAttrs">URL reference attributes</a> and
    <a href="linking.html#XLinkRefAttrs">deprecated XLink attributes</a>.
    <p>To get the referenced resource, do a <a>potentially CORS-enabled fetch</a> of the absolute URL that resulted from the earlier step, with the <em>mode</em> being the current state of the
    element's <a>'script/crossorigin'</a> attribute, the <em>origin</em> being the <a>origin</a> of the <a>'script'</a> element's <a>Document</a>, and the <em>default origin behaviour</em> set to <em>taint</em>.
    For <a>origin</a>, the rules defined for the html <a href="http://www.w3.org/TR/html5/scripting-1.html#the-script-element">'script'</a> element apply the same way to the svg <a>'script'</a> element.
    </p>
  </dd>
</dl>

<h2 id="DOMInterfaces">DOM interfaces</h2>

<h3 id="InterfaceSVGScriptElement">Interface SVGScriptElement</h3>

<edit:with element="script">

<p>The <a>SVGScriptElement</a> interface corresponds to the <a>'script'</a> element.</p>

<pre class="idl">interface <b>SVGScriptElement</b> : <a>SVGElement</a> {
  attribute DOMString <a href="script.html#__svg__SVGScriptElement__type">type</a>;
  attribute DOMString <a href="script.html#__svg__SVGScriptElement__crossOrigin">crossOrigin</a>;
};

<a>SVGScriptElement</a> implements <a>SVGURIReference</a>;</pre>

<dl class="interface">
  <dt class="attributes-header">Attributes:</dt>
  <dd>
    <dl class="attributes">
      <dt id="__svg__SVGScriptElement__type" class="attribute first-child"><b>type</b><span class="idl-type-parenthetical"> (DOMString)</span></dt>
      <dd class="attribute">
        <div>Corresponds to attribute <a>'type'</a> on the given <a>'script'</a>
        element.</div>
      </dd>
      <dt id="__svg__SVGScriptElement__crossOrigin" class="attribute"><b>crossOrigin</b><span class="idl-type-parenthetical"> (DOMString)</span></dt>
      <dd class="attribute">
        <div>The crossOrigin IDL attribute must <a>reflect</a> the <a>'crossorigin'</a> attribute on the given <a>'script'</a> element, <a>limited to only known values</a>.</div>
      </dd>
    </dl>
  </dd>
</dl>

</edit:with>

<h3 id="InterfaceSVGZoomEvent">Interface SVGZoomEvent</h3>

<p>A DOM consumer can use the hasFeature of the DOMImplementation interface
to determine whether the SVG zoom event set has been implemented by a DOM
implementation. The feature string for this event set is "SVGZoomEvents".
This string is also used with the createEvent method.</p>

<p>The zoom event handler occurs before the zoom event is processed. The
remainder of the DOM represents the previous state of the document. The
document will be updated upon normal return from the event handler.</p>

<p>The UI event type for a zoom event is:</p>

<dl>
  <dt><strong>SVGZoom</strong></dt>
  <dd>The zoom event occurs when the user initiates an action
  which causes the current view of the SVG document fragment
  to be rescaled. Event handlers are only recognized on <a>'svg'</a> elements. See <a href="interact.html#ZoomEvent">SVGZoom event</a>.

    <ul>
      <li>Bubbles: Yes</li>
      <li>Cancelable: No</li>
      <li>Context Info: zoomRectScreen, previousScale,
      previousTranslate, newScale, newTranslate, screenX,
      screenY, clientX, clientY, altKey, ctrlKey, shiftKey,
      metaKey, relatedNode.<br/>
      (screenX, screenY, clientX and clientY indicate the
      center of the zoom area, with clientX and clientY in
      viewport coordinates for the corresponding <a>'svg'</a> element. relatedNode is
      the corresponding <a>'svg'</a>
      element.)</li>
    </ul>
  </dd>
</dl>

<pre class="idl">interface <b>SVGZoomEvent</b> : UIEvent {
  readonly attribute <a>DOMRectReadOnly</a> <a href="script.html#__svg__SVGZoomEvent__zoomRectScreen">zoomRectScreen</a>;
  readonly attribute float <a href="script.html#__svg__SVGZoomEvent__previousScale">previousScale</a>;
  readonly attribute <a>DOMPointReadOnly</a> <a href="script.html#__svg__SVGZoomEvent__previousTranslate">previousTranslate</a>;
  readonly attribute float <a href="script.html#__svg__SVGZoomEvent__newScale">newScale</a>;
  readonly attribute <a>DOMPointReadOnly</a> <a href="script.html#__svg__SVGZoomEvent__newTranslate">newTranslate</a>;
};</pre>

<dl class="interface">
  <dt class="attributes-header">Attributes:</dt>
  <dd>
    <dl class="attributes">
      <dt id="__svg__SVGZoomEvent__zoomRectScreen" class="attribute first-child"><b>zoomRectScreen</b><span class="idl-type-parenthetical"> (readonly <a>DOMRectReadOnly</a>)</span></dt>
      <dd class="attribute">
        <div>
          <p>The specified zoom rectangle in screen units.</p>
          <p>The <a>DOMRectReadOnly</a> object is read only.</p>
        </div>
      </dd>
      <dt id="__svg__SVGZoomEvent__previousScale" class="attribute"><b>previousScale</b><span class="idl-type-parenthetical"> (readonly float)</span></dt>
      <dd class="attribute">
        <div>The scale factor from previous zoom operations that was in place before
        the zoom operation occurred.</div>
      </dd>
      <dt id="__svg__SVGZoomEvent__previousTranslate" class="attribute"><b>previousTranslate</b><span class="idl-type-parenthetical"> (readonly <a>DOMPointReadOnly</a>)</span></dt>
      <dd class="attribute">
        <div>
          <p>The translation values from previous zoom operations that were in
          place before the zoom operation occurred.</p>
          <p>The <a>DOMPointReadOnly</a> object is read only.</p>
        </div>
      </dd>
      <dt id="__svg__SVGZoomEvent__newScale" class="attribute"><b>newScale</b><span class="idl-type-parenthetical"> (readonly float)</span></dt>
      <dd class="attribute">
        <div>The scale factor that will be in place after the zoom operation has been processed.</div>
      </dd>
      <dt id="__svg__SVGZoomEvent__newTranslate" class="attribute"><b>newTranslate</b><span class="idl-type-parenthetical"> (readonly <a>DOMPointReadOnly</a>)</span></dt>
      <dd class="attribute">
        <div>
          <p>The translation values that will be in place after the zoom
          operation has been processed.</p>
          <p>The <a>DOMPointReadOnly</a> object is read only.</p>
        </div>
      </dd>
    </dl>
  </dd>
</dl>

</body>
</html>
