<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional+edit//EN" "xhtml1-transitional+edit.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:edit="http://xmlns.grorg.org/SVGT12NG/">
<head>
  <title>Text</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link rel="stylesheet"           title="Default"               type="text/css" media="screen" href="style/default_svg.css"/>
  <link rel="alternate stylesheet" title="No issues/annotations" type="text/css" media="screen" href="style/default_no_issues.css"/>
  <!--
  <link rel="alternate stylesheet" title="CSS3 Unmodified"       type="text/css" media="screen" href="style/default.css"/>
  <link rel="alternate stylesheet" title="SVG 1.1"               type="text/css" media="screen" href="style/svg-style.css"/>
  -->
  <!-- W3C style sheet will be added here during processing. -->
</head>
<body>

<h1>Text</h1>

<h2 id="Introduction">Introduction</h2>

  <p>
    Text that is to be rendered as part of an SVG document fragment is
    specified using the <a>'text'</a> element. The text within a
    <a>'text'</a> element can be rendered:
  </p>
  <ul>
    <li>pre-formatted (with limited line wrapping),</li>
    <li>auto-wrapped (if a <a>content area</a> is provided),</li>
    <li>on a path (if a <a>'textPath'</a> element is provided).</li>
  </ul>

  <p>
    The section <a href="text.html#TextLayout">Text layout</a> gives an
    introduction to text layout. It is followed by sections covering
    <a href="text.html#TextLayoutContentArea">content areas</a> and
    the <a href="text.html#TextLayoutAlgorithm">algorithm</a> for
    laying out text within a <a>content area</a>.
    The specialized layout rules corresponding to text that is
    <a href="text.html#TextLayoutPre">pre-formatted</a>,
    <a href="text.html#TextLayoutAuto">auto-wrapped</a>, and
    <a href="text.html#TextLayoutPath">on a path</a>
    are then addressed in individual sections.
  </p>

  <p class="note">
    Rules for text layout in SVG 1.1 are mostly defined within the SVG
    1.1 specification. The rules mirror to a large extent those found
    in CSS. In SVG 2, the dependence on CSS is more explicit. In
    practice the end layout is the same. The change to directly
    relying on CSS specifications simplifies the SVG specification
    while making it more obvious that rendering agents can use the
    same code to both render text in HTML and in SVG. In particular,
    SVG 2 auto-wrapped text is based on CSS text layout.
  </p>

  <p>
    SVG's <a>'text'</a> elements are rendered like other graphics
    elements. Thus, <a href="coords.html">coordinate system
    transformations</a>, <a href="painting.html">painting</a>,
    <a href="render.html#ClippingAndMasking">clipping</a> and
    <a href="render.html#ClippingAndMasking">masking</a> features apply to
    <a>'text'</a> elements in the same way as they apply to
    <a>shapes</a> such as
    <a href="paths.html">paths</a> and <a href="shapes.html#RectElement">rectangles</a>.
  </p>

  <p>
    SVG text supports advanced typographic features including:
  </p>
  <ul>
    <li>choice of typeface,</li>

    <li>use of discretionary, historical, or stylistic ligatures,</li>

    <li>text decorations (underlining, over-lining, etc.).</li>
  </ul>

  <p>
    SVG text supports international text processing needs such as:
  </p>
  <ul>
    <li>horizontal and vertical orientation of text,</li>

    <li>left-to-right or bidirectional text (i.e., languages
    which intermix right-to-left and left-to-right text, such as
    Arabic and Hebrew),</li>

    <li>
      complex text layout where: there is not always a one-to-one
      correspondence between characters and glyphs, characters
      may change shape depending on location (e.g. Arabic), and
      characters may be reordered or combined depending on context
      (e.g. Devanagari),
    </li>

    <li>
      glyph alignment to different baselines (<em>alphabetic</em> for
      western scripts, <em>hanging</em> for northern indic scripts,
      and <em>ideographic</em> for far-eastern scripts).
    </li>
  </ul>

  <p>
    Multi-language SVG content is possible by
    <a href="struct.html#SwitchElement">substituting different
    text strings based on the user's preferred language</a>.
  </p>

  <p>
    The characters to be drawn are expressed as
    <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#syntax">XML
    character data</a> ([<a href="refs.html#ref-XML10">XML10</a>],
    section 2.4) inside the <a>'text'</a> element. As a result:
  </p>

  <ul>
    <li>
      Text data in SVG content is readily accessible to the visually
      impaired (see <a href="access.html">Accessibility
      Support</a>),
    </li>

    <li>
      In many viewing scenarios, the user will be able to search for
      and select text strings and copy selected text strings to the
      system clipboard (see <a href="text.html#TextSelection">Text
      selection and clipboard operations</a>),
    </li>

    <li>
      XML-compatible Web search engines will find text strings in
      SVG content with no additional effort over what they need to
      do to find text strings in other XML documents.
    </li>
  </ul>

  <p>
    For accessibility reasons, it is recommended that text which is
    included in a document have appropriate semantic markup to
    indicate its function.
    See <a href="access.html">SVG
    accessibility guidelines</a> for more information.
  </p>

<h3 id="Definitions">Definitions</h3>

  <dl class='definitions'  data-dfn-type="dfn" data-export="">

    <dt id="TermFont">font</dt>
    <dd>
      A font represents an organized collection of <a>glyphs</a> in
      which the various glyph representations will share a particular
      look or styling.
    </dd>

    <dt id="TermCharacter">character</dt>
    <dd>
      A character is an atomic unit of text as defined in XML
      [<a href="http://www.w3.org/TR/2008/REC-xml-20081126/">XML10</a>].
    </dd>

    <dt id="TermGlyph">glyph</dt>
    <dd>
      A glyph represents a unit of rendered content within a
      <a>font</a>. Often, there is a one-to-one correspondence between
      characters to be drawn and corresponding glyphs (e.g., often,
      the character "A" is rendered using a single glyph), but other
      times multiple glyphs are used to render a single character
      (e.g., use of accents) or a single glyph can be used to render
      multiple characters (e.g., ligatures). Typically, a glyph is
      defined by one or more <a>shapes</a> such as
      a <a href="paths.html">path</a>, possibly with additional
      information such as rendering hints that help a font engine to
      produce legible text in small sizes.
    </dd>

    <dt id="TermTextContentElement">text content element</dt>
    <dd>
      A text content element is an SVG element that causes a text
      string to be rendered onto the canvas. The SVG text content
      elements are:
      <edit:elementcategory name='text content'/>
    </dd>

    <dt id="TermTextContentChildElement">text content child element</dt>
    <dd>
      A text content child element is a <a>text content element</a>
      that is allowed as a descendant of another <a>text content
      element</a>. In SVG the text content child elements are:
      <edit:elementcategory name='text content child'/>
    </dd>

    <dt id="TermTextContentBlockElement">text content block element</dt>
    <dd>
      A text content block element is a <a>text content element</a>
      that serves as a standalone element for a unit of text, and
      which may optionally contain certain child <a>text content
      elements</a> (e.g.
      <a href="text.html#TextElement"><span class="element-name">'tspan'</span></a>).
      <!--SVG Tiny 1.2 defines two text content block elements:
	<a href="text.html#TextElement"><span class="element-name">'text'</span></a>
	and
	<a href="text.html#TextAreaElement"><span class="element-name">'textArea'</span></a>-->
      SVG 2 defines a single text content block element: <a>'text'</a>.
    </dd>

    <dt id="TermContentArea">content area</dt>
    <dd>
      The area in which the text is normally layed out. This is
      equivalent to the
      <a href="http://www.w3.org/TR/css3-exclusions/#content-area">CSS
      content area</a>. The actual region where text layout occurs may
      be smaller due to padding and/or exclusions.
      <!-- CSS 2 reference: href="http://www.w3.org/TR/CSS2/box.html#box-dimensions" -->
    </dd>

    <dt id="TermWrappingContext">wrapping context</dt>
    <dd>
      One or more regions (shapes) to be excluded from the content
      area during text layout. This is the same as the
      <a href="http://www.w3.org/TR/css3-exclusions/#wrapping-context">
	CSS wrapping context</a>.
    </dd>

    <dt id="TermWrappingArea">wrapping area</dt>
    <dd>
      The area in which the text is layed out after subtracting any
      padding or exclude areas (<a>wrapping context</a>). This is the
      same as the
      <a href="http://www.w3.org/TR/css3-exclusions/#wrapping-area">
	CSS wrapping area</a>.
    </dd>

    <!-- The following two terms are taken from CSS Writing Modes 3, simplified for SVG.-->
    <dt id="TermInlineBaseDirection">inline-base direction</dt>
    <dd>
      The primary direction in which content is ordered within a line
      or part of a line of text. It defines the <q>start</q> and
      <q>end</q> sides of a line or part of a line of text (relevant,
      for example to how the <a>'text-anchor'</a> property is
      applied). It is determined by the <a>'direction'</a> property.
      (Note: the ordering of glyphs in a line of text is primary
      controlled by the Unicode bidi algorithm and not the inline-base
      direction.)
    </dd>

    <dt id="TermBlockFlowDirection">block-flow direction</dt>
    <dd>
      The direction in which lines are stacked. It is determined by
      the <a>'writing-mode'</a> property.
    </dd>

    <dt id="TermWhiteSpaceCharacter">white space characters</dt>
    <dd>The following characters are considered white space characters:
      U+0009 CHARACTER TABULATION,
      U+000C FORM FEED (FF),
      U+000D CARRIAGE RETURN (CR),
      U+000A LINE FEED (LF) and
      U+0020 SPACE.
    </dd>

  </dl>

<h2 id="FontsTablesBaselines">Fonts, font tables and baselines</h2>

  <p>
    A font consists of a collection of glyphs together with other
    information (collectively, the font tables) necessary to use those
    glyphs to present characters on some visual medium. The
    combination of the collection of glyphs and the font tables is
    called the <em>font data</em>.
  </p>

  <p>
    A font may supply supply substitution and positioning tables that
    can be used by a formatter (shaper) to re-order, combine and
    position a sequence of glyphs to make one or more composite
    glyphs. The combination may be as simple as a ligature, or as
    complex as an indic syllable which combines, usually with some
    re-ordering, multiple consonants and vowel glyphs. The tables may
    be language dependent allowing the use of language appropriate
    letter forms.
  </p>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Include explicit support for Web Open Font Format (WOFF).</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2011/03/01-svg-minutes.html#item03">We will mandate WOFF support in SVG 2.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>To allow access to full OpenType features for internationalisation and advanced typography.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Chris (no action)</td>
      </tr>
    </table>
  </div>

  <p>
    Proper text rendering may depend on using the same font as used
    during authoring. For this reason SVG requires support for
    downloadable fonts as defined in the
    <a href="http://dev.w3.org/csswg/css-fonts-3/#font-resources">Font
    Resources</a> section of the
    <a href="http://dev.w3.org/csswg/css3-fonts/">CSS Fonts
    Module</a>. In particular, support for the Web Open Font Format
    [<a href="refs.html#ref-WOFF">WOFF</a>] is required.
  </p>

  <p class="note">
    New in SVG 2. WOFF allows authors to provide the fonts needed to
    properly render their content. This includes ensuring that the
    fonts have the proper OpenType tables to support complex scripts,
    discretionary ligatures, swashes, old-style numbers, and so
    on. WOFF also allows the fonts to be compressed, subsetted, and
    include licensing information.
  </p>

  <p>
    Glyph selection and positioning is normally handled according to
    the rules of CSS. In some cases, though, the final layout of text
    in SVG requires knowledge of the geometry properties of individual
    glyphs.
  </p>

  <p>
    The geometric font characteristics are expressed in a coordinate
    system based on the EM box. (The EM is a relative measure of the
    height of the glyphs in the font.)  The box 1 EM high and 1 EM
    wide is called the <em>design space</em>. This space is given a
    geometric coordinates by sub-dividing the EM into a number
    of <em>units per em</em>.
  </p>

  <p class="note">
    Units per em is a font characteristic. A typical value
    for units per em is 1000 or 2048.
  </p>

  <p>
    The coordinate space of the EM box is called the <em>design space
    coordinate system</em>. For scalable fonts, the curves and lines
    that are used to draw a glyph are represented using this
    coordinate system.
  </p>

  <p class="note">
    Most often, the (0,0) point in this coordinate system is
    positioned on the left edge of the EM box, but not at the bottom
    left corner. The Y coordinate of the bottom of a roman capital
    letter is usually zero. And the descenders on lowercase roman
    letters have negative coordinate values.
  </p>

  <div class="figure">
    <img class="bordered" src="images/text/font_embox.svg"
         alt="An 'M' inside an EM box showing the coordinate system, baseline,
	      ascent and descent."/>
    <p class="caption">
      An 'M' inside an Em box (blue square). The 'M' sits on the
      baseline (blue line). The origin of the coordinate system is
      shown by the small black circle.
    </p>
  </div>

  <p>
    SVG assumes that the font tables will provide at least three font
    characteristics: an ascent, a descent and a set of
    baseline-tables. The ascent is the distance to the top of the EM
    box from the (0,0) point of the font; the descent is the distance
    to the bottom of the EM box from the (0.0) point of the font. The
    baseline-table is explained below.
  </p>

  <p class="note">
    Within an OpenType font, for horizontal writing-modes,
    the ascent and descent are given by the sTypoAscender and
    sTypoDescender entries in the OS/2 table. For vertical writing-modes,
    the descent (the distance, in this case from the (0,0) point to the
    left edge of the glyph) is normally zero because the (0,0) point is on
    the left edge. The ascent for vertical writing-modes is either 1 em or
    is specified by the ideographic top baseline value in the OpenType
    Base table for vertical writing-modes.
  </p>

  <p>
    Glyphs are position relative to a particular point on each glyph
    known as the <em><dfn><a>alignment point</a></dfn></em>.  For
    horizontal writing-modes, the glyphs' alignment points are
    vertically aligned while for vertical writing-modes, they are
    horizontally aligned. The position of the alignment point depends
    on the script. For example, Western glyphs are aligned on the
    bottoms of the capital letters, northern indic glyphs are aligned
    at the top of a horizontal stroke near the top of the glyphs, and
    far-eastern glyphs are aligned either at the bottom or center of
    the glyph. Within a script and within a line of text having a
    single font-size, the sequence of alignment points defines, in the
    inline- progression-direction, a geometric line called
    a <em>baseline</em>. Western and most other alphabetic and
    syllabic glyphs are aligned to an "alphabetic" baseline, the
    northern indic glyphs are aligned to a "hanging" baseline and the
    far-eastern glyphs are aligned to an "ideographic" baseline.
  </p>

  <div class="figure">
    <img class="bordered" src="images/text/font_baseline.svg"
         alt="Baseline example in three different scripts."/>
    <p class="caption">
      Example baselines (red lines) in three different scripts. From
      left to right: alphabetic, hanging, ideographic. The EM box is
      shown in blue for the ideographic script.
    </p>
  </div>

  <p>
    As glyphs are sequencially placed along a baseline, the
    alignment point of a glyph is typically positioned at the
    <dfn><a>current text position</a></dfn>. After each glyph is
    placed, the <a>current text position</a> is advanced by the
    glyph's <em>advance</em> value (typically the width for horizontal
    text or height for vertical text) with any correction for kerning
    or other spacing adjustment. The initial and final current text
    positions are used for alignment (e.g. when the
    <a>'text-anchor'</a> value is either 'start' or 'end').  The
    glyph's width is needed when placing text along a path.
  </p>

  <div class="figure">
    <img class="bordered" src="images/text/font_metrics.svg"
         alt="Baseline example in three different scripts."/>
    <p class="caption">
      Example of font metrics. The blue boxes show the geometric
      boxes for the three glyphs. The labeled small circles show the
      <a>current text position</a> before glyph placement. The
      small square shows the final <a>current text position</a>
      after placing the last glyph. Note that the left side of
      the 'a' glyph's box is not aligned with the right side of
      the 'V' glyph's box due to kerning.
    </p>
  </div>

  <p>
    A <em>baseline-table</em> specifies the position of one or more
    baselines in the design space coordinate system. The function of
    the baseline table is to facilitate the alignment of different
    scripts with respect to each other when they are mixed on the same
    text line. Because the desired relative alignments may depend on
    which script is dominant in a line (or block), there may be a
    different baseline table for each script. In addition, different
    alignment positions are needed for horizontal and vertical writing
    modes. Therefore, the font may have a set of baseline tables:
    typically, one or more for horizontal writing-modes and zero or
    more for vertical writing-modes.
  </p>

  <p class="note">
    Some fonts may not have values for the baseline tables. Heuristics
    are suggested for approximating the baseline tables when a given
    font does not supply baseline tables.
  </p>

  <p>
    SVG further assumes that for each glyph in the font data for a
    font, there are two width values, two alignment-baselines and two
    alignment points, one each for horizontal writing-modes and the
    other for vertical writing-modes. (Even though it is specified as
    a width, for vertical writing-modes the width is used in the
    vertical direction.) The script to which a glyph belongs
    determines an alignment-baseline to which the glyph is to be
    aligned. The
    <a href="text.html#InlineProgressionDirection">inline-progression-direction</a>
    position of the alignment point is on the start-edge of the glyph.
  </p>

  <p>
    Properties related to baselines are described below under
    <a href="text.html#BaselineAlignmentProperties">Baseline alignment
      properties</a>. Additional information on baselines can be found
    in the
    <a href="http://dev.w3.org/csswg/css-inline/#line-height">CSS
      Inline Layout Module Level 3</a> specification.
    <span class="issue">Update to www.w3.org/TR when available.</span>
    [<a href="refs.html#ref-CSS3INLINE">CSS3INLINE</a>]
    (Also see: <a href="http://www.w3.org/TR/css3-writing-modes/#intro-baselines">CSS
      Writing Modes Level 3</a> specification.
    [<a href="refs.html#ref-CSSWRITINGMODES3">CSSWRITINGMODES3</a>])
  </p>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Support text aligned to different baselines.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2012/03/15-svg-irc#T21-07-21">SVG 2 will support glyphs being aligned to different baselines, perhaps by using existing or improved CSS properties.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>To allow glyphs in horizontal text to have different vertical alignments for stylistic effects.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Chris (no action)</td>
      </tr>
    </table>
  </div>

<h2 id="TextElement">The <span class="element-name">'text'</span> and
  <span class="element-name">'tspan'</span> elements</h2>

  <p>
    The <a>'text'</a> element defines a graphics element consisting of
    text. The <a>'tspan'</a> element within a <a>'text'</a> or another
    <a>'tspan'</a> element, allows one to switch the style and/or
    adjust the position of the rendered text inside the <a>'tspan'</a>
    element relative to the parent element.
  </p>
  <p>
    The XML character data within the <a>'text'</a> and <a>'tspan'</a>
    elements,
    along with relevant attributes and properties, and
    character-to-glyph mapping tables within the font itself, define
    the glyphs to be rendered. The attributes and properties on
    the <a>'text'</a> and <a>'tspan'</a> elements indicate such things
    as the writing direction, font specification, and painting
    attributes which describe how exactly to render the
    characters. Subsequent sections of this chapter describe the
    relevant text-specific attributes and properties.
  </p>

  <p>
    Since <a>'text'</a> and <a>'tspan'</a> elements are rendered using
    the same rendering methods as other graphics elements, all of the
    same
    <a href="coords.html">coordinate system transformations</a>, and
    <a href="painting.html">painting</a> features that apply to
    <a>shapes</a> such as <a href="paths.html">paths</a> and 
    <a href="shapes.html#RectElement">rectangles</a> also apply to
    <a>'text'</a> and <a>'tspan'</a> elements. In addition,
    <a href="render.html#ClippingAndMasking">clipping</a>, and
    <a href="render.html#ClippingAndMasking">masking</a> can be applied
    to the <a>'text'</a> element as a whole.
  </p>

  <p id="ObjectBoundingBoxUnitsTextObjects">
    It is possible to apply a gradient, pattern, clipping path, mask
    or filter to text. When one of these facilities is applied to text
    and keyword <span class="attr-value">'objectBoundingBox'</span> is
    used (see
    <a href="coords.html#ObjectBoundingBox">Object bounding box
    units</a>) to specify a graphical effect relative to the "object
    bounding box", then the object bounding box units are computed
    relative to the entire <a>'text'</a> element in all cases, even
    when different effects are applied to different <a>'tspan'</a>
    elements within the same <a>'text'</a> element.
  </p>

  <p>
    The <a>'text'</a> element renders its first glyph (after
    bidirectionality
    reordering) at the initial <a>current text position</a> (with
    possible adjustments due to the value of the
    <a>'text-anchor'</a> property or the <a>'text-align'</a> property).
    For pre-formatted text and for auto-wrapped text where the
    <a>content area</a> is determined by the <a>'inline-size'</a>
    property, the initial <a>current text
    position</a> is determined by the <a>'tspan/x'</a> and
    <a>'tspan/y'</a> values of the <a>'text'</a> or <a>'tspan'</a>
    element which contains the first rendered character.

    For auto-wrapped text in a shape or text on a path see
    the <a href="text.html#TextLayoutAuto">Auto-wrapped text</a> or
    <a href="text.html#TextLayoutPath">Text on a path</a> sections,
    respectively, to determine the initial <a>current text
    position</a>.

    After the glyph(s) corresponding to the given character is (are)
    rendered, the current text position is updated for the next
    character. In the simplest case, the new current text position is
    the previous current text position plus the glyphs' advance value
    (horizontal or vertical). See
    <a href="text.html#TextLayoutAlgorithm">text layout</a> for a description
    of glyph placement and glyph advance.
  </p>

  <div class="example">
    <p>
      The text string <q>Hello, out there!</q> is rendered onto the
      canvas using the Verdana font family with the glyphs filled
      with the color blue.
    </p>
    <edit:includefile href='images/text/text01.svg' image='yes' link='yes'/>
    <div class="figure">
      <img class="bordered" src="images/text/text01.svg"
	   alt="Image showing the blue text."/>
    </div>
  </div>

  <div class="example">
    <p>
      A <a>'tspan'</a> is used to change the styling of the word <q>not</q>.
    </p>
    <edit:includefile href='images/text/tspan01.svg' image='yes' link='yes'/>
    <div class="figure">
      <img class="bordered" src="images/text/tspan01.svg"
	   alt="Blue text except the word 'not' is red."/>
    </div>
  </div>

  <div class="example">
    <p>
      Two <a>'tspan'</a> elements are repositioned horizontally and
      vertically using the <a>'text/x'</a> and <a>'text/y'</a>
      attributes. Because all the text is within a single
      <a>'text'</a> element, a user will be able to select through all
      the text and copy it to the system clipboard in user agents that
      support <a href="text.html#TextSelection">text selection and
      clipboard operations</a>.
    </p>
    <edit:includefile href='images/text/tspan02.svg' image='yes' link='yes'/>
    <div class="figure">
      <img class="bordered" src="images/text/tspan02.svg"
	   alt="A sentence with several shifted words."/>
    </div>
  </div>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Allow transforms on <a>'tspan'</a>.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2011/12/01-svg-irc#T21-02-34">SVG 2 will allow transforms on <span class="element-name">'tspan'</span>.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>Align with other elements such as <a>'a'</a> which already allow transforms.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Cameron (no action)</td>
      </tr>
    </table>
  </div>

  <edit:with element='text'>
  <edit:elementsummary name='text'/>

<h3 id="TSpanAttributes">Attributes</h3>

  <dl class="attrdef-list-svg2">

    <dt>
      <table class="propdef attrdef">
	<tr>
          <th>Name</th>
          <th>Value</th>
          <th>Initial value</th>
          <th>Animatable</th>
	</tr>
	<tr>
          <td><dfn data-dfn-type="element-attr" data-dfn-for="text" id="TextElementXAttribute">x</dfn>, <dfn data-dfn-type="element-attr" data-dfn-for="text" id="TextElementYAttribute">y</dfn></td>
          <td>[<a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> | <a>&lt;number&gt;</a>]#+ ,?</td>
          <td>0</td>
          <td>yes</td>
	</tr>
      </table>
    </dt>
    <dd>
      <p>
	If a single
	<a>&lt;length&gt;</a> is
        provided, then the value represents the new absolute X (Y)
        coordinate for the <a>current text position</a> for rendering
        the glyphs that correspond to the first character within this
        element or any of its descendants.
      </p>
      <p>
	If a comma- or space-separated list of <var>n</var>
	<a>&lt;length&gt;</a>s is provided, then the values represent
        new absolute X (Y) coordinates for the <a>current text
        position</a> for rendering the glyphs corresponding to each of
        the first <var>n</var> characters within this element or any
        of its descendants.
      </p>
      <p>
	If more <a>&lt;length&gt;</a>s are provided than characters,
        then the extra <a>&lt;length&gt;</a>s will have no effect on
        glyph positioning.
      </p>
      <p>
	If more characters exist than <a>&lt;length&gt;</a>s, then for
	each of these extra characters:

	(a) if an ancestor <a>'text'</a> or <a>'tspan'</a> element
        specifies an absolute X (Y) coordinate for the given character
        via an <span class="attr-name">'x'</span>
        (<span class="attr-name">'y'</span>) attribute, then that
        absolute X (Y) coordinate is used as the starting X (Y)
        coordinate for that character (nearest ancestor has
        precedence), else
        
	(b) the starting X (Y) coordinate for rendering the glyphs
        corresponding to the given character is the X (Y) coordinate
        of the resulting <a>current text position</a> from the most
        recently rendered glyph for the current <a>'text'</a> element.
      </p>
      <p>
        If the attribute is not specified:

	(a) if an ancestor <a>'text'</a> or <a>'tspan'</a> element
        specifies an absolute X (Y) coordinate for a given character
        via an <span class="attr-name">'x'</span>
        (<span class="attr-name">'y'</span>) attribute, then that
        absolute X (Y) coordinate is used (nearest ancestor has
        precedence), else

        (b) the starting X (Y) coordinate for rendering the glyphs
        corresponding to a given character is the X (Y) coordinate of
        the resulting <a>current text position</a> from the most
        recently rendered glyph for the current <a>'text'</a> element.
      </p>
      <p class="note">
	In SVG 2, the <a>'text'</a> and <a>'tspan'</a> <a>'text/x'</a>
	and <a>'text/y'</a> attributes are not presentation attributes
	and cannot be set via CSS. This may change in a future version
	of SVG.
      </p>
    </dd>

    <dt>
      <table class="propdef attrdef">
	<tr>
          <th>Name</th>
          <th>Value</th>
          <th>Initial value</th>
          <th>Animatable</th>
	</tr>
	<tr>
          <td><dfn data-dfn-type="element-attr" data-dfn-for="text" id="TextElementDXAttribute">dx</dfn>, <dfn data-dfn-type="element-attr" data-dfn-for="text" id="TextElementDYAttribute">dy</dfn></td>
          <td>[<a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> | <a>&lt;number&gt;</a>]#+ ,?</td>
          <td>See below</td>
          <td>yes</td>
	</tr>
      </table>
    </dt>
    <dd>
      <p>
	If a single <a>&lt;length&gt;</a> is provided, this value
        represents the new relative X (Y) coordinate for the <a>current
        text position</a> for rendering the glyphs corresponding to
        the first character within this element or any of its
        descendants. The <a>current text position</a> is shifted along
        the x-axis (y-axis) of the current user coordinate system
        by <a>&lt;length&gt;</a> before the first character's glyphs
        are rendered.
      </p>
      <p>
        If a comma- or space-separated list of <var>n</var>
	<a>&lt;length&gt;</a>s is provided, then the values represent
        incremental shifts along the x-axis (y-axis) for
        the <a>current text position</a> before rendering the glyphs
        corresponding to the first <var>n</var> characters within this
        element or any of its descendants. Thus, before the glyphs are
        rendered corresponding to each character, the <a >current text
        position</a> resulting from drawing the glyphs for the
        previous character within the current <a>'text'</a> element is
        shifted along the x-axis (y-axis) of the current user
        coordinate system by <a>&lt;length&gt;</a>.
      </p>
      <p>
        If more <a>&lt;length&gt;</a>s are provided than characters,
        then any extra <a>&lt;length&gt;</a>s will have no effect on
        glyph positioning.
      </p>
      <p>
	If more characters exist than <a>&lt;length&gt;</a>s, then for
        each of these extra characters:

	(a) if an ancestor <a>'text'</a> or <a>'tspan'</a> element
        specifies a relative X (Y) coordinate for the given character
        via a <span class="attr-name">'dx'</span>
        (<span class="attr-name">'dy'</span>) attribute, then
        the <a >current text position</a> is shifted along the x-axis
        (y-axis) of the current user coordinate system by that amount
        (nearest ancestor has precedence), else

	(b) no extra shift along the x-axis (y-axis) occurs.
      </p>
      <p>
	If the attribute is not specified:

	(a) if an ancestor <a>'text'</a> or <a>'tspan'</a> element
        specifies a relative X (Y) coordinate for a given character via a
        <span class="attr-name">'dx'</span>
        (<span class="attr-name">'dy'</span>) attribute, then
        the <a>current text position</a> is shifted along the x-axis
        (y-axis) of the current user coordinate system by that amount
        (nearest ancestor has precedence), else

	(b) no extra shift along the x-axis (y-axis) occurs.
      </p>
    </dd>

    <dt>
      <table class="propdef attrdef">
	<tr>
          <th>Name</th>
          <th>Value</th>
          <th>Initial value</th>
          <th>Animatable</th>
	</tr>
	<tr>
          <td><dfn data-dfn-type="element-attr" data-dfn-for="text" id="TextElementRotateAttribute">rotate</dfn></td>
          <td><a>&lt;number&gt;</a>#+ ,?</td>
          <td>See below</td>
          <td>yes (non-additive).</td>
	</tr>
      </table>
    </dt>
    <dd>
      <p>
        The supplemental rotation about the <a>current text
        position</a> that will be applied to all of the glyphs
        corresponding to each character within this element.
      </p>
      <p>
        If a comma- or space-separated list of <a>&lt;number&gt;</a>s
        is provided, then the first <a>&lt;number&gt;</a> represents
        the supplemental rotation for the glyphs corresponding to the
        first character within this element or any of its descendants,
        the second <a>&lt;number&gt;</a> represents the supplemental
        rotation for the glyphs that correspond to the second
        character, and so on.
      </p>
      <p>
	If more <a>&lt;number&gt;</a>s are provided than there are
        characters, then the extra <a>&lt;number&gt;</a>s will be
        ignored.
      </p>
      <p>
	If more characters are provided than <a>&lt;number&gt;</a>s,
        then for each of these extra characters the rotation value
        specified by the last number must be used.
      </p>
      <p>
        If the attribute is not specified and if an ancestor of a
        <a>'tspan'</a> element specifies a supplemental rotation for a
        given character via a <a>'rotate'</a> attribute, then the
        given supplemental rotation is applied to the given character
        (nearest ancestor has precedence). If there are more
        characters than <a>&lt;number&gt;</a>s specified in the
        ancestor's <a>'rotate'</a> attribute, then for each of these
        extra characters the rotation value specified by the last
        number must be used.
      </p>
      <p>
        This supplemental rotation has no impact on the rules by
        which <a>current text position</a> is modified as glyphs get
        rendered and is supplemental to any rotation due to
        <a href="text.html#TextLayoutPath">text on a path</a> and
        to <a>'glyph-orientation-horizontal'</a>
        or <a>'glyph-orientation-vertical'</a>.
      </p>
    </dd>

    <dt>
      <table class="propdef attrdef">
	<tr>
          <th>Name</th>
          <th>Value</th>
          <th>Initial value</th>
          <th>Animatable</th>
	</tr>
	<tr>
          <td><dfn data-dfn-type="element-attr" data-dfn-for="text" id="TextElementTextLengthAttribute">textLength</dfn></td>
          <td><a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> | <a>&lt;number&gt;</a></td>
          <td>See below</td>
          <td>yes</td>
	</tr>
      </table>
    </dt>
    <dd>
      <p>
	The author's computation of the total sum of all of the
        advance values that correspond to character data within this
        element, including the advance value on the glyph (horizontal
        or vertical), the effect of properties <a>'letter-spacing'</a>
        and <a>'word-spacing'</a> and adjustments due to attributes
        <a>'dx'</a> and <a>'dy'</a> on this <a>'text'</a>
        or <a>'tspan'</a> element or any descendants. This value is
        used to calibrate the user agent's own calculations with that
        of the author.
      </p>
      <p>
        The purpose of this attribute is to allow the author to
        achieve exact alignment, in visual rendering order after
        any bidirectional
        reordering, for the first and last rendered glyphs that
        correspond to this element; thus, for the last rendered
        character (in visual rendering order after
        any bidirectional
        reordering), any supplemental inter-character spacing
        beyond normal glyph advances are ignored (in most cases) when
        the user agent determines the appropriate amount to
        expand/compress the text string to fit within a length of
        <a>'textLength'</a>.
      </p>
      <p>
        If attribute <a>'textLength'</a> is specified on a given
        element and also specified on an ancestor, the adjustments on
        all character data within this element are controlled by the
        value of <a>'textLength'</a> on this element exclusively, with
        the possible side-effect that the adjustment ratio for the
        contents of this element might be different than the
        adjustment ratio used for other content that shares the same
        ancestor. The user agent must assume that the total advance
        values for the other content within that ancestor is the
        difference between the advance value on that ancestor and the
        advance value for this element.
      </p>
      <p class="note">
	This attribute is not intended for use to obtain effects such
	as shrinking or expanding text.
      </p>
      <p>
	A negative value is an error
        (see <a href="implnote.html#ErrorProcessing">Error
        processing</a>).
      </p>
      <p>
	If the attribute is not specified anywhere within a
        <a>'text'</a> element, the effect is as if the author's
        computation exactly matched the value calculated by the user
        agent; thus, no advance adjustments are made.
      </p>
    </dd>

    <dt>
      <table class="propdef attrdef">
	<tr>
          <th>Name</th>
          <th>Value</th>
          <th>Initial value</th>
          <th>Animatable</th>
	</tr>
	<tr>
          <td><dfn data-dfn-type="element-attr" data-dfn-for="text" id="TextElementLengthAdjustAttribute">lengthAdjust</dfn></td>
          <td>spacing | spacingAndGlyphs</td>
          <td>spacing</td>
          <td>yes</td>
	</tr>
      </table>
    </dt>
    <dd>
      <dl class="attrdef-values">

	<dt>spacing</dt>
	<dd>
	  Indicates that only the advance values are adjusted. The
          glyphs themselves are not stretched or compressed.
	</dd>

	<dt>spacingAndGlyphs</dt>
	<dd>
	  Indicates that the advance values are adjusted and the
          glyphs themselves stretched or compressed in one axis (i.e.,
          a direction parallel to the inline-progression-direction).
	</dd>
      </dl>

      <p>
        The user agent is required to achieve correct start and end
        positions for the text strings, but the locations of
        intermediate glyphs are not predictable because user agents
        might employ advanced algorithms to stretch or compress text
        strings in order to balance correct start and end positioning
        with optimal typography.
      </p>
      <p>
        Note that, for a text string that contains <var>n</var>
        characters, the adjustments to the advance values often occur
        only for <var>n</var>âˆ’1 characters (see description of
        attribute <a>'textLength'</a>), whereas stretching or
        compressing of the glyphs will be applied to all <var>n</var>
        characters.
      </p>
    </dd>

  </dl>

<h3 id="TSpanNotes">Notes on 'x', 'y', 'dx', 'dy' and 'rotate'</h3>

  <p>
    The <a>'x'</a>, <a>'y'</a>, <a>'dx'</a>, <a>'dy'</a>, and
    <a>'rotate'</a> on the <a>'tspan'</a> element are useful in
    high-end typography scenarios where individual glyphs require
    exact placement. These attributes are useful for minor positioning
    adjustments between characters or for major positioning
    adjustments, such as moving a section of text to a new location to
    achieve the visual effect of a new line of text (compatable with
    SVG 1.1). Note that the <a>'x'</a>, <a>'y'</a>, <a>'dx'</a>,
    <a>'dy'</a>, and <a>'rotate'</a> attributes are
    ignored for auto-wrapped text (except for the initial <a>current
    text position</a> when the <a>content area</a> is specified by
    the <a>'inline-size'</a> property).
  </p>

  <p class="annotation" data-issue="2">
    It was decided at the 2015 Sydney F2F that 'dx', 'dy', and 'rotate'
    would be ignored for auto-wrapped text. (Technically, it is not
    difficult to apply them but it was not seen as being really useful.)
  </p>

  <p>
    In situations where micro-level positioning adjustment are
    necessary for advanced typographic control, the SVG content
    designer needs to ensure that the necessary font will be available
    for all viewers of the document (e.g., package up the necessary
    font data in the form of an SVG font or an alternative WebFont
    format which is stored at the same Web site as the SVG content)
    and that the viewing software will process the font in the
    expected way (the capabilities, characteristics and font layout
    mechanisms vary greatly from system to system). If the SVG content
    contains <a>'x'</a>, <a>'y'</a>, <a>'dx'</a>, or
    <a>'dy'</a> attribute values which are meant to correspond to a
    particular font processed by a particular set of viewing software
    and either of these requirements is not met, then the text might
    display with poor quality.
  </p>
  <p>
    The following additional rules apply to attributes <a>'x'</a>,
    <a>'y'</a>, <a>'dx'</a>, <a>'dy'</a>, and <a>'rotate'</a> when they
    contain a list of numbers:
  </p>

  <ul>
    <li>
      When a single XML character maps to a single glyph &#x2013; In this
      case, the <span class="code-fragment">i</span>-th value for the
      <a>'x'</a>, <a>'y'</a>, <a>'dx'</a>, <a>'dy'</a>,
      and <a>'rotate'</a> attributes is applied to the glyph that
      corresponds to the <span class="code-fragment">i</span>-th
      character.
    </li>

    <li>
      When a single XML character maps to multiple glyphs (e.g., when
      an accent glyph is placed on top of a base glyph) &#x2013; In this
      case, the <span class="code-fragment">i</span>-th value for
      the <a>'x'</a>, <a>'y'</a>, <a>'dx'</a>, and <a>'dy'</a> values
      are applied (i.e., the <a>current text position</a> is adjusted)
      before rendering the first glyph.  The rotation transformation
      corresponding to the
      <span class="code-fragment">i</span>-th <a>'rotate'</a>
      value is applied to the glyphs and to the inter-glyph advance
      values corresponding to this character on a group basis (i.e.,
      the rotation value creates a temporary new rotated coordinate
      system, and the glyphs orresponding to the character are
      rendered into this rotated coordinate system).
    </li>

    <li>
      When multiple XML characters map to a single glyph (e.g., when a
      ligature is used) &#x2013; Suppose that the
      <span class="code-fragment">i</span>-th and
      <span class="code-fragment">(i+1)</span>-th XML characters
      map to a single glyph. In this case, the
      <span class="code-fragment">i</span>-th value for the
      <a>'x'</a>, <a>'y'</a>, <a>'dx'</a>, <a>'dy'</a>,
      and <a>'rotate'</a> attributes all apply when rendering the
      glyph. The <span class="code-fragment">(i+1)</span>-th values,
      however, for <a>'x'</a>, <a>'y'</a>, and <a>'rotate'</a> are
      ignored (exception: the final <a>'rotate'</a> value in the list
      would still apply to subsequent characters), whereas
      the <a>'dx'</a> and <a>'dy'</a> are applied to the subsequent
      XML character (i.e., the
      <span class="code-fragment">(i+2)</span>-th character), if one
      exists, by translating the <a>current text position</a> by the
      given amounts before rendering the first glyph associated with
      that character.
    </li>

    <li>
      When there is a many-to-many mapping of characters to
      glyphs (e.g., when three characters map to two glyphs, such as
      when the first glyph expresses the first character and half
      of the second character, and the second glyph expresses the
      other half of the second character plus the third character)
      &#x2013; Suppose that the <span class="code-fragment">i</span>-th,
      <span class="code-fragment">(i+1)</span>-th and
      <span class="code-fragment">(i+2)</span>-th XML characters map
      to two glyphs. In this case, the
      <span class="code-fragment">i</span>-th value for the
      <a>'x'</a>, <a>'y'</a>, <a>'dx'</a>, and <a>'dy'</a> values
      are applied (i.e., the <a >current text position</a> is
      adjusted) before rendering the first glyph.  The rotation
      transformation corresponding to the
      <span class="code-fragment">i</span>-th <a>'rotate'</a>
      value is applied to both the two glyphs and the glyph advance
      values for the first glyph on a group basis (i.e., the rotation
      value creates a temporary new rotated coordinate system, and the
      two glyphs are rendered into the temporary rotated coordinate
      system). The <span class="code-fragment">(i+1)</span>-th and
      <span class="code-fragment">(i+2)</span>-th values, however, for
      the <a>'x'</a>, <a>'y'</a>, and <a>'rotate'</a> attributes are
      not applied (exception: the final <a>'rotate'</a> value in the
      list would still apply to subsequent characters), whereas
      the <span class="code-fragment">(i+1)</span>-th
      and <span class="code-fragment">(i+2)</span>-th values for
      the <a>'dx'</a> and <a>'dy'</a> attributes are applied to the
      subsequent XML character (i.e.,
      the <span class="code-fragment">(i+3)</span>-th character), if
      one exists, by translating the <a >current text position</a> by
      the given amounts before rendering the first glyph associated
      with that character.
    </li>

    <li>
      Relationship to bidirectionality
      &#x2013;
      Text is laid out in a two-step process, where any bidirectional
      text is first re-ordered into a left-to-right string, and then
      text layout occurs with the re-ordered text string. Whenever the
      character data within a <a>'tspan'</a> element is re-ordered,
      the corresponding elements within the <a>'x'</a>, <a>'y'</a>,
      <a>'dx'</a>, <a>'dy'</a>, and <a>'rotate'</a> are also
      re-ordered to maintain the correspondence. For example,
      suppose that you have the following <a>'tspan'</a> element:
      <pre>
&lt;tspan dx="11 12 13 14 15 0 21 22 23 0 31 32 33 34 35 36"&gt;Latin and Hebrew&lt;/tspan&gt;
      </pre>
      and that the word "Hebrew" will be drawn right-to-left. First,
      the character data and the corresponding values in
      the <a>'dx'</a> list will be reordered, such that the text
      string will be "Latin and werbeH" and the list of values for
      the <a>'dx'</a> attribute will be "11 12 13 14 15 0 21 22 23 0
      36 35 34 33 32 31". After this re-ordering, the glyphs
      corresponding to the characters will be positioned using
      standard left-to-right layout rules.
    </li>
  </ul>

  <p>
    <span class="example-ref">Example tspan04</span> uses the
    <a>'rotate'</a> attribute on the <a>'tspan'</a> element to rotate the
    glyphs to be rendered. This example shows a single text string in a
    <a>'tspan'</a> element that contains more characters than the
    number of values specified in the <a>'rotate'</a> attribute. In
    this case the last value specified in the <a>'rotate'</a>
    attribute of the <a>'tspan'</a> must be applied to the remaining
    characters in the string.
  </p>

  <edit:example href='images/text/tspan04.svg' name='tspan04' description="simple rotation of characters in a tspan element" image='yes' link='yes'/>

  <p>
    <span class="example-ref">Example tspan05</span> specifies the
    <a>'rotate'</a> attribute on the <a>'text'</a> element and on all
    but one of the child <a>'tspan'</a> elements to rotate the glyphs
    to be rendered. The example demonstrates the propagation of the
    <a>'rotate'</a> attribute.
  </p>

  <edit:example href='images/text/tspan05.svg' name='tspan05' description="propagation of rotation values to nested tspan elements" image='yes' link='yes'/>

  <p>
    Rotation of red text inside the <a>'text'</a> element:
  </p>

  <ul>
    <li>
      The <a>'rotate'</a> value will rotate the characters in the text
      <em>"Not "</em> by 5, 15, 25 and 35 degrees respectively.
    </li>
    <li>
      A <a>'rotate'</a> value is applied to the space that follows the
      text <em>"Not"</em>, to the space in between the text in the
      "child1" and "child5" <a>'tspan'</a> elements, and to the space
      before the text <em>"rotation"</em>.
    </li>
    <li>
      The next current <a>'rotate'</a> value specified is 45 followed
      by 55. The current <a>'rotate'</a> value in the <a>'text'</a>
      element is incremented as subsequent characters in the text of the
      child <a>'tspan'</a> elements are processed.
    </li>
    <li>
      The next immediate <a>'tspan'</a> element specifies rotate values
      for the text, hence the current <a>'rotate'</a> value will change to
      the next value in the list (but is not used) as each character is
      processed until the last value of 55 degrees is reached.
    </li>
    <li>
      The last <a>'rotate'</a> value of 55 degrees will be applied to all
      the characters in the text <em>"rotation"</em>.
    </li>
  </ul>

  <p>
    Rotation of the orange text inside the "child1" <a>'tspan'</a>element:
  </p>

  <ul>
    <li>
      The <a>'rotate'</a> value will rotate the first 4 characters in the
      text <em>"all characters "</em> by -10, -20, -30 and -40
      respectively.
    </li>
    <li>
      The last <a>'rotate'</a> value of -40 becomes the current
      <a>'rotate'</a> value and will be applied to all subsequent
      characters in the <a>'tspan'</a> element and to any child
      <a>'tspan'</a> elements that do not specify <a>'rotate'</a>
      values.
    </li>
    <li>
      The "child4" <a>'tspan'</a> element does not specify any
      <a>'rotate'</a> values and thus uses the current <a>'rotate'</a> of
      its ancestor ("child1" <a>'tspan'</a> element). All the characters
      in the text <em>"text"</em> specified within the "child4"
      <a>'tspan'</a> element will be rotated by -40 degrees.
    </li>
    <li>
      The last <a>'rotate'</a> value of -40 degrees will be applied to all
      the characters in the text <em>"have a"</em>.
    </li>
    <li>
      A <a>'rotate'</a> value is applied to the space in between the text
      in the "child2" and "child4" <a>'tspan'</a> elements, and to the
      space before the text <em>"have a"</em>.
    </li>
  </ul>

  <p>
    Rotation of the yellow text inside the "child2" <a>'tspan'</a>element:
  </p>

  <ul>
    <li>
      The <a>'rotate'</a> value will rotate the characters in the (yellow)
      text <em>"in "</em> by 70, 60, and 50 degrees respectively.
    </li>
    <li>
      A <a>'rotate'</a> value is applied to the space that follows the
      text <em>"in"</em>.
    </li>
    <li>
      There are more <a>'rotate'</a> values specified than characters,
      thus the additional <a>'rotate'</a> values will be applied to the
      "child3" <a>'tspan'</a> element which does not specified any
      <a>'rotate'</a> values.
    </li>
    <li>
      The characters in the text <em>"the"</em> specified within the
      "child3" <a>'tspan'</a> element will be rotated 40, 30 and 20
      degrees respectively.
    </li>
  </ul>

  <p>Rotation of the blue text inside the "child5" <a>'tspan'</a> element:</p>

  <ul>
    <li>
      The <a>'rotate'</a> value will rotate all the characters in text
      <em>"specified"</em> by -10 degrees.
    </li>
    <li>
      Only one <a>'rotate'</a> value is specified and is thus
      applied to all characters in the <a>'tspan'</a> element.
    </li>
  </ul>

  <p>
    The following diagram illustrates how the rotation values propagate to
    <a>'tspan'</a> elements nested withing a <a>'text'</a> element:
  </p>

  <img alt="Image that shows propagation of rotation values" src="images/text/tspan05-diagram.png" width="528" height="918" />

  </edit:with>

<h2 id="TextLayout">Text layout &#x2013; Introduction</h2>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Include text layout improvements from SVG Tiny 1.2.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2012/02/02-svg-minutes.html#item10">SVG 2 will include the improved text from SVG Tiny 1.2 on characters and glyphs, text layout, text selection, text search.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>To include clearer descriptions of text layout; no functional change.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Chris (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3236">ACTION-3236</a>)</td>
      </tr>
    </table>
  </div>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Support text in shapes.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2011/11/17-svg-irc#T22-04-11">SVG 2 will require automatic text wrapping compatible with CSS.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>Text in flow charts, etc.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Tav (no action)</td>
      </tr>
    </table>
  </div>

  <p>
    This section gives a short overview of SVG text layout. It is
    followed by sections that cover different aspects of text layout
    in more detail.
  </p>

  <p>
    Text layout in SVG is a multi-stage process that takes as input
    a <a>'text'</a> element subtree and its property values and
    produces a sequence of glyphs to render and their positions in
    each <a>text content element</a>'s coordinate system.
  </p>

  <p>
    First, a <a>'text'</a> element and its descendants are laid out
    inside a <a>content area</a> or <a>wrapping area</a> according to
    CSS, as if the <a>'text'</a> were a block element and
    any <a>'tspan'</a> and <a>'textPath'</a> descendants were inline
    elements. This layout takes into account all paragraph level
    and font related CSS properties described in this chapter.
  </p>
  <p>
    The <a>content area</a> may be explictly declared by setting the
    <a>'inline-size'</a> property, or by setting
    the <a>'shape-inside'</a> property that defines or references an
    SVG <a>shape</a>. If a <a>content area</a> is not declared, it
    defaults to a rectangle of infinite width and height.
  </p>

  <p>
    Second, any positioning given by <a>'tspan/x'</a>, <a>'tspan/y'</a>,
    <a>'tspan/dx'</a> and <a>'tspan/dy'</a> attributes are applied to
    the resulting glyph positions from the CSS layout process.

    The rules for which transforms are allowed depend on if
    the <a>content area</a> was explictly declared or not. If not
    explicitly declared, the rules define the layout of
    <em>pre-formatted</em> text. If declared, the rules define the
    layout of <em>auto-wrapped</em> text.
  </p>

  <p>
    Third, the effect of the <a>'text-anchor'</a> property is applied
    for <em>pre-formatted</em> text.
  </p>

  <p>
    Finally, layout of glyphs for any <a>'textPath'</a> elements is
    performed, converting <em>pre-formatted</em> text
    to <em>text-on-a-path</em>.
  </p>

  <p>
    Examples of the different types of text layout:
  </p>

  <dl>
    <dt>Pre-formatted:</dt>
    <dd>For short strings of text (e.g. labels) or where exact
      placement of glyphs is required (e.g. hand-kerned titles).

      <div class="example">
	<p>An example of multi-line pre-formatted text.</p>

	<pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg">
     width="300" height="100" viewBox="0 0 300 100"

     <text x="20" y="45"
           font-family="sans-serif"
	   font-size="24" >
       Example of multi-line,
       <tspan x="20" y="75">pre-formatted text.</tspan>
     </text>

</svg>
]]></pre>

	<div class="figure">
	  <img class="bordered" src="images/text/text-preformatted.svg"
               alt="Image showing two lines of pre-formatted text."/>
	  <p class="caption">Pre-formatted text where a <a>'tspan'</a> element has
	    been used to create multi-line text.</p>
	</div>
      </div>

    </dd>

    <dt>Wrapped text:</dt>
    <dd>For long strings of text where automatic text wrapping is
      required.
      <div class="example">
	<p>An example of auto-wrapped text.</p>

	<pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg">
     width="300" height="100" viewBox="0 0 300 100"

  <text x="20" y="45"
        font-family="sans-serif"
	font-size="24"
	inline-size="250">
    Example of text auto-wrapped.</text>

</svg>
]]></pre>

	<div class="figure">
	  <img class="bordered" src="images/text/text-wrapped.svg"
               alt="Image showing auto-wrapped text on two lines."/>
	  <p class="caption">Auto-wrapped text. The <a>'inline-size'</a>
	    property defines a rectangular content area (shown
	    in light blue).</p>
	</div>
      </div>

    </dd>

    <dt>Text on path:</dt>
    <dd>For text that follows a specified path.
      <div class="example">
	<p>An example of text on a path.</p>

	<pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg">
     width="300" height="100" viewBox="0 0 300 100"

  <path id="MyPath" stroke="lightblue" fill="none"
	d="M 50,50 C 100,0 200,100 250,50"/>

  <text font-family="sans-serif"
	font-size="24">
    <textPath href="#MyPath">Text on a path.</textPath>
  </text>

</svg>
]]></pre>

	<div class="figure">
	  <img class="bordered" src="images/text/text-path.svg"
               alt="Image showing text following a path."/>
	  <p class="caption">Text on a path. The <a>'textPath'</a>
	    element references a <a>'path'</a> element (shown in light
	    blue).</p>
	</div>
      </div>

    </dd>
  </dl>

  <p class="note">
    SVG 2 introduces the ability to automatically wrap text inside a
    rectangle or other shape by specifying a <a>content area</a>. The
    design of SVG wrapped text is motivated by the desire that SVG
    text wrapping be as compatible as possible with text wrapping in
    CSS inorder that renderers that support CSS text wrapping can
    implement SVG text wrapping easily (but without requiring non-HTML
    compatable SVG renderers to implement HTML). There are several
    differences between SVG and CSS text wrapping. The most important
    is that in SVG, a <a>content area</a> must be explicitly provided
    as SVG does not have an automatic finite (or semi-finite)
    <a>content area</a> (provided in CSS by the box model). Another
    difference is that SVG does not have the &lt;p&gt;&lt;/p&gt; and
    &lt;br/&gt; elements which create line breaks. Instead, SVG relies
    on the <span class="prop-value">pre</span> and
    <span class="prop-value">pre-line</span> values of
    <a>'white-space'</a> to provide line breaks. SVG wrapped text also
    allows a content-creation tool to provide a natural fallback for
    SVG 1.1 renderers that do not support wrapped text (by use of
    <a>'text/x'</a> and <a>'text/y'</a> attributes in the <a>'text'</a> and
    <a>'tspan'</a> elements, which are ignored by SVG 2 renderers for
    auto-wrapped text).
  </p>

  <p class="note">
    SVG's text layout options are designed to cover most general use
    cases. If more complex layout is required (bulleted lists, tables,
    etc.), text can be rendered in another XML namespace such as XHTML
    [<a href="refs.html#ref-XHTML">XHTML</a>] embedded inline within a
    <a>'foreignObject'</a> element.
  </p>

<h2 id="TextLayoutContentArea">Text layout &#x2013; Content Area</h2>

  <p>
    A <dfn>content area</dfn> is defined by specifying in
    a <a>'text'</a> element a <a>'inline-size'</a> property,
    or a <a>'shape-inside'</a> property that defines
    or references an SVG <a>shape</a>. If no <a>content area</a> is
    provided, the <a>content area</a> defaults to a rectangle of
    infinite width and height (see the
    <a href="text.html#TextLayoutPre">pre-formatted text</a> section).
    If both an <a>'inline-size'</a> property and a
    <a>'shape-inside'</a> property with value other than 'none' are
    given, the <a>'shape-inside'</a> property is used.
  </p>

  <p id="TextLayoutWrappingArea">
    Wrapped text is laid out in a <dfn>wrapping area</dfn>. The
    <a>wrapping area</a> is normally the same as the <a>content
    area</a>. When the <a>content area</a> is defined using
    the <a>'shape-inside'</a> property, the <a>wrapping area</a>
    may be smaller due to the presence of a <a>'shape-outside'</a>
    property and/or a <a>'shape-padding'</a> property. The
    <a>'shape-outside'</a> property (along with the
    <a>'shape-margin'</a> property) defines a <dfn>wrapping
    context</dfn>. The <a>wrapping area</a> then is found by
    subtracting the <a>wrapping context</a> from the <a>content
    area</a>. A non-zero value for the <a>'shape-padding'</a> property
    causes an additional inset to the <a>wrapping area</a>.
  </p>


<h3 id='InlineSize'>The <span class="property">'inline-size'</span> property</h3>

  <p class="annotation">
    'extent' added by resolution from
    <a href="http://www.w3.org/2015/02/12-svg-minutes.html#action17">February
      12th, 2015</a>. 'extent' replaces the 'width' and 'height'
    attributes, added by resolution from June 27th, 2013.
    Replaced by 'inline-size' presentation attribute per resolution from
    <a href="http://www.w3.org/2015/06/11-svg-minutes.html#item09">Linkoping
      F2F, June 11, 2015</a>.
  </p>

  <p>
    The <a>'inline-size'</a> property allows one to set the
    <a>content area</a> to a rectangluar shape. The computed value of
    the property sets the width of the rectangle for horizontal text
    and the height of the rectangle for vertical text. The other
    dimension (height for horizontal text, width for vertical text) is
    of infinite length.
  </p>

  <p>
    The initial <a>current text position</a> is taken from the
    <a>'text/x'</a> and <a>'text/y'</a> attributes of the
    <a>'text'</a> element (or first child <a>'tspan'</a> element
    if the attributes are not given on the <a>'text'</a> element).

    For left-to-right text, the initial <a>current text position</a>
    is at the left of the rectangle. For right-to-left text it is at
    the right of the rectangle.

    For vertical text, the initial <a>current text position</a> is at
    the top of the rectangle.
  </p>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="InlineSizeProperty">inline-size</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td><a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> | <a>&lt;number&gt;</a></td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>As if not specified.</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>'text'</a> elements</td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>no</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>Refer to the width (for horizontal text) or height (for vertical text) of the current viewport
	(see <a href="coords.html#Units">Units</a>)</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td>absolute length or percentage</td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes</td>
    </tr>
  </table>

  <div class="example">
    <p>An example of using <a>'inline-size'</a> for wrapping horizontal text.</p>

    <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="300" height="100" viewBox="0 0 300 100">

  <text x="50" y="30" inline-size="200"
        font-family="sans-serif"
	font-size="20px" >This text wraps at 200 pixels.</text>

</svg>
]]></pre>

    <div class="figure">
      <img class="bordered" src="images/text/text-wrap-horizontal.svg"
           alt="Image showing English text wrapped into two lines."/>
      <p class="caption">
	Horizontal text wrapping. The light-blue lines indicate the
	limits of the <a>content area</a>. Note that the content
	area is of infinite height. The red dot shows the initial
	<a>current text position</a>.
      </p>
    </div>
  </div>

  <div class="example">
    <p>An example of using <a>'inline-size'</a> for wrapping right to left horizontal text.</p>

    <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="300" height="100" viewBox="0 0 300 100">

  <text x="250" y="30" inline-size="200"
	writing-mode="rl-tb"
        font-family="PakType Naqsh"
	font-size="20px" >Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ ÙŠÙ„ØªÙ ÙÙŠ 200 Ø¨ÙƒØ³Ù„.</text>

</svg>
]]></pre>

    <div class="figure">
      <img class="bordered" src="images/text/text-wrap-horizontal-rl.svg"
           alt="Image showing Arabic text wrapped into two lines."/>
      <p class="caption">
	Horizontal text wrapping for right to left text.
	The light-blue lines indicate the
	limits of the <a>content area</a>. Note that the content
	area is of infinite height. The red dot shows the initial
	<a>current text
	  position</a>.
      </p>
    </div>
    <p class="issue" data-issue="6">Some browser may not render this
      SVG 1.1 figure correctly. Batik and Firefox seems to get it
      right.
    </p>
  </div>

  <div class="example">
    <p>An example of using <a>'inline-size'</a> for wrapping vertical text.</p>

    <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="100" height="300" viewBox="0 0 100 300">

  <text x="62.5" y="25" inline-size="200"
	writing-mode="tb-rl"
        font-family="IPAMincho"
	font-size="25px" >ãƒ†ã‚­ã‚¹ãƒˆã¯ï¼‘ï¼æ–‡å­—å¾Œã«æŠ˜ã‚Šè¿”ã•ã‚Œã¾ã™ã€‚</text>

</svg>
]]></pre>

    <div class="figure">
      <img class="bordered" src="images/text/text-wrap-vertical.svg"
           alt="Image showing vertical Japanese text wrapped into two columns."/>
      <p class="caption">
	Vertical text wrapping. The light-blue lines indicate the
	limits of the <a>content area</a>. Note that the content
	area is of infinite width. The red dot shows the initial
	<a>current text
	  position</a>.
      </p>
    </div>
    <p class="issue" data-issue="7">This SVG 1.1 image doesn't work in
      Firefox, even nightly. The "period" is in the incorrect place in
      Chrome (should be at upper-right of cell). It appears that
      horizontal to vertical glyph substitution is not being
      done. librsvg does do the correct glyph substitution.
    </p>
  </div>


<h3 id='TextShapeInside'>The <span class="property">'shape-inside'</span> property</h3>

  <p>
    The <a>'shape-inside'</a> property allows one to set the
    <a>content area</a> to a <a>CSS basic shape</a> or to an
    SVG <a>shape</a>.
  </p>
  <p class="note">
    In CSS/HTML <a>'shape-inside'</a> applies to block-level elements
    and absolute and percentage values are defined relative to the
    block-level element.

    In SVG absolute and percentage values are defined relative to the
    current <a>local coordinate system</a> and the <a>'viewBox'</a>.
  </p>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="ShapeInsideProperty">shape-inside</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td>auto | &lt;basic-shape&gt; | &lt;uri&gt;</td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>auto</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>'text'</a> elements</td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>no</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>N/A</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td>computed lengths for &lt;shape&gt;, the absolute URI for &lt;uri&gt;, otherwise as specified </td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes, see <a href="http://dev.w3.org/csswg/css-shapes/#basic-shape-interpolation">Interpolation of Basic Shapes</a></td>
    </tr>
  </table>

  <dl>
    <dt><span class="attr-value">auto</span></dt>
    <dd>
      For the purposes of SVG, the 'auto' value indicates that the
      content area should be defined using the <a>'inline-size'</a>
      property or as for pre-formatted text.
    </dd>

    <dt><span class="attr-value">&lt;basic-shape&gt;</span></dt>
    <dd>
      The shape is computed based on the values of one of 'circle()',
      'ellipse()' or 'polygon()'. The CSS value of 'inset()' is
      invalid for SVG.

      <div class="example">
	<p>
	  An example of using a CSS basic-shape for wrapping horizontal text.
	</p>

	<pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="300" height="100" viewBox="0 0 300 100">

  <text shape-inside="circle(100 at 100 100)"
	font-family="sans-serif"
	font-size="20px">Lorem ipsum dolor sit amet, consec-tetuer adipiscing elit...</text>

</svg>
]]></pre>

	<div class="figure">
	  <img class="bordered" src="images/text/text-wrap-circle.svg"
	       alt="Image showing text wrapped inside a circle."/>
	  <p class="caption">
	    Horizontal text wrapping inside a CSS circle shape.
	    The light-blue lines indicate the limits of the
	    <a>content area</a>.
	  </p>
	</div>
      </div>

      <div class="issue" data-issue="12">
        <p>
          Shapes also defines 'inset'. It might be
          interesting to be able to write:
        </p>

	      <pre><![CDATA[
<rect ...>
  <text shape-inside="inset(20px 10px 20px 10px)">...</text>
</rect>
]]></pre>

        <p>
          where the insets are based on the rectangle geometry (or
          the bounding-box before any transformation).
        </p>
      </div>
    </dd>

    <dt><span class="attr-value">&lt;uri&gt;</span></dt>
    <dd>
      If the &lt;uri&gt; references an SVG <a>shape</a> element,
      that element defines the shape. Otherwise, if the &lt;uri&gt;
      references an image, the shape is extracted and computed based
      on the alpha channel of the specified image. If the
      &lt;uri&gt; does not reference an SVG shape element or an
      image, the effect is as if the value â€˜autoâ€™ had been
      specified.

      <div class="example">
	<p>
	  An example of using a reference to an SVG <a>shape</a> for wrapping horizontal text.
	</p>

	<pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="300" height="100" viewBox="0 0 300 100">

  <defs>
    <rect id="wrap" x="50" y="10" width="200" height="80"/>
  </defs>

  <text shape-inside="url(#wrap)"
	font-family="sans-serif"
	font-size="20px" >This text wraps in a rectangle.</text>

</svg>
]]></pre>

	<div class="figure">
	  <img class="bordered" src="images/text/text-wrap-rectangle.svg"
	       alt="Image showing text wrapped inside a rectangle."/>
	  <p class="caption">
	    Horizontal text wrapping inside an SVG rectangle shape.
	    The light-blue lines indicate the limits of the
	    <a>content area</a>.
	  </p>
	</div>
      </div>
    </dd>

  </dl>

  <p>
    The CSS values of 'outside-shape' and 'shape-box' are invalid for SVG.
  </p>

  <p class="note">
    Except as noted, see the CSS Shapes Module Level 2 for the definition of
    <a href="http://dev.w3.org/csswg/css-shapes-2/#shape-inside-property">'shape-inside'</a>.
    [<a href="refs.html#ref-CSSSHAPES2">CSSSHAPES2</a>]
  </p>

  <p class="annotation">
    'shape-inside' was removed when the CSS Exclusions and Shapes
    Module was split into separate Exclusions and Shapes modules. At
    the Tokyo joint SVG/CSS F2F meeting, it was agreed that it would
    reappear in CSS Shapes Module Level 2.
  </p>

<h3 id='TextShapeOutside'>The <span class="property">'shape-outside'</span> property</h3>

  <p>
    The <a>'shape-outside'</a> property allows one to exclude part of
    the <a>content area</a> from the <a>wrapping area</a>. The
    exclusion can be a <a>CSS basic shape</a> or to an
    SVG <a>shape</a>.
  </p>
  <p class="note">
    In CSS/HTML <a>'shape-outside'</a> applies to floats and
    absolute and percentage values are defined relative to the
    float.

    In SVG absolute and percentage values are defined relative to the
    current <a>local coordinate system</a> and the <a>'viewBox'</a>.

    <span class="issue">We could use the content area.</span>
  </p>
  <p class="issue" data-issue="14">
    The value 'auto' is probably not useful in SVG.
    A new value of 'none' is probably needed in which case
    the property is ignored.
  </p>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="ShapeOutsideProperty">shape-outside</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td>none | &lt;basic-shape&gt; | &lt;uri&gt;</td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>none</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>'text'</a> elements</td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>no</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>N/A</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td>computed lengths for &lt;basic-shape&gt;, the absolute URI for &lt;uri&gt;, otherwise as specified </td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes, see <a href="http://dev.w3.org/csswg/css-shapes/#basic-shape-interpolation">Interpolation of Basic Shapes</a></td>
    </tr>
  </table>

  <dl>
    <dt><span class="attr-value">&lt;basic-shape&gt;</span></dt>
    <dd>
      The shape is computed based on the values of one of 'circle()',
      'ellipse()' or 'polygon()'. The CSS value of 'inset()' is
      invalid for SVG.
    </dd>

    <dt><span class="attr-value">&lt;uri&gt;</span></dt>
    <dd>
      If the &lt;uri&gt; references an SVG <a>shape</a> element,
      that element defines the shape. Otherwise, if the &lt;uri&gt;
      references an image, the shape is extracted and computed based
      on the alpha channel of the specified image. If the
      &lt;uri&gt; does not reference an SVG shape element or an
      image, the effect is as if the value â€˜autoâ€™ had been
      specified.
    </dd>

  </dl>

  <div class="example">
    <p>
      An example of using <a>'shape-outside'</a>.
    </p>.

    <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="450" height="300" viewBox="0 0 450 300">

  <rect id="rect1" x="25"  y="25"  width="225" height="175" fill="white" stroke="black"/>
  <rect id="rect2" x="200" y="125" width="225" height="150" fill="white" stroke="black"/>

  <text shape-inside="url(#rect1)"
	shape-outside="url(#rect2)"
	shape-padding="25"
	shape-margin="25"
        font-family="DejaVu Sans"
	font-size="12px"
	text-align="justified"
	line-height="110%">Lorem ipsum ...</text>
  <text shape-inside="url(#rect2)"
	shape-padding="25"
        font-family="DejaVu Sans"
	font-size="12px"
	text-align="justified"
	line-height="110%">Lorem ipsum ...</text>
</svg>
]]></pre>

    <div class="figure">
      <img class="bordered" src="images/text/text-wrap-complex.png"
           alt="Image showing horizontal text wrapped inside two overlapping rectangles."/>
      <p class="caption">
	Horizontal text wrapping inside two overlapping rectangles
	using <a>'shape-outside'</a> as well as
	<a>'shape-inside'</a>, <a>'shape-padding'</a> and
        <a>'shape-margin'</a>. The black rectangles show
	the <a>content area</a>s. The inner blue lines show
	the <a>wrapping area</a>s.
      </p>
    </div>
  </div>

  <p>
    The CSS value of 'shape-box' are invalid for SVG.
  </p>

  <p class="note">
    Except as noted, see the CSS Shapes Module Level 1 for the definition of
    <a href="http://dev.w3.org/csswg/css-shapes/#shape-outside-property">'shape-outside'</a>.
    [<a href="refs.html#ref-CSSSHAPES1">CSSSHAPES1</a>]
  </p>

<h3 id='TextShapeImageValue'>The <span class='property'>shape-image-threshold</span> property</h3>

  <p>
    The shape-image-threshold defines the alpha channel threshold used
    to extract the shape using an image. A value of 0.5 means that the
    shape will enclose all the pixels that are more than 50% opaque.
  </p>

  <p>
    For the purposes of SVG, this property applies to <a>'text'</a> elements.
  </p>

  <p class="note">
    Except as noted, see the CSS Shapes Module Level 1 for the definition of
    <a href="http://dev.w3.org/csswg/css-shapes/#shape-image-threshold-property">'shape-image-threshold'</a>.
    [<a href="refs.html#ref-CSSSHAPES1">CSSSHAPES1</a>]
  </p>

<h3 id='TextShapeMargin'>The <span class="property">'shape-margin'</span> property</h3>

  <p>
    The <a>'shape-margin'</a> property adds a margin to a
    <a>'shape-outside'</a>. This defines a new shape where every
    point is the specified distance from the shape-outside. This
    property takes on positive values only.
  </p>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="ShapeMarginProperty">shape-margin</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td><a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a></td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>0</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>'text'</a> elements</td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>no</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>N/A</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td>the absolute length </td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes</td>
    </tr>
  </table>

  <p class="note">
    Except as noted, see the CSS Shapes Module Level 1 for the definition of
    See <a href="http://dev.w3.org/csswg/css-shapes/#shape-margin-property">'shape-margin'</a>.
    [<a href="refs.html#ref-CSSSHAPES1">CSSSHAPES1</a>]
  </p>

<h3 id='TextShapePadding'>The <span class="property">'shape-padding'</span> property</h3>

  <p>
    The <a>'shape-padding'</a> property can be used to offset the
    inline flow content wrapping on the inside of elements. Offsets
    created by the â€˜wrap-paddingâ€™ property are offset from the content
    area of the element. This property takes on positive values only.
  </p>

  <div class="example">
    <p>An example of using <a>'shape-padding'</a></p>.

    <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="300" height="300" viewBox="0 0 300 300">

  <circle id="circle" cx="150" cy="150" r="125" fill="none" stroke="black"/>
  <text shape-inside="url(#circle)"
	shape-padding="25"
        font-family="DejaVu Sans"
	font-size="18px"
	text-align="justified"
	line-height="110%">This is an example of
  wrapped text in SVG 2! There should be 25
  pixel pixel around the text. The text is
  justified on both sides. It looks good!</text>

</svg>
]]></pre>

    <div class="figure">
      <img class="bordered" src="images/text/text-shape-padding.png"
           alt="Image showing horizontal text wrapped inside a circle with a padding."/>
      <p class="caption">
	Horizontal text wrapping inside a circle with
	a <a>'shape-padding'</a>. The outer black circle shows
	the <a>content area</a>. The inner blue circle shows
	the <a>wrapping area</a>.
      </p>
    </div>
    <p class="issue" data-issue="16">This image is a PNG. Figure out how to make a good SVG.</p>
  </div>

  <p class="note">
    Except as noted, see the CSS Shapes Module Level 2 for the definition of
    <a href="http://dev.w3.org/csswg/css-shapes-2/#shape-padding-property">'shape-padding'</a>.
  </p>

<h2 id="TextLayoutAlgorithm">Text layout &#x2013; Algorithm</h2>

  <p>
    Once a <a>content area</a> has been defined,
    the following algorithm is used to determine the glyphs to render
    for a given <a>'text'</a> element and their positions:
  </p>

  <ol class='algorithm'>

    <li>
      Let <var>root</var> be the result of generating CSS boxes for
      the <a>'text'</a> element and its subtree, where
      the <a>'text'</a> element is treated as a block element and its
      descendant <a>'tspan'</a> and <a>'textPath'</a> elements are
      treated as inline elements.
    </li>

    <li>
      If the <a>'text'</a> element has an <a>'inline-size'</a>
      attribute, then lay out <var>root</var> with its <a>block
      size</a> set to the <a>'inline-size'</a> attribute's value and
      with an unconstrained <a>inline size</a>.
      <p class='note'>
	This means that <var>root</var> is laid out with its
	width set to the <a>'inline-size'</a> value, if <a>'writing-mode'</a>
	is <span class='prop-value'>horizontal-tb</span>, and its height otherwise.
      </p>
    </li>

    <li>
      Otherwise, <a>'inline-size'</a> was not specified.  Lay
      out <var>root</var> with an unconstrained width and height.
    </li>

    <li>...</li>

  </ol>

  <p class='issue' data-issue="45">Finish this algorithm.</p>

  <hr/>
  <p>Below: junk that should be covered in this section.</p>
  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Align with CSS for text layout functionality.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2011/07/29-svg-minutes.html#item08">SVG 2 Will use CSS3 definitions for text layout (white space, bidi, etc.) that is not specific to SVG.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>To facilitate shared specification and implementation of text layout in HTML and SVG.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Cameron and Chris (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3004">ACTION-3004</a>,
          <a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3005">ACTION-3005</a>)</td>
      </tr>
    </table>
  </div>

  <p>
    This section describes the text layout rules that govern direction
    of text flow inside a <a>content area</a> in order to support
    various international writing directions, such as left-to-right
    (e.g., Latin scripts) and bidirectional (e.g., Hebrew or Arabic),
    and vertical (e.g., Asian scripts).
  </p>

  <p>
    The processing model for bidirectional text is as follows. The
    user agent processes the characters which are provided in
    <em>logical order</em> (i.e., the order the characters appear in
    the original document). The user agent determines
    the set of independent blocks within each of which it should apply
    the Unicode bidirectional algorithm. Each
    <a href="text.html#TextChunk">text chunk</a> represents an
    independent block of text. Additionally, any change in glyph
    orientation due to processing of properties
    <a>'glyph-orientation-horizontal'</a> or
    <a>'glyph-orientation-vertical'</a> will subdivide the independent
    blocks of text further. After processing the Unicode bidirectional
    algorithm and properties <a>'direction'</a> and
    <a>'unicode-bidi'</a> on each of the independent text blocks, the
    user agent will have a potentially re-ordered list of characters
    which are now in left-to-right rendering order. Simultaneous with
    re-ordering of the characters, the <a>'tspan/dx'</a>,
    <a>'tspan/dy'</a>, and <a>'tspan/rotate'</a> attributes on the
    <a>'tspan'</a> elements are also re-ordered to
    maintain the original correspondence between characters and
    attribute values. While kerning or ligature processing might be
    font-specific, the preferred model is that kerning and ligature
    processing occurs between combinations of characters or glyphs
    after the characters have been re-ordered.
  </p>

<h3 id="BasicLayoutMetrics">Layout Orientations</h3>

  <p id="ReferenceOrientation">
    For each <a>'text'</a> element, the SVG user agent determines the
    current <dfn>reference orientation</dfn>. For standard horizontal
    or vertical text (i.e., not text-on-a-path), the reference
    orientation is the vector pointing towards negative infinity in Y
    within the current user coordinate system. (Note: in
    the <a>initial coordinate system</a>, the reference orientation is
    up.)  For <a href="text.html#TextLayoutPath">text on a path</a>,
    the reference orientation is determined at each character's
    position along the path. It is 90 degrees counter-clockwise
    relative to the path direction for horizontal text and 180 degrees
    relative to the path direction for vertical text.
  </p>
  <p class="issue" data-issue="18">In the model that text-on-a-path is text that is
    first layed out according to CSS and then warped along a path, we
    can get rid of the distinction made above.</p>

  <p id="InlineProgressionDirection">
    Based on the reference orientation and the value for
    property <a>'writing-mode'</a>, the SVG user agent determines the
    current <dfn>inline-progression-direction</dfn>. For left-to-right
    text, the inline-progression-direction points 90 degrees clockwise
    from the reference orientation vector. For right-to-left text, the
    inline progression points 90 degrees counter-clockwise from the
    reference orientation vector. For top-to-bottom text, the
    inline-progression-direction points 180 degrees from the reference
    orientation vector.
  </p>

  <p id="BlockProgressionDirection">
    Based on the reference orientation and the value for
    property <a>'writing-mode'</a>, the SVG user agent determines the
    current <dfn>block-progression-direction</dfn>. For left-to-right
    and right-to-left text, the block-progression-direction points 180
    degrees from the reference orientation vector because the only
    available horizontal <a>'writing-mode'</a>s
    are <span class="prop-value">lr-tb</span>
    and <span class="prop-value">rl-tb</span>. For top-to-bottom text,
    the block-progression-direction always points 90 degrees
    counter-clockwise from the reference orientation vector because
    the only available top-to-bottom <a>'writing-mode'</a>
    is <span class="prop-value">tb-rl</span>.
  </p>

  <p class="issue" data-issue="19">Insert figure.</p>

  <p id="ShiftDirection">The <dfn>shift direction</dfn> is the
    direction towards which the
    <a href="#FontsTablesBaselines">baseline table</a> moves due
    to positive values for property <a>'baseline-shift'</a>. The shift
    direction is such that a positive value shifts the baseline table
    towards the topmost entry in the parent's
    <a href="#FontsTablesBaselines">baseline table</a>.
  </p>

<h2 id="TextLayoutPre">Pre-formatted text</h2>

  <p class="note">
    This option corresponds to basic SVG 1.1 text layout.
  </p>

  <p>
    This is the default text layout method and is used in the absence
    of an explicitly defined <a>content area</a>. It is also used as a
    first step in laying out <em>text on a path</em> (with slightly
    modified rules). In this layout method, no automatic line breaking
    or word wrapping is done. Nominally, the text is rendered as a
    single line inside a rectangular <a>content area</a> of infinite
    width and height. Multiple lines of text can be obtained by
    precomputing line breaks and using one of the following methods:
  </p>

  <ul>
    <li>
      Use a single <a>'text'</a> element with <a>'white-space'</a> set
      to <span class="prop-value">pre</span>
      or <span class="prop-value">pre-line</span>. Line spacing is set
      by <a>'line-height'</a>.

      <p class="note">New in SVG 2.</p>
      <p class="issue" data-issue="32">In Firefox. Needs to be fully specified.</p>
    </li>

    <li>
      Use a single <a>'text'</a> element with one or more <a>'tspan'</a>
      child elements with appropriate values for attributes
      <a>'tspan/x'</a>, <a>'tspan/y'</a>,
      <a>'tspan/dx'</a> and <a>'tspan/dy'</a> to set new start positions
      for those characters which start new lines.
    </li>

    <li>
      Use multiple <a>'text'</a> elements, one for each line of
      text. (Not recommended as this prevents selection across multiple
      lines of text -- see
      <a href="text.html#TextSelection">Text selection and clipboard
        operations</a>.)
    </li>
  </ul>

  <p class="note">
    The following properties do not apply to <em>pre-formatted</em> text:
    <a>'text-align'</a>, <a>'text-align-last'</a>, <a>'line-break'</a>,
    <a>'word-break'</a>, <a>'hyphens'</a>, <a>'word-wrap'</a>,
    and <a>'overflow-wrap'</a>.
  </p>

<h3 id="TextLayoutPreMultiline">Multi-line text via 'white-space'</h3>

  <p>
    Multi-line pre-formatted text may be created by using the
    <a>'white-space'</a> values <span class="prop-value">pre</span>
    or <span class="prop-value">pre-line</span>. In these cases, a
    line-feed or carriage return is preserved as a <a>forced line
    break</a>. When a renderer encounters a <a>forced line break</a>,
    the <a>current text
    position</a> is set as follows:
  </p>
  <ul>
    <li>
      For horizontal text: <span class="val">x</span> is reset to
      the initial <a>current
      text position</a> while <span class="val">y</span> is
      incremented by the computed value of the <a>'line-height'</a>
      property.
    </li>
    <li>
      For vertical text: <span class="val">y</span> is reset to the
      initial value while <span class="val">x</span> is decremented
      (for right-to-left block-flow direction) or incremented
      (for left-to-right block-flow direction) by the computed
      value of <a>'line-height'</a>.
    </li>
  </ul>

<h3 id="TextLayoutPreAdjustments">Adjusting Text Chunks</h3>

  <p>
    After text is laid out according to the basic CSS text layout
    rules, glyphs can be repositioned using SVG specific rules. Two
    types of adjustments can be made. The first uses the
    <a>'tspan/x'</a>, <a>'tspan/y'</a>, <a>'tspan/dx'</a>,
    <a>'tspan/dy'</a>, <a>'tspan/rotate'</a> attributes to reposition
    glyphs with in a <a>'tspan'</a> element. The second uses the
    <a>'text-anchor'</a> property to realign lines of text.
  </p>

<h4 id="TextLayoutPreXY">Repositioning Glyphs</h4>

  <p class="issue" data-issue="34">
    Expand on how 'x' and 'y' effect characters.
  </p>

<h4 id="TextAnchoringProperties">Text alignment, the <span class='property'>'text-anchor'</span> property</h4>

  <p>
    The <a>'text-anchor'</a> property is used to align (start-,
    middle- or end-alignment) a string of <em>pre-formatted</em> text
    relative to a given point. It is not applicable to
    <em>auto-wrapped text</em>, see instead <a>'text-align'</a>. For
    multi-line text, the alignment takes place for each line.
  </p>

  <p>
    <span class="issue">This is confusing, perhaps a figure would help:</span>
    The <a>'text-anchor'</a> property is applied to each individual
    <a href="text.html#TextChunks">text chunk</a> within a
    given <a>'text'</a> element. Each text chunk has an initial
    current text position, which represents the point in the user
    coordinate system resulting from (depending on context)
    application of the <a>'text/x'</a> and <a>'text/y'</a> attributes
    on the <a>'text'</a> element, any <a>'tspan/x'</a>
    or <a>'tspan/y'</a> attribute values on a <a>'tspan'</a>
    element assigned explicitly to
    the first rendered character in a text chunk, or determination of
    the initial current text position for a <a>'textPath'</a> element.
  </p>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="TextAnchorProperty">text-anchor</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td>start | middle | end</td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>start</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>text content elements</a></td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>yes</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>N/A</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td>as specified</td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes</td>
    </tr>
  </table>

  <p>
    Values have the following meanings:
  </p>

  <dl>
    <dt><span class="attr-value">start</span></dt>
    <dd>
      The rendered characters are aligned such that the start of the
      resulting rendered text is at the initial current text position.
      For an element with a <a>'direction'</a> property value
      of <span class="prop-value">"ltr"</span> (typical for most
      European languages), the left side of the text is rendered at
      the initial text position.  For an element with a
      <a>'direction'</a> property value of
      <span class="prop-value">"rtl"</span> (typical for Arabic and
      Hebrew), the right side of the text is rendered at the initial
      text position.  For an element with a vertical primary text
      direction (often typical for Asian text), the top side of the
      text is rendered at the initial text position.
    </dd>

    <dt><span class="attr-value">middle</span></dt>
    <dd>
      The rendered characters are aligned such that the geometric
      middle of the resulting rendered text is at the initial current
      text position.
    </dd>

    <dt><span class="attr-value">end</span></dt>
    <dd>
      The rendered characters are aligned such that the end of the
      resulting rendered text is at the initial current text position.
      For an element with a <a>'direction'</a> property value
      of <span class="prop-value">"ltr"</span> (typical for most
      European languages), the right side of the text is rendered at
      the initial text position.  For an element with
      a <a>'direction'</a> property value
      of <span class="prop-value">"rtl"</span> (typical for Arabic and
      Hebrew), the left side of the text is rendered at the initial
      text position.  For an element with a vertical primary text
      direction (often typical for Asian text), the bottom of the text
      is rendered at the initial text position.
    </dd>
  </dl>

  <div class="example">
    <p>An example of using <a>'text-anchor'</a> on multi-line text.</p>

    <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="300" height="100" viewBox="0 0 300 100">

  <text x="150" y="30"
        font-family="sans-serif"
	font-size="20px"
	white-space="pre-line"
	text-anchor="middle">This multi-line text
        is anchored to the middle.</text>

</svg>
]]></pre>

    <div class="figure">
      <img class="bordered" src="images/text/text-anchor-middle.svg"
           alt="Image showing two lines of text centered via text-anchor."/>
      <p class="caption">
	Text anchoring is applied independently to each line of text.
      </p>
    </div>
  </div>

<h2 id="TextLayoutAuto">Auto-wrapped text</h2>

  <p>
    Text is automatically wrapped when a <a>content area</a> is
    specified in the <a>'text'</a> element. The <a>content area</a>
    defines the outermost container for wrapping text. A <a>wrapping
    context</a> (set of exclusion areas) may also be given. The
    actual <a>wrapping area</a> is defined by subtracting the
    <a>wrapping context</a> from the <a>content area</a>. The
    <a>wrapping context</a> may also be reduced by the value of the
    <a>'shape-padding'</a> property. The effective area of an
    exclusion may be enlarged by the value of the
    <a>'shape-margin'</a> property.
  </p>

  <p>
    In the case where the <a>content area</a> is defined by the by
    the <a>'inline-size'</a> attribute,
    the <a>'tspan/x'</a> and <a>'tspan/y'</a> attributes
    corresponding to the first rendered glyph define the
    initial <a>current text position</a>.  When the <a>content
    area</a> is inside a <a>shape</a>, the initial <a>current text
    position</a> is determined by <span class="issue">FIX ME, FIND
    WHERE IN CSS THIS IS SPECED.</span>.
  </p>

  <p>
    Except when used to determine the initial <a>current text
    position</a>, all values <a>'tspan/x'</a> and <a>'tspan/y'</a>
    are ignored on <a>'text'</a>, and <a>'tspan'</a>
    elements.
  </p>

  <p class="note">
    The attributes <a>'text/x'</a> and <a>'text/y'</a> can provide a
    natural fallback mechanism for SVG1.1 renderers for wrapped text.
    Most of the text wrapping examples in this section rely on this
    mechanism to render text in browsers that have not implemented
    text wrapping.
  </p>

<h2 id="TextLayoutPath">Text on a path</h2>

<edit:with element='textPath'>

  <p>
    SVG can place text along a path defined either by a <a>'path'</a>
    element or the path equivalent of a <a>basic shape</a>. This is
    specified by including text within a <a>'textPath'</a> element
    that has either an <a>'href'</a> attribute with an <a>URL
    reference</a> pointing to a <a>'path'</a> element or <a>basic
    shape</a>, or by including a <a>'d'</a> attribute that specifies
    path data directly.
  </p>

  <p class="note">
    The ability to place text along a basic shape is new in SVG 2.
  </p>

  <p class="annotation">
    Placing text along a basic shape was resolved at the
    <a href="http://www.w3.org/2015/02/12-svg-minutes.html#item05">Sydney
    (2015)</a> meeting.
  </p>

  <p>
    Text on a path is conceptional like a single line of
    <a href="text.html#TextLayoutPre">pre-formatted text</a> text that
    is then transformed to follow the path. Except as indicated, all
    the properties that apply to pre-formatted text apply to text on a
    path.
  </p>

<h3 id="TextPathElement">The <span class="element-name">'textPath'</span> element</h3>

  <edit:elementsummary name='textPath'/>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Have a more precise explanation of text path stretch methods.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2011/11/17-svg-irc#T22-23-10">We will clarify <span class='attr-value'>method="stretch"</span> on <span class="element-name">>'textPath'</span> elements.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>Improve interoperability of the feature.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Cameron (no action)</td>
      </tr>
    </table>
  </div>

<h3 id="TextPathAttributes">Attributes</h3>

  <dl class="attrdef-list-svg2">

    <dt id="TextPathElementStartOffsetAttribute"><span class="adef">startOffset</span></dt>
    <dd>
      <p>
        An offset from the start of the path for the initial current
        text position, calculated using the user agent's
	<a href="paths.html#DistanceAlongAPath">distance along the
        path</a> algorithm.
      </p>
      <p>
        If a <a>&lt;length&gt;</a>
        other than a percentage is given, then the
	<a>'startOffset'</a> represents a distance along the path
        measured in the current user coordinate system.<br />  If a
        percentage is given, then the <a>'startOffset'</a> represents
        a percentage distance along the entire path. Thus,
	<span class="attr-value">startOffset="0%"</span> indicates the
        start point of the path and
        <span class="attr-value">startOffset="100%"</span> indicates
        the end point of the path.
      </p>

      <p>
	For an open path, glyphs with mid-points that are not on the
	path are not rendered.
      </p>
      <div class="figure">
	<img alt="Three paths with various values of 'startOffset' showing clipping
		  when glyphs are outside path region."
	     src="images/text/text-path-startoffset.svg" />
	<p class="caption">
	  Rendering for different values of the <a>'startOffset'</a>
	  attribute. From left to right: default value, 50%, -50%.
	</p>
      </div>

      <p>
	For a closed path (including an equivalent path for a <a>basic
	shape</a>), the path is considered to wrap around in both
	directions. All glyphs are rendered.
      </p>
      <div class="figure">
	<img alt="Two circular path with different values of
		  'startOffset' showing that all glyphs are rendered."
		  src="images/text/text-path-startoffset2.svg" />
	<p class="caption">
	  Rendering for text on a path referencing a <a>'circle'</a>
	  with different values of the <a>'startOffset'</a>
	  attribute. Left: 0. Right: 75% or -25%.
	</p>
      </div>

      <p class="annotation">
	Rendering all glyphs was agreed to for basic shapes at the
	<a href="http://www.w3.org/2015/02/12-svg-minutes.html#item05">Sydney
	  (2015)</a> meeting (but missing in minutes).
      </p>

      <dl class="attrdef-svg2">
	<dt>Value</dt>                <dd><a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> | <a>&lt;number&gt;</a></dd>
	<dt><a>Initial value</a></dt>  <dd>0</dd>
	<dt><a>Animatable</a></dt>    <dd>yes</dd>
      </dl>

    </dd>

    <dt id="TextPathElementMethodAttribute"><span class="adef">method</span></dt>
    <dd>
      <p>
	Indicates the method by which text should be rendered
        along the path.
      </p>
      <p>
        A value of <span class="attr-value">align</span> indicates
        that the glyphs should be rendered using simple 2x3
        transformations such that there is no stretching/warping of
        the glyphs. Typically, supplemental rotation, scaling and
        translation transformations are done for each glyph to be
        rendered. As a result, with
        <span class="attr-value">align</span>, fonts where the glyphs
        are designed to be connected (e.g., cursive fonts), the
        connections may not align properly when text is rendered along
        a path.
      </p>
      <p>
        A value of <span class="attr-value">stretch</span> indicates
        that the glyph outlines will be converted into paths, and then
        all end points and control points will be adjusted to be along
        the perpendicular vectors from the path, thereby stretching
        and possibly warping the glyphs.  With this approach,
        connected glyphs, such as in cursive scripts, will maintain
        their connections.
      </p>

      <dl class="attrdef-svg2">
	<dt>Value</dt>                <dd>align | stretch</dd>
	<dt><a>Initial value</a></dt>  <dd>align</dd>
	<dt><a>Animatable</a></dt>    <dd>yes</dd>
      </dl>
    </dd>

    <dt id="TextPathElementSpacingAttribute"><span class="adef">spacing</span></dt>
    <dd>
      <p>
        Indicates how the user agent should determine the
        spacing between glyphs that are to be rendered along a
        path.
      </p>
      <p>
        A value of <span class="attr-value">exact</span> indicates
        that the glyphs should be rendered exactly according to the
        spacing rules as specified in
        <a href="text.html#TextpathLayoutRules">Text on a path layout
        rules</a>.
      </p>
      <p>
        A value of <span class="attr-value">auto</span> indicates that
        the user agent should use text-on-a-path layout algorithms to
        adjust the spacing between glyphs in order to achieve visually
        appealing results.
      </p>

      <dl class="attrdef-svg2">
	<dt>Value</dt>                <dd>auto | exact</dd>
	<dt><a>Initial value</a></dt>  <dd>align</dd>
	<dt><a>Animatable</a></dt>    <dd>yes</dd>
      </dl>
    </dd>

    <dt id="TextPathElementDAttribute"><span class="adef">d</span></dt>
    <dd>
      <p>
        The definition of the path onto which the glyphs will be
        rendered.  The handling of erroneous path data follows the
        behavior specified in the
        <a href="paths.html#PathElementImplementationNotes"><span class="element-name">'path'</span>
        element implementation notes</a>.
      </p>
      <p>
        If both the <a>'d'</a> attribute and <a>'href'</a>
        attributes are specified, it is as if the <a>'href'</a>
        attribute were not specified for the purposes of rendering.
      </p>

      <dl class="attrdef-svg2">
	<dt>Value</dt>                <dd><a href="paths.html#PathDataBNF">svg-path</a> <a href="types.html#syntax" class="syntax">[EBNF]</a></dd>
	<dt><a>Initial value</a></dt>  <dd>See above.</dd>
	<dt><a>Animatable</a></dt>    <dd>yes</dd>
      </dl>

    </dd>

    <dt id="TextPathElementSideAttribute"><span class="adef">side</span></dt>
    <dd>
      <p>
        Determines the side of the path the text is placed on
	(relative to the path direction). Specifying a value
	of <span class="attr-value">right</span> effectively reverses
	the path.
      </p>
      <div class="figure">
	<img alt="Two circular path with different values of 'side'
		  showing glyphs rendered outside the circle for
		  'left' and inside the circle for 'right'."
		  src="images/text/text-path-side.svg" />
	<p class="caption">
	  Rendering for text on a path referencing a <a>'circle'</a>
	  with different values of the <a>'side'</a>
	  attribute. Left: <span class="attr-value">left</span>.
	  Right: <span class="attr-value">right</span>.
	</p>
      </div>

      <p class="note">
	Added in SVG 2 to allow text either inside or outside
	closed paths and <a>basic shapes</a> (e.g. rectangles,
	circles, and ellipses).
      </p>
      <p class="annotation">
	Adding 'side' was resolved at the
	<a href="http://www.w3.org/2015/02/12-svg-minutes.html#item05">Sydney
	  (2015)</a> meeting.
      </p>

      <dl class="attrdef-svg2">
	<dt>Value</dt>                <dd>left | right</dd>
	<dt><a>Initial value</a></dt>  <dd>left</dd>
	<dt><a>Animatable</a></dt>    <dd>yes</dd>
      </dl>

    </dd>

    <dt id="TextPathElementHrefAttribute"><span class="adef">href</span></dt>
    <dd>
      <p>
        An <a href="linking.html#URLReference">URL reference</a> to
        the <a>'path'</a> or <a>basic shape</a> element onto which
        the glyphs will be rendered. If &lt;url&gt; is an invalid
        reference (e.g., no such element exists, or the referenced
        element is not a <a>'path'</a>) or <a>basic shape</a>, then
        the <a>'textPath'</a> element is in error and its entire
        contents shall not be rendered by the user agent.
      </p>
      <p>
        Refer to the common handling defined for <a
        href="linking.html#linkRefAttrs">URL reference attributes</a> and
        <a href="linking.html#XLinkRefAttrs">deprecated XLink attributes</a>.
      </p>

      <dl class="attrdef-svg2">
	<dt>Value</dt>                <dd>URL <a href="types.html#attribute-url" class="syntax">[URL]</a></dd>
	<dt><a>Initial value</a></dt>  <dd>See above.</dd>
	<dt><a>Animatable</a></dt>    <dd>yes</dd>
      </dl>

    </dd>

  </dl>

  <p>
    The path data coordinates within the referenced <a>'path'</a>
    or <a>basic shape</a>
    element are assumed to be in the same coordinate system as the
    current <a>'text'</a> element, not in the coordinate system where
    the <a>'path'</a> element is defined. The <a>'transform'</a>
    attribute on the referenced <a>'path'</a> or <a>basic shape</a>
    element represents a
    supplemental transformation relative to the current user
    coordinate system for the current <a>'text'</a> element, including
    any adjustments to the current user coordinate system due to a
    possible <a>'transform'</a> property on the current <a>'text'</a>
    element.  For example, the following fragment of SVG content:
  </p>

  <pre>
&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;g <span
style="font-weight:bold; color:red">transform="translate(25,25)"</span>&gt;
    &lt;defs&gt;
      &lt;path id="path1" <span
style="font-weight:bold; color:green">transform="scale(2)"</span> d="..." fill="none" stroke="red"/&gt;
    &lt;/defs&gt;
  &lt;/g&gt;
  &lt;text <span
style="font-weight:bold; color:blue">transform="rotate(45)"</span>&gt;
    &lt;textPath href="#path1"&gt;Text on a path1&lt;/textPath&gt;
  &lt;/text&gt;
&lt;/svg&gt;
  </pre>

  <p>
    should have the same effect as the following:
  </p>

  <pre>
&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;g <span
style="font-weight:bold; color:blue">transform="rotate(45)"</span>&gt;
    &lt;defs&gt;
      &lt;path id="path1" <span
style="font-weight:bold; color:green">transform="scale(2)"</span> d="..." fill="none" stroke="red"/&gt;
    &lt;/defs&gt;
    &lt;text&gt;
      &lt;textPath href="#path1"&gt;Text on a path1&lt;/textPath&gt;
    &lt;/text&gt;
  &lt;/g&gt;
&lt;/svg&gt;
  </pre>

  <p>
    Note that the <code style="font-weight:bold;
    color:red">transform="translate(25,25)"</code> has no effect on
    the <a>'textPath'</a> element, whereas the
    <code style="font-weight:bold;
    color:blue">transform="rotate(45)"</code> applies to both
    the <a>'text'</a> and the use of the <a>'path'</a> element as the
    referenced shape for text on a path.
  </p>

  <p id="ExampleToap01">
    <span class="example-ref">Example toap01</span> provides a
    simple example of text on a path:
  </p>

  <edit:example href='images/text/toap01.svg' name='toap01' description="simple text on a path" image='yes' link='yes'/>

  <p id="ExampleToap02">
    <span class="example-ref">Example toap02</span> shows
    how <a>'tspan'</a> elements can be included
    within <a>'textPath'</a> elements to adjust styling attributes and
    adjust the current text position before rendering a particular
    glyph. The first occurrence of the word "up" is filled with the
    color red.  Attribute <a>'tspan/dy'</a> is used to lift the word
    "up" from the baseline.
  </p>

  <edit:example href='images/text/toap02.svg' name='toap02' description="tspan within textPath" image='yes' link='yes'/>

  <p id="ExampleToap03">
    <span class="example-ref">Example toap03</span> demonstrates the
    use of the <a>'startOffset'</a> attribute on the <a>'textPath'</a>
    element to specify the start position of the text string as a
    particular position along the path. Notice that glyphs that fall
    off the end of the path are not rendered
    (see <a href="text.html#TextpathLayoutRules">text on a path layout
    rules</a>).
  </p>

  <edit:example href='images/text/toap03.svg' name='toap03' description="text on a path with startOffset attribute" image='yes' link='yes'/>

<h3 id="TextpathLayoutRules">Text on a path layout rules</h3>

  <p>
    Conceptually, for text on a path the target path is stretched out
    into either a horizontal or vertical straight line segment. For
    horizontal text layout flows, the path is stretched out into a
    hypothetical horizontal line segment such that the start of the
    path is mapped to the left of the line segment. For vertical text
    layout flows, the path is stretched out into a hypothetical
    vertical line segment such that the start of the path is mapped to
    the top of the line segment. The standard
    <a href="text.html#TextLayoutAlgorithm">text layout</a> rules are
    applied to the hypothetical straight line segment and the result
    is mapped back onto the target path. Vertical and
    bidirectional <a href="text.html#TextLayoutAlgorithm">text layout</a> rules
    also apply to text on a path.
  </p>
  <p>
    The <a href="text.html#ReferenceOrientation">reference
    orientation</a> is determined individually for each glyph that is
    rendered along the path. For horizontal text layout flows, the
    reference orientation for a given glyph is the vector that starts
    at the intersection point on the path to which the glyph is
    attached and which points in the direction 90 degrees
    counter-clockwise from the angle of the curve at the intersection
    point. For vertical text layout flows, the reference orientation
    for a given glyph is the vector that starts at the intersection
    point on the path to which the glyph is attached and which points
    in the direction 180 degrees from the angle of the curve at the
    intersection point.
  </p>

  <p id="ExampleToap04">
    <span class="example-ref">Example toap04</span> will be used
    to illustrate the particular layout rules for text on a path
    that supplement the basic <a href="text.html#TextLayoutAlgorithm">text
      layout</a> rules for straight line horizontal or vertical
    text.
  </p>

  <edit:example href='images/text/toap04.svg' name='toap04' description="text on a path layout rules" image='yes' link='yes'/>

  <p>
    The following picture does an initial zoom in on the first glyph
    in the <a>'text'</a> element.
  </p>

  <img alt="Image that shows text
	    on a path" src="images/text/toap05.png" width="288" height="91" />

  <p>
    The small dot above shows the point at which the glyph is attached
    to the path. The box around the glyph shows the glyph is rotated
    such that its horizontal axis is parallel to the tangent of the
    curve at the point at which the glyph is attached to the path. The
    box also shows the glyph's <dfn id="CharWidth">charwidth</dfn>
    (i.e., the amount which the current text position advances
    horizontally when the glyph is drawn using horizontal text
    layout).
  </p>

  <p>
    The next picture zooms in further to demonstrate the detailed
    layout rules.
  </p>

  <img alt="Image that shows text on a path"
       src="images/text/toap06.png" width="288" height="176" />

  <p>
    For left-to-right horizontal text layout along a path (i.e.,
    when the glyph orientation is perpendicular to the
    <a>inline-base direction</a> the layout rules are as follows:
  </p>

  <ul>
    <li>
      Determine the
      <dfn id="StartPointOnPath">startpoint-on-the-path</dfn> for the
      first glyph using attribute <a>'startOffset'</a> and property
      <a>'text-anchor'</a>. For <span class='prop-value'>text-anchor:start</span>,
      startpoint-on-the-path is the point on the path which represents
      the point on the path which is <a>'startOffset'</a> distance
      along the path from the start of the path, calculated using the
      user agent's <a href="paths.html#DistanceAlongAPath">distance
      along the path</a> algorithm.

      For <span class="prop-value">text-anchor:middle</span>,
      startpoint-on-the-path is the point on the path which represents
      the point on the path which is [ <a>'startOffset'</a> minus half
      of the total advance values for all of the glyphs in
      the <a>'textPath'</a> element ] distance along the path from the
      start of the path, calculated using the user
      agent's <a href="paths.html#DistanceAlongAPath">distance along
      the path</a> algorithm.

      For <span class="prop-value">text-anchor:end</span>,
      startpoint-on-the-path is the point on the path which represents
      the point on the path which is [ <a>'startOffset'</a> minus the
      total advance values for all of the glyphs in
      the <a>'textPath'</a> element ]. Before rendering the first
      glyph, the horizontal component of the startpoint-on-the-path is
      adjusted to take into account various horizontal alignment text
      properties and attributes, such as a <a>'tspan/dx'</a> attribute
      value on a <a>'tspan'</a> element. (In the picture above, the
      startpoint-on-the-path is the leftmost dot on the path.)
    </li>

    <li>
      Determine the glyph's charwidth (i.e., the amount which
      the current text position advances horizontally when the
      glyph is drawn using horizontal text layout). (In the picture
      above, the charwidth is the distance between the two dots at
      the side of the box.)
    </li>

    <li>
      Determine the point on the curve which is charwidth
      distance along the path from the startpoint-on-the-path for
      this glyph, calculated using the user agent's
      <a href="paths.html#DistanceAlongAPath">distance along the
      path</a> algorithm. This point is the
      <dfn id="EndPointOnPath">endpoint-on-the-path</dfn> for the
      glyph. (In the picture above, the endpoint-on-the-path for the
      glyph is the rightmost dot on the path.)
    </li>

    <li>
      Determine the
      <dfn id="MidPointOnPath">midpoint-on-the-path</dfn>, which is
      the point on the path which is "halfway" (user agents can choose
      either a distance calculation or a parametric calculation)
      between the startpoint-on-the-path and the
      endpoint-on-the-path. (In the picture above, the
      midpoint-on-the-path is shown as a white dot.)
    </li>

    <li>
      Determine the <dfn id="GlyphMidline">glyph-midline</dfn>, which
      is the vertical line in the glyph's coordinate system that goes
      through the glyph's x-axis midpoint. (In the picture above, the
      glyph-midline is shown as a dashed line.)
    </li>

    <li>
      Position the glyph such that the glyph-midline passes
      through the midpoint-on-the-path and is perpendicular to the
      line through the startpoint-on-the-path and the
      endpoint-on-the-path.
    </li>

    <li>
      Align the glyph vertically relative to the midpoint-on-the-path
      based on property <a>'alignment-baseline'</a> and any specified
      values for attribute <a>'tspan/dy'</a> on a <a>'tspan'</a>
      element. In the example above, the <a>'alignment-baseline'</a>
      property is unspecified, so the initial value
      of <span class="prop-value">alignment-baseline:baseline</span>
      will be used. There are no <a>'tspan'</a> elements; thus, the
      baseline of the glyph is aligned to the
      midpoint-on-the-path.
    </li>

    <li>
      For each subsequent glyph, set a new startpoint-on-the-path as
      the previous endpoint-on-the-path, but with appropriate
      adjustments taking into account horizontal kerning tables in the
      font and current values of various attributes and properties,
      including spacing properties (e.g. <a>'letter-spacing'</a>
      and <a>'word-spacing'</a>) and <a>'tspan'</a> elements with
      values provided
      for attributes <a>'tspan/dx'</a> and <a>'tspan/dy'</a>. All
      adjustments are calculated as distance adjustments along the
      path, calculated using the user
      agent's <a href="paths.html#DistanceAlongAPath">distance along
      the path</a> algorithm.
    </li>

    <li>
      Glyphs whose midpoint-on-the-path are off either end of an open path
      are not rendered.
    </li>

    <li>
      Continue rendering glyphs until there are no more glyphs.
    </li>
  </ul>

  <p>
    Comparable rules are used for top-to-bottom vertical text
    layout along a path (i.e., when the glyph orientation is
    parallel with the <a>inline-base direction</a>,
    the layout rules are as follows:
  </p>

  <ul>
    <li>
      Determine the startpoint-on-the-path using the same method as
      for horizontal text layout along a path, except that before
      rendering the first glyph, the horizontal component of the
      startpoint-on-the-path is adjusted to take into account various
      vertical alignment text properties and attributes, such as
      a <a>'tspan/dy'</a> attribute value on a <a>'tspan'</a> element.
    </li>

    <li>
      Determine the glyph's charheight (i.e., the amount which
      the current text position advances vertically when the glyph
      is drawn using vertical text layout).
    </li>

    <li>
      Determine the point on the curve which is charheight
      distance along the path from the startpoint-on-the-path for
      this glyph, calculated using the user agent's
      <a href="paths.html#DistanceAlongAPath">distance along the
      path</a> algorithm. This point is the endpoint-on-the-path for
      the glyph.
    </li>

    <li>
      Determine the midpoint-on-the-path, which is the point on the
      path which is "halfway" (user agents can choose either a
      distance calculation or a parametric calculation) between the
      startpoint-on-the-path and the endpoint-on-the-path.
    </li>

    <li>
      Determine the glyph-midline, which is the horizontal line in the
      glyph's coordinate system that goes through the glyph's y-axis
      midpoint.
    </li>

    <li>
      Position the glyph such that the glyph-midline passes through
      the midpoint-on-the-path and is perpendicular to the line
      through the startpoint-on-the-path and the endpoint-on-the-path.
    </li>

    <li>
      Align the glyph horizontally (where horizontal is relative to
      the glyph's coordinate system) relative to the
      midpoint-on-the-path based on
      property <a>'alignment-baseline'</a> and any specified values
      for attribute <a>'tspan/dx'</a> on a <a>'tspan'</a> element.
    </li>

    <li>
      For each subsequent glyph, set a new startpoint-on-the-path as
      the previous endpoint-on-the-path, but with appropriate
      adjustments taking into account vertical kerning tables in the
      font and current values of various attributes and properties,
      including spacing
      properties and <a>'tspan'</a> elements with values provided
      for attributes <a>'tspan/dx'</a> and <a>'tspan/dy'</a>. All
      adjustments are calculated as distance adjustments along the
      path, calculated using the user agent's
      <a href="paths.html#DistanceAlongAPath">distance along
      the path</a> algorithm.
    </li>

    <li>
      Glyphs whose midpoint-on-the-path are off either end of
      an open path are not rendered.
    </li>

    <li>
      Continue rendering glyphs until there are no more
      glyphs.
    </li>
  </ul>

  <p>
    In the calculations above, if either the startpoint-on-the-path or
    the endpoint-on-the-path is off the end of the path, then extend
    the path beyond its end points with a straight line that is
    parallel to the tangent at the path at its end point so that the
    midpoint-on-the-path can still be calculated.
  </p>

  <p>
    When the <a>inline-base direction</a>
    is horizontal, then any <span class="attr-name">'x'</span>
    attributes on <a>'text'</a> or <a>'tspan'</a>
    elements represent new absolute offsets along
    the path, thus providing explicit new values for
    startpoint-on-the-path. Any <span class="attr-name">'y'</span>
    attributes on <a>'text'</a> or <a>'tspan'</a>
    elements are ignored.

    When the <a>inline-base direction</a>
    is vertical, then any <span class="attr-name">'y'</span>
    attributes on <a>'text'</a> or <a>'tspan'</a>
    elements represent new absolute offsets along
    the path, thus providing explicit new values for
    startpoint-on-the-path. Any <span class="attr-name">'x'</span>
    attributes on <a>'text'</a> or <a>'tspan'</a> elements are ignored.
  </p>

</edit:with>

<h2 id="TextRenderingOrder">Text rendering order</h2>

<p>A <a>'text'</a> element is rendered in one or more chunks.
Each chunk (as produced by the <a href="#TextLayoutAlgorithm">text layout algorithm</a>)
is rendered, one after the other, in document order.  Each
rendered chunk, which consists of one or more glyphs,
is filled and stroked as if it were a single path.</p>

<p>For the purposes of painting, a <a>'text'</a> has zero, one, or more
<a>equivalent paths</a>, one for each chunk.  Each equivalent path
consists of one subpath per glyph within that chunk.</p>

<p class="note">Since the <a>'fill-rule'</a> property does not apply
to SVG text elements, the specific order of the subpaths within
the <a>equivalent path</a> does not matter.</p>

<p>The specific position of the start of each subpath, and the direction
that the path progresses around glyph shape, is not defined.</p>

<p class="note">This means that dashed strokes on text may not place
the dash pattern at the same positions across different implementations.</p>

<p class="issue" data-issue="47">Make sure these chunks are not confused with the
text anchoring chunks.</p>

<h3 id='TextOverflowProperty'>Text overflow processing:
  the <span class="property">'text-overflow'</span> property</h3>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Add <a>'text-overflow'</a> functionality.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2011/03/03-svg-minutes.html#item04">We will add text-overflow in SVG 2.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>To align with CSS, allow indicating that not all text is shown.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Erik (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3003">ACTION-3003</a>)</td>
      </tr>
    </table>
  </div>

  <p class="note">
    New in SVG 2.

    Added to allow user agents to handle text strings that overflow a
    predefined region in a more useful way.  Aligns SVG and HTML/CSS
    text processing.
  </p>

  <p class="note">
    See the CSS3 UI specification for the definition of
    of <a href="http://www.w3.org/TR/2012/WD-css3-ui-20120117/#text-overflow">'text-overflow'</a>.
    [<a href="refs.html#ref-CSS3UI">CSS3UI</a>]
  </p>

  <p>
    SVG uses the <a>'text-overflow'</a> property to control
    how <a>text content block elements</a> render when the text
    overflows a specified region. In the case of wrapped text, the
    region is the <a>wrapping area</a>. In the case of text on a path,
    a region is determined by the path length. Pre-formatted text does
    not create a region.
  </p>

  <p>
    When applied to a <a>text content block element</a>
    setting <a>'text-overflow'</a> to
    <span class="attr-value">ellipsis</span> then if the text that is
    to be rendered overflows the specified region an ellipsis is
    rendered such that it fits within the given region. For the
    purposes of rendering, the ellipsis is treated as if it replaced
    the characters at the point where it is inserted.

    <!--The text positioning attributes
    (<a>'text/x'</a>, <a>'text/y'</a>, <a>'text/dx'</a>, <a>'text/dy'</a>, <a>'text/rotate'</a>)
    apply to the ellipsis as if it was one character in the logical
    document order mapping to one glyph.-->

    In SVG <a>'text-overflow'</a> has an effect if there is a validly
    specified region, regardless of the computed value of
    the <a>'overflow'</a> property on the <a>text content block
    element</a>.
  </p>

  <p>
    Any other value for <a>'text-overflow'</a> is treated as if it
    wasn't specified.
  </p>

  <p class="issue" data-issue="38">
    SVG could allow the keyword 'clip' to work too. It's already
    possible to do clipping with clip-path, but it's unconditional,
    where this would theoretically only clip if the text
    overflowed. It's mostly a convenient shorthand.
  </p>

  <p>
    Note that the effect of <a>'text-overflow'</a> is purely visual,
    the ellipsis itself does not become part of the DOM.  For all the
    DOM methods it's as if <a>'text-overflow'</a> wasn't applied, and
    as if <a>'inline-size'</a> didn't constrain the text.
  </p>

  <p class="issue" data-issue="39">Need updated example.</p>
  <div class="example">
    <p>
      The following example shows the use of <a>'text-overflow'</a>.
      The top line shows text as it would normally be rendered, without any width restriction.
      The middle line shows text with text-overflow=clip specified, and the bottom line shows
      text with text-overflow=ellipsis.
    </p>

    <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="180" height="120" viewBox="0 0 180 120">
  <style>
    text { font: 16px sans-serif; }
    rect { fill: none; stroke: black; vector-effect: non-scaling-stroke; stroke-width: 1; }
  </style>

  <g>
    <rect x="19.5" y="16.5" width="100" height="20"/>
    <text x="20" y="2em" width="100">SVG is awesome</text>
  </g>

  <g transform="translate(0,30)">
    <rect x="19.5" y="16.5" width="100" height="20"/>
    <text x="20" y="2em" width="100" text-overflow="clip">SVG is awesome</text>
  </g>

  <g transform="translate(0,60)">
    <rect x="19.5" y="16.5" width="100" height="20"/>
    <text x="20" y="2em" width="100" text-overflow="ellipsis">SVG is awesome</text>
  </g>
</svg>
]]></pre>

    <div class="figure">
      <img class="bordered" src="images/text/text-overflow-ref.svg"
           alt="Image showing the use of the text-overflow property."/>
      <p class="caption">The <a>'text-overflow'</a> property used on
      text elements, the bottom line showing text with an ellipsis
      applied.</p>
    </div>
  </div>

  <p class="issue" data-issue="40">It has been argued that this property is useless. It
    would be of more use if coupled with a mechanism that would expose
    the hidden text (tool-tip on hovering over ellipses?).
  </p>

<h2 id="TextProperties">Properties and pseudo-elements</h2>

  <p>
    CSS offers a multitude of properties for styling text. In
    general, only two sets of properties are applicable to SVG: those
    that determine which glyphs are to be rendered
    (<a>'font-family'</a>, <a>'font-style'</a>, etc.) and those that
    apply at the <em>paragraph</em> level (<a>'direction'</a>,
    <a>'writing-mode'</a>, <a>'line-height'</a>, <a>'letter-spacing'</a>,
    etc.).
  </p>

  <p>
    The list of CSS properties that must be supported on SVG text
    elements can be found in the
    the <a href="styling.html#RequiredProperties">Styling</a> chapter.
  </p>

  <ul>
    <li>
      Properties that apply only to pre-formatted text:
      <p>
	<a>'text-anchor'</a>.
      </p>
    </li>
    <li>
      Properties that apply only to auto-wrapped text:
      <p>
	<a>'text-align'</a>,
	<a>'text-align-all'</a>,
	<a>'text-align-last'</a>,
	<a>'text-indent'</a>,
	<a>'text-justify'</a>,
	<a>'line-break'</a>,
	<a>'word-break'</a>,
	<a>'hyphens'</a>,
	<a>'word-wrap'</a>,
	<a>'overflow-wrap'</a>.
      </p>
    </li>
  </ul>

  <p>
    Additionally, the @font-face rule must be supported for
    font selection as well as
    the ::first-line and ::first-letter pseudo-elements must be
    supported on <a>'text'</a> elements.
  </p>

  <p>
    Other CSS properties that affect text layout and rendering may
    also be supported by an SVG user agent; their effect should be
    taken into account as part of the CSS text layout step of the
    overall SVG text layout process.
  </p>

  <p class="note">
    For example, while SVG 2 does not require support for the
    <a>'text-combine-upright'</a> property, its behavior in an SVG
    context should be obvious.
  </p>

  <p>
    A number of CSS properties must not have any effect on SVG text elements:
  </p>

  <ul>
    <li>
      Border properties (such as <a>'border-top-style'</a>).  Boxes
      generated by the CSS layout process must not be sized as if they
      had any borders.  The used value for all of
      the <a>'border-style'</a> component longhand properties on SVG
      text elements is <span class='prop-value'>none</span>.
    </li>

    <li>
      Display property values other than
      <span class='prop-value'>none</span> and
      <span class='prop-value'>inline</span>. Like all other SVG
      elements, any value of <a>'display'</a> on an SVG text element
      other than <span class='prop-value'>none</span> is handled just
      as if it were <span class='prop-value'>inline</span>.  Thus it
      is not possible for a single <a>'text'</a> element to have any
      block children.
    </li>

    <li>
      The <a>'float'</a> property, whose used value on SVG text
      elements is <span class='prop-value'>none</span>.
    </li>

    <li>
      The <a>'position'</a> property, whose used value on SVG text
      elements is <span class='prop-value'>static</span>.
    </li>

    <li>
      Margin properties (such as <a>'margin-top'</a>), whose used
      values on SVG text elements are
      <span class='prop-value'>0</span>.
    </li>

    <li>
      The <a>'text-align'</a> property, whose used value on SVG text
      elements is <span class='prop-value'>start</span>.
    </li>

    <li>
      The <a>'content'</a> property, whose used value on SVG text
      elements is <span class='prop-value'>none</span>.
    </li>
  </ul>

  <p class="issue" data-issue="44">What about text-indent?</p>

  <p>
    Additionally, the ::before and ::after generated content pseudo-elements
    must not apply to SVG text elements.
  </p>

<h3 id="TextPropertiesAdaptions">SVG Adaptions</h3>

  <p>
    This section covers properties that are not covered elsewhere in this
    specification and either have SVG specific rules or are significanlty
    altered from SVG 1.1.
  </p>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Reference CSS3 Fonts.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2011/07/29-svg-minutes.html#item08">SVG 2 will depend on CSS3 Fonts.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>Alignment with CSS 2.1 and CSS3 for Web font functionality, and to provide
	  access to advanced typographic features of fonts.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Chris (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3123">ACTION-3123</a>)</td>
      </tr>
    </table>
  </div>

  <h4 id='FontVariantProperty'>The <span class="property">'font-variant'</span> property</h4>
  <p>
    CSS Font Module Level 3 changes the meaning of the
    <a href="http://www.w3.org/TR/css3-fonts/#propdef-font-variant">'font-variant'</a>
    property from that defined by CSS 2.1. It has been repurposed (and
    function greatly expanded) as a shorthand for selecting font
    variants from within a single font.
  </p>
  <p class="note">
    SVG 2 requires all <a>'font-variant'</a> subproperties to be
    implemented (e.g. 'font-varaint-ligatures').
  </p>

  <h4 id='KerningProperty'>The <span class="property">'kerning'</span> property</h4>
  <p>
    SVG 1.1 uses the 'kerning' property to determine if the font
    kerning tables should be used to adjust inter-glyph
    spacing. It also allows a
    <span class="prop-value">&lt;length&gt;</span> value which
    if given is added to the spacing between glyphs (suplemental
    to any from the <a>'letter-spacing'</a> property). This
    property is replaced in SVG 2 by the
    CSS <a>'font-kerning'</a> property which solely controls
    turning on/off the use of the font kerning tables. The main
    use for 'kerning' is to turn off auto-kerning thus for
    minimal backwards compatability, a 'kerning' value of '0'
    should be mapped to a <a>'font-kerning'</a> value of 'none'.
  </p>
  <p class="issue" data-issue="29">Is this a reasonable way to
    handle the removed 'kerning' property?</p>

  <h4 id='LineHeightProperty'>The <span class="property">'line-height'</span> property</h4>

  <p>
    SVG uses the <a>'line-height'</a> property to determine the amount
    of leading space which is added between lines in multi-line text
    (both for horizontal and vertical text). It is not applicable to
    text on a path.
  </p>
  <p class="issue" data-issue="49">'line-height' is refered to
    several places in this chapter with noting that 'line-height' is
    assumed to be equal to the 'font-size'. These must be fixed.
  </p>
  <p class="issue" data-issue="50">Do we refer to
    <a href="http://www.w3.org/TR/CSS21/visudet.html#line-height">CSS 2.1</a> or
    <a href="http://dev.w3.org/csswg/css-inline/">CSS Inline Module Level 3</a>?
  </p>

  <h4 id='WritingModeProperty'>The <span class="property">'writing-mode'</span> property</h4>

  <p>
    This property sets the <a>block-flow direction</a>; or in-other-words,
    the direction in which lines of text are stacked. As a consequence it
    also determines if the text has a horizontal or vertical orientation.
  </p>
  <p class="issue" data-issue="53">
    SVG 1.1 states that this property only has an effect on a text element. Is this still the case?
  </p>
  <p>
    SVG 2 references
    <a href="http://dev.w3.org/csswg/css-writing-modes-3/">CSS Writing
      Modes Level 3</a> for the definition of the
    <a href="http://dev.w3.org/csswg/css-writing-modes-3/#block-flow">'writing-mode'</a>
    property. That specification introduces new values for the property.
    The SVG 1.1 values are obsolete but must still be supported by
    converting the specified values to computed values as follows:
  </p>
  <ul>
    <li>
      <span class="prop-value">'lr'</span>,
      <span class="prop-value">'lr-tb'</span>,
      <span class="prop-value">'rl'</span>, and
      <span class="prop-value">'rl-tb'</span> to
      <span class="prop-value">'horizontal-tb'</span>;
    </li>
    <li>
      <span class="prop-value">'tb'</span>, and
      <span class="prop-value">'tb-rl'</span>, to
      <span class="prop-value">'vertical-rl'</span>.
    </li>
  </ul>
  <p class="note"><!-- This could be an annotation. -->
    In SVG 1.0, this property could be interpreted as to also setting the
    <a>inline-base direction</a> leading to confusion about its role
    relative to the <a>'direction'</a> property. SVG 1.1 was a bit
    more specific about the role of <a>'direction'</a>
    (e.g. that <a>'direction'</a> set the reference point for
    the <a>'text-anchor'</a> property) but still was open to
    interpretation. The fact that neither SVG 1.0 nor SVG 1.1 allowed
    multi-line text added to the confusion.
  </p>
  <p class="note">
    Except for the additional information provided here, the
    <a href="http://dev.w3.org/csswg/css-writing-modes-3/#block-flow">normitive
      definition</a> of the <a>'writing-mode'</a> property is in CSS
      Writing Modes Level 3
      ([<a href="refs.html#ref-CSSWRITINGMODES3">CSSWRITINGMODES3</a>]).
  </p>

  <h4 id='DirectionProperty'>The <span class="property">'direction'</span> property</h4>

  <p>
    The property specifies the <a>inline-base direction</a> of a
    <a>'text'</a> or <a>'tspan'</a> element. It defines the
    <q>start</q> and <q>end</q> points of a line of text as used by
    the <a>'text-anchor'</a> and <a>'inline-size'</a> properties. It
    also may effect the direction in which characters are positioned
    if the <a>'unicode-bidi'</a> property's value is either
    <span class='prop-value'>embed</span> or
    <span class='prop-value'>bidi-override</span>.
  </p>
  <p>
    The <a>'direction'</a> property applies only to glyphs oriented
    perpendicular to the <a>inline-base direction</a>,
    which includes the usual case of horizontally-oriented Latin or
    Arabic text and the case of narrow-cell Latin or Arabic characters
    rotated 90 degrees clockwise relative to a top-to-bottom
    inline-progression-direction.
  </p>
  <p class="issue" data-issue="54">
    Check this agrees with CSS3 Writing modes.
  </p>

  <p class="note">
    Except for the additional information provided here, the
    <a href="http://www.w3.org/TR/css-writing-modes-3/#direction">normative
      definition</a> of the <a>'direction'</a> property is in CSS
      Writing Modes Level 3
      ([<a href="refs.html#ref-CSSWRITINGMODES3">CSSWRITINGMODES3</a>]).
  </p>

  <p class="issue" data-issue="55">
    Move the following examples to the (yet to exist) examples section?
  </p>
  <p>
    In many cases, the bidirectional algorithm from Unicode
    [<a href="refs.html#ref-UNICODE">UNICODE</a>] produces the desired
    result automatically, and in such cases the author does not need
    to use these properties. For other cases, such as when using
    right-to-left languages, it may be sufficient to add the
    <a>'direction'</a> property to the <a>outermost svg element</a>,
    and allow that direction to inherit to all text elements, as in the
    following example (which may be used as a template):
  </p>

  <edit:example href="images/text/rtl-text.svg" link="yes" image="yes"/>

  <p>
    Below is another example, where where implicit bidi reordering is not sufficient:
  </p>

  <edit:example href="images/text/rtl-complex.svg" link="yes" image="yes"/>


  <h4 id='GlyphOrientationHorizontalProperty'>The <span class="property">'glyph-orientation-horizontal'</span> property</h4>

  <p>
    This property has been removed in SVG 2.
  </p>

  <h4 id='GlyphOrientationVerticalProperty'>The <span class="property">'glyph-orientation-vertical'</span> property</h4>

  <p>
    This property applies only to vertical text. It has been obsoleted
    in SVG 2 and partially replaced by the <a>'text-orientation'</a>
    property of CSS Writing Modes Level 3. The following SVG 1.1
    values must still be supported by aliasing the property
    as a shorthand to <a>'text-orientation'</a> as follows:
  </p>
  <ul>
    <li>
      <span class="prop-value">'auto'</span> to
      <span class="prop-value">'mixed'</span>;
    </li>
    <li>
      <span class="prop-value">'0deg'</span>, and
      <span class="prop-value">'0'</span>, to
      <span class="prop-value">'upright'</span>.
    </li>
    <li>
      <span class="prop-value">'90deg'</span>, and
      <span class="prop-value">'90'</span>, to
      <span class="prop-value">'sideways'</span>.
    </li>
  </ul>
  <p>
    Any other values must be treated as invalid.
  </p>

<h2 id="TextLayoutPositioning">Text layout &#x2013; Positioning</h2>

  <p class="issue" data-issue="25">
    Current text position is referred to throughout the document
    (almost 100 times!).
    The idea of current text position needs to be reconciled with
    CSS inline boxes. See:
    <a href="http://dev.w3.org/csswg/css-inline/">CSS-Inline</a> as
    well as with the idea that text is laid out first using CSS rules
    and then tranformed, if necessary, with SVG rules.
  </p>

  <p>
    The section covers the general rules for positiong glyphs. In SVG,
    the first step in positioning a glyph is to find its inline
    position which is determined by the <a>current text
    position</a>. Next, the glyph is aligned relative to a particular
    <a href="text.html#BaselineAlignmentProperties">baseline</a>.
    Once a glyph is positioned, the <a>current text position</a> is
    advanced and the next glyph is placed.
  </p>


<h3 id="CurrentTextPosition">Current text position</h3>

  <p>
    In processing a given <a>'text'</a> element, the SVG user agent
    keeps track of the <dfn>current text position</dfn>. The initial
    current text position is established by the <a>'text/x'</a>
    and <a>'text/y'</a> attributes on the <a>'text'</a> element for
    pre-formatted and in some cases for auto-wrapped text.
    <span class="issue">FIX FOR AUTO-WRAPPED TEXT IN SHAPE</span>
  </p>

  <p>
    The current text position is adjusted after each glyph to
    establish a new current text position at which the next glyph
    shall be rendered. The adjustment to the current text position is
    based on:
  </p>
  <ul>
    <li>The current <a>inline-base direction</a>.</li>
    <li>Glyph-specific advance values corresponding to
    the glyph orientation of
    the glyph just rendered.</li>
    <li>Kerning tables in the font.</li>
    <li>The current values of various attributes and properties, such as
    <a>'letter-spacing'</a> and <a>'word-spacing'</a>.</li>
    <!-- Removed in SVG2: <li>For pre-formatted and text on a a path, the â€˜xâ€™, â€˜yâ€™, â€˜dxâ€™, and â€˜dyâ€™ attributes on â€˜textâ€™, â€˜tspanâ€™, â€˜trefâ€™, or â€˜altGlyphâ€™ elements.</li>-->
    <li>New lines in pre-formatted or auto-wrapped text.<!-- Added in SVG2--></li>
  </ul>
  <p>
    If a glyph does not provide explicit advance values corresponding
    to the current glyph
    orientation, then an appropriate approximation should be
    used. For vertical text, a suggested approximation is the sum of
    the ascent and descent values for the glyph. Another suggested
    approximation for an advance value for both horizontal and
    vertical text is the size of an <em>em</em><!-- (see
    <a href="fonts.html#FontFaceElementUnitsPerEmAttribute">units-per-em</a>)-->.
  </p>

  <p id="AlignmentPoint">
    For each glyph to be rendered, the SVG user agent determines an
    appropriate <dfn>alignment point</dfn> on the glyph which will be
    placed exactly at the current text position. The alignment point is
    determined based on glyph cell metrics in the glyph itself, the
    current <a>inline-base direction</a>
    and the glyph orientation
    relative to the inline-progression-direction.  For example, in most
    uses of pre-formatted Latin text (i.e.,

    <span class='attr-value'>writing-mode:lr</span>,
    <span class='attr-value'>text-anchor:start</span>, and
    <span class='attr-value'>alignment-baseline:baseline</span>)

    the alignment point in the glyph will be the intersection of left
    edge of the glyph cell (or some other glyph-specific x-axis
    coordinate indicating a left-side origin point) with the Latin
    baseline of the glyph. For many cases with top-to-bottom vertical
    text layout, the reference point will be either a glyph-specific
    origin point based on the set of vertical baselines for the font
    or the intersection of the center of the glyph with its <em>top
    line</em>

    (see
    <a href="http://dev.w3.org/csswg/css-writing-modes-3/#text-baselines">Text
      Baselines</a> in [<a href="refs.html#ref-CSSWRITINGMODES3">CSSWRITINGMODES3</a>]).

    If a glyph does not provide explicit origin points corresponding
    to the current glyph orientation (vertical or horizontal),
    then an appropriate approximation should be used,
    such as the intersection of the left edge of the glyph with the
    appropriate horizontal baseline for the glyph or intersection of
    the top edge of the glyph with the appropriate vertical
    baseline. If baseline tables are not available, user agents should
    establish baseline tables that reflect common practice.
  </p>

  <p class="issue" data-issue="26">
    The distinction between absolute and relative position adjustments
    seems mostly made to define text chunks.  'x' and 'y' attributes
    are ignored for wrapped text and partially ignored for text on a
    path. Does this impact text chunks?  How are new lines (either
    manual or auto) handled?
  </p>

  <p id="TextChunks">
    Once all the glyphs in a <a>'text'</a> element are laid out
    according to the above rules, the position of the glyphs maybe
    adjusted according to SVG specific rules.
    Adjustments to the current text position are either
    <dfn id='absolute-position-adjustment'>absolute position adjustments</dfn> or
    <dfn id='relative-position-adjustment'>relative position
    adjustments</dfn>. An absolute position adjustment occurs in the
    following circumstances:
  </p>

  <ul>
    <li>At the start of a <a>'text'</a> element</li>
    <li>At the start of each <a>'textPath'</a> element</li>
    <li>For each character within a <a>'text'</a> and <a>'tspan'</a>
    element which for pre-formatted text has an explicit
    <span class='attr-name'>'x'</span> or
    <span class='attr-name'>'y'</span> value,
    or for text on a path has an explicit
    <span class='attr-name'>'x'</span> value if horizontal or
    <span class='attr-name'>'y'</span> value if vertical.</li>
  </ul>

  <p>
    All other position adjustments to the current text position are
    relative position adjustments.
  </p>

  <p id="TextChunk">
    Each absolute position adjustment defines a new
    <dfn>text chunk</dfn>. Absolute position adjustments impact text
    layout in the following ways:
  </p>

  <ul>
    <li>
      Ligatures only occur when a set of characters which might map
      to a ligature are all in the same text chunk.
    </li>
    <li>
      Each text chunk represents a separate block of text for
      alignment due to <a>'text-anchor'</a> property values.
    </li>
    <li>
      Reordering of characters due to bidirectionality
      only occurs within a text chunk. Reordering does <em>not</em>
      happen across text chunks.
    </li>
  </ul>

  <p>
    The following additional rules apply to ligature formation:
  </p>

  <ul>
    <li>
      As <a href="http://www.w3.org/TR/2011/REC-CSS2-20110607/text.html#spacing-props">defined
      in CSS 2.1</a>, ([<a href="refs.html#ref-CSS21">CSS21</a>],
      section 16.4), when the resultant space between two characters
      is not the same as the default space, user agents should not
      use ligatures; thus, if there is a non-default value for
      <a>'letter-spacing'</a>, the user agent should not use
      ligatures.
    </li>

    <li>
      Ligature formation should not be enabled for the glyphs
      corresponding to characters within different DOM text nodes;
      thus, characters separated by markup should not use ligatures.
    </li>

    <li>
      As mentioned above, ligature formation should not be
      enabled for the glyphs corresponding to characters within
      different text chunks.
    </li>
  </ul>

<h3 id="WhiteSpace">White Space</h3>

  <p class="note">
    New in SVG 2. Added <a>'white-space'</a> to allow a more useful
    way to control whitespace handling.  Aligns SVG and HTML/CSS text
    processing. <a>'xml:space'</a> deprecated in new content, retained
    for backwards compatibility.
  </p>

  <h4 id="TextWhiteSpace">SVG 2 Preferred white space handling, the <span class='property'>'white-space'</span> property</h4>

  <p>
    Rendering of white space in SVG 2 is controlled by the <a>'white-space'</a>
    property. This specifies two things:
  </p>
  <ul>
    <li>whether and how white space inside the element is collapsed</li>
    <li>whether lines may wrap at unforced soft wrap opportunities</li>
  </ul>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="WhiteSpaceProperty">white-space</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td>normal | pre | nowrap | pre-wrap | pre-line </td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>not defined for shorthand properties </td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>text content elements</a></td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>yes</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>N/A</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td>see individual properties </td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes</td>
    </tr>
  </table>

  <p class="note">
    Values and their meanings are defined in
    [<a href="http://dev.w3.org/csswg/css3-text/#white-space">CSS3
    Text</a>].
  </p>

  <div class="example">
    <p>
      An example of using the <a>'white-space'</a>
      value <span class="prop-value">pre-line</span>.
    </p>

    <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg">
     width="200" height="200" viewBox="0 0 200 200">

     <text x="150" y="30"
           font-family="IPAMincho"
	   font-size="20px"
	   writing-mode="tb-rl"
	   white-space="pre-line">åƒåˆ©å¥´æµä¹Žå’ŒåŠ 
                                  é¤˜å¤šé€£æ›½æ´¥ç¥¢é‚£
                                  è‰¯ç‰Ÿæœ‰ç‚ºèƒ½æ–¼ä¹…
                                  è€¶ä¸‡è¨ˆä¸å·±è¡£å¤©
                                  é˜¿ä½ä¼Žå–©å¥³ç¾Žä¹‹
                                  æµæ¯”æ¯›å‹¢é ˆ</text>
</svg>
]]></pre>

    <div class="figure">
      <img class="bordered" src="images/text/text-whitespace-vertical.svg"
           alt="Japanese poem showing traditional line-breaking after every seven kanji."/>
      <p class="caption">
	Example of multi-line vertical text with line breaks. The text
	is from the Japanese poem <em>Iroha</em>. The lines are broken
	at traditional places. <span class="issue">Example does not
	  render properly in Firefox. It is SVG 1.1 text. Bad Firefox.</span>
      </p>
    </div>
  </div>


<h4 id="LegacyXMLSpace">Legacy whitespace handling, the <span class='property'>'xml:space'</span> property</h4>

  <p id="XMLSpaceAttribute">
    For compatibility, SVG 2 also supports the  XML attribute
    <a>'xml:space'</a> to specify the handling of white space
    characters within a given <a>'text'</a> element's character
    data. New content should not use <a>'xml:space'</a> but
    instead, use the <a>'white-space'</a> property.
  </p>

  <p class="issue" data-issue="27">I think we should limit the discussion of xml:space
  and just define it in the user agent style sheet to a value
  of <a>'white-space'</a>.
  <a href="https://log.csswg.org/irc.w3.org/css/2015-02-08/#e519951">fantasai
  agreed</a> to add an appropriate value for <a>'white-space'</a> to match
  SVG 1.1's odd xml:space="preserve" behaviur.</p>

  <p>
    Note that any child element of a <a>'text'</a> element may also
    have an <a>'xml:space'</a> attribute which will apply to that
    child element's text content.  The SVG user agent has special
    processing rules associated with this attribute as described
    below. These are behaviors that occur subsequent to XML parsing
    [<a href="http://www.w3.org/TR/2008/REC-xml-20081126/">XML10</a>]
    and any construction of a DOM.
  </p>

  <p>
    <a>'xml:space'</a> is an inheritable attribute which can have one of
    two values:
  </p>

  <dl>
    <dt><span class='attr-value'>'default'</span></dt>
    <dd>
      (The initial/default value for <a>'xml:space'</a>.) When
      <span class='attr-value'>xml:space="default"</span>, the SVG
      user agent will do the following using a copy of the original
      character data content. First, it will remove all newline
      characters. Then it will convert all tab characters into space
      characters. Then, it will strip off all leading and trailing
      space characters. Then, all contiguous space characters will be
      consolidated.
    </dd>

    <dt><span class='attr-value'>'preserve'</span></dt>
    <dd>
      When <span class='attr-value'>xml:space="preserve"</span>, the
      SVG user agent will do the following using a copy of the
      original character data content. It will convert all newline and
      tab characters into space characters. Then, it will draw all
      space characters, including leading, trailing and multiple
      contiguous space characters. Thus, when drawn with
      <span class='attr-value'>xml:space="preserve"</span>, the string
      <code>"a&nbsp;&nbsp;&nbsp;b"</code> (three spaces between "a"
      and "b") will produce a larger separation between "a" and "b"
      than <code>"a&nbsp;b"</code> (one space between "a" and "b").
    </dd>
  </dl>

  <p>
    The following example illustrates that line indentation can be
    important when using
    <span class='attr-value'>xml:space="default"</span>.  The fragment
    below show two pairs of similar <a>'text'</a> elements, with
    both <a>'text'</a> elements using
    <span class="attr-value">xml:space="default"</span>. For
    these examples, there is no extra white space at the end of any of
    the lines (i.e., the line break occurs immediately after the last
    visible character).
  </p>

  <pre>
[01]  &lt;text xml:space='default'&gt;
[02]    WS example
[03]    indented lines
[04]  &lt;/text&gt;
[05]  &lt;text xml:space='preserve'&gt;WS example indented lines&lt;/text&gt;
[06]
[07]  &lt;text xml:space='default'&gt;
[08]WS example
[09]non-indented lines
[10]  &lt;/text&gt;
[11]  &lt;text xml:space='preserve'&gt;WS examplenon-indented lines&lt;/text&gt;
  </pre>

  <p>
    The first pair of <a>'text'</a> elements above show the
    effect of indented character data. The attribute
    <span class="attr-value">xml:space="default"</span> in the first
    <a>'text'</a> element instructs the user agent to:
  </p>

  <ul>
    <li>convert all tabs (if any) to space characters,</li>
    <li>strip out all line breaks (i.e., strip out the line
    breaks at the end of lines [01], [02] and [03]),</li>
    <li>strip out all leading space characters (i.e., strip out
    space characters before "WS example" on line [02]),</li>
    <li>strip out all trailing space characters (i.e., strip out
    space characters before "&lt;/text&gt;" on line [04]),</li>
    <li>consolidate all intermediate space characters (i.e., the
    space characters before "indented lines" on line [03]) into a
    single space character.</li>
  </ul>

  <p>
    The second pair of <a>'text'</a> elements above show the
    effect of non-indented character data. The attribute
    <span class="attr-value">xml:space="default"</span> in the third
    <a>'text'</a> element instructs the user agent to:
  </p>

  <ul>
    <li>convert all tabs (if any) to space characters,</li>
    <li>strip out all line breaks (i.e., strip out the line
    breaks at the end of lines [07], [08] and [09]),</li>
    <li>strip out all leading space characters (there are no
    leading space characters in this example),</li>
    <li>strip out all trailing space characters (i.e., strip out
    space characters before "&lt;/text&gt;" on line [10]),</li>
    <li>consolidate all intermediate space characters into a
    single space character (in this example, there are no
    intermediate space characters).</li>
  </ul>

  <p>
    Note that XML parsers are required to convert the standard
    representations for a newline indicator (e.g., the literal
    two-character sequence "#xD#xA" or the stand-alone literals #xD or
    #xA) into the single character #xA before passing character data
    to the application. Thus, each newline in SVG will be represented
    by the single character #xA, no matter what representation for
    newlines might have been used in the original resource. (See
    <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#sec-line-ends">XML
    end-of-line handling</a>.)
  </p>

  <p>
    Any features in the SVG language or the SVG DOM that are based
    on character position number, such as the <a>'tspan/x'</a>,
    <a>'tspan/y'</a>, <a>'tspan/dx'</a>, <a>'tspan/dy'</a> and
    <a>'tspan/rotate'</a> attributes on the <a>'text'</a> and <a>'tspan'</a>
    elements, are based on
    character position after applying the white space handling rules
    described here.  In particular,
    if <span class='attr-value'>xml:space="default"</span>, it is
    often the case that white space characters are removed as part of
    processing. Character position numbers index into the text string
    after the white space characters have been removed per the rules
    in this section.
  </p>

  <p>
    Note that a glyph corresponding to a whitespace character should
    only be displayed as a visible but blank space, even if the glyph
    itself happens to be non-blank.
    See <a href="http://www.unicode.org/faq/unsup_char.html">display
    of unsupported characters</a>
    [<a href="refs.html#ref-UNICODE">UNICODE</a>].
  </p>

  <p>
    The <a>'xml:space'</a> attribute is:
  </p>
  <p>
    &nbsp;&nbsp;&nbsp;&nbsp;<span class="anim-target"><a href="https://svgwg.org/specs/animations/#Animatable">Animatable</a>:
    no.</span>
  </p>

<h4 id="DuplicateWhiteSpace">Duplicate whitespace directives</h4>

  <p>
    Older, SVG 1.1 content will use <a>'xml:space'</a>. New content,
    and older content that is being reworked, will use
    <a>'white-space'</a> and remove any existing
    <a>'xml:space'</a>. However, user agents may come across content
    which uses both methods on the same element. If
    the <a>'white-space'</a> property is set on any element, then the
    value of <a>'xml:space'</a> is ignored.
  </p>

<h3 id="BaselineAlignmentProperties">Baseline alignment properties</h3>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Align with CSS for baseline alignment functionality.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2012/01/13-svg-irc#T03-24-06">SVG 2 will deprecate <span class="property">'baseline-shift'</span> and use <span class="property">'vertical-align'</span> instead.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>To align with CSS.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Cameron (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3281">ACTION-3281</a>)</td>
      </tr>
    </table>
  </div>

  <p class="issue" data-issue="31">
    <a href="http://dev.w3.org/csswg/css-inline/#propdef-baseline-shift">'baseline-shift'</a>
    is still in CSS Line Layout Module 3. It is important for aligning
    subscripts and superscripts (Inkscape relies on it for this
    purpose).
    <a href="http://dev.w3.org/csswg/css-inline/#propdef-vertical-align">'vertical-align'</a>
    is a shorthand for changing multiple properties at once,
    including 'baseline-shift'.
  </p>

  <p>
    An overview of baseline alignment and baseline tables can be
    found above in <a href="text.html#FontsTablesBaselines">Fonts,
      font tables and baselines</a>.
  </p>

  <p>
    One of the characteristics of international text is that there are
    different baselines (different alignment points) for glyphs in
    different scripts. For example, in horizontal writing, ideographic
    scripts, such as Han Ideographs, Katakana, Hiragana, and Hangul,
    alignment occurs with a baseline near the bottoms of the glyphs;
    alphabetic based scripts, such as Latin, Cyrillic, Hebrew, Arabic,
    align a point that is the bottom of most glyphs, but some glyphs
    descend below the baseline; and Indic based scripts are aligned at
    a point that is near the top of the glyphs.
  </p>

  <p>
    When different scripts are mixed on a line of text, an adjustment
    must be made to ensure that the glyphs in the different scripts
    are aligned correctly with one another.  OpenType
    [<a href="http://www.microsoft.com/typography/otspec/">OPENTYPE</a>]
    fonts have a Baseline table (BASE)
    [<a href="http://www.microsoft.com/typography/otspec/base.htm">OPENTYPE-BASETABLE</a>]
    that specifies the offsets of the alternative baselines from the
    current baseline.
  </p>

  <p>
    SVG uses a similar baseline table model that assumes one script
    (at one font-size) is the "dominant run" during processing of
    a <a>'text'</a> element; that is, all other baselines are defined
    in relation to this dominant run.  The baseline of the script with
    the dominant run is called the <dfn>dominant baseline</dfn>. So,
    for example, if the dominant baseline is the alphabetic baseline,
    there will be offsets in the baseline table for the alternate
    baselines, such as the ideographic baseline and the Indic
    baseline. There will also be an offset for the math baseline which
    is used for some math fonts. Note that there are separate baseline
    tables for horizontal and vertical writing-modes. The offsets in
    these tables may be different for horizontal and vertical writing.
  </p>

  <p>
    The baseline table established at the start of processing of
    a <a>'text'</a> element is called the
    <dfn>dominant baseline table</dfn>.
  </p>

  <p>
    Because the value of the <a>'font-family'</a> property is a list
    of fonts, to insure a consistent choice of baseline table we
    define the <em>nominal font</em> in a font list as the first font
    in the list for which a glyph is available. This is the first font
    that could contain a glyph for each character encountered. (For
    this definition, glyph data is assumed to be present if a font
    substitution is made or if the font is synthesized.) This
    definition insures a content independent determination of the font
    and baseline table that is to be used.
  </p>

  <p>
    The value of the <a>'font-size'</a> property on the <a>'text'</a>
    element establishes the <dfn>dominant baseline table font size</dfn>.
  </p>

  <p>
    The model assumes that each glyph has a 'alignment-baseline' value
    which specifies the baseline with which the glyph is to be
    aligned. (The 'alignment-baseline' is called the "Baseline Tag" in
    the OpenType baseline table description.) The initial value of
    the <a>'alignment-baseline'</a> property uses the baseline
    identifier associated with the given glyph.  Alternate values
    for <a>'alignment-baseline'</a> can be useful for glyphs such as a
    "*" which are ambiguous with respect to script membership.
  </p>

  <p>
    The model assumes that the font from which the glyph is drawn also
    has a baseline table, the <dfn>font baseline table</dfn>. This
    baseline table has offsets in units-per-em from the (0,0) point to
    each of the baselines the font knows about. In particular, it has
    the offset from the glyph's (0,0) point to the baseline identified
    by the 'alignment-baseline'.
  </p>

  <p>
    The offset values in the baseline table are in "design units"
    which means fractional units of the EM.  Thus, the
    current <a>'font-size'</a> is used to determine the actual offset
    from the dominant baseline to the alternate baselines.
  </p>

  <p>
    The glyph is aligned so that its baseline identified by its
    'alignment-baseline' is aligned with the baseline with the same
    name from the dominant baseline table.
  </p>

  <p>
    The offset from the dominant baseline of the parent to the
    baseline identified by the 'alignment-baseline' is computed using
    the dominant baseline table and dominant baseline table font
    size. The font baseline table and font size applicable to the
    glyph are used to compute the offset from the identified baseline
    to the (0,0) point of the glyph. This second offset is subtracted
    from the first offset to get the position of the (0,0) point in
    the <a href="text.html#ShiftDirection">shift direction</a>. Both
    offsets are computed by multiplying the baseline value from the
    baseline table times the appropriate font size value.
  </p>

  <p>
    If the 'alignment-baseline' identifies the dominant baseline, then
    the first offset is zero and the glyph is aligned with the
    dominant baseline; otherwise, the glyph is aligned with the chosen
    alternate baseline.
  </p>

  <p>
    The baseline-identifiers below are used in this
    specification. Some of these are determined by baseline-tables
    contained in a font
    <a href="http://www.w3.org/TR/2006/REC-xsl11-20061205/#font-model">as
    described in XSL</a> ([<a href="refs.html#ref-XSL">XSL</a>],
    section 7.9.1).  Others are computed from other font
    characteristics as described below.
  </p>

  <dl>
    <dt><b>alphabetic</b></dt>
    <dd>
      This identifies the baseline used by most alphabetic and
      syllabic scripts. These include, but are not limited to, many
      Western, Southern Indic, Southeast Asian (non-ideographic)
      scripts.
    </dd>
    <dt><b>ideographic</b></dt>
    <dd>
      This identifies the baseline used by ideographic scripts. For
      historical reasons, this baseline is at the bottom of the
      ideographic EM box and not in the center of the ideographic EM
      box. See the "central" baseline. The ideographic scripts include
      Chinese, Japanese, Korean, and Vietnamese Chu Nom.
    </dd>
    <dt><b>hanging</b></dt>
    <dd>
      This identifies the baseline used by certain Indic
      scripts. These scripts include Devanagari, Gurmukhi and Bengali.
    </dd>
    <dt><b>mathematical</b></dt>
    <dd>
      This identifies the baseline used by mathematical symbols.
    </dd>
    <dt><b>central</b></dt>
    <dd>
      This identifies a computed baseline that is at the center of the
      EM box. This baseline lies halfway between the text-before-edge
      and text-after-edge baselines.
      <p class="note">
	For ideographic fonts, this baseline is often used to
	align the glyphs; it is an alternative to the ideographic
	baseline.
      </p>
    </dd>
    <dt><b>middle</b></dt>
    <dd>
      This identifies a baseline that is offset from the alphabetic
      baseline in the <b>shift-direction</b> by 1/2 the value of the
      x-height font characteristic. The position of this baseline may
      be obtained from the font data or, for fonts that have a font
      characteristic for "x-height", it may be computed using 1/2 the
      "x-height". Lacking either of these pieces of information, the
      position of this baseline may be approximated by the "central"
      baseline.
    </dd>
    <dt><b>text-before-edge</b></dt>
    <dd>
      This identifies the before-edge of the EM box. The
      position of this baseline may be specified in the
      baseline-table or it may be calculated.
      <p class="note">
	The position of this baseline is normally around or at the top
	of the ascenders, but it may not encompass all accents that
	can appear above a glyph. For these fonts the value of the
	"ascent" font characteristic is used.  For ideographic fonts,
	the position of this baseline is normally 1 EM in
	the <b>shift-direction</b> from the "ideographic"
	baseline. However, some ideographic fonts have a reduced width
	in the inline-progression-direction to allow tighter
	setting. When such a font, designed only for vertical
	writing-modes, is used in a horizontal writing-mode, the
	"text-before-edge" baseline may be less than 1 EM from the
	text-after-edge.
      </p>
    </dd>
    <dt><b>text-after-edge</b></dt>
    <dd>
      This identifies the after-edge of the EM box. The position of
      this baseline may be specified in the baseline-table or it may
      be calculated.
      <p class="note">
	For fonts with descenders, the position of this
	baseline is normally around or at the bottom of the
	descenders. For these fonts the value of the "descent"
	font characteristic is used. For ideographic fonts, the
	position of this baseline is normally at the
	"ideographic" baseline.
      </p>
    </dd>
  </dl>
  <p>
    There are, in addition, two computed baselines that are only
    defined for line areas. Since SVG does not support the notion
    of computations based on line areas, the two computed baselines
    are mapped as follows:
  </p>
  <dl>
    <dt><b>before-edge</b></dt>
    <dd>For SVG, this is equivalent to <b>text-before-edge</b>.</dd>
    <dt><b>after-edge</b></dt>
    <dd>For SVG, this is equivalent to <b>text-after-edge</b>.</dd>
  </dl>
  <p>
    There are also four baselines that are defined only for
    horizontal writing-modes.
  </p>
  <dl>
    <dt><b>top</b></dt>
    <dd>
      This baseline is the same as the "before-edge" baseline in a
      horizontal writing-mode and is undefined in a vertical writing
      mode.
    </dd>
    <dt id="TextTopBaselineDefinition"><b>text-top</b></dt>
    <dd>
      This baseline is the same as the "text-before-edge" baseline in a
      horizontal writing-mode and is undefined in a vertical writing
      mode.
    </dd>
    <dt><b>bottom</b></dt>
    <dd>
      This baseline is the same as the "after-edge" baseline in a
      horizontal writing-mode and is undefined in a vertical writing
      mode.
    </dd>
    <dt id="TextBottomBaselineDefinition"><b>text-bottom</b></dt>
    <dd>
      This baseline is the same as the "text-after-edge"
      baseline in a horizontal writing-mode and is undefined in a
      vertical writing mode.
    </dd>
  </dl>

<h4 id='DominantBaseline'>The <span class='property'>'dominant-baseline'</span> property</h4>

  <p class="note">
    See the CSS Line Layout Module 3 specification for the definition of
    <a href="http://dev.w3.org/csswg/css-inline/#propdef-dominant-baseline">'dominant-baseline'</a>.
    [<a href="refs.html#ref-CSS21">CSSXX</a>]
  </p>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="DominantBaselineProperty">dominant-baseline</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td>auto | use-script | no-change | reset-size |
        ideographic | alphabetic | hanging |
        mathematical | central | middle | text-after-edge |
        text-before-edge</td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>auto</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>text content elements</a></td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>no</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>N/A</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td></td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes</td>
    </tr>
  </table>

  <p>
    The "dominant-baseline" property is used to determine or
    re-determine a scaled-baseline-table. A scaled-baseline-table is a
    compound value with three components: a baseline-identifier for
    the dominant-baseline, a baseline-table and a baseline-table
    font-size. Some values of the property re-determine all three
    values; other only re-establish the baseline-table font-size. When
    the initial value, <span class='prop-value'>auto</span>, would
    give an undesired result, this property can be used to explicitly
    set the desire scaled-baseline-table.
  </p>

  <p>
    Values for the property have the following meaning:
  </p>

  <dl>
    <dt><span class="attr-value">auto</span></dt>
    <dd>
      <p>
	If this property occurs on a <a>'text'</a> element, then the
	computed value depends on the value of the
	<a>'writing-mode'</a> property. If the 'writing-mode' is
	horizontal, then the value of the dominant-baseline component
	is 'alphabetic', else if the 'writing-mode' is vertical, then
	the value of the dominant-baseline component is 'central'.
      </p>
      <p>
	If this property occurs on a <a>'tspan'</a>
	or <a>'textPath'</a> element, then the
	dominant-baseline and the baseline-table components remain the
	same as those of the parent <a>text content element</a>. If
	the computed <a>'baseline-shift'</a> value actually shifts the
	baseline, then the baseline-table font-size component is set
	to the value of the <a>'font-size'</a> property on the element
	on which the <a>'dominant-baseline'</a> property occurs,
	otherwise the baseline-table font-size remains the same as
	that of the element. If there is no parent <a>text content
	element</a>, the scaled-baseline-table value is constructed as
	above for <a>'text'</a> elements.
      </p>
    </dd>

    <dt><span class="attr-value">use-script</span></dt>
    <dd>
      The dominant-baseline and the baseline-table components are set
      by determining the predominant script of the character data
      content. The <a>'writing-mode'</a>, whether horizontal or
      vertical, is used to select the appropriate set of
      baseline-tables and the dominant baseline is used to select the
      baseline-table that corresponds to that baseline.  The
      baseline-table font-size component is set to the value of
      the <a>'font-size'</a> property on the element on which
      the <a>'dominant-baseline'</a> property occurs.
    </dd>

    <dt><span class="attr-value">no-change</span></dt>
    <dd>
      The dominant-baseline, the baseline-table, and the
      baseline-table font-size remain the same as that of the
      parent <a>text content element</a>.
    </dd>

    <dt><span class="attr-value">reset-size</span></dt>
    <dd>
      The dominant-baseline and the baseline-table remain the same,
      but the baseline-table font-size is changed to the value of
      the <a>'font-size'</a> property on this element. This re-scales
      the baseline-table for the current <a>'font-size'</a>.
    </dd>

    <dt><span class="attr-value">ideographic</span></dt>
    <dd>
      The baseline-identifier for the dominant-baseline is set to be
      'ideographic', the derived baseline-table is constructed using
      the 'ideographic' baseline-table in the nominal font, and the
      baseline-table font-size is changed to the value of
      the <a>'font-size'</a> property on this element.
    </dd>

    <dt><span class="attr-value">alphabetic</span></dt>
    <dd>
      The baseline-identifier for the dominant-baseline is set to be
      'alphabetic', the derived baseline-table is constructed using
      the 'alphabetic' baseline-table in the nominal font, and the
      baseline-table font-size is changed to the value of
      the <a>'font-size'</a> property on this element.
    </dd>

    <dt><span class="attr-value">hanging</span></dt>
    <dd>
      The baseline-identifier for the dominant-baseline is set
      to be 'hanging', the derived baseline-table is constructed
      using the 'hanging' baseline-table in the nominal font, and
      the baseline-table font-size is changed to the value of the
      <a>'font-size'</a> property on this element.
    </dd>

    <dt><span class="attr-value">mathematical</span></dt>
    <dd>
      The baseline-identifier for the dominant-baseline is set to be
      'mathematical', the derived baseline-table is constructed using
      the 'mathematical' baseline-table in the nominal font, and the
      baseline-table font-size is changed to the value of
      the <a>'font-size'</a> property on this element.
    </dd>

    <dt><span class="attr-value">central</span></dt>
    <dd>
      The baseline-identifier for the dominant-baseline is set to be
      'central'. The derived baseline-table is constructed from the
      defined baselines in a baseline-table in the nominal font. That
      font baseline-table is chosen using the following priority order
      of baseline-table names: 'ideographic', 'alphabetic', 'hanging',
      'mathematical'. The baseline-table font-size is changed to the
      value of the <a>'font-size'</a> property on this element.
    </dd>

    <dt><span class="attr-value">middle</span></dt>
    <dd>
      The baseline-identifier for the dominant-baseline is set to be
      'middle'. The derived baseline-table is constructed from the
      defined baselines in a baseline-table in the nominal font. That
      font baseline -table is chosen using the following priority
      order of baseline-table names: 'alphabetic', 'ideographic',
      'hanging', 'mathematical'. The baseline-table font-size is
      changed to the value of the <a>'font-size'</a> property on this
      element.
    </dd>

    <dt><span class="attr-value">text-after-edge</span></dt>
    <dd>
      The baseline-identifier for the dominant-baseline is set
      to be 'text-after-edge'. The derived baseline-table is
      constructed from the defined baselines in a baseline-table in
      the nominal font. The choice of which font baseline-table to
      use from the baseline-tables in the nominal font is
      implementation defined. The baseline-table font-size is
      changed to the value of the <a>'font-size'</a> property on this
      element.
      <p class="note">
	Using the following priority order of baseline-table names:
	'alphabetic', 'ideographic', 'hanging', 'mathematical' is
	probably a reasonable strategy for determining which font
	baseline-table to use.
      </p>
    </dd>

    <dt><span class="attr-value">text-before-edge</span></dt>
    <dd>
      The baseline-identifier for the dominant-baseline is set
      to be 'text-before-edge'. The derived baseline-table is
      constructed from the defined baselines in a baseline-table in
      the nominal font. The choice of which baseline-table to use
      from the baseline-tables in the nominal font is
      implementation defined. The baseline-table font-size is
      changed to the value of the <a>'font-size'</a> property on this
      element.
      <p class="note">
	Using the following priority order of baseline-table names:
	'alphabetic', 'ideographic', 'hanging', 'mathematical' is
	probably a reasonable strategy for determining which font
	baseline-table to use.
      </p>
    </dd>
  </dl>

  <p>
    If there is no baseline table in the nominal font or if the
    baseline table lacks an entry for the desired baseline, then the
    user agent may use heuristics to determine the position of the
    desired baseline.
  </p>

<h4 id='AlignmentBaseline'>The <span class='property'>'alignment-baseline'</span> property</h4>

  <p class="note">
    See the CSS Line Layout Module 3 specification for the definition of
    <a href="http://dev.w3.org/csswg/css-inline/#propdef-alignment-baseline">'alignment-baseline'</a>.
    [<a href="refs.html#ref-CSS21">CSSXX</a>]
  </p>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="AlignmentBaselineProperty">alignment-baseline</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td>auto | baseline | before-edge | text-before-edge
        | middle | central | after-edge | text-after-edge |
        ideographic | alphabetic | hanging | mathematical</td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>auto</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>'tspan'</a>, <a>'textPath'</a> elements</td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>no</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>N/A</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td></td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes</td>
    </tr>
  </table>

  <p>
    This property specifies how an object is aligned with respect to
    its parent. This property specifies which baseline of this element
    is to be aligned with the corresponding baseline of the
    parent. For example, this allows alphabetic baselines in Roman
    text to stay aligned across font size changes. It defaults to the
    baseline with the same name as the computed value of the
    alignment-baseline property. That is, the position of
    "ideographic" alignment point in the
    <b>block-progression-direction</b> is the position of the
    "ideographic" baseline in the baseline-table of the object being
    aligned.
  </p>

  <p>
    Values have the following meanings:
  </p>

  <dl>
    <dt><b>auto</b></dt>
    <dd>The value is the dominant-baseline of the script to which
      the character belongs &#x2013; i.e., use the dominant-baseline of
      the parent.</dd>

    <dt><b>baseline</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the dominant-baseline of the parent <a>text content element</a>.</dd>

    <dt><b>before-edge</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "before-edge" baseline of the parent <a>text content element</a>.</dd>

    <dt><b>text-before-edge</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "text-before-edge" baseline of the parent <a>text content element</a>.</dd>

    <dt><b>middle</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "middle" baseline of the parent <a>text content element</a>.</dd>

    <dt><b>central</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "central" baseline of the parent <a>text content element</a>.</dd>

    <dt><b>after-edge</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "after-edge" baseline of the parent <a>text content element</a>.</dd>

    <dt><b>text-after-edge</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "text-after-edge" baseline of the parent <a>text content element</a>.</dd>

    <dt><b>ideographic</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "ideographic" baseline of the parent <a>text content element</a>.</dd>

    <dt><b>alphabetic</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "alphabetic" baseline of the parent <a>text content element</a>.</dd>

    <dt><b>hanging</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "hanging" baseline of the parent <a>text content element</a>.</dd>

    <dt><b>mathematical</b></dt>
    <dd>The alignment point of the object being aligned is
      aligned with the "mathematical" baseline of the parent <a>text content element</a>.</dd>
  </dl>

<h4 id='BaselineShift'>The <span class='property'>'baseline-shift'</span> property</h4>

  <p class="note">
    See the CSS Line Layout Module 3 specification for the definition of
    <a href="http://dev.w3.org/csswg/css-inline/#propdef-alignment-baseline">'baseline-shift'</a>.
    [<a href="refs.html#ref-CSS21">CSSXX</a>]
  </p>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="BaselineShiftProperty">baseline-shift</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td>baseline | sub | super
        | <a>&lt;percentage&gt;</a>
        | <a>&lt;length&gt;</a>
      </td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>baseline</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>'tspan'</a>, <a>'textPath'</a> elements</td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>no</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>refers to the "line-height" of the <a>'text'</a> element, which
        in the case of SVG is defined to be equal to the <a>'font-size'</a></td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td>absolute length, percentage, or keyword specified</td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes</td>
    </tr>
  </table>

  <p>
    The <a>'baseline-shift'</a> property allows repositioning of the
    dominant-baseline relative to the dominant-baseline of the
    parent <a>text content element</a>. The shifted object might be a
    sub- or superscript.  Within the shifted object, the whole
    baseline-table is offset; not just a single baseline. The amount
    of the shift is determined from information from the
    parent <a>text content element</a>, the sub- or superscript offset
    from the nominal font of the parent <a>text content element</a>,
    percent of the "line-height" of the parent <a>text content
    element</a> or an absolute value.
  </p>

  <p>
    In SVG, the <a>'baseline-shift'</a> property represents a
    supplemental adjustment to the baseline tables. The
    <a>'baseline-shift'</a> property shifts the baseline tables for
    each glyph to temporary new positions, for example to lift the
    glyph into superscript or subscript position, but it does not
    affect the current text position. When the current text position
    is adjusted after rendering a glyph to take into account glyph
    advance values, the adjustment happens as if there were no
    baseline shift.
  </p>

  <p>
    <a>'baseline-shift'</a> properties can nest. Each nested
    <a>'baseline-shift'</a> is added to previous baseline shift
    values.
  </p>

  <p>
    Values for the property have the following meaning:
  </p>

  <dl>
    <dt><strong>baseline</strong></dt>
    <dd>
      There is no baseline shift; the dominant-baseline remains in its
      original position.
    </dd>

    <dt><strong>sub</strong></dt>
    <dd>
      The dominant-baseline is shifted to the default position for
      subscripts. The offset to this position is determined using the
      font data for the nominal font. Because in most fonts the
      subscript position is normally given relative to the
      "alphabetic" baseline, the user agent may compute the effective
      position for subscripts for superscripts when some other
      baseline is dominant. The suggested computation is to subtract
      the difference between the position of the dominant baseline and
      the position of the "alphabetic" baseline from the position of
      the subscript. The resulting offset is determined by multiplying
      the effective subscript position by the dominant baseline-table
      font-size. If there is no applicable font data the user agent
      may use heuristics to determine the offset.
    </dd>

    <dt><strong>super</strong></dt>
    <dd>
      The dominant-baseline is shifted to the default position for
      superscripts. The offset to this position is determined using
      the font data for the nominal font. Because in most fonts the
      superscript position is normally given relative to the
      "alphabetic" baseline, the user agent may compute the effective
      position for superscripts when some other baseline is
      dominant. The suggested computation is to subtract the
      difference between the position of the dominant baseline and the
      position of the "alphabetic" baseline from the position of the
      superscript. The resulting offset is determined by multiplying
      the effective superscript position by the dominant
      baseline-table font-size. If there is no applicable font data
      the user agent may use heuristics to determine the offset.
    </dd>

    <dt><strong>&lt;percentage&gt;</strong></dt>
    <dd>
      The computed value of the property is this percentage multiplied
      by the computed "line-height" of the <a>'text'</a> element. The
      dominant-baseline is shifted in the
      <a href="text.html#ShiftDirection">shift direction</a> (positive
      value) or opposite to the
      <a href="text.html#ShiftDirection">shift direction</a>
      (negative value) of the parent <a>text content element</a> by
      the computed value. A value of "0%" is equivalent to
      "baseline".
    </dd>

    <dt><strong>&lt;length&gt;</strong></dt>
    <dd>
      The dominant-baseline is shifted in the
      <a href="text.html#ShiftDirection">shift direction</a> (positive
      value) or opposite to the
      <a href="text.html#ShiftDirection">shift direction</a> (negative
      value) of the parent <a>text content element</a> by the
      &lt;length&gt; value. A value of "0cm" is equivalent to
      "baseline".
    </dd>
  </dl>

<h2 id="TextDecorationProperties">Text decoration</h2>

  <p>
    Text in SVG can be <em>decorated</em> with an underline, overline,
    and/or strike-through. The position and style of the decoration is
    determined respectively by the <a>'text-decoration-line'</a> and
    <a>'text-decoration-style'</a> properties, or by
    the <a>'text-decoration'</a> shorthand property as defined in the
    <a href="http://dev.w3.org/csswg/css-text-decor-3/#line-decoration">Line
      Decoration</a> section of the
    <a href="http://dev.w3.org/csswg/css-text-decor-3/">CSS Text
    Decoration Module Level 3</a>
    [(<a href="refs.html#ref-CSS3TEXTDECOR">CSS3TEXTDECOR</a>)]
    specification. The fill and stroke of the decoration are given by
    the <a>'text-decoration-fill'</a> and
    <a>'text-decoration-stroke'</a> properties.  If a color value is
    specified either by the <a>'text-decoration-color'</a> property or
    by the <a>'text-decoration'</a> shorthand, and no
    <a>'text-decoration-fill'</a> property is specified, it is
    interpreted as if the <a>'text-decoration-fill'</a> property were
    specified with that color value.
  </p>

  <p>
    If the fill or stroke of the text decoration are not explicitly
    specified (via <a>'text-decoration'</a>, <a>'text-decoration-color'</a>,
    <a>'text-decoration-fill'</a>, or <a>'text-decoration-stroke'</a>),
    they are given by the fill and stroke of the text at the point
    where the text decoration is declared (see example below).
  </p>

  <p class="note">
    The <a>'text-decoration-line'</a> and
    <a>'text-decoration-style'</a> properties are new in SVG 2. The
    SVG 1.1/CSS 2.1 <a>'text-decoration'</a> property is transformed
    in a backwards compatible way to a short hand for these
    properties. <a>'text-decoration-fill'</a> and
    <a>'text-decoration-stroke'</a> are SVG specific properties which
    may be added to a future level of the CSS Text Decoration
    specification.
  </p>

  <p>
    The order in which the text and decorations are drawn is defined
    by the
    <a href="http://dev.w3.org/csswg/css-text-decor-3/#painting-order">Painting
      Order of Text Decorations</a> section of
    <a href="http://dev.w3.org/csswg/css-text-decor-3/">CSS Text
    Decoration Module Level 3</a>. The paint order of the text
    decoration itself (fill/stroke) is determined by the value of the
    <a>'paint-order'</a> property at the point where the text
    decoration is declared.
  </p>

  <p id="ExampleTextDecoration01">
    <span class="example-ref">Example textdecoration01</span> provides
    examples for <a>'text-decoration'</a>. The first line of text has
    no value for <a>'text-decoration'</a>, so the initial value
    of <span class="prop-value">text-decoration:none</span> is
    used. The second line shows
    <span class="prop-value">text-decoration:line-through</span>. The
    third line shows
    <span class="prop-value">text-decoration:underline</span>. The
    fourth line illustrates the rule whereby decorations are rendered
    using the same fill and stroke properties as are present on the
    element for which the <a>'text-decoration'</a> is specified. Since
    <a>'text-decoration'</a> is specified on the <a>'text'</a>
    element, all text within the <a>'text'</a> element has its
    underline rendered with the same fill and stroke properties as
    exist on the <a>'text'</a> element (i.e., blue fill, red stroke),
    even though the various words have different fill and stroke
    property values. However, the word "different" explicitly
    specifies a value for <a>'text-decoration'</a>; thus, its
    underline is rendered using the fill and stroke properties as
    the <a>'tspan'</a> element that surrounds the word "different"
    (i.e., yellow fill, darkgreen stroke):
  </p>

  <edit:example href='images/text/textdecoration01.svg' name='textdecoration01' description="behavior of 'text-decoration' property" image='yes' link='yes'/>

  <h3 id="TextDecorationFillStroke">The <span class="property">'text-decoration-fill'</span>
    and <span class="property">'text-decoration-stroke'</span> properties</h3>

  <p class="annotation">
    The CSS working group agreed to the SVG specification of the
    'text-decoration-fill' and 'text-decoration-stroke' properties at
    the joint CSS/SVG 2014 TPAC meeting. They again endorsed the use
    of these properties at the joint 2015 Sydney meeting. They
    expressed their intention to extend CSS text decoration to include
    these properties at the same time they allow 'fill' and 'stroke'
    properties on text.
  </p>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="TextDecorationFillProperty">text-decoration-fill</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td><a>&lt;paint&gt;</a></td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>See prose.</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>text content elements</a></td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>See prose.</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>N/A</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td>as specified, but with <a>&lt;color&gt;</a> values computed and
	<a>&lt;url&gt;</a> values made absolute.</td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes</td>
    </tr>
  </table>

  <table class="propdef">
    <tr>
      <th>Name:</th>
      <td><dfn id="TextDecorationStrokeProperty">text-decoration-stroke</dfn></td>
    </tr>
    <tr>
      <th>Value:</th>
      <td><a>&lt;paint&gt;</a></td>
    </tr>
    <tr>
      <th>Initial:</th>
      <td>See prose.</td>
    </tr>
    <tr>
      <th>Applies to:</th>
      <td><a>text content elements</a></td>
    </tr>
    <tr>
      <th>Inherited:</th>
      <td>See prose.</td>
    </tr>
    <tr>
      <th>Percentages:</th>
      <td>N/A</td>
    </tr>
    <tr>
      <th>Media:</th>
      <td>visual</td>
    </tr>
    <tr>
      <th>Computed&#160;value:</th>
      <td>as specified, but with <a>&lt;color&gt;</a> values computed and
	<a>&lt;url&gt;</a> values made absolute.</td>
    </tr>
    <tr>
      <th><a>Animatable</a>:</th>
      <td>yes</td>
    </tr>
  </table>

<h2 id="TextSelection">Text selection and clipboard operations</h2>

  <p>
    <a href="conform.html#ConformingSVGViewers">Conforming SVG
    viewers</a> on systems which have the capacity for text selection (e.g.,
    systems which are equipped with a pointer device such as a mouse) and
    which have system clipboards for copy/paste operations are required to
    support:
  </p>

  <ul>
    <li>user selection of text strings in SVG content</li>
    <li>the ability to copy selected text strings to the system clipboard</li>
  </ul>

  <p>
    A text selection operation starts when all of the following occur:
  </p>

  <ul>
    <li>
      the user positions the pointing device over a glyph that has
      been rendered as part of a <a>'text'</a> element, initiates a
      <em>select</em> operation (e.g., pressing the standard system
      mouse button for select operations) and then moves the pointing
      device while continuing the <em>select</em> operation (e.g.,
      continuing to press the standard system mouse button for select
      operations)
    </li>

    <li>
      no other visible graphics element has been painted above the glyph
      at the point at which the pointing device was clicked
    </li>

    <li>
      no <a href="linking.html#Links">links</a> or
      <a href="interact.html">events</a> have been
      assigned to the <a>'text'</a>, <a>'tspan'</a> or
      <a>'textPath'</a> element(s) (or their ancestors) associated
      with the given glyph.
    </li>
  </ul>

  <p>
    As the text selection operation proceeds (e.g., the user continues
    to press the given mouse button), all associated events with other
    graphics elements are ignored (i.e., the text selection operation
    is modal) and the SVG user agent shall dynamically indicate which
    characters are selected by an appropriate highlighting technique,
    such as redrawing the selected glyphs with inverse colors. As the
    pointer is moved during the text selection process, the end glyph
    for the text selection operation is the glyph within the
    same <a>'text'</a> element whose glyph cell is closest to the
    pointer. All characters within the <a>'text'</a> element whose
    position within the <a>'text'</a> element is between the start of
    selection and end of selection shall be highlighted, regardless of
    position on the canvas and regardless of any graphics elements
    that might be above the end of selection point.
  </p>

  <p>
    Once the text selection operation ends (e.g., the user releases
    the given mouse button), the selected text will stay highlighted
    until an event occurs which cancels text selection, such as a
    pointer device activation event (e.g., pressing a mouse button).
  </p>

  <p>
    Detailed rules for determining which characters to highlight
    during a text selection operation are provided in
    <a href="implnote.html#TextSelectionImplementationNotes">Text
      selection implementation notes</a>.
  </p>

  <p>
    For systems which have system clipboards, the SVG user agent is
    required to provide a user interface for initiating a copy of the
    currently selected text to the system clipboard. It is sufficient
    for the SVG user agent to post the selected text string in the
    system's appropriate clipboard format for plain text, but it is
    preferable if the SVG user agent also posts a rich text
    alternative which captures the various font properties associated
    with the given text string.
  </p>

  <p>
    For bidirectional text, the user agent must support text selection
    in logical order, which will result in discontinuous highlighting
    of glyphs due to the bidirectional reordering of characters. User
    agents can provide an alternative ability to select bidirectional
    text in visual rendering order (i.e., after bidirectional
    text layout algorithms have been applied), with the result that
    selected character data might be discontinuous logically. In this
    case, if the user requests that bidirectional text be copied to
    the clipboard, then the user agent is required to make appropriate
    adjustments to copy only the visually selected characters to the
    clipboard.
  </p>

  <p>
    When feasible, it is recommended that generators of SVG attempt to
    order their text strings to facilitate properly ordered text
    selection within SVG viewing applications such as Web browsers.
  </p>

<h2 id="DOMInterfaces">DOM interfaces</h2>

  <div class="annotation svg2-requirement">
    <table>
      <tr>
	<th>SVG 2 Requirement:</th>
	<td>Have a DOM method to convert a <a>'text'</a> element to outline path data.</td>
      </tr>
      <tr>
	<th>Resolution:</th>
	<td><a href="http://www.w3.org/2012/01/13-svg-irc#T05-07-07">We will add a DOM method to convert a <span class='element-name'>'text'</span> element to outline path data, possibly moving the functionality to the FXTF.</a></td>
      </tr>
      <tr>
	<th>Purpose:</th>
	<td>To allow manipualtion of text as a path.</td>
      </tr>
      <tr>
	<th>Owner:</th>
	<td>Cameron (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3076">ACTION-3076</a>)</td>
      </tr>
    </table>
  </div>

<div class='ready-for-wider-review'>
<h3 id="InterfaceSVGTextContentElement">Interface SVGTextContentElement</h3>

<p>The <a>SVGTextContentElement</a> interface is implemented by elements
that support rendering child text content.</p>

<p>For the methods on this interface that refer to an index to a
character or a number of characters, these references are to be
interpreted as an index to a UTF-16 code unit or a number of
UTF-16 code units, respectively.  This is for consistency with DOM
Level 2 Core, where methods on the <a>CharacterData</a> interface
use UTF-16 code units as indexes and counts within the character
data. Thus for example, if the text content of a <a>'text'</a>
element is a single non-BMP character, such as U+10000, then
invoking <a>SVGTextContentElement::getNumberOfChars</a> on that
element will return 2 since there are two UTF-16 code units (the
surrogate pair) used to represent that one character.</p>

<pre class="idl">interface <b>SVGTextContentElement</b> : <a>SVGGraphicsElement</a> {

  // lengthAdjust Types
  const unsigned short <a href="text.html#__svg__SVGTextContentElement__LENGTHADJUST_UNKNOWN">LENGTHADJUST_UNKNOWN</a> = 0;
  const unsigned short <a href="text.html#__svg__SVGTextContentElement__LENGTHADJUST_SPACING">LENGTHADJUST_SPACING</a> = 1;
  const unsigned short <a href="text.html#__svg__SVGTextContentElement__LENGTHADJUST_SPACINGANDGLYPHS">LENGTHADJUST_SPACINGANDGLYPHS</a> = 2;

  [SameObject] readonly attribute <a>SVGAnimatedLength</a> <a href="text.html#__svg__SVGTextContentElement__textLength">textLength</a>;
  [SameObject] readonly attribute <a>SVGAnimatedEnumeration</a> <a href="text.html#__svg__SVGTextContentElement__lengthAdjust">lengthAdjust</a>;

  long <a href="text.html#__svg__SVGTextContentElement__getNumberOfChars">getNumberOfChars</a>();
  float <a href="text.html#__svg__SVGTextContentElement__getComputedTextLength">getComputedTextLength</a>();
  float <a href="text.html#__svg__SVGTextContentElement__getSubStringLength">getSubStringLength</a>(unsigned long charnum, unsigned long nchars);
  <a>DOMPoint</a> <a href="text.html#__svg__SVGTextContentElement__getStartPositionOfChar">getStartPositionOfChar</a>(unsigned long charnum);
  <a>DOMPoint</a> <a href="text.html#__svg__SVGTextContentElement__getEndPositionOfChar">getEndPositionOfChar</a>(unsigned long charnum);
  <a>DOMRect</a> <a href="text.html#__svg__SVGTextContentElement__getExtentOfChar">getExtentOfChar</a>(unsigned long charnum);
  float <a href="text.html#__svg__SVGTextContentElement__getRotationOfChar">getRotationOfChar</a>(unsigned long charnum);
  long <a href="text.html#__svg__SVGTextContentElement__getCharNumAtPosition">getCharNumAtPosition</a>(<a>DOMPoint</a> point);
  void <a href="text.html#__svg__SVGTextContentElement__selectSubString">selectSubString</a>(unsigned long charnum, unsigned long nchars);
};</pre>

<p>The numeric length adjument type constants defined on <a>SVGTextContentElement</a>
are used to represent the keyword values that the <a>'lengthAdjust'</a> attribute
can take.  Their meanings are as follows:</p>

<table class='vert'>
  <tr><th>Constant</th><th>Meaning</th></tr>
  <tr><td><b id="__svg__SVGTextContentElement__LENGTHADJUST_SPACING">LENGTHADJUST_SPACING</b></td><td>The <span class="attr-value">spacing</span> keyword.</td></tr>
  <tr><td><b id="__svg__SVGTextContentElement__LENGTHADJUST_SPACINGANDGLYPHS">LENGTHADJUST_SPACINGANDGLYPHS</b></td><td>The <span class="attr-value">spacingAndGlyphs</span> keyword.</td></tr>
  <tr><td><b id="__svg__SVGTextContentElement__LENGTHADJUST_UNKNOWN">LENGTHADJUST_UNKNOWN</b></td><td>Some other value.</td></tr>
</table>

<p>The <b id="__svg__SVGTextContentElement__textLength">textLength</b> IDL attribute
<a>reflects</a> the <a>'textLength'</a> content attribute.</p>

<p>The <b id="__svg__SVGTextContentElement__lengthAdjust">lengthAdjust</b> IDL attribute
<a>reflects</a> the <a>'lengthAdjust'</a> content attribute.  The <a>numeric type values</a>
for <a>'lengthAdjust'</a> are as described above in the numeric length adjust type
constant table.</p>

<p>The <b id="__svg__SVGTextContentElement__getNumberOfChars">getNumberOfChars</b>
method is used to determine the total number of characters available for
rendering within the current element.  When getNumberOfChars() is called,
the following steps are run:</p>

<ol class='algorithm'>
  <li>Let <var>text</var> be the result that would be obtained
  from getting the 
  <a href="http://www.w3.org/TR/dom/#dom-node-textcontent">textContent</a>
  IDL attribute on the current element.</li>
  <li>Return the length of <var>text</var>.</li>
</ol>

<p>The <b id="__svg__SVGTextContentElement__getComputedTextLength">getComputedTextLength</b>
method is used to compute a "length" for the text within the element.
When getComputedTextLength() is called, the following steps are run:</p>

<ol class='algorithm'>
  <li>Let <var>count</var> be the value that would be returned if
  the <a href="#__svg__SVGTextContentElement__getNumberOfChars">getNumberOfChars</a>
  method were called on this element.</li>
  <li>Let <var>length</var> be the value that would be returned
  if the <a href="#__svg__SVGTextContentElement__getSubStringLength">getSubStringLength</a>
  method were called on this element, passing 0 and <var>count</var> as arguments.</li>
  <li>Return <var>length</var>.</li>
</ol>

<p>The <b id="__svg__SVGTextContentElement__getSubStringLength">getSubStringLength</b>
method is used to compute a "length" for a substring of text within the
element.  When getSubStringLength(<var>charnum</var>, <var>nchars</var>)
is called, the following steps are run:</p>

<ol class='algorithm'>
  <li>Assign an index to each character in the DOM within this element,
  where the first character has index 0.</li>
  <li>If <var>charnum</var> is greater than the highest index assigned
  to a character or if <var>nchars</var>, then throw a <a>DOMException</a> with code
  INDEX_SIZE_ERR.</li>
  <li>Let <var>length</var> be a length in user units, initialized to 0.</li>
  <li>For each character in the DOM within this element that has an
    index such that
    <var>charnum</var> â‰¤ index &lt; (<var>charnum</var> + <var>nchars</var>):
    <ol>
      <li>If the character corresponds to a grapheme cluster and it is the first character
      in document order to correspond to that grapheme cluster, then:
        <ol>
          <li>Add the advance of the grapheme cluster to <var>length</var>.</li>
          <li>If the <a>'letter-spacing'</a> or <a>'word-spacing'</a> properties
          contributed space just after the grapheme cluster, then add that space
          to <var>length</var>.</li>
        </ol>
        <p class="note">This means that, for example, if you have a ligature
        that crosses the boundary between two <a>'tspan'</a> elements, the
        advance of the grapheme cluster and any subsequent <a>'letter-spacing'</a> or
        <a>'word-spacing'</a> space will be assigned to the first
        <a>'tspan'</a> element's text length.</p>
      </li>
    </ol>
  </li>
  <li>Return <var>length</var>.</li>
</ol>

<p>To <dfn id="TermFindGraphemeClusterForCharacter">find the grapheme
cluster for a character</dfn> at index <var>index</var> within an
element <var>element</var>, the following steps are run:</p>

<ol class="algorithm">
  <li>Assign an index to each character in the DOM within this element,
  where the first character has index 0.</li>
  <li>Let <var>last</var> be the highest index assigned to a character.</li>
  <li>While <var>charnum</var> &lt; <var>last</var> and
    the character at index <var>charnum</var> does not correspond to
    a grapheme cluster:
    <ol>
      <li>Set <var>charnum</var> to <var>charnum</var> + 1.</li>
    </ol>
  </li>
  <li>If <var>charnum</var> is greater than the highest index assigned
  to a character or, then return null.</li>
  <li>Otherwise, return the grapheme cluster that corresponds to
  <var>charnum</var>.</li>
</ol>

<p>The <b id="__svg__SVGTextContentElement__getStartPositionOfChar">getStartPositionOfChar</b>
method is used to get the position of a grapheme cluster after text
layout has been performed.  When getStartPositionOfChar(<var>charnum</var>) is
called, the following steps are run:</p>

<ol class='algorithm'>
  <li>Let <var>cluster</var> be the result of
  <a href="#TermFindGraphemeClusterForCharacter">finding the grapheme
  cluster for the character</a> at index <var>charnum</var> within
  the current element.</li>
  <li>If <var>cluster</var> is null, then then throw a
  <a>DOMException</a> with code INDEX_SIZE_ERR.</li>
  <li>Let <var>p</var> be the
  <a href="#AlignmentPoint">alignment point</a> of the grapheme cluster
  that correspond to the character at index <var>charnum</var>,
  in the coordinate system of the current element.</li>
  <li>Return a newly created, <a href="shapes.html#PointMode">detached</a>
  <a>DOMPoint</a> object representing the point <var>p</var>.</li>
</ol>

<p>The <b id="__svg__SVGTextContentElement__getEndPositionOfChar">getEndPositionOfChar</b>
method is used to get the trailing position of a grapheme cluster after text
layout has been performed.  When getEndPositionOfChar(<var>charnum</var>) is
called, the following steps are run:</p>

<ol class='algorithm'>
  <li>Let <var>cluster</var> be the result of
  <a href="#TermFindGraphemeClusterForCharacter">finding the grapheme
  cluster for the character</a> at index <var>charnum</var> within
  the current element.</li>
  <li>If <var>cluster</var> is null, then then throw a
  <a>DOMException</a> with code INDEX_SIZE_ERR.</li>
  <li>Let <var>p</var> be the
  <a href="#AlignmentPoint">alignment point</a> of <var>cluster</var>
  that correspond to the character at index <var>charnum</var>,
  in the coordinate system of the current element.</li>
  <li>Let <var>direction</var> be a unit vector in the direction of
  the <var>cluster</var>'s advance.  This direction takes into account
  the writing mode being used, the direction of the character,
  the <a>'text-orientation'</a>, <a>'glyph-orientation-horizontal'</a>
  and <a>'glyph-orientation-vertical'</a> properties,
  any <a>'tspan/rotate'</a> value that applies to <var>cluster</var>,
  and any rotation applied to due a <a>'textPath'</a>.</li>
  <li>Let <var>advance</var> be <var>cluster</var>'s advance.</li>
  <li>Set <var>p</var> to <var>p</var> + <var>advance</var> Â· <var>direction</var>.</li>
  <li>Return a newly created, <a href="shapes.html#PointMode">detached</a>
  <a>DOMPoint</a> object representing the point <var>p</var>.</li>
</ol>

<p>The <b id="__svg__SVGTextContentElement__getExtentOfChar">getExtentOfChar</b>
method is used to compute a tight bounding box of the glyph cell
that corresponds to a given grapheme cluster.  When getExtentOfChar(<var>charnum</var>)
is called, the following steps are run:</p>

<ol class='algorithm'>
  <li>Let <var>cluster</var> be the result of
  <a href="#TermFindGraphemeClusterForCharacter">finding the grapheme
  cluster for the character</a> at index <var>charnum</var> within
  the current element.</li>
  <li>If <var>cluster</var> is null, then then throw a
  <a>DOMException</a> with code INDEX_SIZE_ERR.</li>
  <li>Let <var>quad</var> be the potentially rotated rectangle in
  the current element's coordinate system that
  is the glyph cell for <var>cluster</var>.</li>
  <li>Let <var>rect</var> be the rectangle that forms the tightest
  bounding box around <var>quad</var> in the current element's
  coordinate system.</li>
  <li>Return a newly created <a>DOMRect</a> object representing the
  rectangle <var>rect</var>.</li>
</ol>

<p>The <b id="__svg__SVGTextContentElement__getRotationOfChar">getRotationOfChar</b>
method is used to get the rotation of grapheme cluster.  When
getRotationOfChar(<var>charnum</var>) is called, the following steps are run:</p>

<ol class='algorithm'>
  <li>Let <var>cluster</var> be the result of
  <a href="#TermFindGraphemeClusterForCharacter">finding the grapheme
  cluster for the character</a> at index <var>charnum</var> within
  the current element.</li>
  <li>If <var>cluster</var> is null, then then throw a
  <a>DOMException</a> with code INDEX_SIZE_ERR.</li>
  <li>Let <var>direction</var> be the angle in degrees that represents
  the direction of the <var>cluster</var>'s advance.
  This direction takes into account
  the writing mode being used, the direction of the character,
  the <a>'text-orientation'</a>, <a>'glyph-orientation-horizontal'</a>
  and <a>'glyph-orientation-vertical'</a> properties,
  any <a>'tspan/rotate'</a> value that applies to <var>cluster</var>,
  and any rotation applied to due a <a>'textPath'</a>.</li>
  <li>Return <var>direction</var>.</li>
</ol>

<p>The <b id="__svg__SVGTextContentElement__getCharNumAtPosition">getCharNumAtPosition</b>
method is used to find which character caused a grapheme cluster to
be rendered at a given position.  When getCharNumAtPosition(<var>point</var>)
is called, the following steps are run:</p>

<ol class='algorithm'>
  <li>Assign an index to each character in the DOM within this element,
  where the first character has index 0.</li>
  <li>Let <var>last</var> be the highest index assigned to a character.</li>
  <li>Let <var>charnum</var> be 0.</li>
  <li>Let <var>result</var> be -1.</li>
  <li>While <var>charnum</var> &lt; <var>last</var>:
    <ol>
      <li>If the character at index <var>charnum</var> corresponds
      to a grapheme cluster and it is the first character
      in document order to correspond to that grapheme cluster,
      and <var>point</var> in this element's coordinate system
      is within the glyph cell for the grapheme cluster, then
      set <var>result</var> to <var>charnum</var>.</li>
    </ol>
  </li>
  <li>Return <var>result</var>.</li>
</ol>
</div>

<div class='ready-for-wider-review'>
<p>The <b id="__svg__SVGTextContentElement__selectSubString">selectSubString</b>
method is used to select text within the element.  When
selectSubString(<var>charnum</var>, <var>nchars</var>) is called, the
following steps are run:</p>

<p>Selects a substring of the text in this element, beginning at character
index <var>charnum</var> and extending forwards <var>nchars</var>
characters.  The following steps must be followed when this method is called:</p>
<ol>
  <li>Let <var>node</var> be this text content element.</li>
  <li>Let <var>count</var> be the number of characters in this text content element.</li>
  <li>Let <var>end</var> = <var>charnum</var> + <var>nchars</var>.</li>
  <li>If <var>charnum</var> â‰¥ <var>count</var> or <var>end</var> â‰¥ <var>count</var>,
  then throw an IndexSizeError <a>DOMException</a>.</li>
  <li>Remove all <a href="http://www.w3.org/TR/2014/WD-dom-20140204/#concept-range">ranges</a>
  from the document's <a href="http://w3c.github.io/selection-api/#dfn-selection">selection</a>. [<a href="refs.html#ref-DOM4">DOM4</a>][<a href="refs.html#ref-EDITING">EDITING</a>]</li>
  <li>Set the <a href="http://w3c.github.io/selection-api/#dfn-selection">selection</a>'s
  <a href="http://w3c.github.io/selection-api/#dfn-direction">direction</a> to
  forwards.</li>
  <li>Add to the <a href="http://w3c.github.io/selection-api/#dfn-selection">selection</a>
  a new <a href="http://www.w3.org/TR/2014/WD-dom-20140204/#concept-range">range</a> whose
  <a href="http://www.w3.org/TR/2014/WD-dom-20140204/#concept-range-start">start</a> is the
  <a href="http://www.w3.org/TR/2014/WD-dom-20140204/#concept-range-bp">boundary point</a>
  tuple (<var>node</var>, <var>charnum</var>) and <a href="http://www.w3.org/TR/2014/WD-dom-20140204/#concept-range-end">end</a>
  is the <a href="http://www.w3.org/TR/2014/WD-dom-20140204/#concept-range-bp">boundary point</a>
  tuple (<var>node</var>, <var>end</var>).</li>
</ol>
<div class="note">
  <p>Ignoring the argument checking and exception throwing, this is equivalent to
  performing the following:</p>
  <pre>var selection = document.getSelection();
selection.removeAllRanges();
var range = new Range();
range.setStart(textContentElement, charnum);
range.setEnd(textContentElement, charnum + nchars);
selection.addRange(range);</pre>
</div>
<p>This method is deprecated, as it duplicates functionality from the Selection API.</p>
</div>


<div class='ready-for-wider-review'>
<h3 id="InterfaceSVGTextPositioningElement">Interface SVGTextPositioningElement</h3>

<p>The <a>SVGTextPositioningElement</a> interface is implemented by elements
that support attributes that position individual text glyphs.  It is inherited by
<a>SVGTextElement</a> and <a>SVGTSpanElement</a>.</p>

<pre class="idl">interface <b>SVGTextPositioningElement</b> : <a>SVGTextContentElement</a> {
  [SameObject] readonly attribute <a>SVGAnimatedLengthList</a> <a href="text.html#__svg__SVGTextPositioningElement__x">x</a>;
  [SameObject] readonly attribute <a>SVGAnimatedLengthList</a> <a href="text.html#__svg__SVGTextPositioningElement__y">y</a>;
  [SameObject] readonly attribute <a>SVGAnimatedLengthList</a> <a href="text.html#__svg__SVGTextPositioningElement__dx">dx</a>;
  [SameObject] readonly attribute <a>SVGAnimatedLengthList</a> <a href="text.html#__svg__SVGTextPositioningElement__dy">dy</a>;
  [SameObject] readonly attribute <a>SVGAnimatedNumberList</a> <a href="text.html#__svg__SVGTextPositioningElement__rotate">rotate</a>;
};</pre>

<p>The
<b id="__svg__SVGTextPositioningElement__x">x</b>,
<b id="__svg__SVGTextPositioningElement__y">y</b>,
<b id="__svg__SVGTextPositioningElement__dx">dx</b>,
<b id="__svg__SVGTextPositioningElement__dy">dy</b> and
<b id="__svg__SVGTextPositioningElement__rotate">rotate</b> IDL attributes
<a>reflect</a> the <a>'tspan/x'</a>, <a>'tspan/y'</a>,
<a>'tspan/dx'</a>, <a>'tspan/dy'</a> and <a>'tspan/rotate'</a>
content attributes, respectively.</p>


<h3 id="InterfaceSVGTextElement">Interface SVGTextElement</h3>

<edit:with element="text">

<p>An <a>SVGTextElement</a> object represents a <a>'text'</a> element in the DOM.</p>

<pre class="idl">interface <b>SVGTextElement</b> : <a>SVGTextPositioningElement</a> {
};</pre>

</edit:with>

<h3 id="InterfaceSVGTSpanElement">Interface SVGTSpanElement</h3>

<edit:with element="tspan">

<p>An <a>SVGTSpanElement</a> object represents a <a>'tspan'</a> element in the DOM.</p>

<pre class="idl">interface <b>SVGTSpanElement</b> : <a>SVGTextPositioningElement</a> {
};</pre>

</edit:with>

<h3 id="InterfaceSVGTextPathElement">Interface SVGTextPathElement</h3>

<edit:with element="textPath">

<p>An <a>SVGTextPathElement</a> object represents a <a>'textPath'</a> element in the DOM.</p>

<pre class="idl">interface <b>SVGTextPathElement</b> : <a>SVGTextContentElement</a> {

  // textPath Method Types
  const unsigned short <a href="text.html#__svg__SVGTextPathElement__TEXTPATH_METHODTYPE_UNKNOWN">TEXTPATH_METHODTYPE_UNKNOWN</a> = 0;
  const unsigned short <a href="text.html#__svg__SVGTextPathElement__TEXTPATH_METHODTYPE_ALIGN">TEXTPATH_METHODTYPE_ALIGN</a> = 1;
  const unsigned short <a href="text.html#__svg__SVGTextPathElement__TEXTPATH_METHODTYPE_STRETCH">TEXTPATH_METHODTYPE_STRETCH</a> = 2;

  // textPath Spacing Types
  const unsigned short <a href="text.html#__svg__SVGTextPathElement__TEXTPATH_SPACINGTYPE_UNKNOWN">TEXTPATH_SPACINGTYPE_UNKNOWN</a> = 0;
  const unsigned short <a href="text.html#__svg__SVGTextPathElement__TEXTPATH_SPACINGTYPE_AUTO">TEXTPATH_SPACINGTYPE_AUTO</a> = 1;
  const unsigned short <a href="text.html#__svg__SVGTextPathElement__TEXTPATH_SPACINGTYPE_EXACT">TEXTPATH_SPACINGTYPE_EXACT</a> = 2;

  [SameObject] readonly attribute <a>SVGAnimatedLength</a> <a href="text.html#__svg__SVGTextPathElement__startOffset">startOffset</a>;
  [SameObject] readonly attribute <a>SVGAnimatedEnumeration</a> <a href="text.html#__svg__SVGTextPathElement__method">method</a>;
  [SameObject] readonly attribute <a>SVGAnimatedEnumeration</a> <a href="text.html#__svg__SVGTextPathElement__spacing">spacing</a>;
};

<a>SVGTextPathElement</a> implements <a>SVGURIReference</a>;</pre>

<p>The numeric method type constants defined on <a>SVGTextPathElement</a>
are used to represent the keyword values that the <a>'method'</a>
attribute can take.  Their meanings are as follows:</p>

<table class='vert'>
  <tr><th>Constant</th><th>Meaning</th></tr>
  <tr><td><b id="__svg__SVGTextPathElement__TEXTPATH_METHODTYPE_ALIGN">TEXTPATH_METHODTYPE_ALIGN</b></td><td>The <span class="attr-value">align</span> keyword.</td></tr>
  <tr><td><b id="__svg__SVGTextPathElement__TEXTPATH_METHODTYPE_STRETCH">TEXTPATH_METHODTYPE_STRETCH</b></td><td>The <span class="attr-value">stretch</span> keyword.</td></tr>
  <tr><td><b id="__svg__SVGTextPathElement__TEXTPATH_METHODTYPE_UNKNOWN">TEXTPATH_METHODTYPE_UNKNOWN</b></td><td>Some other value.</td></tr>
</table>

<p>The numeric spacing type constants defined on <a>SVGTextPathElement</a>
are used to represent the keyword values that the <a>'spacing'</a>
attribute can take.  Their meanings are as follows:</p>

<table class='vert'>
  <tr><th>Constant</th><th>Meaning</th></tr>
  <tr><td><b id="__svg__SVGTextPathElement__TEXTPATH_SPACINGTYPE_AUTO">TEXTPATH_SPACINGTYPE_AUTO</b></td><td>The <span class="attr-value">auto</span> keyword.</td></tr>
  <tr><td><b id="__svg__SVGTextPathElement__TEXTPATH_SPACINGTYPE_EXACT">TEXTPATH_SPACINGTYPE_EXACT</b></td><td>The <span class="attr-value">exact</span> keyword.</td></tr>
  <tr><td><b id="__svg__SVGTextPathElement__TEXTPATH_SPACINGTYPE_UNKNOWN">TEXTPATH_SPACINGTYPE_UNKNOWN</b></td><td>Some other value.</td></tr>
</table>

<p>The <b id="__svg__SVGTextPathElement__startOffset">startOffset</b> IDL attribute
<a>reflects</a> the <a>'startOffset'</a> content attribute.</p>

<p>The <b id="__svg__SVGTextPathElement__method">method</b> IDL attribute
<a>reflects</a> the <a>'method'</a> content attribute.  The
<a>numeric type values</a> for <a>'method'</a> are as described
above in the numeric method type constant table.</p>

<p>The <b id="__svg__SVGTextPathElement__spacing">spacing</b> IDL attribute
<a>reflects</a> the <a>'spacing'</a> content attribute.  The
<a>numeric type values</a> for <a>'spacing'</a> are as described
above in the numeric spacing type constant table.</p>

</edit:with>
</div>

</body>
</html>
