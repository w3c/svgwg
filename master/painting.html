<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional+edit//EN" "xhtml1-transitional+edit.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:edit="http://xmlns.grorg.org/SVGT12NG/">
<head>
  <title>Painting: Filling, Stroking and Marker Symbols</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link rel="stylesheet"           title="Default"               type="text/css" media="screen" href="style/default_svg.css"/>
  <link rel="alternate stylesheet" title="No issues/annotations" type="text/css" media="screen" href="style/default_no_issues.css"/>
  <link rel="alternate stylesheet" title="CSS3 Unmodified"       type="text/css" media="screen" href="style/default.css"/>
  <link rel="alternate stylesheet" title="SVG 1.1"               type="text/css" media="screen" href="style/svg-style.css"/>
  <!-- W3C style sheet will be added here during processing. -->
</head>
<body>

<h1>Painting: Filling, Stroking and Marker Symbols</h1>

<h2 id="Introduction">Introduction</h2>

<p><a>'path'</a> elements, <a>'text'</a> elements and <a href="shapes.html">basic shapes</a> can be
<strong>filled</strong> (which means painting the interior of
the object) and <strong>stroked</strong> (which means painting
along the outline of the object). Filling and stroking both can
be thought of in more general terms as
<strong>painting</strong> operations.</p>

<p>Certain elements (i.e., <a>'path'</a>, <a>'polyline'</a>, <a>'polygon'</a>
and <a>'line'</a> elements) can also have
<a href="painting.html#Markers">marker symbols</a> drawn at their vertices.</p>

<p>With SVG, you can paint (i.e., fill or stroke) with:</p>

<ul>
  <li>a single color</li>
  <li>a gradient (linear or radial)</li>
  <li>a pattern (vector or image, possibly tiled)</li>
  <li>custom paints available via <a href="extend.html">extensibility</a></li>
</ul>

<p>SVG uses the general notion of a <strong>paint server</strong>. Paint
servers are specified using a <a href="linking.html#IRIReference">IRI reference</a>
on a <a>'fill'</a> or <a>'stroke'</a> property.
<a href="pservers.html">Gradients and patterns</a> are just specific types of
paint servers.</p>

<h2 id="SpecifyingPaint">Specifying paint</h2>

<p>Properties <a>'fill'</a> and <a>'stroke'</a> take on a value of type
<span class="prop-value">&lt;paint&gt;</span>, which is specified as follows:</p>

    <table summary="paint specification" cellspacing="0"
    cellpadding="0">
      <tr valign="baseline">
        <td><span
        class="property">&lt;paint&gt;</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td><span class="prop-value">none |<br />
         currentColor |<br />
         <a href="types.html#DataTypeColor">&lt;color&gt;</a>
         [<a href="types.html#DataTypeICCColor">&lt;icccolor&gt;</a>] |<br />
          <a href="types.html#DataTypeFuncIRI">&lt;funciri&gt;</a> [ none | currentColor | <a href="types.html#DataTypeColor">&lt;color&gt;</a>
         [<a href="types.html#DataTypeICCColor">&lt;icccolor&gt;</a>] ] |<br />
         <a class="noxref"
        href="http://www.w3.org/TR/2008/REC-CSS2-20080411/cascade.html#value-def-inherit">
        <span
        class="value-inst-inherit noxref">inherit</span></a></span></td>
      </tr>
    </table>

<dl>
  <dt>none</dt>
  <dd>Indicates that no paint is applied.</dd>

  <dt>currentColor</dt>
  <dd>Indicates that painting is done using the current animated value of the color specified
  by the <a>'color'</a> property. This
  mechanism is provided to facilitate sharing of color
  attributes between parent grammars such as other (non-SVG)
  XML. This mechanism allows you to define a style in your HTML
  which sets the <span class='property'>'color'</span> property and then pass that style to
  the SVG user agent so that your SVG text will draw in the
  same color.</dd>

  <dt><strong>&lt;color&gt; [&lt;icccolor&gt;]</strong></dt>
  <dd><a href="types.html#DataTypeColor">&lt;color&gt;</a> is
  the explicit color (in the sRGB color space [<a href='refs.html#ref-SRGB'>SRGB</a>])
  to be used to paint the current object. SVG supports all of
  the syntax alternatives for &lt;color&gt;
  <a href="http://www.w3.org/TR/2008/REC-CSS2-20080411/syndata.html#value-def-color">defined in CSS2</a>
  ([<a href="refs.html#ref-CSS2">CSS2</a>], section 4.3.6), with the
  exception that SVG contains an expanded list of <a
  href="types.html#ColorKeywords">recognized color keywords
  names</a>. If an optional ICC color specification [<a href='refs.html#ref-ICC42'>ICC42</a>] is
  provided, then the user agent searches the color profile
  description database for a <a
  href="color.html#ColorProfileDescriptions">color profile
  description</a> entry whose name descriptor matches
  the &lt;name&gt; part of the <a href="types.html#DataTypeICCColor">&lt;icccolor&gt;</a>
  and uses the last matching entry that is found.
  (If no match is found, then the ICC color specification is
  ignored.) The comma and/or whitespace separated list
  of <a href="types.html#DataTypeNumber">&lt;number&gt;</a>s
  is a set of ICC-profile-specific color values.
  (In most cases, the <a href="types.html#DataTypeNumber">&lt;number&gt;</a>s will
  be in the range 0 to 1.) On platforms which support ICC-based
  color management, the <a href="types.html#DataTypeICCColor">&lt;icccolor&gt;</a> gets
  precedence over the <a href="types.html#DataTypeColor">&lt;color&gt;</a> (which is in the sRGB color
  space). Note that color interpolation occurs in an RGB color
  space even if an ICC-based color specification is provided
  (see <a>'color-interpolation'</a>).
  For more on ICC-based colors, refer to <a
  href="color.html#ColorProfileDescriptions">Color profile
  descriptions</a>.</dd>

  <dt><strong><a href="types.html#DataTypeFuncIRI">&lt;funciri&gt;</a><br />
   &nbsp;&nbsp;&nbsp;[ none |<br />
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentColor |<br />
   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;color&gt;
  [&lt;icccolor&gt;] ]</strong></dt>
  <dd>The <a href="types.html#DataTypeFuncIRI">&lt;funciri&gt;</a> is used to identify a <a
  href="pservers.html">paint server</a> such as a gradient, a
  pattern or a custom paint defined by an extension (see <a
  href="extend.html">Extensibility</a>). The &lt;funciri&gt;
  points to the paint server (e.g., a <a
  href="pservers.html#Gradients">gradient</a> or <a
  href="pservers.html#Patterns">pattern</a>) to be
  used to paint the current object. If the <a
  href="linking.html#IRIReference">IRI reference</a>
  is not valid (e.g., it points to an object that doesn't exist
  or the object is not a valid paint server), then the paint
  method following the &lt;funciri&gt; (i.e., <span class='prop-value'>none |
  currentColor | &lt;color&gt; [&lt;icccolor&gt;]</span>
  is used if provided; otherwise, the document is in error (see
  <a href="implnote.html#ErrorProcessing">Error
  processing</a>).</dd>
</dl>

<div class="ready-for-wg-review">
<h2 id="FillProperties">Fill properties</h2>

<h3 id="SpecifyingFillPaint">Specifying fill paint: the <span class="property">'fill'</span> property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="FillProperty">fill</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;paint&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>black</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>If a <a>&lt;color&gt;</a> value is part of the specified value, then
    it is computed as per the <a>'color'</a> property.  For anything else the
    computed value is as specified.</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'fill'</a> property paints the interior of the given graphical
element. The area to be painted consists of any areas inside the outline
of the shape. To determine the inside of the shape, all subpaths are
considered, and the interior is determined according to the rules
associated with the current value of the <a>'fill-rule'</a> property.
The zero-width geometric outline of a shape is included in the area to
be painted.</p>

<p>The fill operation fills open subpaths by performing the fill
operation as if an additional "closepath" command were added to the
path to connect the last point of the subpath with the first point of
the subpath. Thus, fill operations apply to both open subpaths within
<a>'path'</a> elements (i.e., subpaths without a closepath command) and
<a>'polyline'</a> elements.</p>

<h3 id="WindingRule">Winding rule: the <span class="property">'fill-rule'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="FillRuleProperty">fill-rule</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>nonzero | evenodd</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>nonzero</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>As specified.</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'fill-rule'</a> property indicates the algorithm (or
<em>winding rule</em>) which is to
be used to determine what parts of the canvas are included inside the
shape. For a simple, non-intersecting path, it is intuitively clear
what region lies "inside"; however, for a more complex path, such as a
path that intersects itself or where one subpath encloses another, the
interpretation of "inside" is not so obvious.</p>

<p>The <a>'fill-rule'</a> property provides two options for how the
inside of a shape is determined:</p>

<dl>
  <dt><span class='prop-value'>nonzero</span></dt>
  <dd>
    <p>This rule determines the "insideness" of a point on the
    canvas by drawing a ray from that point to infinity in any
    direction and then examining the places where a segment of
    the shape crosses the ray. Starting with a count of zero,
    add one each time a path segment crosses the ray from left
    to right and subtract one each time a path segment crosses
    the ray from right to left. After counting the crossings,
    if the result is zero then the point is <em>outside</em>
    the path. Otherwise, it is <em>inside</em>. The following
    drawing illustrates the <span class='prop-value'>nonzero</span>
    rule:</p>

    <div class="figure">
      <img class="bordered" src="images/painting/fillrule-nonzero.svg" alt="Image showing nonzero fill rule"/>
      <p class="caption">The effect of a nonzero fill rule on paths with self-intersections
      and enclosed subpaths.</p>
    </div>
  </dd>

  <dt><span class='prop-value'>evenodd</span></dt>
  <dd>
    <p>This rule determines the "insideness" of a point on the
    canvas by drawing a ray from that point to infinity in any
    direction and counting the number of path segments from the
    given shape that the ray crosses. If this number is odd,
    the point is inside; if even, the point is outside. The
    following drawing illustrates the <span class='prop-value'>evenodd</span>
    rule:</p>

    <div class="figure">
      <img class="bordered" src="images/painting/fillrule-evenodd.svg" alt="Image showing evenodd fill rule"/>
      <p class="caption">The effect of an evenodd fill rule on paths with self-intersections
      and enclosed subpaths.</p>
    </div>
  </dd>
</dl>

<p class="note">The above descriptions do not specify what to do if a path
segment coincides with or is tangent to the ray. Since any ray will do,
one may simply choose a different ray that does not have such problem
intersections.</p>

<h3 id="FillOpacity">Fill paint opacity: the <span class="property">'fill-opacity'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="FillOpacityProperty">fill-opacity</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;number&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>1</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified, but clamped to the range [0, 1]</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>
  
<p><a>'fill-opacity'</a> specifies the
opacity of the painting operation used to paint the interior
the current object. (See <a
href="render.html#PaintingShapesAndText">Painting shapes and
text</a>.)  A value of 0 means fully transparent, and a
value of 1 means fully opaque.</p>

<p class="note">See also the <a>'opacity'</a> property, which
specifies group opacity.</p>

<h2 id="StrokeProperties">Stroke properties</h2>

<div class="annotation">
 <p>
   SVG2 Requirement: Have the vector-effect property
 </p>
 <p>
   Resolution: SVG 2 will have the vector-effect property
 </p>
 <p>
   <a href="http://www.w3.org/2012/02/02-svg-minutes.html#item05">SVG Working Group Teleconference 02 Feb 2012</a>.
 </p>
 <p>
   Purpose: To get stroke that doesn't scale when element is transformed. 
 </p>
 <p>
   Owner: Erik
 </p>
</div>

<p>The following are the properties which affect how an element is stroked.</p>

<p>In all cases, all stroking properties which are affected by
directionality, such as those having to do with dash patterns, must be
rendered such that the stroke operation starts at the same point at
which the graphics element starts. In particular, for <a>'path'</a>
elements, the start of the path is the first point of the initial
"moveto" command.</p>

<p>For stroking properties such as dash patterns whose computations
are dependent on progress along the outline of the graphics element,
distance calculations are required to utilize the SVG user agent's
standard <a href="paths.html#DistanceAlongAPath">Distance along a path</a>
algorithms.</p>

<p>When stroking is performed using a complex paint server, such as a
gradient or a pattern, the stroke operation must be identical to the
result that would have occurred if the geometric shape defined by the
geometry of the current graphics element and its associated stroking
properties were converted to an equivalent <a>'path'</a> element and
then filled using the given paint server.</p>

<h3 id="SpecifyingStrokePaint">Specifying stroke paint: the <span class="property">'stroke'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeProperty">stroke</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;paint&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>none</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>If a <a>&lt;color&gt;</a> value is part of the specified value, then
    it is computed as per the <a>'color'</a> property.  For anything else the
    computed value is as specified.</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'stroke'</a> property paints along the outline of the given
graphical element.</p>

<p>A subpath (see <a href="paths.html">Paths</a>) consisting of
a single <a href="paths.html#PathDataMovetoCommands">moveto</a>
shall not be stroked. Any zero length subpath shall not be
stroked if the <a>'stroke-linecap'</a> property has a value of
<span class="prop-value">butt</span> but shall be stroked if the
<a>'stroke-linecap'</a> property has a value of
<span class="prop-value">round</span> or <span class="prop-value">square</span>,
producing respectively a circle or a square centered at the given point.
Examples of zero length subpaths include
<span class="attr-value">'M 10,10 L 10,10'</span>,
<span class="attr-value">'M 20,20 h 0'</span>,
<span class="attr-value">'M 30,30 z'</span> and
<span class="attr-value">'M 40,40 c 0,0 0,0 0,0'</span>.</p>

<div class="annotation">
  <p>SVG2 Requirement: Include non-scaling stroke.</p>
  <p>Resolution: SVG2 will include non-scaling stroke.</p>
  <p><a href="http://www.w3.org/2011/10/28-svg-irc#T17-46-34">Pre-TPAC F2F 2011-10-28</a>.</p>
  <p>Purpose: Keep diagrams readable as zoom level changes.</p>
  <p>Owner: Chris.</p>
  <p>Note that this could be part of more generic non-scaling features.</p>
</div>

<div class="annotation">
  <p>SVG2 Requirement: Include a way to specify stroke-position.</p>
  <p>Resolution: SVG2 shall include a way to specify stroke-position.</p>
  <p><a href="http://www.w3.org/2011/10/28-svg-irc#T18-09-48">Pre-TPAC F2F 2011-10-28</a>.</p>
  <p>Purpose: Allow stroke to be inside or outside path.</p>
  <p>Owner: Cameron.</p>
  <p>See proposal page: <a href="http://www.w3.org/Graphics/SVG/WG/wiki/Proposals/Stroke_position">Stroke position</a>.</p>
</div>

<div class="annotation">
  <p>SVG2 Requirement: Specify more precisely stroke dashing.</p>
  <p>Resolution: SVG2 shall specify stroke dashing more precisely.</p>
  <p><a href="http://www.w3.org/2011/10/28-svg-irc#T18-14-14">Pre-TPAC F2F 2011-10-28</a>.</p>
  <p>Purpose: Define dash starting point on basic shapes and path segments.</p>
  <p>Owner: Cameron.</p>
</div>

<div class="annotation">
  <p>SVG2 Requirement: Allow more author control over positions of dashes. (Scaling of dashes to fit path.)</p>
  <p>Resolution: SVG2 shall allow more author control over positions of dashes.</p>
  <p><a href="http://www.w3.org/2011/10/28-svg-irc#T18-17-51">Pre-TPAC 2011-10-28</a>.</p>
  <p>Purpose: Allow things like aligning dashes at rectangle corners or along paths, needed for mapping.</p>
  <p>Owner: Cameron.</p>
  <p>See proposal page: <a href="http://www.w3.org/Graphics/SVG/WG/wiki/Proposals/Stroke_dash_adjustment">Stroke dash adjustment</a>.</p>
</div>

<h3 id="StrokeOpacity">Stroke paint opacity: the <span class="property">'stroke-opacity'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeOpacityProperty">stroke-opacity</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;number&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>1</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>As specified, but clamped to the range [0, 1].</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>
  
<p>The <a>'stroke-opacity'</a> property specifies the opacity of the
painting operation used to stroke the current object.  (See
<a href="render.html#PaintingShapesAndText">Painting shapes and text</a>.)
As with <a>'fill-opacity'</a>, a value of 0 means fully transparent, and a value of 1
means fully opaque.</p>

<p class="note">See also the <a>'opacity'</a> property, which specifies
group opacity.</p>

<h3 id="StrokeWidth">Stroke width: the <span class="property">'stroke-width'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeWidthProperty">stroke-width</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;percentage&gt;</a> | <a>&lt;length&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>1</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>refer to the size of the current viewport (see <a href="coords.html#Units">Units</a>)</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>This property specifies the width of the stroke on the current object.
A zero value causes no stroke to be painted. A negative value
is <a>invalid</a>.</p>

<h3 id="LineCaps">Drawing caps at the ends of strokes: the <span class="property">'stroke-linecap'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeLinecapProperty">stroke-linecap</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>butt | round | square</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>butt</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p><a>'stroke-linecap'</a> specifies the shape to be used at the end of
open subpaths when they are stroked.  The possible values are:</p>

<dl>
  <dt><span class='prop-value'>butt</span></dt>
  <dd>This value indicates that the stroke for each subpath does not
  extend beyond its two endpoints.  A zero length subpath will therefore
  not have any stroke.</dd>

  <dt><span class='prop-value'>round</span></dt>
  <dd>
    <p>This value indicates that at each end of each subpath, the shape
    representing the stroke will be extended by a half circle with a radius equal
    to the stroke width.  If a subpath has zero length, then the resulting
    effect is that the stroke for that subpath consists solely of a full circle
    centered at the subpath's point.</p>
  </dd>

  <dt><span class='prop-value'>square</span></dt>
  <dd>
    <p>This value indicates that at the end of each subpath, the shape
    representing the stroke will be extended by a rectangle with the
    same width as the stroke width and whose length is half of the stroke width.
    If a subpath has zero length, then the resulting effect is that the
    stroke for that subpath consists solely of a square with side length
    equal to the stroke width, centered at the subpath's point, and oriented
    such that two of its sides are parallel to the effective tangent
    at that subpath's point.  See
    <a href="implnote.html#PathElementImplementationNotes"><span class='element-name'>'path'</span>
    element implementation notes</a> for details on how to determine the tangent
    at a zero-length subpath.</p>
  </dd>
</dl>

<div class="figure">
  <img class="bordered" src="images/painting/linecap.svg"
       alt="Image showing three paths, each with a different line cap."/>
  <p class="caption">The three types of line caps.</p>
</div>

<p>See the definition of the <a>cap shape</a> below for a more precise
description of the shape a line cap will have.</p>

<h3 id="LineJoin">Controlling line joins: the <span class="property">'stroke-linejoin'</span>
and <span class="property">'stroke-miterlimit'</span> properties</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeLinejoinProperty">stroke-linejoin</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>miter | round | bevel</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>miter</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p><a>'stroke-linejoin'</a> specifies the shape to be used at the
corners of paths or basic shapes when they are stroked. For further details see
the <a href="implnote.html#PathElementImplementationNotes">path implementation notes</a>.</p>

<dl>
  <dt><span class='prop-value'>miter</span></dt>
  <dd>This value indicates that a sharp corner is to be used to join path segments.
  The corner is formed by extending the outer edges of the stroke at the tangents
  of the path segments until they intersect.</dd>

  <dt><span class='prop-value'>round</span></dt>
  <dd>This value indicates that a round corner is to be used to join path segments.
  The corner is a circular sector centered on the join point.</dd>

  <dt><span class='prop-value'>bevel</span></dt>
  <dd>This value indicates that a bevelled corner is to be used to join path segments.
  The bevel shape is a triangle that fills the area between the two stroked segments.</dd>
</dl>

<div class="figure">
  <img class="bordered" src="images/painting/linejoin.svg"
       alt="Image showing three paths, each with a different line join."/>
  <p class="caption">The three types of line joins.</p>
</div>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeMiterlimitProperty">stroke-miterlimit</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;number&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>4</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>When two line segments meet at a sharp angle and <span
class='prop-value'>miter</span> joins have been specified for
<a>'stroke-linejoin'</a>, it is possible for the miter to extend
far beyond the thickness of the line stroking the path. The
<a>'stroke-miterlimit'</a> imposes a limit on the ratio of the miter
length to the <a>'stroke-width'</a>. When the limit is exceeded, the
join is converted from a miter to a bevel.</p>

<dl>
  <dt><span class='prop-value'>&lt;number&gt;</span></dt>
  <dd>The limit on the ratio of the miter length to the <a>'stroke-width'</a>.
  The value of <span class='prop-value'>&lt;miterlimit&gt;</span> must be a
  <a>&lt;number&gt;</a> greater than or equal to 1. Any other value is an error (see
  <a href="implnote.html#ErrorProcessing">Error processing</a>).</dd>
</dl>

<p>The ratio of miter length (distance between the outer tip and
the inner corner of the miter) to <a>'stroke-width'</a> is directly
related to the angle <var>θ</var> between the segments in user space by the
formula:</p>

<div role="math" aria-describedby="math-miterlength">
  <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
    <mrow>
      <mfrac>
        <mi>miterLength</mi>
        <mi style="font-family: sans-serif">‘stroke-width’</mi>
      </mfrac>
      <mo>=</mo>
      <mfrac>
        <mn>1</mn>
        <mrow>
          <mi>sin</mi>
          <mo>&#x2061;</mo>
          <mfrac>
            <mi>θ</mi>
            <mn>2</mn>
          </mfrac>
        </mrow>
      </mfrac>
    </mrow>
  </math>
  <pre id="math-miterlength">miterLength / stroke-width = 1 / sin(theta / 2)</pre>
</div>

<p>For example, a miter limit of 1.414 converts miters to bevels for
theta less than 90 degrees, a limit of 4.0 converts them for theta less
than approximately 29 degrees, and a limit of 10.0 converts them for
theta less than approximately 11.5 degrees.</p>

<p>See the definition of the <a>line join shape</a> below for a more precise
description of the shape a line join will have.</p>

<h3 id="StrokeDashing">Dashing strokes: the <span class="property">'stroke-dasharray'</span>
and <span class="property">'stroke-dashoffset'</span> properties</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeDasharrayProperty">stroke-dasharray</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>none | <a>&lt;dasharray&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>none</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>refer to the size of the current viewport (see <a href="coords.html#Units">Units</a>)</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes (<a href="animate.html#AdditionAttributes">non-additive</a>)</td>
  </tr>
</table>

<p>where:</p>

<p class="definition"><dfn id="DataTypeDasharray">&lt;dasharray&gt;</dfn> =
[ <a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> ]#*</p>

<p>The <a>'stroke-dasharray'</a> property controls
the pattern of dashes and gaps used to form the shape of
a path's stroke.</p>

<dl>
  <dt><span class='prop-value'>none</span></dt>
  <dd>Indicates that no dashing is used.</dd>

  <dt><span class='prop-value'>&lt;dasharray&gt;</span></dt>
  <dd>
    <p>Specifies a dashing pattern to use.  A <a>&lt;dasharray&gt;</a> is
    a list of comma and/or white space separated lengths and percentages.
    Each value specifies a length along the path for which the stroke
    is to be painted (a <em>dash</em>) and not painted (a <em>gap</em>).
    Every second value in the list beginning with the first one specifies
    the length of a dash, and every other value specifies the length of a gap
    between the dashes.  If the list has an odd number of values, then it is
    repeated to yield an even number of values.  (Thus, the rendering behavior
    of <span class="prop-value">stroke-dasharray: 5,3,2</span>
    is equivalent to <span class="prop-value">stroke-dasharray: 5,3,2,5,3,2</span>.)</p>

    <p>The resulting even-length dashing pattern is repeated along each subpath.
    The dashing pattern is reset and begins again at the start of each subpath.</p>

    <p>If any value in the list is negative, the <a>&lt;dasharray&gt;</a> value is
    <a>invalid</a>.  If all of the values in the list are zero,
    then the stroke is rendered as if a value of <span class='prop-value'>none</span>
    were specified.</p>
  </dd>
</dl>

<div class="figure">
  <img class="bordered" src="images/painting/dashes.svg" alt="Image showing a thick, dashed stroke."/>
  <p class="caption">A dashed stroke.  The dashing pattern is <span class="prop-value">20,10</span>.
  The red line shows the actual path that is stroked.</p>
</div>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeDashoffsetProperty">stroke-dashoffset</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>0</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>refer to the size of the current viewport (see <a href="coords.html#Units">Units</a>)</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'stroke-dashoffset'</a> property specifies the distance into the repeated
dash pattern to start the stroke dashing at the beginning of the path.  If the
value is negative, then the effect is the same as dash offset <var>d</var>:</p>

<div role="math" aria-describedby="math-dashoffset">
  <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
    <mrow>
      <mi>d</mi>
      <mo>=</mo>
      <mi>s</mi>
      <mo>-</mo>
      <mfenced open="|" close="|">
        <mi style="font-family: sans-serif">‘stroke-dashoffset’</mi>
      </mfenced>
      <mo>mod</mo>
      <mi>s</mi>
    </mrow>
  </math>
  <pre id="math-dashoffset">d = s - (abs(stroke-dashoffset) mod s)</pre>
</div>

<p>where <var>s</var> is the sum of the dash array values.</p>

<div class="figure">
  <img class="bordered" src="images/painting/dashoffset.svg"
       alt="Image showing a thick, dashed stroke with a non-zero dash offset."/>
  <p class="caption">A dashed stroke with a non-zero dash offset.  The dashing
  pattern is <span class="prop-value">20,10</span> and the dash offset is
  <span class="prop-value">15</span>.  The red line shows the actual path that
  is stroked.</p>
</div>

<p>See the definition of <a>dash positions</a> below for a more precise
description of positions along a path that dashes will be placed.</p>

<h3 id="StrokeShape">Computing the shape of the stroke</h3>

<p>The following algorithm describes what the shape of a
<a>'path'</a> or <a>basic shape</a>'s stroke is, taking into account the
stroking properties above:</p>

<p class="issue">This should include text elements too, but should we
keep stroke dashing on text?</p>

<ol>
  <li>Let <var>shape</var> be an empty shape.</li>
  <li>Let <var>path</var> be the <a>equivalent path</a> of the element.</li>
  <li>For each subpath of <var>path</var>:
    <ol>
      <li>Let <var>positions</var> be the <a>dash positions</a> for the subpath.</li>
      <li>For each pair &lt;<var>start</var>, <var>end</var>&gt; in <var>positions</var>:
        <ol>
          <li>Let <var>dash</var> be the shape that includes, for all distances
          between <var>start</var> and <var>end</var> along the subpath, all
          points that lie on the line perpendicular to the subpath at that
          distance and which are within distance <a>'stroke-width'</a> of
          the point on the subpath at that position.</li>

          <li>Set <var>dash</var> to be the union of <var>dash</var> and the
          starting <a>cap shape</a> for the subpath at position <var>start</var>.</li>

          <li>Set <var>dash</var> to be the union of <var>dash</var> and the
          ending <a>cap shape</a> for the subpath at position <var>end</var>.</li>

          <li>
            Let <var>index</var> and <var>last</var> be the indexes of the
            path segments in the subpath at distance <var>start</var> and
            <var>end</var> along the subpath.

            <p class="note">It does not matter whether any zero length segments are
            included when choosing <var>index</var> and <var>last</var>.</p>
          </li>

          <li>While <var>index</var> &lt; <var>last</var>:
            <ol>
              <li>Set <var>dash</var> to be the union of <var>dash</var> and the
              <a>line join shape</a> for the subpath at segment index <var>index</var>.</li>

              <li>Set <var>index</var> to <var>index</var> + 1.</li>
            </ol>
          </li>

          <li>Set <var>shape</var> to be the union of <var>shape</var> and
          <var>stroke</var>.</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>Return <var>shape</var>.</li>
</ol>

<p>The <dfn id="TermDashPositions">dash positions</dfn> for a given subpath of
the <a>equivalent path</a> of a <a>'path'</a> or <a>basic shape</a> is a
sequence of pairs of values, which represent the starting and ending distance
along the subpath for each of the dashes that form the subpath's stroke.  It is
determined as follows:</p>

<ol>
  <li>Let <var>pathlength</var> be the length of the subpath.</li>

  <li>Let <var>dashes</var> be the list of values of <a>'stroke-dasharray'</a>
  on the element, converted to user units, repeated if necessary so that it has
  an even number of elements; if the property has the value
  <span class="prop-value">none</span>, then the list has a single value 0.</li>

  <li>Let <var>count</var> be the number of values in <var>dashes</var>.</li>
  <li>Let <var>sum</var> be the sum of the values in <var>dashes</var>.</li>

  <li>If <var>sum</var> = 0, then return a sequence with the single pair
  &lt;0, <var>pathlength</var>&gt;.</li>

  <li>Let <var>positions</var> be an empty sequence.</li>

  <li>Let <var>offset</var> be the value of the <a>'stroke-dashoffset'</a>
  property on the element.</li>

  <li>If <var>offset</var> is negative, then set <var>offset</var> to
  <var>sum</var> − abs(<var>offset</var>).</li>

  <li>Set <var>offset</var> to <var>offset</var> mod <var>sum</var>.</li>

  <li>Let <var>index</var> be the smallest integer such that
  sum(<var>dashes<sub>i</sub></var>, 0 ≤ <var>i</var> ≤ <var>index</var>) ≥ <var>offset</var>.</li>

  <li>Let <var>dashlength</var> be
  min(sum(<var>dashes<sub>i</sub></var>, 0 ≤ <var>i</var> ≤ <var>index</var>) − <var>offset</var>, <var>pathlength</var>).</li>

  <li>If <var>index</var> mod 2 = 0, then append to <var>positions</var> the
  pair &lt;0, <var>dashlength</var>&gt;.</li>

  <li>Let <var>position</var> be <var>dashlength</var>.</li>

  <li>While <var>position</var> &lt; <var>pathlength</var>:
    <ol>
      <li>Set <var>index</var> to (<var>index</var> + 1) mod <var>count</var>.</li>

      <li>Let <var>dashlength</var> be
      min(<var>dashes</var><sub><var>index</var></sub>, <var>pathlength</var> − <var>position</var>).</li>

      <li>If <var>index</var> mod 2 = 0, then append to <var>positions</var> the
      pair &lt;<var>position</var>, <var>position</var> + <var>dashlength</var>&gt;.</li>

      <li>Set <var>position</var> to <var>position</var> + <var>dashlength</var>.</li>
    </ol>
  </li>

  <li>Return <var>positions</var>.</li>
</ol>

<p>The starting and ending <dfn id="TermCapShape">cap shapes</dfn> at a given
<var>position</var> along a subpath are determined as follows:</p>

<ol>
  <li>If <a>'stroke-linecap'</a> is <span class="prop-value">butt</span>, then return an empty shape.</li>

  <li>Otherwise, if <a>'stroke-linecap'</a> is <span class="prop-value">round</span>, then:
    <ol>
      <li>If this is a starting cap, then return a semicircle of radius <a>'stroke-width'</a> positioned such that:
        <ul>
          <li>Its straight edge is parallel to the line perpendicular to the subpath at distance <var>position</var> along it.</li>
          <li>The midpoint of its straight edge is at the point that is along the subpath at distance <var>position</var>.</li>
          <li>The direction from the midpoint of its arc to the midpoint of its straight edge is the same as the direction of the subpath at distance <var>position</var> along it.</li>
        </ul>
      </li>
      <li>Otherwise, this is an ending cap.  Return a semicircle of radius <a>'stroke-width'</a> positioned such that:
        <ul>
          <li>Its straight edge is parallel to the line perpendicular to the subpath at distance <var>position</var> along it.</li>
          <li>The midpoint of its straight edge is at the point that is along the subpath at distance <var>position</var>.</li>
          <li>The direction from the midpoint of its straight edge to the midpoint of its arc is the same as the direction of the subpath at distance <var>position</var> along it.</li>
        </ul>
      </li>
    </ol>
  </li>

  <li>Otherwise, <a>'stroke-linecap'</a> is <span class="prop-value">square</span>:
    <ol>
      <li>If this is a starting cap, then return a rectangle with side lengths <a>'stroke-width'</a> and <a>'stroke-width'</a> / 2 positioned such that:
        <ul>
          <li>Its longer edges, <var>A</var> and <var>B</var>, are parallel to the line perpendicular to the subpath at distance <var>position</var> along it.</li>
          <li>The midpoint of <var>A</var> is at <var>start</var>.</li>
          <li>The direction from the midpoint of <var>B</var> to the midpoint of <var>A</var> is the same as the direction of the subpath at distance <var>position</var> along it.</li>
        </ul>
      </li>
      <li>Otherwise, this is an ending cap.  Return a rectangle with side lengths <a>'stroke-width'</a> and <a>'stroke-width'</a> / 2 positioned such that:
        <ul>
          <li>Its longer edges, <var>A</var> and <var>B</var>, are parallel to the line perpendicular to the subpath at distance <var>position</var> along it.</li>
          <li>The midpoint of <var>A</var> is at <var>end</var>.</li>
          <li>The direction from the midpoint of <var>A</var> to the midpoint of <var>B</var> is the same as the direction of the subpath at distance <var>position</var> along it.</li>
        </ul>
      </li>
    </ol>
  </li>
</ol>

<div class="figure">
  <img class="bordered" src="images/painting/linecap-construction.svg"
       alt="Image showing how to construct the three types of line caps"/>
  <p class="caption">The three different <a>'stroke-linecap'</a> values used on
  paths with a single, non-zero length subpath.  The white line is the path
  itself and the thick gray area is the stroke.  On the top row, the green lines
  indicate the perpendicular to the tangent at the path endpoints and the pink
  areas are the caps.  The bottom row shows the stroke without the perpendicular
  and cap highlighting.</p>
</div>

<p>The <dfn id="TermLineJoinShape">line join shape</dfn> for a given segment of
a subpath is determined as follows:</p>

<ol>
  <li>Let <var>P</var> be the point at the end of the segment.</li>
  <li>Let <var>A</var> be the line parallel to the tangent at the end of the segment.</li>
  <li>Let <var>B</var> be the line parallel to the tangent at the start of the following segment.</li>

  <li>If <var>A</var> and <var>B</var> are the same line, then return an empty shape.</li>

  <li>Let <var>A<sub>left</sub></var> and <var>A<sub>right</sub></var> be lines
  parallel to <var>A</var> at a distance of <a>'stroke-width'</a> / 2 to the
  left and to the right of <var>A</var>, respectively.</li>

  <li>Let <var>B<sub>left</sub></var> and <var>B<sub>right</sub></var> be lines
  parallel to <var>B</var> at a distance of <a>'stroke-width'</a> / 2 to the
  left and to the right of <var>B</var>, respectively.</li>

  <li>
    Let <var>P</var><sub>1</sub>, <var>P</var><sub>2</sub> and
    <var>P</var><sub>3</sub> be points determined as follows:

    <ol>
      <li>If the acute angle between <var>A</var> and <var>B</var> is on the
      right of these lines, considering the direction of the subpath, then
      <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub> are the points on
      <var>A<sub>left</sub></var> and <var>B<sub>left</sub></var> closest to
      <var>P</var>, and <var>P</var><sub>3</sub> is the intersection of
      <var>A<sub>left</sub></var> and <var>B<sub>left</sub></var>.</li>

      <li>Otherwise, <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub> are
      the points on <var>A<sub>right</sub></var> and <var>B<sub>right</sub></var>
      closest to <var>P</var>, and <var>P</var><sub>3</sub> is the intersection
      of <var>A<sub>right</sub></var> and <var>B<sub>right</sub></var>.</li>
    </ol>
  </li>

  <li>Let <var>bevel</var> be the triangle formed from the three points
  <var>P</var>, <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub>.</li>

  <li>If <a>'stroke-linejoin'</a> is <span class="prop-value">round</span>, then
  return the union of <var>bevel</var> and a circular sector of radius
  <a>'stroke-width'</a>, centered on <var>P</var>, and which has
  <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub> as the two endpoints of
  the arc.</li> 

  <li>Let <var>θ</var> be the angle between <var>A</var> and <var>B</var>.</li>

  <li>If <a>'stroke-linejoin'</a> is <span class="prop-value">miter</span> and
  1 / sin(<var>θ</var> / 2) ≤ <a>'stroke-miterlimit'</a>, then return the union
  of <var>bevel</var> and the triangle formed from the three points
  <var>P</var><sub>1</sub>, <var>P</var><sub>2</sub> and <var>P</var><sub>3</sub>.</li>

  <li>Return <var>bevel</var>.</li>
</ol>

<div class="figure">
  <img class="bordered" src="images/painting/linejoin-construction.svg"
       alt="Image showing the lines and points computed to construct a round line join."/>
  <p class="caption">Construction of a round line join shape, shown in pink.
  The white line is the original path, which has two segments that come to a
  point, and the gray region is the stroke.</p>
</div>

<h2 id="VisibilityControl">Controlling visibility: the effect of the <span
class="property">'display'</span> and <span class="property">'visibility'</span>
properties</h2>

<p class="note">See the CSS 2.1 specification for the definitions
of <a>'display'</a> and <a>'visibility'</a>.
[<a href="refs.html#ref-CSS21">CSS21</a>]</p>

<p>SVG uses two properties to control the visibility of
<a>container elements</a>, <a>graphics elements</a>
and <a>text content elements</a>:
<a>'display'</a> and <a>'visibility'</a>.</p>

<p>When applied to certain <a>container element</a>, <a>graphics element</a>
or <a>text content element</a>, setting <a>'display'</a> to
<span class="prop-value">none</span> results in the element not becoming part of
the rendering tree.  Such elements and all of their descendants (regardless of
their own <a>'display'</a> property value):</p>

<ul>
  <li>are not rendered</li>

  <li>are not sensitive to <a href="interact.html#UIEvents">pointer events</a></li>

  <li>do not contribute to <a href="coords.html#ObjectBoundingBox">bounding box
  calculations</a></li>

  <li>do not contribute to <a href="masking.html#Masking">masks</a> or
  <a href="masking.html#ClippingPaths">clipping paths</a>, when descendants of a
  <a>'mask element'</a> or <a>'clipPath'</a> element</li>

  <li>are not considered when performing <a href="text.html#TextLayout">text layout</a></li>
</ul>

<p>Elements that have any other <a>'display'</a> value than
<span class="prop-value">none</span> behave normally with
respect to all of the above.</p>

<p>The <a>'display'</a> property only applies to the following SVG elements:
<a>'svg'</a>, <a>'g'</a>, <a>'switch'</a>, <a>'a'</a>,
<a>'foreignObject'</a>, <a>graphics elements</a> and
<a>text content elements</a>.  Note that <a>'display'</a>
is not an inherited property.</p>

<p>The <a>'display'</a> property affects the direct processing
of a given element, but it does not prevent it from
being referenced by other elements. For example, setting
<span class="prop-value">display: none</span> on a <a>'path'</a> element
will prevent that element from getting rendered directly onto the
canvas, but the <a>'path'</a> element can still be referenced by a
<a>'textPath'</a> element; furthermore, its geometry will be used
in text-on-a-path processing even if the <a>'path'</a> has
<span class="prop-value">display: none</span>.</p>

<p>When applied to a <a>graphics element</a> or <a>text content element</a>,
setting <a>'visibility'</a> to <span class="prop-value">hidden</span>
or <span class="prop-value">collapse</span>
results in the element not being painted.  It is, however,
still part of the rendering tree, is sensitive
to pointer events (depending on the value of <a>'pointer-events'</a>),
contributes to bounding box calculations and clipping paths,
and does affect text layout.</p>

<p>The <a>'visibility'</a> property only applies to
<a>graphics elements</a> and <a>text content elements</a>.
Note that since <a>'visibility'</a> is an inherited property,
although it has no effect on a <a>container element</a> itself,
its inherited value can affect descendant elements.</p>
</div>


<h2 id="Markers">Markers</h2>

<div class="annotation">
 <p>
   SVG2 Requirement: Improve markers
 </p>
 <p>
   Resolution: We will improve markers for SVG2
 </p>
 <p>
   <a href="http://www.w3.org/2011/10/27-svg-irc#T18-12-30">Pre-TPAC F2F Day 1</a>.
 </p>
 <p>
   Purpose: To solve the common problems authors have with SVG markers
 </p>
 <p>
   Owner: Cameron (ACTION-3286)
 </p>
</div>

<edit:with element='marker'>

<p>A marker is a symbol which is attached to one or more vertices of
<a>'path'</a>, <a>'line'</a>, <a>'polyline'</a> and <a>'polygon'</a>
elements. Typically, markers are used to make arrowheads or polymarkers.
Arrowheads can be defined by attaching a marker to the start or end
vertices of <a>'path'</a>, <a>'line'</a> or <a>'polyline'</a> elements.
Polymarkers can be defined by attaching a marker to all vertices of a
<a>'path'</a>, <a>'line'</a>, <a>'polyline'</a> or <a>'polygon'</a>
element.</p>

<p>The graphics for a marker are defined by a <a>'marker element'</a> element.
To indicate that a particular <a>'marker element'</a> element should be
rendered at the vertices of a particular <a>'path'</a>, <a>'line'</a>,
<a>'polyline'</a> or <a>'polygon'</a> element, set one or more marker
properties (<a>'marker property'</a>, <a>'marker-start'</a>, <a>'marker-mid'</a>
or <a>'marker-end'</a>) to reference the given <a>'marker element'</a>
element.</p>

<p><span class="example-ref">Example Marker</span> draws a triangular marker
symbol as an arrowhead at the end of a path.</p>

<edit:example href='images/painting/marker.svg' name='Marker' description="Triangular marker at the end of a path" image='yes' link='yes'/>

<p>Markers can be animated. The animated effects will show on all current uses
of the markers within the document.</p>

<h3 id="MarkerElement">The <span class="element-name">'marker'</span> element</h3>

<p>The <a>'marker element'</a> element defines the graphics that is to
be used for drawing arrowheads or polymarkers on a given <a>'path'</a>,
<a>'line'</a>, <a>'polyline'</a> or <a>'polygon'</a> element.</p>

<edit:elementsummary name='marker'/>

    <div class="adef-list">
      <p><em>Attribute definitions:</em></p>
      <dl>
        <dt id="MarkerUnitsAttribute"><span
        class="adef">markerUnits</span> = "<span
        class="attr-value">strokeWidth |
        userSpaceOnUse</span>"</dt>
        <dd>Defines the coordinate system for attributes
        <a>'markerWidth'</a>, <a>'markerHeight'</a> and the
        contents of the <a>'marker element'</a>.<br />
        If <span class="attr-value">markerUnits="strokeWidth"</span>,
        <a>'markerWidth'</a>, <a>'markerHeight'</a> and the contents
        of the <a>'marker element'</a> represent values in a coordinate system
        which has a single unit equal the size in user units of the
        current stroke width (see the <a>'stroke-width'</a> property) in
        place for the graphic object referencing the marker.<br />
        If <span class="attr-value">markerUnits="userSpaceOnUse"</span>,
        <a>'markerWidth'</a>, <a>'markerHeight'</a> and the contents
        of the <a>'marker element'</a> represent values in the current
        user coordinate system in place for the graphic object
        referencing the marker (i.e., the user coordinate system for
        the element referencing the <a>'marker element'</a> element via a
        <a>'marker property'</a>, <a>'marker-start'</a>, <a>'marker-mid'</a>
        or <a>'marker-end'</a> property).<br />
        If attribute <a>'markerUnits'</a> is not specified, then the effect
        is as if a value of <span class="attr-value">'strokeWidth'</span>
        were specified.<br />
        <span class="anim-target"><a href="animate.html#Animatable">Animatable</a>: yes.</span></dd>
        <dt id="MarkerElementRefXAttribute"><span
        class="adef">refX</span> = "<span class="attr-value"><a
        href="types.html#DataTypeCoordinate">&lt;coordinate&gt;</a></span>"</dt>
        <dd>The x-axis coordinate of the reference point which is
        to be aligned exactly at the marker position. The
        coordinate is defined in the coordinate system after
        application of the <a>'viewBox'</a> and <a>'preserveAspectRatio'</a>
        attributes.<br />
         If the attribute is not specified, the effect is as if a
        value of "0" were specified.<br />
         <span class="anim-target"><a
        href="animate.html#Animatable">Animatable</a>:
        yes.</span></dd>
        <dt id="MarkerElementRefYAttribute"><span
        class="adef">refY</span> = "<span class="attr-value"><a
        href="types.html#DataTypeCoordinate">&lt;coordinate&gt;</a></span>"</dt>
        <dd>The y-axis coordinate of the reference point which is
        to be aligned exactly at the marker position. The
        coordinate is defined in the coordinate system after
        application of the <a>'viewBox'</a> and <a>'preserveAspectRatio'</a>
        attributes.<br />
         If the attribute is not specified, the effect is as if a
        value of "0" were specified.<br />
         <span class="anim-target"><a
        href="animate.html#Animatable">Animatable</a>:
        yes.</span></dd>
        <dt id="MarkerWidthAttribute"><span
        class="adef">markerWidth</span> = "<span
        class="attr-value"><a
        href="types.html#DataTypeLength">&lt;length&gt;</a></span>"</dt>
        <dd>Represents the width of the viewport into which the
        marker is to be fitted when it is rendered.<br />
         A negative value is an error (see <a
        href="implnote.html#ErrorProcessing">Error processing</a>).
        A value of zero disables rendering of the element.<br />
         If the attribute is not specified, the effect is as if a
        value of "3" were specified.<br />
         <span class="anim-target"><a
        href="animate.html#Animatable">Animatable</a>:
        yes.</span></dd>
        <dt id="MarkerHeightAttribute"><span
        class="adef">markerHeight</span> = "<span
        class="attr-value"><a
        href="types.html#DataTypeLength">&lt;length&gt;</a></span>"</dt>
        <dd>Represents the height of the viewport into which the
        marker is to be fitted when it is rendered.<br />
         A negative value is an error (see <a
        href="implnote.html#ErrorProcessing">Error processing</a>).
        A value of zero disables rendering of the element.<br />
         If the attribute is not specified, the effect is as if a
        value of "3" were specified.<br />
         <span class="anim-target"><a
        href="animate.html#Animatable">Animatable</a>:
        yes.</span></dd>
        <dt id="OrientAttribute"><span class="adef">orient</span> = "<span
        class="attr-value">auto | <a
        href="types.html#DataTypeAngle">&lt;angle&gt;</a></span>"</dt>
        <dd>
          Indicates how the marker is rotated.<br />
          <br />
           A value of <span class='attr-value'>'auto'</span> indicates that the marker is
          oriented such that its positive x-axis is pointing as
          follows:
          <ol type="a">
            <li>
              If there is a path segment coming into the
              vertex and another path segment going out of the vertex,
              the marker's positive x-axis should point toward the
              angle bisector for the angle at the given vertex, where
              that angle has one side consisting of tangent vector for
              the path segment going into the vertex and the other side
              the tangent vector for the path segment going out of the
              vertex. Note:
              <ul>
                <li>If the tangent vectors are the same, the angle bisector equals the two tangent vectors.</li>
                <li>If an incoming and an outgoing vertex produce a zero vector the direction of marker is undefined.</li>
              </ul>
            </li>
            <li>
              If there is only a path segment going into the vertex (e.g.,
              the last vertex on an open path), the marker's positive
              x-axis should point in the same direction as the tangent
              vector for the path segment going into the vertex.
            </li>
            <li>
              If there is only a path segment going out of the vertex
              (e.g., the first vertex on an open path), the marker's
              positive x-axis should point in the same direction as the
              tangent vector for the path segment going out of the
              vertex. (Refer to <a href="implnote.html#PathElementImplementationNotes"><span class='element-name'>'path'</span>
              element implementation notes</a> for a more thorough
              discussion of the directionality of path segments.)
            </li>
          </ol>
          <br />
           In all cases for closed subpaths (e.g., subpaths which
          end with a <a
          href="paths.html#PathDataClosePathCommand">'closepath'</a>
          command), the orientation of the marker corresponding to
          the initial point of the subpath is calculated assuming
          that: 
          <ul>
            <li>the path segment going into the vertex is the path
            segment corresponding to the closepath</li>
            <li>the path segment coming out of the vertex is the
            first path segment in the subpath</li>
          </ul>
          <br />
           When a <a
          href="paths.html#PathDataClosePathCommand">'closepath'</a>
          command is followed by a command other than a <a
          href="paths.html#PathDataMovetoCommands">'moveto'</a>
          command, then the orientation of the marker corresponding
          to the <a
          href="paths.html#PathDataClosePathCommand">'closepath'</a>
          command is calculated assuming that: 
          <ul>
            <li>the path segment going into the vertex is the path
            segment corresponding to the closepath</li>
            <li>the path segment coming out of the vertex is the
            first path segment of the subsequent subpath</li>
          </ul>
          <br />
          A <a>&lt;angle&gt;</a> value represents a
          particular orientation in the user space of the graphic
          object referencing the marker. For example, if a value of
          "0" is given, then the marker will be drawn such that its
          x-axis will align with the x-axis of the user space of
          the graphic object referencing the marker. If the
          attribute is not specified, the effect is as if a value
          of "0" were specified.<br />
           <span class="anim-target"><a
          href="animate.html#Animatable">Animatable</a>: yes
          (non-additive).</span>
        </dd>
      </dl>
    </div>

<p>Markers are drawn such that their reference point (i.e.,
attributes <a>'refX'</a> and <a>'refY'</a>) is positioned at the
given vertex. In other words, a translation transformation is
constructed by the user agent to achieve the effect of having point
(<a>'refX'</a> and <a>'refY'</a>) within the marker content's coordinate
system (after any transformations due to the <a>'viewBox'</a> and
<a>'preserveAspectRatio'</a> attributes) align exactly with the given
vertex.</p>

<p>SVG's <a href="styling.html#UAStyleSheet">user agent style sheet</a> sets
the <a>'overflow'</a> property for <a>'marker element'</a> elements to
<span class="prop-value">hidden</span>, which causes a rectangular clipping
path to be created at the bounds of the marker tile.  Unless the
<a>'overflow'</a> property is overridden, any graphics within the marker which
goes outside of the marker rectangle will be clipped.</p>

<p>The contents of the <a>'marker element'</a> are relative to a new
coordinate system. Attribute <a>'markerUnits'</a> determines an initial
scale factor for transforming the graphics in the marker into the user
coordinate system for the referencing element. An additional set of
transformations might occur if there is a <a>'viewBox'</a> attribute, in
which case the coordinate system for the contents of the <a>'marker element'</a>
will be transformed due to the processing of attributes <a>'viewBox'</a>
and <a>'preserveAspectRatio'</a>. If there is no <a>'viewBox'</a>
attribute, then the assumed default value for the the <a>'viewBox'</a>
attribute has the origin of the viewBox coincident with the origin
of the viewport and the width/height of the viewBox the same as the
width/height of the viewport.</p>

<p><a href="styling.html#SVGStylingProperties">Properties</a> inherit into the
<a>'marker element'</a> element from its ancestors; properties do <em>not</em>
inherit from the element referencing the <a>'marker element'</a> element.</p>

<p><a>'marker element'</a> elements are never rendered directly;
their only usage is as something that can be referenced using the
<a>'marker property'</a>, <a>'marker-start'</a>, <a>'marker-end'</a> and
<a>'marker-mid'</a> properties. The <a>'display'</a> property does not
apply to the <a>'marker element'</a> element; thus, <a>'marker element'</a> elements
are not directly rendered even if the <a>'display'</a> property is
set to a value other than <span class="prop-value">none</span>, and
<a>'marker element'</a> elements are available for referencing even when the
<a>'display'</a> property on the <a>'marker element'</a> element or any of its
ancestors is set to <span class="prop-value">none</span>.</p>

<p><a href="script.html#EventAttributes">Event attributes</a> and
<a href="svgdom.html#EventListeners">event listeners</a> attached
to the contents of a <a>'marker element'</a> element are not processed;
only the rendering aspects of <a>'marker element'</a> elements are
processed.</p>

<h3 id="MarkerProperties">Marker properties: the <span class="property">'marker-start'</span>,
<span class="property">'marker-mid'</span> and <span class="property">'marker-end'</span>
properties</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="MarkerStartProperty">marker-start</dfn>,
        <dfn id="MarkerMidProperty">marker-mid</dfn>,
	<dfn id="MarkerEndProperty">marker-end</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>none | <a>&lt;funciri&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>none</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>'path'</a>, <a>'line'</a>, <a>'polyline'</a> and <a>'polygon'</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>As specified.</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p><a>'marker-start'</a> defines the arrowhead or polymarker that shall
be drawn at the first vertex of the given <a>'path'</a> element or
<a href="shapes.html">basic shape</a>. <a>'marker-end'</a> defines
the arrowhead or polymarker that shall be drawn at the final vertex.
<a>'marker-mid'</a> defines the arrowhead or polymarker that shall be
drawn at every other vertex (i.e., every vertex except the first and
last). Note that for a <a>'path'</a> element which ends with a closed
sub-path, the last vertex is the same as the initial vertex on the given
sub-path. In this case, if <a>'marker-end'</a> does not equal
<span class="prop-value">none</span>, then it is possible that two markers
will be rendered on the given vertex. One way to prevent this is to set
<a>'marker-end'</a> to <span class="prop-value">none</span>. (Note that
the same comment applies to <a>'polygon'</a> elements.)</p>

<p>Possible values for <a>'marker-start'</a>, <a>'marker-mid'</a> and
<a>'marker-end'</a> are:</p>

<dl>
  <dt><span class='prop-value'>none</span></dt>
  <dd>Indicates that no marker symbol shall be drawn at the given
  vertex (vertices).</dd>

  <dt><span class='prop-value'>&lt;funciri&gt;</span></dt>
  <dd>The &lt;funciri&gt; is a <a href="types.html#DataTypeFuncIRI">Functional IRI reference</a>
  to the <a>'marker element'</a> element which shall be used as the arrowhead
  symbol or polymarker at the given vertex or vertices. If the
  <a href="linking.html#IRIReference">IRI reference</a> is not valid (e.g.,
  it points to an object that is undefined or the object is not a
  <a>'marker element'</a> element), then the marker(s) shall not
  be drawn.</dd>
</dl>

<h3 id="MarkerShorthand">Marker shorthand: the <span class="property">'marker'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="MarkerProperty">marker</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>none | <a>&lt;funciri&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>not defined for shorthand properties</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>'path'</a>, <a>'line'</a>, <a>'polyline'</a> and <a>'polygon'</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>see individual properties</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'marker property'</a> property specifies
the marker symbol that shall be used for all points on the given
element.  It is a shorthand for setting the three individual marker
properties – <a>'marker-start'</a>, <a>'marker-mid'</a> and <a>'marker-end'</a> –
to the same value.</p>

<h3 id="MarkerAlgorithm">Details on how markers are rendered</h3>

<p>Markers are drawn after the given object is filled and stroked.</p>

<p>For each marker that is drawn, a temporary new user coordinate
system is established so that the marker will be positioned and sized
correctly, as follows:</p>

<ul>
  <li>The axes of the temporary new user coordinate system are aligned
  according to the <a>'orient'</a> attribute on the
  <a>'marker element'</a> element and the slope of the curve at the given vertex.
  (Note: if there is a discontinuity at a vertex, the slope is the
  average of the slopes of the two segments of the curve that join
  at the given vertex. If a slope cannot be determined, the slope is
  assumed to be zero.)</li>

  <li>A temporary new coordinate system is established by attribute
  <a>'markerUnits'</a>. If <a>'markerUnits'</a> equals
  <span class="attr-value">'strokeWidth'</span>, then the temporary new
  user coordinate system is the result of scaling the current
  user coordinate system by the current value of property
  <a>'stroke-width'</a>. If <a>'markerUnits'</a> equals
  <span class="attr-value">'userSpaceOnUse'</span>, then no extra scale
  transformation is applied.</li>

  <li>An additional set of transformations might occur if the
  <a>'marker element'</a> element includes a <a>'viewBox'</a> attribute, in
  which case additional transformations are set up to produce the necessary
  result due to attributes <a>'viewBox'</a> and <a>'preserveAspectRatio'</a>.</li>

  <li>If the <a>'overflow'</a> property on the <a>'marker element'</a> element
  indicates that the marker needs to be clipped to its viewport, then an
  implicit clipping path is established at the bounds of the viewport.</li>
</ul>

<p>The rendering effect of a marker is as if the contents of the
referenced <a>'marker element'</a> element were deeply cloned
into a separate non-exposed DOM tree for each instance of the
marker. Because the cloned DOM tree is non-exposed, the SVG DOM
does not show the cloned instance of the marker.</p> <p>For user
agents that support <a href="styling.html#StylingWithCSS">Styling
with CSS</a>, the conceptual deep cloning of the referenced
<a>'marker element'</a> element into a non-exposed DOM tree also
copies any property values resulting from
<a href="http://www.w3.org/TR/2008/REC-CSS2-20080411/cascade.html">the CSS cascade</a>
([<a href="refs.html#ref-CSS2">CSS2</a>], chapter 6) and
property inheritance on the referenced element and its contents. CSS2
selectors can be applied to the original (i.e., referenced) elements
because they are part of the formal document structure. CSS2 selectors
cannot be applied to the (conceptually) cloned DOM tree because its
contents are not part of the formal document structure.</p>

<p>For illustrative purposes, we'll repeat the marker example shown earlier:</p>

<pre>
&lt;?xml version="1.0" standalone="no"?&gt;
&lt;svg width="4in" height="2in" 
     viewBox="0 0 4000 2000" version="1.1"
     xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;defs&gt;
    &lt;marker id="Triangle"
      viewBox="0 0 10 10" refX="0" refY="5" 
      markerUnits="strokeWidth"
      markerWidth="4" markerHeight="3"
      orient="auto"&gt;
      &lt;path d="M 0 0 L 10 5 L 0 10 z" /&gt;
    &lt;/marker&gt;
  &lt;/defs&gt;
  &lt;rect x="10" y="10" width="3980" height="1980"
       fill="none" stroke="blue" stroke-width="10" /&gt;
  &lt;desc&gt;Placing an arrowhead at the end of a path.
  &lt;/desc&gt;
  &lt;path d="M 1000 750 L 2000 750 L 2500 1250"
        fill="none" stroke="black" stroke-width="100" 
        marker-end="url(#Triangle)"  /&gt;
&lt;/svg&gt;
</pre>

<p>The rendering effect of the above file will be visually identical to
the following:</p>

<pre>
&lt;?xml version="1.0" standalone="no"?&gt;
&lt;svg width="4in" height="2in" 
     viewBox="0 0 4000 2000" version="1.1"
     xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;desc&gt;File which produces the same effect
      as the marker example file, but without
      using markers.
  &lt;/desc&gt;
  &lt;rect x="10" y="10" width="3980" height="1980"
       fill="none" stroke="blue" stroke-width="10" /&gt;
  &lt;!-- The path draws as before, but without the marker properties --&gt;
  &lt;path d="M 1000 750 L 2000 750 L 2500 1250"
        fill="none" stroke="black" stroke-width="100"  /&gt;
  &lt;!-- The following logic simulates drawing a marker 
       at final vertex of the path. --&gt;
  &lt;!-- First off, move the origin of the user coordinate system
       so that the origin is now aligned with the end point of the path. --&gt;
  <strong>&lt;g transform="translate(2500,1250)" &gt;</strong>
    &lt;!-- Rotate the coordinate system 45 degrees because
         the marker specified orient="auto" and the final segment
         of the path is going in the direction of 45 degrees. --&gt;
    <strong>&lt;g transform="rotate(45)" &gt;</strong>
      &lt;!-- Scale the coordinate system to match the coordinate system
           indicated by the 'markerUnits' attributes, which in this case has
           a value of 'strokeWidth'. Therefore, scale the coordinate system
           by the current value of the 'stroke-width' property, which is 100. --&gt;
      <strong>&lt;g transform="scale(100)" &gt;</strong>
        &lt;!-- Translate the coordinate system by 
             (-refX*viewBoxToMarkerUnitsScaleX, -refY*viewBoxToMarkerUnitsScaleY)
             in order that (refX,refY) within the marker will align with the vertex.
             In this case, we use the default value for preserveAspectRatio
             ('xMidYMid meet'), which means find a uniform scale factor
             (i.e., viewBoxToMarkerUnitsScaleX=viewBoxToMarkerUnitsScaleY)
             such that the viewBox fits entirely within the viewport ('meet') and 
             is center-aligned ('xMidYMid'). In this case, the uniform scale factor
             is markerHeight/viewBoxHeight=3/10=.3. Therefore, translate by
             (-refX*.3,-refY*.3)=(0*.3,-5*.3)=(0,-1.5). --&gt;
        <strong>&lt;g transform="translate(0,-1.5)" &gt;</strong>
          &lt;!-- There is an implicit clipping path because the user agent style
               sheet says that the 'overflow' property for markers has the value
               'hidden'. To achieve this, create a clipping path at the bounds
               of the viewport. Note that in this case the viewport extends
               0.5 units to the left and right of the viewBox due to 
               a uniform scale factor, different ratios for markerWidth/viewBoxWidth
               and markerHeight/viewBoxHeight, and 'xMidYMid' alignment --&gt;
          <strong>&lt;clipPath id="cp1" &gt;
            &lt;rect x="-0.5" y="0" width="4" height="3" /&gt;
          &lt;/clipPath&gt;</strong>
          <strong>&lt;g clip-path="url(#cp1)" &gt;</strong>
            &lt;!-- Scale the coordinate system by the uniform scale factor
                 markerHeight/viewBoxHeight=3/10=.3 to set the coordinate
                 system to viewBox units. --&gt;
            <strong>&lt;g transform="scale(.3)" &gt;</strong>
              &lt;!-- This 'g' element carries all property values that result from
                   cascading and inheritance of properties on the original 'marker' element.
                   In this example, neither fill nor stroke was specified on the 'marker'
                   element or any ancestors of the 'marker', so the initial values of
                   "black" and "none" are used, respectively. --&gt;
             <strong>&lt;g fill="black" stroke="none" &gt;</strong>
                &lt;!-- Expand out the contents of the 'marker' element. --&gt;
                <strong>&lt;path d="M 0 0 L 10 5 L 0 10 z" /&gt;</strong>
              <strong>&lt;/g&gt;</strong>
            <strong>&lt;/g&gt;</strong>
          <strong>&lt;/g&gt;</strong>
        <strong>&lt;/g&gt;</strong>
      <strong>&lt;/g&gt;</strong>
    <strong>&lt;/g&gt;</strong>
  <strong>&lt;/g&gt;</strong>
&lt;/svg&gt;
</pre>
<p class="view-as-svg"><a href="images/painting/marker-simulated.svg">View this example as SVG (SVG-enabled browsers only)</a></p>

</edit:with>

<div class="ready-for-wg-review">
<h2 id="PaintOrder">Controlling paint operation order: the
<span class="property">'paint-order'</span> property</h2>

<div class="annotation">
 <p>SVG2 Requirement: Control the order of painting and filling and markers</p>
 <p>Resolution: SVG2 will adopt the "paint-order" property proposal, though possibly with a different name.</p>
 <p><a href="http://www.w3.org/2012/05/07-svg-minutes#item05">Hamburg 2012 F2F Day 1</a>.</p>
 <p>Purpose: To address the common desire to paint strokes below fills without having to duplicate an element</p>
 <p>Owner: Cameron (ACTION-3285)</p>
</div>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="PaintOrderProperty">paint-order</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>normal | [ fill || stroke || markers ]</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>normal</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>graphics elements</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'paint-order'</a> property controls the order that the three
paint operations that <a>shapes</a> and text are rendered with:
their fill, their stroke and any markers they might have.</p>

<p class="issue">Is there a better name than <a>'paint-order'</a>?</p>

<p>When the value of this property is <span class="prop-value">normal</span>,
the element is painted with the standard order of painting operations:
the fill is painted first, then its stroke and finally its markers.</p>

<p>When any of the other keywords are used, the order of the paint
operations for painting the element is as given, from left to right.  If any of
the three keywords are omitted, they are painted last, in the order they
would be painted with <span class="prop-value">paint-order: normal</span>.</p>

<p class="note">This mean that, for example,
<span class="prop-value">paint-order: stroke</span>
has the same rendering behavior as
<span class="prop-value">paint-order: stroke fill markers</span>.</p>

<p class="issue">This does not affect interaction, but once the
<a href="http://www.w3.org/Graphics/SVG/WG/wiki/Proposals/Marker_children">marker children proposal</a>
is added to the spec, it will be possible for <a>'marker element'</a> elements to
receive mouse events or not depending on the value of <a>'paint-order'</a>.</p>

<p class="issue">The Rendering chapter will need some changes to accommodate
<a>'paint-order'</a>, and should probably gain a more precise description of
exactly how an SVG fragment is rendered.</p>

<div class="example">
  <p>The following example shows how the <a>'paint-order'</a> property can
  be used to render stroked text in a more aesthetically pleasing manner.</p>

  <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="600" height="150" viewBox="0 0 600 150">

  <style>
    text {
      font: 80px bold sans-serif; stroke-linejoin: round;
      text-anchor: middle; fill: peachpuff; stroke: crimson;
    }
  </style>

  <text x="150" y="100" stroke-width="6px">pizazz</text>
  <text x="450" y="100" stroke-width="12px" paint-order="stroke">pizazz</text>
</svg>
]]></pre>

  <div class="figure">
    <img class="bordered" src="images/painting/paintorder.svg"/>
    <p class="caption">Text painted with its stroke below the fill.</p>
  </div>
</div>

<div class="ready-for-wg-review">
<h2 id="ColorInterpolation">Color space for interpolation: the
<span class="property">'color-interpolation'</span> property</h2>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="ColorInterpolationProperty">color-interpolation</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | sRGB | linearRGB</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>sRGB</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>container elements</a>, <a>graphics elements</a>,
    <a>gradient elements</a>, <a>'animate'</a> and <a>'animateColor'</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The SVG user agent performs color interpolations and compositing
at various points as it processes SVG content.  The <a>'color-interpolation'</a>
property controls which color space is used for the following graphics operations:</p>

<ul>
  <li>interpolating between <a href="pservers.html#Gradients">gradient</a> stops,</li>

  <li>interpolating color when performing color animations with either
  <a>'animate'</a> or <a>'animateColor'</a>,</li>

  <li>and <a href="masking.html#SimpleAlphaBlending">alpha compositing</a> of
  <a>graphics elements</a> into the current background.</li>
</ul>

<p class="note">For <a href="filters.html">filter effects</a>, the
<a>'color-interpolation-filters'</a> property controls which color space is used.
[<a href="refs.html#ref-FILTERS">FILTERS</a>]</p>
</div>

<p>The <a>'color-interpolation'</a> property chooses between color operations
occurring in the sRGB color space or in a (light energy linear) linearized RGB
color space. Having chosen the appropriate color space, component-wise linear
interpolation is used.  Possible values for <a>'color-interpolation'</a> are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent can choose either the
  <span class='prop-value'>sRGB</span> or
  <span class='prop-value'>linearRGB</span> spaces for color interpolation.
  This option indicates that the author doesn't require that color
  interpolation occur in a particular color space.</dd>

  <dt><span class='prop-value'>sRGB</span></dt>
  <dd>Indicates that color interpolation occurs in the sRGB
  color space.</dd>

  <dt><span class='prop-value'>linearRGB</span></dt>
  <dd>Indicates that color interpolation occurs in the
  linearized RGB color space as described below.</dd>
</dl>

<p id="sRGBlinearRGBConversionFormulas">The conversion formulas between the
sRGB color space (i.e., nonlinear with 2.2 gamma curve) and the linearized RGB
color space (i.e., color values expressed as sRGB tristimulus values without a
gamma curve) can be found in <a href="http://webstore.iec.ch/webstore/webstore.nsf/artnum/025408">the sRGB specification</a>
[<a href="refs.html#ref-SRGB">SRGB</a>].
For illustrative purposes, the following formula shows the conversion from
sRGB to linearized RGB, where <var>C<sub>srgb</sub></var> is one of the
three sRGB color components, <var>C<sub>linear</sub></var> is the corresponding
linearized RGB color component, and all color values are between 0 and 1:</p>

<div role="math" aria-describedby="math-linearRGB">
  <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
    <mrow>
      <msub>
        <mi>C</mi>
        <mi>linear</mi>
      </msub>
      <mo>=</mo>
      <mo>{</mo>
      <mtable columnalign="left">
        <mtr>
          <mtd>
            <mfrac>
              <msub>
                <mi>C</mi>
                <mi>srgb</mi>
              </msub>
              <mn>12.92</mn>
            </mfrac>
          </mtd>
          <mtd>
            <mtext>if&#160;</mtext>
            <msub>
              <mi>C</mi>
              <mi>srgb</mi>
            </msub>
            <mo>≤</mo>
            <mn>0.04045</mn>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msup>
              <mfenced>
                <mfrac>
                  <mrow>
                    <msub>
                      <mi>C</mi>
                      <mi>srgb</mi>
                    </msub>
                    <mo>+</mo>
                    <mn>0.055</mn>
                  </mrow>
                  <mn>1.055</mn>
                </mfrac>
              </mfenced>
              <mn>2.4</mn>
            </msup>
          </mtd>
          <mtd>
            <mtext>if&#160;</mtext>
            <msub>
              <mi>C</mi>
              <mi>srgb</mi>
            </msub>
            <mo>></mo>
            <mn>0.04045</mn>
          </mtd>
        </mtr>
      </mtable>
    </mrow>
  </math>
  <pre id="math-linearRGB">
if C_srgb &lt;= 0.04045
  C_linear = C_srgb / 12.92
else if c_srgb &gt; 0.04045
  C_linear = ((C_srgb + 0.055) / 1.055) ^ 2.4
</pre>
</div>

<p>Out-of-range color values, if supported by the user agent, also are
converted using the above formulas. (See
<a href="implnote.html#RangeClamping">Clamping values which are restricted to a particular range</a>.)</p>

<p>When a child element is blended into a background, the value of the
<a>'color-interpolation'</a> property on the child determines the type of
blending, not the value of the <a>'color-interpolation'</a> on the parent.
For <a href="pservers.html#Gradients">gradients</a> which make use of the
<span class='attr-name'>'xlink:href'</span> attribute to reference another
gradient, the gradient uses the <a>'color-interpolation'</a> property value
from the gradient element which is directly referenced by the <a>'fill'</a> or
<a>'stroke'</a> property. When animating colors, color interpolation is
performed according to the value of the <a>'color-interpolation'</a> property
on the element being animated.</p>

<h2 id="RenderingHints">Rendering hints</h2>

<h3 id="ColorRenderingProperty">The <span class="property">'color-rendering'</span> property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="ColorRenderingProperty">color-rendering</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | optimizeSpeed | optimizeQuality</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>auto</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>container elements</a>, <a>graphics elements</a>, <a>gradient elements</a>, <a>'animate'</a> and <a>'animateColor'</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The creator of SVG content might want to provide a hint
to the implementation about how to make speed vs. quality
tradeoffs as it performs color interpolation and compositing. The
<a>'color-rendering'</a> property provides a hint to the SVG user
agent about how to optimize its color interpolation and compositing
operations.  Possible values are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent shall make appropriate
  tradeoffs to balance speed and quality, but quality shall be
  given more importance than speed.</dd>

  <dt><span class='prop-value'>optimizeSpeed</span></dt>
  <dd>Indicates that the user agent shall emphasize rendering
  speed over quality. For RGB display devices, this option will
  sometimes cause the user agent to perform color interpolation
  and compositing in the device RGB color space.</dd>

  <dt><span class='prop-value'>optimizeQuality</span></dt>
  <dd>Indicates that the user agent shall emphasize quality
  over rendering speed.</dd>
</dl>

<p><a>'color-rendering'</a> takes precedence over
<a>'color-interpolation-filters'</a>. For example, assume
<span class="prop-value">color-rendering: optimizeSpeed</span> and
<span class="prop-value">color-interpolation-filters: linearRGB</span>.
In this case, the SVG user agent should perform color operations in a way that
optimizes performance, which might mean sacrificing the color interpolation
precision as specified by <span class="prop-value">color-interpolation-filters: linearRGB</span>.</p>

<h3 id="ShapeRenderingProperty">The <span class="property">'shape-rendering'</span> property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="ShapeRenderingProperty">shape-rendering</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | optimizeSpeed | crispEdges | geometricPrecision</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>auto</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The creator of SVG content might want to provide a hint to the
implementation about what tradeoffs to make as it renders vector graphics
elements such as <a>'path'</a> elements and <a href="shapes.html">basic shapes</a>
such as circles and rectangles. The <a>'shape-rendering'</a> property provides
these hints.  Possible values are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent shall make appropriate
  tradeoffs to balance speed, crisp edges and geometric
  precision, but with geometric precision given more importance
  than speed and crisp edges.</dd>

  <dt><span class='prop-value'>optimizeSpeed</span></dt>
  <dd>Indicates that the user agent shall emphasize rendering
  speed over geometric precision and crisp edges. This option
  will sometimes cause the user agent to turn off shape
  anti-aliasing.</dd>

  <dt><span class='prop-value'>crispEdges</span></dt>
  <dd>Indicates that the user agent shall attempt to emphasize
  the contrast between clean edges of artwork over rendering
  speed and geometric precision. To achieve crisp edges, the
  user agent might turn off anti-aliasing for all lines and
  curves or possibly just for straight lines which are close to
  vertical or horizontal. Also, the user agent might adjust
  line positions and line widths to align edges with device
  pixels.</dd>

  <dt><span class='prop-value'>geometricPrecision</span></dt>
  <dd>Indicates that the user agent shall emphasize geometric
  precision over speed and crisp edges.</dd>
</dl>

<h3 id="TextRenderingProperty">The <span class="property">'text-rendering'</span> property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="TextRenderingProperty">text-rendering</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | optimizeSpeed | optimizeLegibility | geometricPrecision</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>auto</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The creator of SVG content might want to provide a hint to the
implementation about what tradeoffs to make as it renders text. The
<a>'text-rendering'</a> property provides these hints.  Possible
values are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent shall make appropriate
  tradeoffs to balance speed, legibility and geometric
  precision, but with legibility given more importance than
  speed and geometric precision.</dd>

  <dt><span class='prop-value'>optimizeSpeed</span></dt>
  <dd>Indicates that the user agent shall emphasize rendering
  speed over legibility and geometric precision. This option
  will sometimes cause the user agent to turn off text
  anti-aliasing.</dd>

  <dt><span class='prop-value'>optimizeLegibility</span></dt>
  <dd>Indicates that the user agent shall emphasize legibility
  over rendering speed and geometric precision. The user agent
  will often choose whether to apply anti-aliasing techniques,
  built-in font hinting or both to produce the most legible
  text.</dd>

  <dt><span class='prop-value'>geometricPrecision</span></dt>
  <dd>Indicates that the user agent shall emphasize geometric
  precision over legibility and rendering speed. This option
  will usually cause the user agent to suspend the use of
  hinting so that glyph outlines are drawn with comparable
  geometric precision to the rendering of path data.</dd>
</dl>

<h3 id="ImageRenderingProperty">The <span class="property">'image-rendering'</span> property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="ImageRenderingProperty">image-rendering</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | optimizeQuality | optimizeSpeed</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>auto</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a href="animate.html#Animatable">Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The creator of SVG content might want to provide a hint to the
implementation about how to make speed vs. quality tradeoffs as it performs
image processing. The <a>'image-rendering'</a> property provides a hint to the
SVG user agent about how to optimize its image rendering.  Possible values are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent shall make appropriate
  tradeoffs to balance speed and quality, but quality shall be
  given more importance than speed. The user agent shall employ
  a resampling algorithm at least as good as nearest neighbor
  resampling, but bilinear resampling is strongly preferred.
  For <a href="conform.html#ConformingHighQualitySVGViewers">Conforming
  High-Quality SVG Viewers</a>, the user agent shall employ a
  resampling algorithm at least as good as bilinear
  resampling.</dd>

  <dt><span class='prop-value'>optimizeQuality</span></dt>
  <dd>Indicates that the user agent shall emphasize quality
  over rendering speed. The user agent shall employ a
  resampling algorithm at least as good as bilinear
  resampling.</dd>

  <dt><span class='prop-value'>optimizeSpeed</span></dt>
  <dd>Indicates that the user agent shall emphasize rendering
  speed over quality. The user agent should use a resampling
  algorithm which achieves the goal of fast rendering, with the
  requirement that the resampling algorithm shall be at least
  as good as nearest neighbor resampling. If performance goals
  can be achieved with higher quality algorithms, then the user
  agent should use the higher quality algorithms instead of
  nearest neighbor resampling.</dd>
</dl>

<p>In all cases, resampling must be done in a truecolor (e.g.,
24-bit) color space even if the original data and/or the target
device is indexed color.</p>
</div>

<h3 id="BufferedRendering">The <span class="property">'buffered-rendering'</span>
property</h3>

<div class="annotation">
 <p>SVG2 Requirement: Add buffered-rendering</p>
 <p>Resolution: SVG 2 will add buffered-rendering (implementor feedback indicates that it is needed).</p>
 <p><a href="http://www.w3.org/2012/01/26-svg-irc#T21-28-56">SVG telcon 2012-01-26</a>.</p>
 <p>Purpose: For caching rendered results for faster display.</p>
 <p>Owner: Erik</p>
</div>

<div class="ready-for-wg-review">
<h2 id="InheritanceOfPaintingProperties">Inheritance of painting properties</h2>

<p>The values of any of the painting properties defined in this chapter can
be inherited from a given object's parent.  Painting, however, is always done
on each <a>graphics element</a>
individually, never at the <a>container element</a>
(e.g., a <a>'g'</a>) level. Thus, for the following SVG, even though the
gradient fill is specified on the <a>'g'</a>, the gradient is simply inherited
through the <a>'g'</a> element down into each rectangle, each of which is
rendered such that its interior is painted with the gradient.</p>

<p>Any painting properties defined in terms of the
<a href="coords.html#ObjectBoundingBoxUnits">object's bounding box</a> use the
bounding box of the <a>graphics element</a>
to which the operation applies. Note that <a href="text.html">text elements</a>
are defined such that any painting operations defined in terms of the
<a href="coords.html#ObjectBoundingBoxUnits">object's bounding box</a> use the
bounding box of the entire <a>'text'</a> element. (See the discussion of
<a href="text.html#ObjectBoundingBoxUnitsTextObjects">object bounding box units and text elements</a>.)</p>

<div class="example">
  <p>The following example shows how painting properties are inherited
  from a <a>'g'</a> element to its child <a>'rect'</a> elements.</p>

  <edit:includefile href="images/painting/inheritance.svg"/>

  <div class="figure">
    <img class="bordered" src="images/painting/inheritance.svg"/>
    <p class="caption">Both rectangles are filled with the same orange-to-yellow
    gradient.</p>
  </div>
</div>
</div>

<h2 id="DOMInterfaces">DOM interfaces</h2>

<h3 id="InterfaceSVGPaint">Interface SVGPaint</h3>

<edit:interface name='::svg::SVGPaint'/>

<h3 id="InterfaceSVGMarkerElement">Interface SVGMarkerElement</h3>

<edit:with element='marker'>
<edit:interface name='::svg::SVGMarkerElement'/>
</edit:with>

</body>
</html>
