<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional+edit//EN" "xhtml1-transitional+edit.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:edit="http://xmlns.grorg.org/SVGT12NG/">
<head>
  <title>Painting: Filling, Stroking and Marker Symbols</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <link rel="stylesheet"           title="Default"               type="text/css" media="screen" href="style/default_no_maturity.css"/>
  <link rel="alternate stylesheet" title="All annotations"       type="text/css" media="screen" href="style/default_svg.css"/>
  <link rel="alternate stylesheet" title="No issues/annotations" type="text/css" media="screen" href="style/default_no_issues.css"/>
  <!--
  <link rel="alternate stylesheet" title="CSS3 Unmodified"       type="text/css" media="screen" href="style/default.css"/>
  <link rel="alternate stylesheet" title="SVG 1.1"               type="text/css" media="screen" href="style/svg-style.css"/>
  -->
  <!-- W3C style sheet will be added here during processing. -->
</head>
<body>

<h1>Painting: Filling, Stroking and Marker Symbols</h1>

<div class="ready-for-wider-review">
<h2 id="Introduction">Introduction</h2>

<h3 id="Definitions">Definitions</h3>
<dl class='definitions'  data-dfn-type="dfn" data-export="">

  <dt id="TermFill">fill</dt>
  <dd>The operation of <a>painting</a> the interior of a
  <a>shape</a> or the interior of the
  character glyphs in a text string.</dd>

  <dt id="TermPaint">paint</dt>
  <dd>A paint represents a way of putting color values onto the
  canvas. A paint might consist of both color values and
  associated alpha values which control the blending of colors
  against already existing color values on the canvas. SVG
  supports three types of built-in paint:
  <a href="http://www.w3.org/TR/css3-values/#colors">color</a>,
  <a href="pservers.html#Gradients">gradients</a> and
  <a href="pservers.html#Patterns">patterns</a>.</dd>

  <dt id="TermPaintServerElement"><dfn>paint server element</dfn></dt>
  <dd>An element that defines a <a href="pservers.html">paint server</a>.
  Specifically: <edit:elementcategory name='paint server'/>.</dd>

  <dt id="TermStroke">stroke</dt>
  <dd>The operation of <a>painting</a> the outline
  of a <a>shape</a> or the outline of
  character glyphs in a text string.</dd>

</dl>

<p>Graphical elements that define a shape – <a>'path'</a> elements, <a>basic shapes</a>,
and <a>text content elements</a> – are rendered by being <strong>filled</strong>,
which is painting the interior of the object, and <strong>stroked</strong>, which is
painting along the outline of the object.  Filling and stroking are both
<strong>painting</strong> operations.  SVG 2 supports a number of
different paints that the fill and stroke of a graphical element can be painted with:</p>

<ul>
  <li>a single color,</li>
  <li>a gradient (linear, radial, or mesh),</li>
  <li>a pattern (vector or raster, possibly tiled),</li>
  <li>a hatch,</li>
  <li>other images as specified using CSS Image Value syntax [<a href="refs.html#ref-CSS3IMAGES">CSS3IMAGES</a>].</li>
</ul>

<p>The paint to use for filling and stroking an element is specified using the
<a>'fill'</a> and <a>'stroke'</a> properties.  The following section describes
the different values that can be used for these properties.</p>

<p>Other properties, such as <a>'fill-opacity'</a> and <a>'stroke-width'</a>,
also have an effect on the way fill and stroke paint is applied to the
canvas.  The <a href='#FillProperties'>Fill properties</a> and <a href='#StrokeProperties'>Stroke properties</a>
sections below describe these properties.</p>

<p>Some graphics elements – <a>'path'</a> elements and <a>basic
shapes</a> – can also have <strong>marker symbols</strong>
drawn at their vertices or at other positions along the path that
they describe.  The <a href='#Markers'>Markers</a> section below describes
how markers can be defined and used.</p>

<p class="annotation">SVG 2 adds markers on shapes. Resolved at
<a href="http://www.w3.org/2013/06/03-svg-minutes.html#item03">Tokyo F2F</a>.</p>

<!--
<p>SVG uses the general notion of a <strong>paint server</strong>. Paint
servers are specified using a <a href="linking.html#URLReference">URL reference</a>
on a <a>'fill'</a> or <a>'stroke'</a> property.
<a href="pservers.html">Gradients and patterns</a> are just specific types of
paint servers.</p>
-->

<h2 id="SpecifyingPaint">Specifying paint</h2>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Add new paint values for referencing current fill paint, stroke paint, etc.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2011/07/29-svg-minutes.html#item02">We will add new paint values currentFillPaint, currentStrokePaint etc. to SVG 2</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>Among other things, to provide an easy way to match marker color to stroke color.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Chris (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3094">ACTION-3094</a>)</td>
    </tr>
  </table>
</div>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Addition:</th>
      <td>Allow multiple paints in fill and stroke.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2013/06/03-svg-minutes.html#item10">We will allow multiple paints in the fill and stroke properties in SVG 2.</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>Useful for creating cross hatchings, putting a partially transparent pattern on top of a solid fill, etc.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Tav (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3500">ACTION-3500</a>)</td>
    </tr>
  </table>
</div>

<p>Properties <a>'fill'</a> and <a>'stroke'</a> take on a comma separated list of values of type <a>&lt;paint&gt;</a>. Each paint is applied to an element in reverse order. Note, only a <a href="pservers.html">paint server</a> in the last position may take an optional fallback color.</p>

<p class="note">The ability to apply more than one paint to an element is new in SVG 2.</p>
<p class="annotation">The paint order follows that of CSS backgrounds.</p>

<div class="example">
  <pre><![CDATA[
<rect width="100" height="100" fill="url(#MyHatch1), url(#MyHatch2), powderblue">
  ]]></pre>
  <div class="figure">
    <img
       alt="An example of applying three paints to a rectangle."
       src="images/painting/multiple_paints.svg"/>
    <p class="caption">The rightmost rectangle is filled by stacking the paints shown in the other rectangles.</p>
  </div>
</div>


<p>The type <a>&lt;paint&gt;</a> is defined as:</p>

<div class="definition">
<pre class="prod"><dfn class="css-code" data-dfn-type="type" data-export="" id="typedef-paint">&lt;paint&gt;</dfn> = [ <a>&lt;paint-layer&gt;</a> , ]* <a>&lt;final-paint-layer&gt;</a></pre>

<pre class="prod"><dfn class="css-code" data-dfn-type="type" data-export="" id="typedef-paint-layer">&lt;paint-layer&gt;</dfn> = <a>&lt;paint-source&gt;</a>|| <a>&lt;position&gt;</a> [ / <a>&lt;paint-size&gt;</a> ]? || <a>&lt;repeat-style&gt;</a> ||
[ <a>&lt;shape-box&gt;</a> | fill | stroke | view-box ] || [ <a>&lt;shape-box&gt;</a> | fill | stroke | view-box ]</pre>

<pre class="prod"><dfn class="css-code" data-dfn-type="type" data-export="" id="typedef-final-paint-layer">&lt;final-paint-layer&gt;</dfn> = <a>&lt;paint-source&gt;</a> || <a>&lt;position&gt;</a> [ / <a>&lt;paint-size&gt;</a> ]? || <a>&lt;repeat-style&gt;</a> ||
[ <a>&lt;shape-box&gt;</a> | fill | stroke | view-box ] || <a>&lt;color&gt;</a></pre>

<pre class="prod"><dfn class="css-code" data-dfn-type="type" data-export="" id="typedef-paint-source">&lt;paint-source&gt;</dfn> = none | <a>&lt;image&gt;</a> | <a>&lt;url&gt;</a> | context-fill | context-stroke</pre>
</div>

<p>Values have the following meaning:</p>

<dl>
  <dt>none</dt>
  <dd>Indicates that no paint is applied.</dd>

  <dt>&lt;color&gt;</dt>
  <dd>A solid color as <a href="http://www.w3.org/TR/css3-color/#colorunits">defined in <cite>CSS Color Module Level 3</cite></a>.
  [<a href="refs.html#ref-CSS3COLOR">CSS3COLOR</a>]  All forms of &lt;color&gt;
  defined by that specification are valid for use as a <a>&lt;paint&gt;</a>
  value.  This includes the basic color keywords,
  RGB &amp; RGBA color values, the <span class="prop-value">transparent</span>
  value, HSL &amp; HSLA color values, the extended color keywords,
  the <span class="prop-value">currentColor</span> value,
  and the CSS2 UI colors.  Note that when <span class='prop-value'>currentColor</span>
  is used, it refers to the current animated value of the <a>'color'</a> property.</dd>

  <dt><a>&lt;url&gt;</a> <!--| child</a>--></dt>
  <dd>A reference to a <a href="pservers.html">paint server</a> element with, if
  the paint server is the last paint specified, an
  optional fallback color or <span class="prop-value">none</span>.
  The <a>&lt;url&gt;</a> or <span class="prop-value">child</span> keyword
  is used to identify a <a>'solidcolor'</a>
  element, <a>gradient element</a>, <a>'pattern'</a> element, or <a>'hatch'</a> element,
  which defines the paint to use.
  The <span class="prop-value">child</span> keyword in this instance matches the
  last child <a>paint server element</a> of the element where the paint value
  is specified.
  If the reference is not valid (e.g., it points to an element that
  does not exist, no element was matched, or the element is not a valid paint
  server), then the fallback value is used (if the paint server reference is the last
  paint specified and if the fallback color is provided); otherwise,
  it must be treated as if <span class='prop-value'>none</span> was specified.
  <p class="annotation">Changed from SVG 1.1 behavior where document is in error
    if paint server missing or invalid.</p>

  <div class="example">
    <pre><![CDATA[
<rect width="100" height="100" fill="url(#MyHatch1), url(#MyHatch2) powderblue">
    ]]></pre>
    <div class="figure">
      <img
         alt="An example with a fallback solid paint fill."
         src="images/painting/multiple_paints2.svg"/>
      <p class="caption">The left rectangle shows the expected fill if both MyHatch1  and MyHatch2 are defined. The right rectangle shows the expected fill if MyHatch1 is defined but MyHatch2 is missing.</p>
    </div>
  </div>

  <p class="issue" data-issue="1">
    How should 'child' behave with allowing multiple paints?
    Include an example.
  </p>
    <div class="example">
      <edit:includefile href="images/painting/child-paint.svg2.svg"/>
      <div class="figure">
        <img
           alt="An example of the child keyword for paint"
           src="images/painting/child-paint.svg11.svg" height="200"/>
        <p class="caption">The paint server used to fill the <a>'rect'</a>
        element is a child element of the shape being filled.
        Note that there are two child paint servers and the last paint server
        is the one matched to the child keyword.
       </p>
      </div>
    </div>
  </dd>

  <dt>context-fill</dt>
  <dt>context-stroke</dt>
  <dd>The same paint as the computed value of the <a>'fill'</a> or <a>'stroke'</a>
  property, respectively, of the <a>context element</a>.  If there
  is no context element, then no paint is applied.  If the referenced paint
  is a gradient or a pattern, then the coordinate space to use and the
  object used for any <span class='attr-value'>'objectBoundingBox'</span>-relative
  values are the same as those of the <a>context element</a>.</dd>
</dl>
</div>

<dl class="definitions">
  <dt id="TermContextElement"><dfn id="context-element">context element</dfn></dt>
  <dd>The context element of an element is defined as follows:
  <ul>
    <li>If the element is within a <a>'marker element'</a>, and
    is being rendered as part of that marker due to being referenced
    via a <a>marker property</a>, then the context element
    is the element referencing that <a>'marker element'</a>.</li>
    <li>If the element is within a sub-tree that is instantiated
    with a <a>'use'</a> element, then the context element is
    that <a>'use'</a> element.</li>
    <li>Otherwise, there is no context element.</li>
  </ul>
  </dd>
</dl>

<div class="ready-for-wider-review">

<h2 id="ColorProperty">The effect of the <span class="property">'color'</span> property</h2>

<p class="note">See the CSS Color Module Level 3 specification for the
definition of <a>'color'</a>.
[<a href="refs.html#ref-CSS3COLOR">CSS3COLOR</a>]</p>

<p>The <a>'color'</a> property is used to provide a potential indirect value,
<span class="prop-value">currentColor</span>, for the <a>'fill'</a>,
<a>'stroke'</a>, <a>'solid-color'</a>, <a>'stop-color'</a>, <a>'flood-color'</a> and
<a>'lighting-color'</a> properties.  The property has no other effect
on SVG elements.</p>

<div class="example">
  <p>The following example shows how the inherited value of the
  <a>'color'</a> property from an HTML document can be used to
  set the color of SVG text in an inline SVG fragment.</p>

  <pre><![CDATA[
<!DOCTYPE html>
<style>
body { color: #468; font: 16px sans-serif }
svg { border: 1px solid #888; background-color: #eee }
</style>
<p>Please see the diagram below:</p>
<svg width="200" height="100">
  <g fill="currentColor">
    <text x="70" y="55" text-anchor="end">START</text>
    <text x="130" y="55">STOP</text>
    <path d="M 85,45 h 25 v -5 l 10,10 -10,10 v -5 h -25 z"/>
  </g>
</svg>
]]></pre>

  <div class="figure">
    <div class="bordered" style="color: #468; font: 16px sans-serif; display: inline-block; text-align: left; padding: 32px 128px 32px 32px">
      <p style="margin-top: 0; margin-bottom: 1em">Please see the diagram below:</p>
      <svg xmlns="http://www.w3.org/2000/svg" width="200" height="100" style="border: 1px solid #888; background-color: #eee">
        <g fill="currentColor">
          <text x="70" y="55" text-anchor="end">START</text>
          <text x="130" y="55">STOP</text>
          <path d="M 85,45 h 25 v -5 l 10,10 -10,10 v -5 h -25 z"/>
        </g>
      </svg>
    </div>
    <p class="caption">The text and arrow in the SVG fragment are filled
    with the same color as the inherited <a>'color'</a> property.</p>
  </div>
</div>

<h2 id="FillProperties">Fill properties</h2>

<h3 id="SpecifyingFillPaint">Specifying fill paint: the <span class="property">'fill'</span> property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="FillProperty">fill</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;paint&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>black</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified, but with <a>&lt;color&gt;</a> values computed and
    <a>&lt;url&gt;</a> values made absolute</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'fill'</a> property paints the interior of the given graphical
element. The area to be painted consists of any areas inside the outline
of the shape. To determine the inside of the shape, all subpaths are
considered, and the interior is determined according to the rules
associated with the current value of the <a>'fill-rule'</a> property.
The zero-width geometric outline of a shape is included in the area to
be painted.</p>

<p>The fill operation fills open subpaths by performing the fill
operation as if an additional "closepath" command were added to the
path to connect the last point of the subpath with the first point of
the subpath. Thus, fill operations apply to both open subpaths within
<a>'path'</a> elements (i.e., subpaths without a closepath command) and
<a>'polyline'</a> elements.</p>

<h3 id="WindingRule">Winding rule: the <span class="property">'fill-rule'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="FillRuleProperty">fill-rule</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>nonzero | evenodd</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>nonzero</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'fill-rule'</a> property indicates the algorithm (or
<em>winding rule</em>) which is to
be used to determine what parts of the canvas are included inside the
shape. For a simple, non-intersecting path, it is intuitively clear
what region lies "inside"; however, for a more complex path, such as a
path that intersects itself or where one subpath encloses another, the
interpretation of "inside" is not so obvious.</p>

<p>The <a>'fill-rule'</a> property provides two options for how the
inside of a shape is determined:</p>

<dl>
  <dt><span class='prop-value'>nonzero</span></dt>
  <dd>
    <p>This rule determines the "insideness" of a point on the
    canvas by drawing a ray from that point to infinity in any
    direction and then examining the places where a segment of
    the shape crosses the ray. Starting with a count of zero,
    add one each time a path segment crosses the ray from left
    to right and subtract one each time a path segment crosses
    the ray from right to left. After counting the crossings,
    if the result is zero then the point is <em>outside</em>
    the path. Otherwise, it is <em>inside</em>. The following
    drawing illustrates the <span class='prop-value'>nonzero</span>
    rule:</p>

    <div class="figure">
      <img class="bordered" src="images/painting/fillrule-nonzero.svg" alt="Image showing nonzero fill rule"/>
      <p class="caption">The effect of a nonzero fill rule on paths with self-intersections
      and enclosed subpaths.</p>
    </div>
  </dd>

  <dt><span class='prop-value'>evenodd</span></dt>
  <dd>
    <p>This rule determines the "insideness" of a point on the
    canvas by drawing a ray from that point to infinity in any
    direction and counting the number of path segments from the
    given shape that the ray crosses. If this number is odd,
    the point is inside; if even, the point is outside. The
    following drawing illustrates the <span class='prop-value'>evenodd</span>
    rule:</p>

    <div class="figure">
      <img class="bordered" src="images/painting/fillrule-evenodd.svg" alt="Image showing evenodd fill rule"/>
      <p class="caption">The effect of an evenodd fill rule on paths with self-intersections
      and enclosed subpaths.</p>
    </div>
  </dd>
</dl>

<p class="note">The above descriptions do not specify what to do if a path
segment coincides with or is tangent to the ray. Since any ray will do,
one may simply choose a different ray that does not have such problem
intersections.</p>

<h3 id="FillOpacity">Fill paint opacity: the <span class="property">'fill-opacity'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="FillOpacityProperty">fill-opacity</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;number&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>1</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified, but clamped to the range [0, 1]</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p><a>'fill-opacity'</a> specifies the
opacity of the painting operation used to paint the interior
the current object. (See <a
href="render.html#PaintingShapesAndText">Painting shapes and
text</a>.)  A value of 0 means fully transparent, and a
value of 1 means fully opaque.</p>

<p class="note">See also the <a>'opacity'</a> property, which
specifies group opacity.</p>

<h2 id="StrokeProperties">Stroke properties</h2>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Support non-scaling stroke.</td>
    </tr>
    <tr>
      <th>Resolutions:</th>
      <td><a href="http://www.w3.org/2011/10/28-svg-irc#T17-46-34">SVG 2 will include non-scaling stroke.</a><br/>
          <a href="http://www.w3.org/2012/02/02-svg-minutes.html#item05">SVG 2 will have the <span class="property">'vector-effect'</span> property.</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>To support strokes whose width does not change when zooming a page, as common for example in maps.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Chris or Erik (no action)</td>
    </tr>
    <tr>
      <th>Note:</th>
      <td>Note that this could be part of more generic non-scaling features.</td>
    </tr>
  </table>
</div>

<p>In this section, we define a number of properties that allow the
author to control different aspects of a stroke, including its paint,
thickness, use of dashing, and joining and capping of
path segments.</p>

<p>In all cases, all stroking properties which are affected by
directionality, such as those having to do with dash patterns, must be
rendered such that the stroke operation starts at the same point at
which the graphics element starts. In particular, for <a>'path'</a>
elements, the start of the path is the first point of the initial
"moveto" command.</p>

<p>For stroking properties such as dash patterns whose computations
are dependent on progress along the outline of the graphics element,
distance calculations are required to utilize the SVG user agent's
standard <a href="paths.html#DistanceAlongAPath">Distance along a path</a>
algorithms.</p>

<p>When stroking is performed using a complex paint server, such as a
gradient or a pattern, the stroke operation must be identical to the
result that would have occurred if the geometric shape defined by the
geometry of the current graphics element and its associated stroking
properties were converted to an equivalent <a>'path'</a> element and
then filled using the given paint server.</p>

<h3 id="SpecifyingStrokePaint">Specifying stroke paint: the <span class="property">'stroke'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeProperty">stroke</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;paint&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>none</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified, but with <a>&lt;color&gt;</a> values computed and
    <a>&lt;url&gt;</a> values made absolute</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'stroke'</a> property paints along the outline of the given
graphical element.</p>

<p class="note">Note that when stroking a <a>'path'</a> element,
any subpath consisting of a <a href="paths.html#PathDataMovetoCommands">moveto</a>
but no following line drawing command will not be stroked.
Any other type of zero-length subpath, such as 
<span class="attr-value">'M 10,10 L 10,10'</span>
or <span class="attr-value">'M 30,30 Z'</span>
will also not be stroked if the <a>'stroke-linecap'</a> property has a value of
<span class="prop-value">butt</span>.  See the definition of
the <a>stroke shape</a> below for the details of computing
the stroke of a path.</p>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Include a way to specify stroke position.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2011/10/28-svg-irc#T18-09-48">SVG 2 shall include a way to specify stroke position.</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>To allow a stroke to be inside or outside the path.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Cameron (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3162">ACTION-3162</a>)</td>
    </tr>
    <tr>
      <th>Note:</th>
      <td>See <a href="http://www.w3.org/Graphics/SVG/WG/wiki/Proposals/Stroke_position">proposal page</a>.</td>
    </tr>
  </table>
</div>

<h3 id="StrokeOpacity">Stroke paint opacity: the <span class="property">'stroke-opacity'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeOpacityProperty">stroke-opacity</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;number&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>1</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified, but clamped to the range [0, 1]</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'stroke-opacity'</a> property specifies the opacity of the
painting operation used to stroke the current object.  (See
<a href="render.html#PaintingShapesAndText">Painting shapes and text</a>.)
As with <a>'fill-opacity'</a>, a value of 0 means fully transparent, and a value of 1
means fully opaque.</p>

<p class="note">See also the <a>'opacity'</a> property, which specifies
group opacity.</p>

<h3 id="StrokeWidth">Stroke width: the <span class="property">'stroke-width'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeWidthProperty">stroke-width</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;percentage&gt;</a> | <a>&lt;length&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>1</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>refer to the size of the current viewport (see <a href="coords.html#Units">Units</a>)</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>absolute length or percentage</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>This property specifies the width of the stroke on the current object.
A zero value causes no stroke to be painted. A negative value
is <a>invalid</a>.</p>

<h3 id="LineCaps">Drawing caps at the ends of strokes: the <span class="property">'stroke-linecap'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeLinecapProperty">stroke-linecap</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>butt | round | square</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>butt</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p><a>'stroke-linecap'</a> specifies the shape to be used at the end of
open subpaths when they are stroked.  The possible values are:</p>

<dl>
  <dt><span class='prop-value'>butt</span></dt>
  <dd>This value indicates that the stroke for each subpath does not
  extend beyond its two endpoints.  A zero length subpath will therefore
  not have any stroke.</dd>

  <dt><span class='prop-value'>round</span></dt>
  <dd>
    <p>This value indicates that at each end of each subpath, the shape
    representing the stroke will be extended by a half circle with a radius equal
    to the stroke width.  If a subpath has zero length, then the resulting
    effect is that the stroke for that subpath consists solely of a full circle
    centered at the subpath's point.</p>
  </dd>

  <dt><span class='prop-value'>square</span></dt>
  <dd>
    <p>This value indicates that at the end of each subpath, the shape
    representing the stroke will be extended by a rectangle with the
    same width as the stroke width and whose length is half of the stroke width.
    If a subpath has zero length, then the resulting effect is that the
    stroke for that subpath consists solely of a square with side length
    equal to the stroke width, centered at the subpath's point, and oriented
    such that two of its sides are parallel to the effective tangent
    at that subpath's point.  See
    <a href="paths.html#PathElementImplementationNotes"><span class='element-name'>'path'</span>
    element implementation notes</a> for details on how to determine the tangent
    at a zero-length subpath.</p>
  </dd>
</dl>

<div class="figure">
  <img class="bordered" src="images/painting/linecap.svg"
       alt="Image showing three paths, each with a different line cap."/>
  <p class="caption">The three types of line caps.</p>
</div>

<p>See the definition of the <a>cap shape</a> below for a more precise
description of the shape a line cap will have.</p>

<h3 id="LineJoin">Controlling line joins: the <span class="property">'stroke-linejoin'</span>
and <span class="property">'stroke-miterlimit'</span> properties</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeLinejoinProperty">stroke-linejoin</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>miter | miter-clip | round | bevel | arcs </td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>miter</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p><a>'stroke-linejoin'</a> specifies the shape to be used at the
corners of paths or basic shapes when they are stroked. For further details see
the <a href="paths.html#PathElementImplementationNotes">path implementation notes</a>.</p>

<dl>
  <dt><span class='prop-value'>miter</span></dt>
  <dd>This value indicates that a sharp corner is to be used to join path segments.
  The corner is formed by extending the outer edges of the stroke at the tangents
  of the path segments until they intersect. If the <a>'stroke-miterlimit'</a>
  is exceeded, the line join falls back to <span class='prop-value'>bevel</span>
  (see below).</dd>

  <dt><span class='prop-value'>miter-clip</span></dt>
  <dd>This value is the same as <span class='prop-value'>miter</span> but if
    the <a>'stroke-miterlimit'</a> is exceeded, the miter is clipped at a
    miter length equal to the <a>'stroke-miterlimit'</a> value multiplied
    by the stroke width (see below).</dd>

  <dt><span class='prop-value'>round</span></dt>
  <dd>This value indicates that a round corner is to be used to join path segments.
  The corner is a circular sector centered on the join point.</dd>

  <dt><span class='prop-value'>bevel</span></dt>
  <dd>This value indicates that a bevelled corner is to be used to join path segments.
  The bevel shape is a triangle that fills the area between the two stroked segments.</dd>

  <dt><span class='prop-value'>arcs</span></dt>
  <dd>This value indicates that an arcs corner is to be used to join
    path segments. The arcs shape is formed by extending the outer
    edges of the stroke at the join point with arcs that have the same
    curvature as the outer edges at the join point.</dd>
</dl>

<p class="note">
  The <span class='prop-value'>miter-clip</span> and
  <span class='prop-value'>arcs</span> values are new in SVG 2.
  The <span class='prop-value'>miter-clip</span> value offers a more
  consistent presentation for a path with multiple joins as well as
  better behavior when a path is animated.
  The <span class='prop-value'>arcs</span> value provides a better
  looking join when the path segments at the join are curved.
</p>

<p class="annotation">
  Adding 'arcs' line join was resolved at the
  <a href="http://www.w3.org/2012/09/19-svg-minutes.html#item08">Rigi
  Kaltbad group meeting</a>.
</p>

<p class="annotation">
  Adding 'miter-clip' line join was resolved at the
  <a href="http://www.w3.org/2015/02/12-svg-minutes.html#item03">Sydney
  (2015) group meeting</a>.
</p>

<div class="figure">
  <img class="bordered" src="images/painting/linejoin-four.svg"
       alt="Image showing four paths, each with a different line join."/>
  <p class="caption">Four types of line joins.</p>
</div>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeMiterlimitProperty">stroke-miterlimit</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;number&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>4</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>
  When two line segments meet at a sharp angle and a value of
  <span class='prop-value'>miter</span>,
  <span class='prop-value'>miter-clip</span>, or
  <span class='prop-value'>arcs</span> has been specified for
  <a>'stroke-linejoin'</a>, it is possible for the join to extend
  far beyond the thickness of the line stroking the path. The
  <a>'stroke-miterlimit'</a> imposes a limit on the extent of the
  line join.
</p>

<dl>
  <dt><span class='prop-value'>&lt;number&gt;</span></dt>
  <dd>
    The limit on the extent of a
    <span class='prop-value'>miter</span>,
    <span class='prop-value'>miter-clip</span>, or
    <span class='prop-value'>arcs</span> line join as a multiple of
    the <a>'stroke-width'</a> value. The value of
    <a>'stroke-miterlimit'</a> must be a <a>&lt;number&gt;</a> greater
    than or equal to 1. Any other value is an error (see
    <a href="implnote.html#ErrorProcessing">Error processing</a>).
  </dd>
</dl>

<p>
  For the <span class='prop-value'>miter</span> or the
  <span class='prop-value'>miter-clip</span> values, given
  the angle <var>θ</var> between the segments in local coordinate system,
  the miter length is calculated by:
</p>

<div role="math" aria-describedby="math-miter-length">
  <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
    <mrow>
      <mi>miter length</mi>
      <mo>=</mo>
      <mfrac>
        <mi style="font-family: sans-serif">‘stroke-width’</mi>
        <mrow>
          <mi>sin</mi>
          <mo>&#x2061;</mo>
          <mfrac>
            <mi>θ</mi>
            <mn>2</mn>
          </mfrac>
        </mrow>
      </mfrac>
    </mrow>
  </math>
  <pre id="math-miter-length">miter length = stroke-width / sin(theta / 2)</pre>
</div>

<p>
  If the miter length divided by the stroke width exceeds the
  <a>'stroke-miterlimit'</a> then for the value:
</p>
<dl>
  <dt><span class='prop-value'>miter</span></dt>
  <dd>
    the join is converted to a bevel;
  </dd>
  <dt><span class='prop-value'>miter-clip</span></dt>
  <dd>
    the miter is clipped by a line perpendicular to the line bisecting
    the angle between the two path segments at a distance of the value
    of miter length from the intersection of the two path segments.
  </dd>
</dl>

<div class="figure">
  <img class="bordered" src="images/painting/miter-limit.svg"
       alt="Image showing resulting stroke when stroke miter limit is exceeded."/>
  <p class="caption">
    Effect on line join when <a>'stroke-miterlimit'</a> is
    exceeded. The olive-green dashed lines shows the position of the
    miter limit when the <a>'stroke-miterlimit'</a> value is 1.5. The
    gray regions shows what the joins would look like without a miter
    limit.
  </p>
</div>

<p>
  For the <span class='prop-value'>arcs</span> value, the
  <em>miter length</em> is calculated along a circular arc that is
  tangent to the line bisecting the angle between the two segments at
  the point the two segments intersect and passes through the end
  point of the join. The line join is clipped, if necessary, by a line
  perpendicular to this arc at a <em>miter length</em> equal to the
  value of the <a>'stroke-miterlimit'</a> value multiplied by the
  stroke width.
</p>

<p class="annotation">
  The effect of 'stroke-miterlimit' on an 'arcs' line join was resolved
  at <a href="http://www.w3.org/2015/02/12-svg-minutes.html#item12">Sydney
  (2015) group meeting</a>.
</p>

<p>
  See the definition of the <a>line join shape</a> below for a more
  precise description of the shape a line join will have.
</p>

<h3 id="StrokeDashing">Dashing strokes: the <span class="property">'stroke-dasharray'</span> and
<span class="property">'stroke-dashoffset'</span> properties</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeDasharrayProperty">stroke-dasharray</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>none | <a>&lt;dasharray&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>none</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>refer to the size of the current viewport (see <a href="coords.html#Units">Units</a>)</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>absolute lengths or percentages for &lt;dasharray&gt;, or keyword specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes (<a href="https://svgwg.org/specs/animations/#AdditionAttributes">non-additive</a>)</td>
  </tr>
</table>

<p>where:</p>

<p class="definition"><dfn id="DataTypeDasharray">&lt;dasharray&gt;</dfn> =
[ <a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> | <a>&lt;number&gt;</a> ]#*</p>

<p>The <a>'stroke-dasharray'</a> property controls
the pattern of dashes and gaps used to form the shape of
a path's stroke.</p>

<dl>
  <dt><span class='prop-value'>none</span></dt>
  <dd>Indicates that no dashing is used.</dd>

  <dt><span class='prop-value'>&lt;dasharray&gt;</span></dt>
  <dd>
    <p>Specifies a dashing pattern to use.  A <a>&lt;dasharray&gt;</a> is
    a list of comma and/or white space separated lengths or percentages.
    Each value specifies a length along the path for which the stroke
    is to be painted (a <em>dash</em>) and not painted (a <em>gap</em>).
    The first value and every second value in the list after it specifies
    the length of a dash, and every other value specifies the length of a gap
    between the dashes.  If the list has an odd number of values, then it is
    repeated to yield an even number of values.  (Thus, the rendering behavior
    of <span class="prop-value">stroke-dasharray: 5,3,2</span>
    is equivalent to <span class="prop-value">stroke-dasharray: 5,3,2,5,3,2</span>.)</p>

    <p>The resulting even-length dashing pattern is repeated along each subpath.
    The dashing pattern is reset and begins again at the start of each subpath.</p>

    <p>If any value in the list is negative, the <a>&lt;dasharray&gt;</a> value is
    <a>invalid</a>.  If all of the values in the list are zero,
    then the stroke is rendered as a solid line without any dashing.</p>
  </dd>
</dl>

<div class="figure">
  <img class="bordered" src="images/painting/dashes.svg" alt="Image showing a thick, dashed stroke."/>
  <p class="caption">A dashed stroke.  The dashing pattern is <span class="prop-value">20,10</span>.
  The red line shows the actual path that is stroked.</p>
</div>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="StrokeDashoffsetProperty">stroke-dashoffset</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td><a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>0</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>refer to the size of the current viewport (see <a href="coords.html#Units">Units</a>)</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>absolute length or percentage</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'stroke-dashoffset'</a> property specifies the distance into the repeated
dash pattern to start the stroke dashing at the beginning of the path.  If the
value is negative, then the effect is the same as dash offset <var>d</var>:</p>

<div role="math" aria-describedby="math-dashoffset">
  <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
    <mrow>
      <mi>d</mi>
      <mo>=</mo>
      <mi>s</mi>
      <mo>-</mo>
      <mfenced open="|" close="|">
        <mi style="font-family: sans-serif">‘stroke-dashoffset’</mi>
      </mfenced>
      <mo>mod</mo>
      <mi>s</mi>
    </mrow>
  </math>
  <pre id="math-dashoffset">d = s - (abs(stroke-dashoffset) mod s)</pre>
</div>

<p>where <var>s</var> is the sum of the dash array values.</p>

<div class="figure">
  <img class="bordered" src="images/painting/dashoffset.svg"
       alt="Image showing a thick, dashed stroke with a non-zero dash offset."/>
  <p class="caption">A dashed stroke with a non-zero dash offset.  The dashing
  pattern is <span class="prop-value">20,10</span> and the dash offset is
  <span class="prop-value">15</span>.  The red line shows the actual path that
  is stroked.</p>
</div>

<p>See the definition of <a>dash positions</a> below for a more precise
description of positions along a path that dashes will be placed.</p>
</div>

<div class="ready-for-wider-review">
<h3 id="StrokeShape">Computing the shape of the stroke</h3>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Specify stroke dashing more precisely.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2011/10/28-svg-irc#T18-14-14">SVG 2 shall specify stroke dashing more precisely.</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>To define dash starting point on basic shapes and path segments.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Cameron (no action)</td>
    </tr>
  </table>
</div>

<p class="issue" data-issue="16">Something in this section needs to reference
<a>'path/pathLength'</a> so that dash lengths are in the author's
path length space.</p>

<p>The <dfn id="TermStrokeShape">stroke shape</dfn> of an element is the
shape that is filled by the <a>'stroke'</a> property.  Since <a>'text'</a>
elements can be rendered in multiple chunks, each chunk has its own
<a>stroke shape</a>.  The following algorithm describes what the stroke shape
of a <a>'path'</a>, <a>basic shape</a> or individual <a>'text'</a> chunk is,
taking into account the stroking properties above:</p>

<ol class="algorithm">
  <li>Let <var>shape</var> be an empty shape.</li>
  <li>Let <var>path</var> be the <a>equivalent path</a> of the element (or the individual
  chunk of a <a>'text'</a> element).</li>
  <li>For each subpath of <var>path</var>:
    <ol>
      <li>Let <var>positions</var> be the <a>dash positions</a> for the subpath.</li>
      <li>For each pair &lt;<var>start</var>, <var>end</var>&gt; in <var>positions</var>:
        <ol>
          <li>Let <var>dash</var> be the shape that includes, for all distances
          between <var>start</var> and <var>end</var> along the subpath, all
          points that lie on the line perpendicular to the subpath at that
          distance and which are within distance <a>'stroke-width'</a> of
          the point on the subpath at that position.</li>

          <li>Set <var>dash</var> to be the union of <var>dash</var> and the
          starting <a>cap shape</a> for the subpath at position <var>start</var>.</li>

          <li>Set <var>dash</var> to be the union of <var>dash</var> and the
          ending <a>cap shape</a> for the subpath at position <var>end</var>.</li>

          <li>
            Let <var>index</var> and <var>last</var> be the indexes of the
            path segments in the subpath at distance <var>start</var> and
            <var>end</var> along the subpath.

            <p class="note">It does not matter whether any zero length segments are
            included when choosing <var>index</var> and <var>last</var>.</p>
          </li>

          <li>While <var>index</var> &lt; <var>last</var>:
            <ol>
              <li>Set <var>dash</var> to be the union of <var>dash</var> and the
              <a>line join shape</a> for the subpath at segment index <var>index</var>.</li>

              <li>Set <var>index</var> to <var>index</var> + 1.</li>
            </ol>
          </li>

          <li>Set <var>shape</var> to be the union of <var>shape</var> and
          <var>stroke</var>.</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>Return <var>shape</var>.</li>
</ol>

<p>The <dfn id="TermDashPositions">dash positions</dfn> for a given subpath of
the <a>equivalent path</a> of a <a>'path'</a> or <a>basic shape</a> is a
sequence of pairs of values, which represent the starting and ending distance
along the subpath for each of the dashes that form the subpath's stroke.  It is
determined as follows:</p>

<ol class="algorithm">
  <li>Let <var>pathlength</var> be the length of the subpath.</li>

  <li>Let <var>dashes</var> be the list of values of <a>'stroke-dasharray'</a>
  on the element, converted to user units, repeated if necessary so that it has
  an even number of elements; if the property has the value
  <span class="prop-value">none</span>, then the list has a single value 0.</li>

  <li>Let <var>count</var> be the number of values in <var>dashes</var>.</li>
  <li>Let <var>sum</var> be the sum of the values in <var>dashes</var>.</li>

  <li>If <var>sum</var> = 0, then return a sequence with the single pair
  &lt;0, <var>pathlength</var>&gt;.</li>

  <li>Let <var>positions</var> be an empty sequence.</li>

  <li>Let <var>offset</var> be the value of the <a>'stroke-dashoffset'</a>
  property on the element.</li>

  <li>If <var>offset</var> is negative, then set <var>offset</var> to
  <var>sum</var> − abs(<var>offset</var>).</li>

  <li>Set <var>offset</var> to <var>offset</var> mod <var>sum</var>.</li>

  <li>Let <var>index</var> be the smallest integer such that
  sum(<var>dashes<sub>i</sub></var>, 0 ≤ <var>i</var> ≤ <var>index</var>) ≥ <var>offset</var>.</li>

  <li>Let <var>dashlength</var> be
  min(sum(<var>dashes<sub>i</sub></var>, 0 ≤ <var>i</var> ≤ <var>index</var>) − <var>offset</var>, <var>pathlength</var>).</li>

  <li>If <var>index</var> mod 2 = 0, then append to <var>positions</var> the
  pair &lt;0, <var>dashlength</var>&gt;.</li>

  <li>Let <var>position</var> be <var>dashlength</var>.</li>

  <li>While <var>position</var> &lt; <var>pathlength</var>:
    <ol>
      <li>Set <var>index</var> to (<var>index</var> + 1) mod <var>count</var>.</li>

      <li>Let <var>dashlength</var> be
      min(<var>dashes</var><sub><var>index</var></sub>, <var>pathlength</var> − <var>position</var>).</li>

      <li>If <var>index</var> mod 2 = 0, then append to <var>positions</var> the
      pair &lt;<var>position</var>, <var>position</var> + <var>dashlength</var>&gt;.</li>

      <li>Set <var>position</var> to <var>position</var> + <var>dashlength</var>.</li>
    </ol>
  </li>

  <li>Return <var>positions</var>.</li>
</ol>

<p>The starting and ending <dfn id="TermCapShape">cap shapes</dfn> at a given
<var>position</var> along a subpath are determined as follows:</p>

<ol class="algorithm">
  <li>If <a>'stroke-linecap'</a> is <span class="prop-value">butt</span>, then return an empty shape.</li>

  <li>Otherwise, if <a>'stroke-linecap'</a> is <span class="prop-value">round</span>, then:
    <ol>
      <li>If this is a starting cap, then return a semicircle of radius <a>'stroke-width'</a> positioned such that:
        <ul>
          <li>Its straight edge is parallel to the line perpendicular to the subpath at distance <var>position</var> along it.</li>
          <li>The midpoint of its straight edge is at the point that is along the subpath at distance <var>position</var>.</li>
          <li>The direction from the midpoint of its arc to the midpoint of its straight edge is the same as the direction of the subpath at distance <var>position</var> along it.</li>
        </ul>
      </li>
      <li>Otherwise, this is an ending cap.  Return a semicircle of radius <a>'stroke-width'</a> positioned such that:
        <ul>
          <li>Its straight edge is parallel to the line perpendicular to the subpath at distance <var>position</var> along it.</li>
          <li>The midpoint of its straight edge is at the point that is along the subpath at distance <var>position</var>.</li>
          <li>The direction from the midpoint of its straight edge to the midpoint of its arc is the same as the direction of the subpath at distance <var>position</var> along it.</li>
        </ul>
      </li>
    </ol>
  </li>

  <li>Otherwise, <a>'stroke-linecap'</a> is <span class="prop-value">square</span>:
    <ol>
      <li>If this is a starting cap, then return a rectangle with side lengths <a>'stroke-width'</a> and <a>'stroke-width'</a> / 2 positioned such that:
        <ul>
          <li>Its longer edges, <var>A</var> and <var>B</var>, are parallel to the line perpendicular to the subpath at distance <var>position</var> along it.</li>
          <li>The midpoint of <var>A</var> is at <var>start</var>.</li>
          <li>The direction from the midpoint of <var>B</var> to the midpoint of <var>A</var> is the same as the direction of the subpath at distance <var>position</var> along it.</li>
        </ul>
      </li>
      <li>Otherwise, this is an ending cap.  Return a rectangle with side lengths <a>'stroke-width'</a> and <a>'stroke-width'</a> / 2 positioned such that:
        <ul>
          <li>Its longer edges, <var>A</var> and <var>B</var>, are parallel to the line perpendicular to the subpath at distance <var>position</var> along it.</li>
          <li>The midpoint of <var>A</var> is at <var>end</var>.</li>
          <li>The direction from the midpoint of <var>A</var> to the midpoint of <var>B</var> is the same as the direction of the subpath at distance <var>position</var> along it.</li>
        </ul>
      </li>
    </ol>
  </li>
</ol>

<div class="figure">
  <img class="bordered" src="images/painting/linecap-construction.svg"
       alt="Image showing how to construct the three types of line caps"/>
  <p class="caption">The three different <a>'stroke-linecap'</a> values used on
  paths with a single, non-zero length subpath.  The white line is the path
  itself and the thick gray area is the stroke.  On the top row, the green lines
  indicate the perpendicular to the tangent at the path endpoints and the pink
  areas are the caps.  The bottom row shows the stroke without the perpendicular
  and cap highlighting.</p>
</div>

<p>The <dfn id="TermLineJoinShape">line join shape</dfn> for a given segment of
a subpath is determined as follows:</p>

<ol class="algorithm">
  <li>Let <var>P</var> be the point at the end of the segment.</li>
  <li>Let <var>A</var> be the line parallel to the tangent at the end of the segment.</li>
  <li>Let <var>B</var> be the line parallel to the tangent at the start of the following segment.</li>

  <li>If <var>A</var> and <var>B</var> are the same line, then return an empty shape.</li>

  <li>Let <var>A<sub>left</sub></var> and <var>A<sub>right</sub></var> be lines
  parallel to <var>A</var> at a distance of <a>'stroke-width'</a> / 2 to the
  left and to the right of <var>A</var> relative to the subpath direction, respectively.</li>

  <li>Let <var>B<sub>left</sub></var> and <var>B<sub>right</sub></var> be lines
  parallel to <var>B</var> at a distance of <a>'stroke-width'</a> / 2 to the
  left and to the right of <var>B</var>, relative to the subpath direction, respectively.</li>

  <li>
    Let <var>P</var><sub>1</sub>, <var>P</var><sub>2</sub> and
    <var>P</var><sub>3</sub> be points determined as follows:

    <ol>
      <li>If the smaller angle between <var>A</var> and <var>B</var> is on the
      right of these lines, considering the direction of the subpath, then
      <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub> are the points on
      <var>A<sub>left</sub></var> and <var>B<sub>left</sub></var> closest to
      <var>P</var>, and <var>P</var><sub>3</sub> is the intersection of
      <var>A<sub>left</sub></var> and <var>B<sub>left</sub></var>.</li>

      <li>Otherwise, <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub> are
      the points on <var>A<sub>right</sub></var> and <var>B<sub>right</sub></var>
      closest to <var>P</var>, and <var>P</var><sub>3</sub> is the intersection
      of <var>A<sub>right</sub></var> and <var>B<sub>right</sub></var>.</li>
    </ol>
  </li>

  <li>Let <var>bevel</var> be the triangle formed from the three points
  <var>P</var>, <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub>.</li>

  <li>If <a>'stroke-linejoin'</a> is <span class="prop-value">round</span>, then
  return the union of <var>bevel</var> and a circular sector of radius
  <a>'stroke-width'</a>, centered on <var>P</var>, and which has
  <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub> as the two endpoints of
  the arc.</li>

  <li>If <a>'stroke-linejoin'</a> is <span class="prop-value">arcs</span>,
    then find the circles that are tangent to the stroke edges at
    <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub> with the
    same curvature as the edges at those points (see below). If both
    curvatures are zero fall through to <span class="prop-value">miter-clip</span>.
    Extend the stroke edges using these circles (or a line, in the case
    of zero curvature). If the two circles (or circle and line) do not
    intersect, fall through to <span class="prop-value">miter-clip</span>.

    If the two circles (or circle and line) intersect, the line join
    region is defined by the lines that connect <var>P</var>
    with <var>P</var><sub>1</sub> and <var>P</var><sub>2</sub> and the
    arcs defined by the circles (or arc and line) between the closest
    intersection point to <var>P</var>, and <var>P</var><sub>1</sub>
    and <var>P</var><sub>2</sub>.

    Next calculate the <em>miter limit</em> as defined in
    the <a>'stroke-miterlimit'</a> section. Clip any part of the line
    join region that extends past the miter limit. Return the
    resulting region.

    Note that the curvatures are calculated in user-space before any
    transforms are applied.</li>

  <li>
    If <a>'stroke-linejoin'</a> is <span class="prop-value">miter</span> or
    <span class="prop-value">miter-clip</span> then the line join
    region is the union of <var>bevel</var> and the triangle formed
    from the three points <var>P</var><sub>1</sub>,
    <var>P</var><sub>2</sub> and <var>P</var><sub>3</sub>.
  </li>

  <li>
    Let <var>θ</var> be the angle between <var>A</var> and <var>B</var>.
    If 1 / sin(<var>θ</var> / 2) ≤ <a>'stroke-miterlimit'</a>, then return
    the line join region.
  </li>

  <li>
    If <a>'stroke-linejoin'</a> is <span class="prop-value">miter-clip</span>,
    then clip any part of the line join region that extends past the
    miter limit and return this region.
  </li>

  <li>Return <var>bevel</var>.</li>
</ol>

<div class="figure">
  <img class="bordered" src="images/painting/linejoin-construction.svg"
       alt="Image showing the lines and points computed to construct a round line join."/>
  <p class="caption">Construction of a round line join shape, shown in pink.
  The white line is the original path, which has two segments that come to a
  point, and the gray region is the stroke.</p>
</div>

<div class="figure">
  <img class="bordered" src="images/painting/linejoin-construction-arcs.svg"
       alt="Image showing the lines and points computed to construct an arcs line join."/>
  <p class="caption">Construction of an arcs line join shape, shown in
    pink. The white line is the original path, which has two segments
    that come to a point, and the gray region is the stroke. The
    dashed lines show circles that are tangent to and have the
    curvature of the segments at the join.  The olive-green circles
    (concentric with the dashed circles) define the join shape.</p>
</div>

<h3 id="CurvatureCalculation">Computing the circles for the <span class="prop-value">arcs</span>
'stroke-linejoin'</h3>

<p>The <span class="prop-value">arcs</span> <a>'stroke-linejoin'</a>
  requires finding circles that are both tangent to and have the same
  curvatures as the outer stroke edges at the ends of path
  segments. To find one of these circles, first calculate the
  curvature <var>&#x03BA;</var> of the path segment at its end (see
  below). Next, find the radius of a circle corresponding to this
  curvature: <var>r</var> = 1/<var>&#x03BA;</var>. Increase or
  decrease the radius by one half of the stroke width to account for
  the stroke: <var>r<sub>c</sub></var> = <var>r</var> &#x00b1; &#xbd;
  stroke-width. The center of the circle will be on a line normal to
  the path end a distance of <var>r<sub>c</sub></var> away from the
  outer stroke edge at the end.</p>

<p>For a line: the curvature is infinite. Extend the outer stroke edge by a line.</p>

<p>For an elliptical arc:</p>

  <div role="math" aria-describedby="math-curvature-of-ellipse">
    <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
      <mi>&#x03BA;<!-- κ --></mi>
      <mo stretchy="false">(</mo>
      <mi>t</mi>
      <mo stretchy="false">)</mo>
      <mo>=</mo>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <mrow class="MJX-TeXAtom-ORD">
            <msub>
              <mi>r</mi>
              <mi>x</mi>
            </msub>
            <msub>
              <mi>r</mi>
              <mi>y</mi>
            </msub>
	  </mrow>
	  <mrow class="MJX-TeXAtom-ORD">
            <mo stretchy="false">(</mo>
            <msubsup>
              <mi>r</mi>
              <mi>x</mi>
              <mn>2</mn>
            </msubsup>
            <msup>
              <mi>sin</mi>
              <mn>2</mn>
            </msup>
            <mo>&#x2061;<!-- ⁡ --></mo>
            <mi>t</mi>
            <mo>+</mo>
            <msubsup>
              <mi>r</mi>
              <mi>y</mi>
              <mn>2</mn>
            </msubsup>
            <msup>
              <mi>cos</mi>
              <mn>2</mn>
            </msup>
            <mo>&#x2061;<!-- ⁡ --></mo>
            <mi>t</mi>
            <msup>
              <mo stretchy="false">)</mo>
              <mrow class="MJX-TeXAtom-ORD">
		<mn>3</mn>
		<mrow class="MJX-TeXAtom-ORD">
		  <mo>/</mo>
		</mrow>
		<mn>2</mn>
              </mrow>
            </msup>
	  </mrow>
	</mfrac>
      </mrow>
    </math>
    <pre id="math-curvature-of-ellipse">$$\kappa(t) = {{r_x r_y}\over{(r_x^2 \sin^2 t + r_y^2 \cos^2 t)^{3/2}}}$$</pre>
  </div>

  <p>where:</p>

  <div role="math" aria-describedby="math-curvature-t">
    <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
      <mi>t</mi>
      <mo>=</mo>
      <mi>arctan</mi>
      <mo>&#x2061;<!-- ⁡ --></mo>
      <mo stretchy="false">(</mo>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <msub>
            <mi>r</mi>
            <mi>y</mi>
	  </msub>
	  <msub>
            <mi>r</mi>
            <mi>x</mi>
	  </msub>
	</mfrac>
      </mrow>
      <mi>tan</mi>
      <mo>&#x2061;<!-- ⁡ --></mo>
      <mi>&#x03B8;<!-- θ --></mi>
      <mo stretchy="false">)</mo>
    </math>
    <pre id="math-curvature-t">$$t = \arctan ( {r_y \over r_x} \tan \theta )$$</pre>
  </div>

  <p>The parameter <var>&#x03B8;</var> at the beginning or end of an
    arc segment can be found by using the formulas in
    the <a href="implnote.html#ArcImplementationNotes">Elliptical arc
    implementation notes</a>. (Note, some renderers convert elliptical
    arcs to cubic Béziers prior to rendering so the equations here may
    not be needed.)</p>

<p>For a quadratic Bézier:</p>

  <div role="math" aria-describedby="math-quadratic-start">
    <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
      <mi>&#x03BA;<!-- κ --></mi>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
      <mo>=</mo>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <mn>1</mn>
	  <mn>2</mn>
	</mfrac>
      </mrow>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <mrow>
            <mo stretchy="false">(</mo>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>0</mn>
            </msub>
            <mo stretchy="false">)</mo>
            <mo>&#x00D7;<!-- × --></mo>
            <mo stretchy="false">(</mo>
            <msub>
              <mi>P</mi>
              <mn>2</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <mo stretchy="false">)</mo>
	  </mrow>
	  <mrow>
            <mrow class="MJX-TeXAtom-ORD">
              <mo stretchy="false">|</mo>
            </mrow>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>0</mn>
            </msub>
            <msup>
              <mrow class="MJX-TeXAtom-ORD">
		<mo stretchy="false">|</mo>
              </mrow>
              <mn>3</mn>
            </msup>
	  </mrow>
	</mfrac>
      </mrow>
    </math>
    <pre id="math-quadratic-start">$$\kappa(0) = {2\over3}{(P_1-P_0)\times((P_0-P_1)+(P_2-P_1))\over|P_1-P_0|^3}$$</pre>
  </div>

  <div role="math" aria-describedby="math-quadratic-end">
    <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
      <mi>&#x03BA;<!-- κ --></mi>
      <mo stretchy="false">(</mo>
      <mn>1</mn>
      <mo stretchy="false">)</mo>
      <mo>=</mo>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <mn>1</mn>
	  <mn>2</mn>
	</mfrac>
      </mrow>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <mrow>
            <mo stretchy="false">(</mo>
            <msub>
              <mi>P</mi>
              <mn>2</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <mo stretchy="false">)</mo>
            <mo>&#x00D7;<!-- × --></mo>
            <mo stretchy="false">(</mo>
            <msub>
              <mi>P</mi>
              <mn>0</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <mo stretchy="false">)</mo>
	  </mrow>
	  <mrow>
            <mrow class="MJX-TeXAtom-ORD">
              <mo stretchy="false">|</mo>
            </mrow>
            <msub>
              <mi>P</mi>
              <mn>2</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <msup>
              <mrow class="MJX-TeXAtom-ORD">
		<mo stretchy="false">|</mo>
              </mrow>
              <mn>3</mn>
            </msup>
	  </mrow>
	</mfrac>
      </mrow>
    </math>
    <pre id="math-quadratic-end">$$\kappa(0) = {2\over3}{(P_1-P_0)\times((P_0-P_1)+(P_2-P_1))\over|P_1-P_0|^3}$$</pre>
  </div>

  <p>Where <var>&#x03BA;(0)</var> and <var>&#x03BA;(1)</var> are the
  signed curvatures at the start and end of the path segment
  respectively, and the <var>P</var>'s are the three points that
  define the quadratic Bézier.</p>

<p>For a cubic Bézier:</p>

  <div role="math" aria-describedby="math-cubic-start">
    <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
      <mi>&#x03BA;<!-- κ --></mi>
      <mo stretchy="false">(</mo>
      <mn>0</mn>
      <mo stretchy="false">)</mo>
      <mo>=</mo>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <mn>2</mn>
	  <mn>3</mn>
	</mfrac>
      </mrow>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <mrow>
            <mo stretchy="false">(</mo>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>0</mn>
            </msub>
            <mo stretchy="false">)</mo>
            <mo>&#x00D7;<!-- × --></mo>
            <mo stretchy="false">(</mo>
            <msub>
              <mi>P</mi>
              <mn>2</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <mo stretchy="false">)</mo>
	  </mrow>
	  <mrow>
            <mrow class="MJX-TeXAtom-ORD">
              <mo stretchy="false">|</mo>
            </mrow>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>0</mn>
            </msub>
            <msup>
              <mrow class="MJX-TeXAtom-ORD">
		<mo stretchy="false">|</mo>
              </mrow>
              <mn>3</mn>
            </msup>
	  </mrow>
	</mfrac>
      </mrow>
    </math>
    <pre id="math-cubic-start">$$\kappa(0) = {2\over3}{(P_1-P_0)\times((P_0-P_1)+(P_2-P_1))\over|P_1-P_0|^3}$$</pre>
  </div>

  <div role="math" aria-describedby="math-cubic-end">
    <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
      <mi>&#x03BA;<!-- κ --></mi>
      <mo stretchy="false">(</mo>
      <mn>1</mn>
      <mo stretchy="false">)</mo>
      <mo>=</mo>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <mn>2</mn>
	  <mn>3</mn>
	</mfrac>
      </mrow>
      <mrow class="MJX-TeXAtom-ORD">
	<mfrac>
	  <mrow>
            <mo stretchy="false">(</mo>
            <msub>
              <mi>P</mi>
              <mn>3</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>2</mn>
            </msub>
            <mo stretchy="false">)</mo>
            <mo>&#x00D7;<!-- × --></mo>
            <mo stretchy="false">(</mo>
            <msub>
              <mi>P</mi>
              <mn>1</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>2</mn>
            </msub>
            <mo stretchy="false">)</mo>
	  </mrow>
	  <mrow>
            <mrow class="MJX-TeXAtom-ORD">
              <mo stretchy="false">|</mo>
            </mrow>
            <msub>
              <mi>P</mi>
              <mn>3</mn>
            </msub>
            <mo>&#x2212;<!-- − --></mo>
            <msub>
              <mi>P</mi>
              <mn>2</mn>
            </msub>
            <msup>
              <mrow class="MJX-TeXAtom-ORD">
		<mo stretchy="false">|</mo>
              </mrow>
              <mn>3</mn>
            </msup>
	  </mrow>
	</mfrac>
      </mrow>
    </math>
    <pre id="math-cubic-end">$$\kappa(1) = {2\over3}{(P_3-P_2)\times((P_1-P_2)+(P_3-P_2))\over|P_3-P_2|^3}$$</pre>
  </div>

  <p>Where <var>&#x03BA;(0)</var> and <var>&#x03BA;(1)</var> are the
  signed curvatures at the start and end of the path segment
  respectively, and the <var>P</var>'s are the four points that define
  the cubic Bézier. Note, if
  <var>P<sub>0</sub></var> and <var>P<sub>1</sub></var>, or
  <var>P<sub>2</sub></var> and <var>P<sub>3</sub></var> are degenerate, the
  curvature will be infinite and a line should be used in constructing the join.</p>

<h2 id="VisibilityControl">Controlling visibility: the effect of the <span
class="property">'display'</span> and <span class="property">'visibility'</span>
properties</h2>

<p class="note">See the CSS 2.1 specification for the definitions
of <a>'display'</a> and <a>'visibility'</a>.
[<a href="refs.html#ref-CSS21">CSS21</a>]</p>

<p>SVG uses two properties to control the visibility of
<a>container elements</a>, <a>graphics elements</a>
and <a>text content elements</a>:
<a>'display'</a> and <a>'visibility'</a>.</p>

<p>When applied to certain <a>container elements</a>, <a>graphics elements</a>
or <a>text content elements</a>, setting <a>'display'</a> to
<span class="prop-value">none</span> results in the element not becoming part of
the rendering tree.  Such elements and all of their descendants (regardless of
their own <a>'display'</a> property value):</p>

<ul>
  <li>are not rendered</li>

  <li>are not sensitive to <a href="interact.html#UIEvents">pointer events</a></li>

  <li>do not contribute to <a href="coords.html#ObjectBoundingBox">bounding box
  calculations</a></li>

  <li>do not contribute to <a>masks</a> or
  <a>clipping paths</a>, when descendants of a
  <a>'mask element'</a> or <a>'clipPath'</a> element</li>

  <li>are not considered when performing <a href="text.html#TextLayout">text layout</a></li>
</ul>

<p>Elements that have any other <a>'display'</a> value than
<span class="prop-value">none</span> behave normally with
respect to all of the above.</p>

<p>The <a>'display'</a> property only applies to the following SVG elements:
<a>'svg'</a>, <a>'g'</a>, <a>'switch'</a>, <a>'a'</a>,
<a>'foreignObject'</a>, <a>graphics elements</a> and
<a>text content elements</a>.  Note that <a>'display'</a>
is not an inherited property.</p>

<p>The <a>'display'</a> property affects the direct processing
of a given element, but it does not prevent it from
being referenced by other elements. For example, setting
<span class="prop-value">display: none</span> on a <a>'path'</a> element
will prevent that element from getting rendered directly onto the
canvas, but the <a>'path'</a> element can still be referenced by a
<a>'textPath'</a> element; furthermore, its geometry will be used
in text-on-a-path processing even if the <a>'path'</a> has
<span class="prop-value">display: none</span>.</p>

<p>When applied to a <a>graphics element</a> or <a>text content element</a>,
setting <a>'visibility'</a> to <span class="prop-value">hidden</span>
or <span class="prop-value">collapse</span>
results in the element not being painted.  It is, however,
still part of the rendering tree, is sensitive
to pointer events (depending on the value of <a>'pointer-events'</a>),
contributes to bounding box calculations and clipping paths,
and does affect text layout.</p>

<p>The <a>'visibility'</a> property only applies to
<a>graphics elements</a> and <a>text content elements</a>.
Note that since <a>'visibility'</a> is an inherited property,
although it has no effect on a <a>container element</a> itself,
its inherited value can affect descendant elements.</p>

</div>

<h2 id="VectorEffects">Vector effects</h2>
<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td><a href="http://www.w3.org/Graphics/SVG/WG/wiki/SVG2_Requirements_Input#Constrained_Transformations">SVG 2 will have constrained transformations based on SVG 1.2 Tiny.</a></td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2014/04/09-svg-minutes.html#item06">Add vector effects extension proposal to SVG 2 specification.</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>To include non-scaling features (non-scaling part of the object, and non-scaling entire object</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Satoru Takagi (<a href="https://www.w3.org/Graphics/SVG/WG/track/actions/3619">ACTION-3619</a>)</td>
    </tr>
  </table>
</div>

<p>Sometimes it is of interest to let the outline of an object keep its
original width or to let the position of an object fix no matter which
transforms are applied to it. For example, in a map with a 2px wide line
representing roads it is of interest to keep the roads 2px wide even when the
user zooms into the map, or introductory notes on the graphic chart in which
panning is possible. </p>

<p>To offer such effects regarding special coordinate transformations and
graphic drawings, SVG Tiny 1.2 introduces the <a>'vector-effect'</a> property.
Although SVG Tiny 1.2 introduced only non-scaling stroke behavior, this version
introduces a number of additional effects. Furthermore, since these effects
can be specified in combination, they show more various effects. And, future
versions of the SVG language will allow for more powerful vector effects
through this property.</p>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="VectorEffectProperty">vector-effect</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>none | [ non-scaling-stroke | non-scaling-size | non-rotation | fixed-position ]+ [ viewport | screen ]?</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>none (When values except <span class="prop-value">none</span> are set, <span class="prop-value">viewport</span> becomes the another initial value.)</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>graphics elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>no</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<dl>
  <dt class="prop-value">none</dt>
  <dd>Specifies that no vector effect shall be applied, i.e. the default rendering behaviour
  from SVG 1.1 is used which is to first fill the geometry of a shape with a specified
  paint, then stroke the outline with a specified paint.</dd>
  <dt class="prop-value">non-scaling-stroke</dt>
  <dd>Modifies the way an object is stroked. Normally stroking involves calculating stroke
  outline of the shape's path in current <a>local coordinate system</a> and filling that outline with the
  stroke paint (color or gradient). With the non-scaling-stroke vector effect, stroke outline
  shall be calculated in the "host" coordinate space instead of <a>local coordinate system</a>.
  More precisely: a user agent establishes a host coordinate space which in SVG Tiny 1.2 is
  always the same as "screen coordinate space". The stroke outline is calculated in the
  following manner: first, the shape's path is transformed into the host coordinate space.
  Stroke outline is calculated in the host coordinate space. The resulting outline is
  transformed back to the <a>local coordinate system</a>.
  (Stroke outline is always filled with stroke paint in the current local coordinate system). The resulting visual effect of this
  modification is that stroke width is not dependant on the transformations of the element
  (including non-uniform scaling and shear transformations) and zoom level.</dd>
  <dt class="prop-value">non-scaling-size</dt>
  <dd>Specifies special <a>local coordinate system</a> toward this element
  and its descendant by constrained transformations with the following
  characteristics. The scale of the <a>local coordinate system</a> do not
  change in spite of change of <a>CTM</a>s from a host coordinate space.
  However, it does not specify the suppression of rotation and skew. Also,
  it does not specify the fixation of placement of <a>local coordinate system</a>.
  Since non-scaling-size suppresses scaling of <a>local coordinate system</a>,
  it also has the characteristic of non-scaling-stroke. The transformation
  formula and the example behavior are indicated to the following chapter.</dd>
  <dt class="prop-value">non-rotation</dt>
  <dd>Specifies special <a>local coordinate system</a> toward this element
  and its descendant by constrained transformations with the following
  characteristics. The rotation and skew of the <a>local coordinate system</a>
  is suppressd in spite of change of <a>CTM</a>s from a host coordinate space.
  However, it does not specify the suppression of scaling. Also, it does not
  specify the fixation of placement of <a>local coordinate system</a>.
  The transformation formula and the example behavior are indicated to the
  following chapter.</dd>
  <dt class="prop-value">fixed-position</dt>
  <dd>Specifies special <a>local coordinate system</a> toward this element
  and its descendant by constrained transformations with the following
  characteristics. The placement of <a>local coordinate system</a> is fixed
  in spite of change of <a>CTM</a>s from a host coordinate space. However,
  it does not specify the suppression of rotation, skew and scaling. When
  the element that has fixed-position effect and also has <a>'transform'</a>
  property, that property is consumed for this effect. The shift components
  <var>e</var> and <var>f</var> of matrix of <a>'transform'</a> property are
  used to transfer the origin of fixed <a>local coordinate system</a>. The
  transformation formula and the example behavior are indicated to the
  following chapter.</dd>
</dl>

<p>These values can be enumerated. Thereby, the effect which has these
characteristics simultaneously can be specified.</p>

<p>The following two values assists the above-mentioned values. They show the
host coordinate space of constrained transformations. Especially it has
effective for the element belonging to nested viewport coordinate system such
as nested contents or nested <a>'svg'</a> elements. An initial value in case
it is not specified is <span class="prop-value">viewport</span>.</p>

<dl>
  <dt class="prop-value">viewport</dt>
  <dd>Specifies immediate <a>viewport coordinate system</a> as the host
  coordinate space. When that element belongs to nested
  <a>viewport coordinate system</a>, vector effects are applied toward
  <a>viewport coordinate system</a> to which that element belongs directly.
  That is, that vector effect is not effective for change of <a>CTM</a> on
  ancestral <a>viewport coordinate system</a>.</dd>
  <dt class="prop-value">screen</dt>
  <dd>It specifies the coordinate system of content which under the immediate
  control of <a>user agent</a>. So to speak, it is "scrren" which <a>user agent</a>
  has. ("screen coordinate space" in SVGT1.2)  Even if that element belongs to
  nested viewport coordinate system, that vector effect is always effective for
  change of <a>CTM</a> of the any hierarchy. If the SVG implementation is part
  of a <a>user agent</a> which supports CSS compatible px units, it is a
  coordinate system on CSS pixel of rootmost content. Generally, the pixel (or
  dot) of a device and pixel of CSS are not always equal by influences of the
  zoom function which <a>user agent</a> itself has, and variation of dpi. (see
  <a href="http://www.w3.org/TR/css3-values/#resolution">resolution</a>
  [<a href="http://www.w3.org/TR/css3-values/">CSS Values and Units Module Level 3</a>])
  Accordingly, this value does not specify constrained transformations toward
  the such a device coordinate system.</dd>
</dl>

<p>Note: Future versions of SVG may allow ways to specify the device coordinate system.</p>

<h3 id="VectorEffectsCalculation">Computing the vector effects</h3>

<p>This section shows the list of transformation formulas regarding
combinations of the values for clarification of the behavior of vector effects
excluding <span class="prop-value">non-scaling-stroke</span> which has clear
implications.</p>

<p>The normal coordinate transformation formula from <a>local coordinate system</a>
to <a>viewport coordinate system</a> is as follows.</p>

<p class="issue" data-issue="19">The code assumes a 2D rendering context.
Width CSS Transforms we get a 3D rendering context as well? How does that work
on perspective or 3D transformations?<br/>
CSS Transforms Level 1 <a href="http://www.w3.org/TR/css3-transforms/#svg-three-dimensional-functions">mentions</a>
about 3D rendering context and non scaling stroke with the purport that the
functionality becomes no affect. Is it appropriate to extend it to all the
vector effects?</p>

<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mtable columnalign='left'>
  <mtr>
  <mtd>
    <mfenced open = '[' close = ']'>
      <mtable rowalign='center'>
        <mtr>
          <mtd>
            <msub>
              <mi>x</mi>
              <mi>viewport</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>y</mi>
              <mi>viewport</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mn>1</mn>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo>=</mo>
      <mtext mathsize='big'>CTM</mtext>
    <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
    <mfenced open = '[' close = ']'>
      <mtable rowalign='center'>
        <mtr>
          <mtd>
            <msub>
              <mi>x</mi>
              <mi>userspace</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>y</mi>
              <mi>userspace</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mn>1</mn>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mtd>
  </mtr>
  <mtr>
  <mtd>
    <mtext mathsize='big'>CTM</mtext>
    <mo>=</mo>
    <mfenced open = '[' close = ']'>
      <mtable rowalign='center'>
        <mtr>
          <mtd>
            <msub>
              <mi>a</mi>
              <mi>ctm</mi>
            </msub>
          </mtd>
          <mtd>
            <msub>
              <mi>c</mi>
              <mi>ctm</mi>
            </msub>
          </mtd>
          <mtd>
            <msub>
              <mi>e</mi>
              <mi>ctm</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>b</mi>
              <mi>ctm</mi>
            </msub>
          </mtd>
          <mtd>
            <msub>
              <mi>d</mi>
              <mi>ctm</mi>
            </msub>
          </mtd>
          <mtd>
            <msub>
              <mi>f</mi>
              <mi>ctm</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mn>0</mn>
          </mtd>
          <mtd>
            <mn>0</mn>
          </mtd>
          <mtd>
            <mn>1</mn>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mtd>
  </mtr>
  </mtable>
</math>
</div>

<!--
<p>Here, [DPR] is <a href="http://dev.w3.org/csswg/cssom-view/#dom-window-devicepixelratio">Device Pixel Ratio</a> (in scalar). And [BCM] presupposes that it is a matrix synthesizing the coordinate transformation by Browser Chrome's built-in zooming panning functions. Hereafter, x(<a href="intro.html#TermUserSpace">userspace</a>), y(<a href="intro.html#TermUserSpace">userspace</a>) is abbreviated as x, y.
</p>
-->

<pre class='xml'>
&lt;circle vector-effect="<var>veValue</var>" transform="translate(<var>x<sub>o</sub></var> <var>y<sub>o</sub></var>)" cx="<var>x<sub>f</sub></var>" cy="<var>y<sub>f</sub></var>" r=".."/&gt;
</pre>

<p>When the <a>'vector-effect'</a> is added to an element like the above, the
transformation formula for user coordinate to the device coordinate changes as
follows. Here, <var>x<sub>f</sub></var> and <var>y<sub>f</sub></var> are user
coordinate of the corresponding element and its descendant. And,
<var>x<sub>o</sub></var> and <var>y<sub>o</sub></var> are matrix element
<var>e</var> and <var>f</var> of the transform attribute which the
corresponding element has. In addition, <b>|det(CTM)|</b> is absolute value of
the determinants of <a>CTM</a>. When this value becomes 0 and
<span class="prop-value">non-scaling-size</span> is appointed,
<a>'vector-effect'</a> becomes invalidity namely <span class="prop-value">none</span>.</p>

<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
      <mrow>
        <mtext>det</mtext>
        <mfenced open = '(' close = ')'>
	      <mtext mathsize='big'>CTM</mtext>
        </mfenced>
      </mrow>
    <mo>=</mo>
        <msub>
          <mi>a</mi>
          <mi>ctm</mi>
        </msub>
      <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
        <msub>
          <mi>d</mi>
          <mi>ctm</mi>
        </msub>
      <mo lspace='2px' rspace='2px'>-</mo>
        <msub>
          <mi>b</mi>
          <mi>ctm</mi>
        </msub>
      <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
        <msub>
          <mi>c</mi>
          <mi>ctm</mi>
        </msub>
  </mrow>
</math>
</div>


<table class="propdef attrdef">
  <tr>
    <th>veValue</th>
    <th>Formula</th>
  </tr>
  <tr>
    <td><span class="prop-value">non-scaling-size</span></td>
    <td>
		<div role="math">
		<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
		  <mrow>
		    <mfenced open = '[' close = ']'>
		      <mtable rowalign='center'>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>x</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>y</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <mn>1</mn>
		          </mtd>
		        </mtr>
		      </mtable>
		    </mfenced>
		    <mo>=</mo>
		      <mrow>
		        <mtext mathsize='big'>CTM</mtext>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mtext>0</mtext>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mtext>0</mtext>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>+</mo>
		        <mfrac>
		          <mtext mathsize='big'>CTM</mtext>
		          <msqrt>
		            <mfenced open = '|' close = '|'>
		              <mrow>
		                <mtext>det</mtext>
		                <mfenced open = '(' close = ')'>
		                  <mtext mathsize='big'>CTM</mtext>
		                </mfenced>
		              </mrow>
		            </mfenced>
		          </msqrt>
		        </mfrac>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		      </mrow>
		  </mrow>
		</math>
		</div>
    </td>
  </tr>
  <tr>
    <td><span class="prop-value">non-rotation</span></td>
    <td>
		<div role="math">
		<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
		  <mrow>
		    <mfenced open = '[' close = ']'>
		      <mtable rowalign='center'>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>x</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>y</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <mn>1</mn>
		          </mtd>
		        </mtr>
		      </mtable>
		    </mfenced>
		    <mo>=</mo>
		      <mrow>
		        <mtext mathsize='big'>CTM</mtext>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mtext>0</mtext>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mtext>0</mtext>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>+</mo>
		        <msqrt>
		          <mfenced open = '|' close = '|'>
		            <mrow>
		              <mtext>det</mtext>
		              <mfenced open = '(' close = ')'>
		                <mtext mathsize='big'>CTM</mtext>
		              </mfenced>
		            </mrow>
		          </mfenced>
		        </msqrt>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		      </mrow>
		  </mrow>
		</math>
		</div>
    </td>
  </tr>
  <tr>
    <td><span class="prop-value">non-scaling-size</span> <span class="prop-value">non-rotation</span></td>
    <td>
		<div role="math">
		<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
		  <mrow>
		    <mfenced open = '[' close = ']'>
		      <mtable rowalign='center'>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>x</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>y</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <mn>1</mn>
		          </mtd>
		        </mtr>
		      </mtable>
		    </mfenced>
		    <mo>=</mo>
		      <mrow>
		        <mtext mathsize='big'>CTM</mtext>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mtext>0</mtext>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mtext>0</mtext>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>+</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		      </mrow>
		  </mrow>
		</math>
		</div>
    </td>
  </tr>
  <tr>
    <td><span class="prop-value">fixed-position</span></td>
    <td>
		<div role="math">
		<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
		  <mrow>
		    <mfenced open = '[' close = ']'>
		      <mtable rowalign='center'>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>x</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>y</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <mn>1</mn>
		          </mtd>
		        </mtr>
		      </mtable>
		    </mfenced>
		    <mo>=</mo>
		      <mrow>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>o</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>o</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo>+</mo>
		        <mtext mathsize='big'>CTM</mtext>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		      </mrow>
		  </mrow>
		</math>
		</div>
    </td>
  </tr>
  <tr>
    <td><span class="prop-value">fixed-position</span> <span class="prop-value">non-scaling-size</span></td>
    <td>
		<div role="math">
		<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
		  <mrow>
		    <mfenced open = '[' close = ']'>
		      <mtable rowalign='center'>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>x</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>y</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <mn>1</mn>
		          </mtd>
		        </mtr>
		      </mtable>
		    </mfenced>
		    <mo>=</mo>
		      <mrow>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>o</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>o</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo>+</mo>
		        <mfrac>
		          <mtext mathsize='big'>CTM</mtext>
		          <msqrt>
		            <mfenced open = '|' close = '|'>
		              <mrow>
		                <mtext>det</mtext>
		                <mfenced open = '(' close = ')'>
		                  <mtext mathsize='big'>CTM</mtext>
		                </mfenced>
		              </mrow>
		            </mfenced>
		          </msqrt>
		        </mfrac>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		      </mrow>
		  </mrow>
		</math>
		</div>
    </td>
  </tr>
  <tr>
    <td><span class="prop-value">fixed-position</span> <span class="prop-value">non-rotation</span></td>
    <td>
		<div role="math">
		<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
		  <mrow>
		    <mfenced open = '[' close = ']'>
		      <mtable rowalign='center'>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>x</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>y</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <mn>1</mn>
		          </mtd>
		        </mtr>
		      </mtable>
		    </mfenced>
		    <mo>=</mo>
		      <mrow>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>o</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>o</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo>+</mo>
		        <msqrt>
		          <mfenced open = '|' close = '|'>
		            <mrow>
		              <mtext>det</mtext>
		              <mfenced open = '(' close = ')'>
		                <mtext mathsize='big'>CTM</mtext>
		              </mfenced>
		            </mrow>
		          </mfenced>
		        </msqrt>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		      </mrow>
		  </mrow>
		</math>
		</div>
    </td>
  </tr>
  <tr>
    <td><span class="prop-value">fixed-position</span> <span class="prop-value">non-scaling-size</span> <span class="prop-value">non-rotation</span></td>
    <td>
		<div role="math">
		<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
		  <mrow>
		    <mfenced open = '[' close = ']'>
		      <mtable rowalign='center'>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>x</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <msub>
		              <mi>y</mi>
		              <mi>viewport</mi>
		            </msub>
		          </mtd>
		        </mtr>
		        <mtr>
		          <mtd>
		            <mn>1</mn>
		          </mtd>
		        </mtr>
		      </mtable>
		    </mfenced>
		    <mo>=</mo>
		      <mrow>
		        <mrow>
		          <mfenced open = '[' close = ']'>
		            <mtable rowalign='center'>
		              <mtr>
		                <mtd>
		                  <msub>
		                    <mi>x</mi>
		                    <mi>o</mi>
		                  </msub>
		                </mtd>
		              </mtr>
		              <mtr>
		                <mtd>
		                  <msub>
		                    <mi>y</mi>
		                    <mi>o</mi>
		                  </msub>
		                </mtd>
		              </mtr>
		              <mtr>
		                <mtd>
		                  <mn>1</mn>
		                </mtd>
		              </mtr>
		            </mtable>
		          </mfenced>
		        </mrow>
		        <mo>+</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		              <mtd>
		                <mn>0</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
		        <mfenced open = '[' close = ']'>
		          <mtable rowalign='center'>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>x</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <msub>
		                  <mi>y</mi>
		                  <mi>f</mi>
		                </msub>
		              </mtd>
		            </mtr>
		            <mtr>
		              <mtd>
		                <mn>1</mn>
		              </mtd>
		            </mtr>
		          </mtable>
		        </mfenced>
		      </mrow>
		  </mrow>
		</math>
		</div>
    </td>
  </tr>
</table>

<h3 id="NestedVectorEffectsCalculation">Computing the vector effects for nested viewport coordinate systems</h3>

<p>Below is normal coordinate transformation formula for nested viewport
coordinate systems without vector effects. <b>x<sub>viewport(UA)</sub></b> and
<b>y<sub>viewport(UA)</sub></b> are coordinates which under the immediate
control of <a>user agent</a>. <b>CTM<sub>this</sub></b> is <a>CTM</a> for the
transformation matrix from <a>local coordinate system</a> of an target graphic
to <a>viewport coordinate system</a> to which it belongs.
<b>CTM<sub>parent</sub></b> is <a>CTM</a> for the transformation matrix from
aforementioned <a>viewport coordinate system</a> to <a>viewport coordinate system</a>
of the parent of that. And, <b>CTM<sub>root</sub></b> is <a>CTM</a> for
rootmost viewport coordinate system (UA).</p>

<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mfenced open = '[' close = ']'>
      <mtable rowalign='center'>
        <mtr>
          <mtd>
            <msub>
              <mi>x</mi>
              <mi>viewport(UA)</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>y</mi>
              <mi>viewport(UA)</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mn>1</mn>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
    <mo>=</mo>
    <msub>
      <mtext mathsize='big'>CTM</mtext>
      <mi>root</mi>
    </msub>
    <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
    <mtext>...</mtext>
    <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
    <msub>
      <mtext mathsize='big'>CTM</mtext>
      <mi>parent</mi>
    </msub>
    <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
    <msub>
      <mtext mathsize='big'>CTM</mtext>
      <mi>this</mi>
    </msub>
    <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
    <mfenced open = '[' close = ']'>
      <mtable rowalign='center'>
        <mtr>
          <mtd>
            <msub>
              <mi>x</mi>
              <mi>userspace</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>y</mi>
              <mi>userspace</mi>
            </msub>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mn>1</mn>
          </mtd>
        </mtr>
      </mtable>
    </mfenced>
  </mrow>
</math>
</div>

<p>When applying seven formulas of the preceding section to nested viewport
coordinate systems, the application way of those formulas changes as follows
by whether <span class="prop-value">viewport</span> or
<span class="prop-value">screen</span> is specified as the additional value of
<a><span class="prop-name">'vector-effect'</span></a>.</p>

<p>When <span class="prop-value">viewport</span> value is specified,
<a>user agent</a> computes coordinates combining either of seven formulas of
the preceding chapter, and the following formulas.</p>

<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mtable columnalign='left'>
    <mtr>
      <mtd>
        <mfenced open = '[' close = ']'>
          <mtable rowalign='center'>
            <mtr>
              <mtd>
                <msub>
                  <mi>x</mi>
                  <mrow>
                    <mi>viewport</mi>
                    <mo stretchy='false'>(</mo>
                    <mi>UA</mi>
                    <mo stretchy='false'>)</mo>
                  </mrow>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <msub>
                  <mi>y</mi>
                  <mrow>
                    <mi>viewport</mi>
                    <mo stretchy='false'>(</mo>
                    <mi>UA</mi>
                    <mo stretchy='false'>)</mo>
                  </mrow>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <mn>1</mn>
              </mtd>
            </mtr>
          </mtable>
        </mfenced>
        <mo>=</mo>
        <msub>
          <mtext mathsize='big'>CTM</mtext>
          <mtext>root</mtext>
        </msub>
        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
        <mtext>...</mtext>
        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
        <msub>
          <mtext mathsize='big'>CTM</mtext>
          <mtext>parent</mtext>
        </msub>
        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
        <mfenced open = '[' close = ']'>
          <mtable rowalign='center'>
            <mtr>
              <mtd>
                <msub>
                  <mi>x</mi>
                  <mi>viewport</mi>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <msub>
                  <mi>y</mi>
                  <mi>viewport</mi>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <mn>1</mn>
              </mtd>
            </mtr>
          </mtable>
        </mfenced>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mtext mathsize='big'>CTM</mtext>
        <mo>=</mo>
        <msub>
          <mtext mathsize='big'>CTM</mtext>
          <mtext>this</mtext>
        </msub>
      </mtd>
    </mtr>
  </mtable>
</math>
</div>

<p>When <span class="prop-value">screen</span> value is specified,
<a>user agent</a> computes coordinates combining either of seven formulas of
the preceding chapter, and the following formulas.</p>

<div role="math">
<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mtable columnalign='left'>
    <mtr>
      <mtd>
        <mfenced open = '[' close = ']'>
          <mtable rowalign='center'>
            <mtr>
              <mtd>
                <msub>
                  <mi>x</mi>
                  <mrow>
                    <mi>viewport</mi>
                    <mo stretchy='false'>(</mo>
                    <mi>UA</mi>
                    <mo stretchy='false'>)</mo>
                  </mrow>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <msub>
                  <mi>y</mi>
                  <mrow>
                    <mi>viewport</mi>
                    <mo stretchy='false'>(</mo>
                    <mi>UA</mi>
                    <mo stretchy='false'>)</mo>
                  </mrow>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <mn>1</mn>
              </mtd>
            </mtr>
          </mtable>
        </mfenced>
        <mo>=</mo>
        <mfenced open = '[' close = ']'>
          <mtable rowalign='center'>
            <mtr>
              <mtd>
                <msub>
                  <mi>x</mi>
                  <mi>viewport</mi>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <msub>
                  <mi>y</mi>
                  <mi>viewport</mi>
                </msub>
              </mtd>
            </mtr>
            <mtr>
              <mtd>
                <mn>1</mn>
              </mtd>
            </mtr>
          </mtable>
        </mfenced>
      </mtd>
    </mtr>
    <mtr>
      <mtd>
        <mtext mathsize='big'>CTM</mtext>
        <mo>=</mo>
        <msub>
          <mtext mathsize='big'>CTM</mtext>
          <mtext>root</mtext>
        </msub>
        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
        <mtext>...</mtext>
        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
        <msub>
          <mtext mathsize='big'>CTM</mtext>
          <mtext>parent</mtext>
        </msub>
        <mo lspace='2px' rspace='2px'>&#x22c5;</mo>
        <msub>
          <mtext mathsize='big'>CTM</mtext>
          <mtext>this</mtext>
        </msub>
      </mtd>
    </mtr>
  </mtable>
</math>
</div>

<h3 id="VectorEffectsExamples">Examples of vector effects</h3>

<div class="example">
  <p>Below is an example of the <span class="prop-value">non-scaling-stroke</span> <a><span class="prop-name">'vector-effect'</span></a>.</p>

  <edit:includefile href='images/painting/non-scaling-stroke.svg' link="yes" image="yes"/>
</div>

<div class="example">
  <p>Below is an example of the <span class="prop-value">none</span> <a><span class="prop-name">'vector-effect'</span></a> (no vector effect).</p>
  <table>
    <tr><td>Before changing CTM</td><td>After changing CTM</td></tr>
    <tr>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-initial.svg" alt="Image showing none vector effect"/></td>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-none.svg" alt="Image showing none vector effect"/></td>
    </tr>
  </table>

  <p>Source code </p>
  <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg" viewBox="-50,-50,500,500" height="500" width="500">

  <rect x="-50" y="-50" width="500" height="500" stroke="orange" stroke-width="3" fill="none"/>

  <!-- Nested local coordinate system is transformed by this transform attribute -->
  <g transform="matrix(2.1169438081370817,0.3576047954311102,-0.3576047954311102,1.4700998667618626,0,0)
                translate(-50,-50)">
    <svg viewBox="-50,-50,500,500" height="500" width="500">
      <!-- Graph paper on the this svg's base local coordinate system -->
      <g stroke="green" stroke-width="1" fill="none">
        <circle cx="0" cy="0" r="10"/>
        <circle cx="150" cy="150" r="7"/>
        <path fill="green" stroke="none" d="M0,-3 L30,-3 25,-10 50,0 25,10 30,3 0,3z"/>

        <line x1="-100" y1="-100" x2="600" y2="-100" stroke-dasharray="5,5"/>
        <line x1="-100" y1="000" x2="600" y2="000"/>
        <line x1="-100" y1="100" x2="600" y2="100" stroke-dasharray="5,5"/>
        <line x1="-100" y1="200" x2="600" y2="200" stroke-dasharray="5,5"/>
        <line x1="-100" y1="300" x2="600" y2="300" stroke-dasharray="5,5"/>
        <line x1="-100" y1="400" x2="600" y2="400" stroke-dasharray="5,5"/>
        <line x1="-100" y1="500" x2="600" y2="500" stroke-dasharray="5,5"/>

        <line y1="-100" x1="-100" y2="600" x2="-100" stroke-dasharray="5,5"/>
        <line y1="-100" x1="000" y2="600" x2="000"/>
        <line y1="-100" x1="100" y2="600" x2="100" stroke-dasharray="5,5"/>
        <line y1="-100" x1="200" y2="600" x2="200" stroke-dasharray="5,5"/>
        <line y1="-100" x1="300" y2="600" x2="300" stroke-dasharray="5,5"/>
        <line y1="-100" x1="400" y2="600" x2="400" stroke-dasharray="5,5"/>
        <line y1="-100" x1="500" y2="600" x2="500" stroke-dasharray="5,5"/>
      </g>

      <!-- Figure having vector effect -->
      <!-- A thick red right arrow and small rectangle on this figure's nested
           local coordinate system origin -->
      <path id="ve" vector-effect="none"
            stroke="red" stroke-width="3" fill="none"
            transform="matrix(1,0,0,1,150,150)"
            d="M-50,-50 L50,-50 50,-100 150,0 50,100 50,50 -50,50 -50,-50z M5 0 L0 -5 -5 0 0 5z"/>
    </svg>
  </g>
</svg>
]]></pre>
</div>

<div class="example">
  <p>Below is an example of the <span class="prop-value">non-scaling-size</span>.</p>
  <table>
    <tr><td>Before changing CTM</td><td>After changing CTM</td></tr>
    <tr>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-initial.svg" alt="Image showing appearance before the effect of the vector effect showing up"/></td>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-nonScalingSize.svg" alt="Image showing non-scaling-size vector effect"/></td>
    </tr>
  </table>

  <pre><![CDATA[
<path id="ve" vector-effect="non-scaling-size"
      stroke="red" stroke-width="3" fill="none"
      transform="matrix(1,0,0,1,150,150)"
      d="M-50,-50 L50,-50 50,-100 150,0 50,100 50,50 -50,50 -50,-50z M5 0 L0 -5 -5 0 0 5z"/>]]></pre>
</div>

<div class="example">
  <p>Below is an example of the <span class="prop-value">non-rotation</span>.</p>
  <table>
    <tr><td>Before changing CTM</td><td>After changing CTM</td></tr>
    <tr>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-initial.svg" alt="Image showing appearance before the effect of the vector effect showing up"/></td>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-nonRotation.svg" alt="Image showing non-rotation vector effect"/></td>
    </tr>
  </table>

  <pre><![CDATA[
<path id="ve" vector-effect="non-rotation"
      stroke="red" stroke-width="3" fill="none"
      transform="matrix(1,0,0,1,150,150)"
      d="M-50,-50 L50,-50 50,-100 150,0 50,100 50,50 -50,50 -50,-50z M5 0 L0 -5 -5 0 0 5z"/>]]></pre>
</div>

<div class="example">
  <p>Below is an example of the <span class="prop-value">non-scaling-size</span> <span class="prop-value">non-rotation</span>.</p>
  <table>
    <tr><td>Before changing CTM</td><td>After changing CTM</td></tr>
    <tr>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-initial.svg" alt="Image showing appearance before the effect of the vector effect showing up"/></td>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-nonScalingSize-nonRotation.svg" alt="Image showing non-scaling-size non-rotation vector effect"/></td>
    </tr>
  </table>

  <pre><![CDATA[
<path id="ve" vector-effect="non-scaling-size non-rotation"
      stroke="red" stroke-width="3" fill="none"
      transform="matrix(1,0,0,1,150,150)"
      d="M-50,-50 L50,-50 50,-100 150,0 50,100 50,50 -50,50 -50,-50z M5 0 L0 -5 -5 0 0 5z"/>]]></pre>
</div>

<div class="example">
  <p>Below is an example of the <span class="prop-value">fixed-position</span>.</p>
  <table>
    <tr><td>Before changing CTM</td><td>After changing CTM</td></tr>
    <tr>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-initial.svg" alt="Image showing appearance before the effect of the vector effect showing up"/></td>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-fixedPosition.svg" alt="Image showing fixed-position vector effect"/></td>
    </tr>
  </table>

  <pre><![CDATA[
<path id="ve" vector-effect="fixed-position"
      stroke="red" stroke-width="3" fill="none"
      transform="matrix(1,0,0,1,150,150)"
      d="M-50,-50 L50,-50 50,-100 150,0 50,100 50,50 -50,50 -50,-50z M5 0 L0 -5 -5 0 0 5z"/>]]></pre>
</div>

<div class="example">
  <p>Below is an example of the <span class="prop-value">non-scaling-size</span> <span class="prop-value">fixed-position</span>.</p>
  <table>
    <tr><td>Before changing CTM</td><td>After changing CTM</td></tr>
    <tr>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-initial.svg" alt="Image showing appearance before the effect of the vector effect showing up"/></td>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-nonScalingSize-fixedPosition.svg" alt="Image showing non-scaling-size fixed-position vector effect"/></td>
    </tr>
  </table>

  <pre><![CDATA[
<path id="ve" vector-effect="non-scaling-size fixed-position"
      stroke="red" stroke-width="3" fill="none"
      transform="matrix(1,0,0,1,150,150)"
      d="M-50,-50 L50,-50 50,-100 150,0 50,100 50,50 -50,50 -50,-50z M5 0 L0 -5 -5 0 0 5z"/>]]></pre>
</div>

<div class="example">
  <p>Below is an example of the <span class="prop-value">non-rotation</span> <span class="prop-value">fixed-position</span>.</p>
  <table>
    <tr><td>Before changing CTM</td><td>After changing CTM</td></tr>
    <tr>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-initial.svg" alt="Image showing appearance before the effect of the vector effect showing up"/></td>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-nonRotation-fixedPosition.svg" alt="Image showing non-rotation fixed-position vector effect"/></td>
    </tr>
  </table>

  <pre><![CDATA[
<path id="ve" vector-effect="non-rotation fixed-position"
      stroke="red" stroke-width="3" fill="none"
      transform="matrix(1,0,0,1,150,150)"
      d="M-50,-50 L50,-50 50,-100 150,0 50,100 50,50 -50,50 -50,-50z M5 0 L0 -5 -5 0 0 5z"/>]]></pre>
</div>

<div class="example">
  <p>Below is an example of the <span class="prop-value">non-scaling-size</span> <span class="prop-value">non-rotation</span> <span class="prop-value">fixed-position</span>.</p>
  <table>
    <tr><td>Before changing CTM</td><td>After changing CTM</td></tr>
    <tr>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-initial.svg" alt="Image showing appearance before the effect of the vector effect showing up"/></td>
      <td><img class="bordered" src="images/painting/vectorEffects/ve-nonScalingSize-nonRotation-fixedPosition.svg" alt="Image showing non-scaling-size non-rotation fixed-position vector effect"/></td>
    </tr>
  </table>

  <pre><![CDATA[
<path id="ve" vector-effect="non-scaling-size non-rotation fixed-position"
      stroke="red" stroke-width="3" fill="none"
      transform="matrix(1,0,0,1,150,150)"
      d="M-50,-50 L50,-50 50,-100 150,0 50,100 50,50 -50,50 -50,-50z M5 0 L0 -5 -5 0 0 5z"/>]]></pre>
</div>


<h2 id="Markers">Markers</h2>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Improve markers.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2011/10/27-svg-irc#T18-12-30">We will improve markers for SVG 2.</a></td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>To solve the common problems authors have with SVG markers.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Cameron (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3286">ACTION-3286</a>)</td>
    </tr>
  </table>
</div>

<edit:with element='marker'>

<p>A marker is a graphical object that is painted at particular positions along
a <a>'path'</a>, <a>'line'</a>, <a>'polyline'</a> or <a>'polygon'</a>
element, together known as the <a>markable elements</a>.</p>

<dl class='definitions'  data-dfn-type="dfn" data-export="">
  <dt id="TermMarkableElement">markable element</dt>
  <dd>A markable element is one that can have <a href="painting.html#Markers">markers</a>
  painted on it either through the use of the <a href="painting.html#TermMarkerProperties">marker properties</a>
  or by having a <a>'marker element'</a> element as a child.
  The following elements are markable elements:
  <edit:elementcategory name='markable'/></dd>
</dl>

<p>The <a>'marker-start'</a> and <a>'marker-end'</a> properties
can be used to place markers at the first and last vertex, and the
<a>'marker-mid'</a> property can be used to place markers at every
other vertex (aside from the first and last).  The <a>'marker-start'</a> and
<a>'marker-end'</a> can be used for example to add arrowheads to paths.
Markers placed using these properties are known as
<dfn id="TermVertexMarker">vertex markers</dfn>.</p>

<p class='note'>In SVG 2, vertex markers are the only kind of markers
available.  Other specifications will add new types of markers.</p>

<p>The graphics for a marker are defined by a <a>'marker element'</a> element.
The <a>'marker-start'</a>, <a>'marker-end'</a> and <a>'marker-mid'</a> properties,
together known as the <dfn id="TermMarkerProperties">marker properties</dfn>, reference
<a>'marker element'</a> elements.</p>

<p>Markers can be animated, and as with <a>'use'</a> elements, the animated
effects will show on all current uses of the markers within the document.</p>

<p>Markers on a given element are painted in the following order, from
bottom to top:</p>

<ul>
  <li>any marker specified by <a>'marker-start'</a></li>

  <li>the <a>'marker-mid'</a> markers, in order of their position along the path</li>

  <li>any marker specified by <a>'marker-end'</a></li>
</ul>

<h3 id="MarkerElement">The <span class="element-name">'marker'</span> element</h3>

<edit:elementsummary name='marker'/>

<p>The <a>'marker element'</a> element defines the graphics that are to
be used for drawing markers on a <a>markable element</a>.</p>

<p id="MarkerAttributes"><em>Attribute definitions:</em></p>

<dl class="attrdef-list">
  <dt>

<table class="propdef attrdef">
  <tr>
    <th>Name</th>
    <th>Value</th>
    <th>Initial value</th>
    <th>Animatable</th>
  </tr>
  <tr>
    <td><dfn id="MarkerUnitsAttribute">markerUnits</dfn></td>
    <td>strokeWidth | userSpaceOnUse</td>
    <td>strokeWidth</td>
    <td>yes</td>
  </tr>
</table>

</dt>
<dd>

<p>The <a>'markerUnits'</a> attribute defines the coordinate system for
attributes <a>'markerWidth'</a>, <a>'markerHeight'</a> and the
contents of the <a>'marker element'</a>.  Values have the
following meanings:</p>

<dl>
  <dt><span class="attr-value">strokeWidth</span></dt>
  <dd><a>'markerWidth'</a>, <a>'markerHeight'</a> and the contents
  of the <a>'marker element'</a> represent values in a coordinate system
  which has a single unit equal the size in user units of the
  current stroke width (see the <a>'stroke-width'</a> property) in
  place for the graphic object referencing the marker.</dd>

  <dt><span class="attr-value">userSpaceOnUse</span></dt>
  <dd><a>'markerWidth'</a>, <a>'markerHeight'</a> and the contents
  of the <a>'marker element'</a> represent values in the current
  user coordinate system in place for the graphic object
  referencing the marker (i.e., the user coordinate system for
  the element referencing the <a>'marker element'</a> element via a
  <a>marker property</a>).</dd>
</dl>

</dd>
<dt>

<table class="propdef attrdef">
  <tr>
    <th>Name</th>
    <th>Value</th>
    <th>Initial value</th>
    <th>Animatable</th>
  </tr>
  <tr>
    <td><dfn id="MarkerWidthAttribute">markerWidth</dfn>,
    <dfn id="MarkerHeightAttribute">markerHeight</dfn></td>
    <td><a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> | <a>&lt;number&gt;</a></td>
    <td>3</td>
    <td>yes</td>
  </tr>
</table>

</dt>
<dd>

<p>The <a>'markerWidth'</a> and <a>'markerHeight'</a> attributes
represent the size of the viewport into which the marker is to
be fitted according to the <a>'viewBox'</a> and <a>'preserveAspectRatio'</a>
attributes.  A value of zero for either
attribute results in nothing being rendered for the marker.  A negative value
for either attribute is an error (see
<a href="implnote.html#ErrorProcessing">Error processing</a>).</p>

</dd>
<dt>

<table class="propdef attrdef">
  <tr>
    <th>Name</th>
    <th>Value</th>
    <th>Initial value</th>
    <th>Animatable</th>
  </tr>
  <tr>
    <td><dfn id="MarkerElementRefXAttribute">refX</dfn></td>
    <td><a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> | <a>&lt;number&gt;</a> | left | center | right</td>
    <td>0</td>
    <td>yes</td>
  </tr>
  <tr>
    <td><dfn id="MarkerElementRefYAttribute">refY</dfn></td>
    <td><a>&lt;length&gt;</a> | <a>&lt;percentage&gt;</a> | <a>&lt;number&gt;</a> | top | center | bottom</td>
    <td>0</td>
    <td>yes</td>
  </tr>
</table>

</dt>
<dd>

    <p class="note">
      New in SVG 2: geometric keywords (matches use in <a>'symbol'</a>).
    </p>
    <p class="annotation">
      We will add top/center/bottom, left/center/right keywords to
      refX/refY on marker/symbol. Resolved at
      <a href="http://www.w3.org/2014/08/26-svg-minutes.html#item07">London
      F2F</a>. Values inspired by
      <a href="http://www.w3.org/TR/css3-background/#the-background-position">'background-position'</a>.
    </p>

<p>The <a>'refX'</a> and <a>'refY'</a> attributes define the reference
point of the marker which is to be placed exactly at the marker's
position on the <a>markable element</a>.  They are interpreted as being in the
coordinate system of the marker contents, after application of the
<a>'viewBox'</a> and <a>'preserveAspectRatio'</a> attributes.</p>

</dd>
<dt>

<table class="propdef attrdef">
  <tr>
    <th>Name</th>
    <th>Value</th>
    <th>Initial value</th>
    <th>Animatable</th>
  </tr>
  <tr>
    <td><dfn id="OrientAttribute">orient</dfn></td>
    <td>auto | auto-start-reverse | <a>&lt;angle&gt;</a> | <a>&lt;number&gt;</a></td>
    <td>0</td>
    <td>yes&#160;(non-additive)</td>
  </tr>
</table>

</dt>
<dd>

<p>The <a>'orient'</a> attribute indicates how the marker
is rotated when it is placed at its position on the <a>markable element</a>.
Values have the following meaning:</p>

<dl>
  <dt><span class="attr-value">'auto'</span></dt>
  <dd>
    <p>A value of <span class="attr-value">'auto'</span>
    indicates that the marker is oriented such that its positive
    x-axis is pointing in the direction of the path at the point
    it is placed.</p>

    <p class="issue" data-issue="21">This needs to reference a definition for how
    directionality of a given start/mid/end vertex is calculated.
    Part of that (which should be moved somewhere more appropriate) is in
    the <a href="paths.html#PathElementImplementationNotes">path element implementation notes</a>.
    Some wording from SVG 1.1 appears to have been lost, compare with <a href="http://www.w3.org/TR/SVG11/painting.html#OrientAttribute">this</a>.
	<br/><br/>
    Here's an example that is a bit unclear currently:
    <code style="white-space:pre">
&lt;svg>
  &lt;marker id="m" orient="auto" overflow="visible">
    &lt;rect x="-1" y="-0.5" width="1" height="1" fill="green"/>
  &lt;/marker>
  &lt;path d="M50,0C50,50 50,100 50,100" marker-end="url(#m)" stroke-width="100" stroke="red"/>
&lt;/svg>
	</code>
	<br/>
	The second control point and the endpoint coincide, should this mean that the direction of the endpoint is a) <em>unknown [aka default to 0 degrees]</em> or
	b) <em>that you have to look at the previous segment(s)/command(s) until a direction can be established</em>?
    </p>

    <p>If the marker is on the first or last vertex of a closed subpath, then the
    incoming direction taken from the final path segment and the outgoing
    direction is taken from:</p>

    <ul>
      <li>the first path segment of the <em>following</em> subpath,
      if the following subpath does not begin with a
      <a href="paths.html#PathDataMovetoCommands">'moveto'</a> command, and</li>
      <li>the first path segment of the <em>current</em> subpath,
      if the following subpath does begin with a
      <a href="paths.html#PathDataMovetoCommands">'moveto'</a> command
      or if there is no following subpath.</li>
    </ul>
  </dd>
</dl>

<dl class="ready-for-wider-review">
  <dt><span class="attr-value">'auto-start-reverse'</span></dt>
  <dd>
    <p>A value of <span class="attr-value">'auto-start-reverse'</span>
    means the same as <span class="attr-value">'auto'</span> except that
    for a marker placed by <a>'marker-start'</a>, the orientation is 180°
    different from the orientation as determined by <span class="attr-value">'auto'</span>.</p>

    <p class="note">This allows a single arrowhead marker to be defined
    that can be used for both the start and end of a path, point in the right
    directions.</p>
  </dd>
</dl>

<dl>
  <dt><span class="attr-value"><a>&lt;angle&gt;</a></span></dt>
  <dt><span class="attr-value"><a>&lt;number&gt;</a></span></dt>
  <dd>
    <p>An <a>&lt;angle&gt;</a> value represents the angle the marker's
    positive x-axis makes with the positive x-axis in the local coordinate system
    of the <a>markable element</a>, and a <a>&lt;number&gt;</a> value
    with no unit represents an angle in degrees.  For example, if a value of
    <span class="attr-value">'0'</span> is given, then the marker will be drawn
    such that its x-axis will align with the x-axis of the user
    space of the graphic object referencing the marker.
    A value of <span class="attr-value">'90deg'</span> will result in the
    marker being drawn with its positive x-axis in the direction
    of the positive y-axis of the <a>markable element</a>'s local coordinate system.</p>
  </dd>
</dl>

<p>The orientation occurs after the marker has been fitted into its
viewport.  See the <a href="#MarkerAlgorithm">Details on how markers are rendered</a>
section below for an illustrative example.</p>

</dd>

</dl>

<!--
<style>
hr.break { border: none; margin: 2em 0 }
hr.break:before { display: block; text-align: center; content: "*\a0\a0\a0\a0*\a0\a0\a0\a0*"; }
</style>
<hr class="break"/>
-->

<p>The contents of the <a>'marker element'</a> are relative to a new
coordinate system. The <a>'markerUnits'</a> attribute determines an initial
scale factor for transforming the graphics in the marker into the user
coordinate system for the referencing element. An additional set of
transformations might occur if there is a <a>'viewBox'</a> attribute, in
which case the coordinate system for the contents of the <a>'marker element'</a>
will be transformed due to the processing of attributes <a>'viewBox'</a>
and <a>'preserveAspectRatio'</a>. If there is no <a>'viewBox'</a>
attribute, then the assumed default value for the the <a>'viewBox'</a>
attribute has the origin of the viewBox coincident with the origin
of the viewport and the width/height of the viewBox the same as the
width/height of the viewport.</p>

<p>The <a href="styling.html#UAStyleSheet">user agent style sheet</a> sets
the <a>'overflow'</a> property for <a>'marker element'</a> elements to
<span class="prop-value">hidden</span>, which causes a rectangular clipping
path to be created at the bounds of marker's viewport.  Unless the
<a>'overflow'</a> property is overridden, any graphics within the marker which
goes outside of the marker's viewport will be clipped.</p>

<p><a>Properties</a> inherit into the
<a>'marker element'</a> element from its ancestors; properties do <em>not</em>
inherit from the element referencing the <a>'marker element'</a> element.
<span class="ready-for-wider-review">Note however that by using the <span class="prop-value">context-stroke</span>
value for the <a>'fill'</a> or <a>'stroke'</a> on elements in its definition,
a single marker can be designed to match the style of the element referencing
the marker.</span></p>

<p><a>'marker element'</a> elements are not rendered directly
and must be referenced by one of the <a>marker properties</a>
to be rendered.  The <a>'display'</a> property does not apply to the
<a>'marker element'</a> element; thus, <a>'marker element'</a> elements are not
directly rendered even if the <a>'display'</a> property is
set to a value other than <span class="prop-value">none</span>, and
<a>'marker element'</a> elements are available for referencing even when the
<a>'display'</a> property on the <a>'marker element'</a> element or any of its
ancestors is set to <span class="prop-value">none</span>.</p>

<p><a href="interact.html#EventAttributes">Event attributes</a> and
<a href="svgdom.html#EventListeners">event listeners</a> attached
to the contents of a <a>'marker element'</a> element are not processed;
only the rendering aspects of <a>'marker element'</a> elements are
processed.</p>

<h3 id="MarkerReferences">Referencing <span class="element-name">'marker'</span> elements</h3>

<p>A number of marker properties allow specifying a <a>'marker element'</a> using a <a>&lt;marker-ref&gt;</a> value.</p>

<div class="definition">
  <dfn id="DataTypeMarkerRef">&lt;marker-ref&gt;</dfn> =<br/>
  <div style="margin-left: 2em">
    <a>&lt;url&gt;</a> |<br/>
    child
  </div>
</div>

<p>Values have the following meaning</p>

<dl>
  <dt><span class='prop-value'>&lt;url&gt;</span></dt>
  <dd>Indicates that the <a>'marker element'</a> element referenced
  by the <a>&lt;url&gt;</a> value will be used.
  If the <a href="linking.html#URLReference">URL reference</a> is not valid
  (e.g., it points to an object that is undefined or the object is not
  a <a>'marker element'</a> element), then the marker reference is also not
  valid.</dd>

  <dt><span class='prop-value'>child</span></dt>
  <dd>Indicates that the last child <a>'marker element'</a> element of the
  element where the property is specified will be used.
  If there is no such element, then the reference is not valid.</dd>
</dl>

<h3 id="VertexMarkerProperties">Vertex markers: the <span class="property">'marker-start'</span>,
<span class="property">'marker-mid'</span> and <span class="property">'marker-end'</span>
properties</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="MarkerStartProperty">marker-start</dfn>,
        <dfn id="MarkerMidProperty">marker-mid</dfn>,
        <dfn id="MarkerEndProperty">marker-end</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>none | <a>&lt;marker-ref&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>none</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>markable elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified, but with <a>&lt;url&gt;</a> values (that are part of
    a <a>&lt;marker-ref&gt;</a>) made absolute</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'marker-start'</a> and <a>'marker-end'</a> properties are used
to specify the marker that will be drawn at the first and last vertices
of the given <a>markable element</a>, respectively.  <a>'marker-mid'</a>
is used to specify the marker that will be drawn at all other vertices
(i.e., every vertex except the first and last).
Possible values for <a>'marker-start'</a>, <a>'marker-mid'</a> and
<a>'marker-end'</a> are:</p>

<dl>
  <dt><span class='prop-value'>none</span></dt>
  <dd>Indicates that no marker symbol will be drawn at the given
  vertex or vertices.</dd>

  <dt><span class='prop-value'>&lt;marker-ref&gt;</span></dt>
  <dd>Indicates that the <a>'marker element'</a> element referenced
  by the <a>&lt;marker-ref&gt;</a> value will be drawn at the given vertex or
  vertices.
  If the reference is not valid, then no marker will be drawn at the given
  vertex or vertices.</dd>
</dl>

<p>For <a>'polygon'</a> elements, the last vertex is the same as the first
vertex, and for <a>'path'</a> elements that end with a closed subpath, the last
vertex is the same as the first vertex of that final subpath.
In this case, if the value of <a>'marker-end'</a> is not
<span class="prop-value">none</span>, then it is possible that two markers
will be rendered on that final vertex.</p>

<p class="note">Note that <a>'marker-start'</a> and <a>'marker-end'</a>
refer to the first and last vertex of the entire path, not each subpath.</p>

<div class="ready-for-wider-review">
<div class="example">
  <p>The following example shows a triangular marker symbol used as a
  <a>vertex marker</a> to form an arrowhead at the end of two paths.</p>

  <edit:includefile href='images/painting/marker.svg'/>

  <div class="figure">
    <img class="bordered" src="images/painting/marker-rendering.svg"
         alt="Image showing the use of an automatically oriented marker."/>
    <p class="caption">The triangle is placed at the end of the path and
    oriented automatically so that it points in the right direction.
    The use of <span class="prop-value">context-stroke</span> ensures
    the fill of the triangle matches the stroke of each <a>'path'</a>.</p>
  </div>
</div>
</div>

<h3 id="MarkerShorthand">Marker shorthand: the <span class="property">'marker'</span>
property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="MarkerProperty">marker</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>none | <a>&lt;marker-ref&gt;</a></td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>not defined for shorthand properties</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>markable elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>see individual properties</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The <a>'marker property'</a> property sets values for the
<a>'marker-start'</a>, <a>'marker-mid'</a> and <a>'marker-end'</a>
properties.  The value of the <a>'marker property'</a> is used
directly for all three of the corresponding longhand properties.</p>

<h3 id="MarkerAlgorithm">Details on how markers are rendered</h3>

<p>For each marker that is drawn, a temporary new user coordinate
system is established so that the marker will be positioned and sized
correctly, as follows:</p>

<ul>
  <li>The axes of the temporary new user coordinate system are aligned
  according to the <a>'orient'</a> attribute on the
  <a>'marker element'</a> element and the slope of the curve at the given vertex.
  (Note: if there is a discontinuity at a vertex, the slope is the
  average of the slopes of the two segments of the curve that join
  at the given vertex. If a slope cannot be determined, the slope is
  assumed to be zero.)</li>

  <li>A temporary new coordinate system is established by attribute
  <a>'markerUnits'</a>. If <a>'markerUnits'</a> equals
  <span class="attr-value">'strokeWidth'</span>, then the temporary new
  user coordinate system is the result of scaling the current
  user coordinate system by the current value of property
  <a>'stroke-width'</a>. If <a>'markerUnits'</a> equals
  <span class="attr-value">'userSpaceOnUse'</span>, then no extra scale
  transformation is applied.</li>

  <li>An additional set of transformations might occur if the
  <a>'marker element'</a> element includes a <a>'viewBox'</a> attribute, in
  which case additional transformations are set up to produce the necessary
  result due to attributes <a>'viewBox'</a> and <a>'preserveAspectRatio'</a>.</li>

  <li>If the <a>'overflow'</a> property on the <a>'marker element'</a> element
  indicates that the marker needs to be clipped to its viewport, then an
  implicit clipping path is established at the bounds of the viewport.</li>
</ul>

<p>The rendering effect of a marker is as if the contents of the
referenced <a>'marker element'</a> element were deeply cloned
into a separate non-exposed DOM tree for each instance of the
marker. Because the cloned DOM tree is non-exposed, the SVG DOM
does not show the cloned instance of the marker.</p> <p>For user
agents that support <a href="styling.html">Styling
with CSS</a>, the conceptual deep cloning of the referenced
<a>'marker element'</a> element into a non-exposed DOM tree also
copies any property values resulting from
<a href="http://www.w3.org/TR/2011/REC-CSS2-20110607/cascade.html">the CSS cascade</a>
([<a href="refs.html#ref-CSS21">CSS21</a>], chapter 6) and
property inheritance on the referenced element and its contents. CSS 2.1
selectors can be applied to the original (i.e., referenced) elements
because they are part of the formal document structure. CSS 2.1 selectors
cannot be applied to the (conceptually) cloned DOM tree because its
contents are not part of the formal document structure.</p>

<p>For illustrative purposes, we'll repeat the marker example shown earlier:</p>

<pre>
&lt;?xml version="1.0" standalone="no"?&gt;
&lt;svg width="4in" height="2in"
     viewBox="0 0 4000 2000"
     xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;defs&gt;
    &lt;marker id="Triangle"
      viewBox="0 0 10 10" refX="0" refY="5"
      markerUnits="strokeWidth"
      markerWidth="4" markerHeight="3"
      orient="auto"&gt;
      &lt;path d="M 0 0 L 10 5 L 0 10 z" /&gt;
    &lt;/marker&gt;
  &lt;/defs&gt;
  &lt;rect x="10" y="10" width="3980" height="1980"
       fill="none" stroke="blue" stroke-width="10" /&gt;
  &lt;desc&gt;Placing an arrowhead at the end of a path.
  &lt;/desc&gt;
  &lt;path d="M 1000 750 L 2000 750 L 2500 1250"
        fill="none" stroke="black" stroke-width="100"
        marker-end="url(#Triangle)"  /&gt;
&lt;/svg&gt;
</pre>

<p>The rendering effect of the above file will be visually identical to
the following:</p>

<pre>
&lt;?xml version="1.0" standalone="no"?&gt;
&lt;svg width="4in" height="2in"
     viewBox="0 0 4000 2000"
     xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;desc&gt;File which produces the same effect
      as the marker example file, but without
      using markers.
  &lt;/desc&gt;
  &lt;rect x="10" y="10" width="3980" height="1980"
       fill="none" stroke="blue" stroke-width="10" /&gt;
  &lt;!-- The path draws as before, but without the marker properties --&gt;
  &lt;path d="M 1000 750 L 2000 750 L 2500 1250"
        fill="none" stroke="black" stroke-width="100"  /&gt;
  &lt;!-- The following logic simulates drawing a marker
       at final vertex of the path. --&gt;
  &lt;!-- First off, move the origin of the user coordinate system
       so that the origin is now aligned with the end point of the path. --&gt;
  <strong>&lt;g transform="translate(2500,1250)" &gt;</strong>
    &lt;!-- Rotate the coordinate system 45 degrees because
         the marker specified orient="auto" and the final segment
         of the path is going in the direction of 45 degrees. --&gt;
    <strong>&lt;g transform="rotate(45)" &gt;</strong>
      &lt;!-- Scale the coordinate system to match the coordinate system
           indicated by the 'markerUnits' attributes, which in this case has
           a value of 'strokeWidth'. Therefore, scale the coordinate system
           by the current value of the 'stroke-width' property, which is 100. --&gt;
      <strong>&lt;g transform="scale(100)" &gt;</strong>
        &lt;!-- Translate the coordinate system by
             (-refX*viewBoxToMarkerUnitsScaleX, -refY*viewBoxToMarkerUnitsScaleY)
             in order that (refX,refY) within the marker will align with the vertex.
             In this case, we use the default value for preserveAspectRatio
             ('xMidYMid meet'), which means find a uniform scale factor
             (i.e., viewBoxToMarkerUnitsScaleX=viewBoxToMarkerUnitsScaleY)
             such that the viewBox fits entirely within the viewport ('meet') and
             is center-aligned ('xMidYMid'). In this case, the uniform scale factor
             is markerHeight/viewBoxHeight=3/10=.3. Therefore, translate by
             (-refX*.3,-refY*.3)=(0*.3,-5*.3)=(0,-1.5). --&gt;
        <strong>&lt;g transform="translate(0,-1.5)" &gt;</strong>
          &lt;!-- There is an implicit clipping path because the user agent style
               sheet says that the 'overflow' property for markers has the value
               'hidden'. To achieve this, create a clipping path at the bounds
               of the viewport. Note that in this case the viewport extends
               0.5 units to the left and right of the viewBox due to
               a uniform scale factor, different ratios for markerWidth/viewBoxWidth
               and markerHeight/viewBoxHeight, and 'xMidYMid' alignment --&gt;
          <strong>&lt;clipPath id="cp1" &gt;
            &lt;rect x="-0.5" y="0" width="4" height="3" /&gt;
          &lt;/clipPath&gt;</strong>
          <strong>&lt;g clip-path="url(#cp1)" &gt;</strong>
            &lt;!-- Scale the coordinate system by the uniform scale factor
                 markerHeight/viewBoxHeight=3/10=.3 to set the coordinate
                 system to viewBox units. --&gt;
            <strong>&lt;g transform="scale(.3)" &gt;</strong>
              &lt;!-- This 'g' element carries all property values that result from
                   cascading and inheritance of properties on the original 'marker' element.
                   In this example, neither fill nor stroke was specified on the 'marker'
                   element or any ancestors of the 'marker', so the initial values of
                   "black" and "none" are used, respectively. --&gt;
             <strong>&lt;g fill="black" stroke="none" &gt;</strong>
                &lt;!-- Expand out the contents of the 'marker' element. --&gt;
                <strong>&lt;path d="M 0 0 L 10 5 L 0 10 z" /&gt;</strong>
              <strong>&lt;/g&gt;</strong>
            <strong>&lt;/g&gt;</strong>
          <strong>&lt;/g&gt;</strong>
        <strong>&lt;/g&gt;</strong>
      <strong>&lt;/g&gt;</strong>
    <strong>&lt;/g&gt;</strong>
  <strong>&lt;/g&gt;</strong>
&lt;/svg&gt;
</pre>
<p class="view-as-svg"><a href="images/painting/marker-simulated.svg">View this example as SVG (SVG-enabled browsers only)</a></p>

</edit:with>

<div class="ready-for-wider-review">
<h2 id="PaintOrder">Controlling paint operation order: the
<span class="property">'paint-order'</span> property</h2>

<div class="annotation svg2-requirement">
  <table>
    <tr>
      <th>SVG 2 Requirement:</th>
      <td>Support control of the order of filling, stroke and painting markers on shapes.</td>
    </tr>
    <tr>
      <th>Resolution:</th>
      <td><a href="http://www.w3.org/2012/05/07-svg-minutes#item03">SVG 2 will adopt the <span class="property">'paint-order'</span> property proposal, though possibly with a different name.</a>
      The property name is now resolved, see <a href="http://www.w3.org/2013/11/15-svg-minutes.html#item12">15 Nov 2013 minutes</a>.</td>
    </tr>
    <tr>
      <th>Purpose:</th>
      <td>To address the common desire to paint strokes below fills without having to duplicate an element.</td>
    </tr>
    <tr>
      <th>Owner:</th>
      <td>Cameron (<a href="http://www.w3.org/Graphics/SVG/WG/track/actions/3285">ACTION-3285</a>)</td>
    </tr>
  </table>
</div>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="PaintOrderProperty">paint-order</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>normal | [ fill || stroke || markers ]</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>normal</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>graphics elements</a> and <a>text content elements</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p class="note">New in SVG 2.  Added primarily to allow painting the stroke
of text below its fill without needing to duplicate the <a>'text'</a> element.</p>

<p>The <a>'paint-order'</a> property controls the order that the three
paint operations that <a>shapes</a> and text are rendered with:
their fill, their stroke and any markers they might have.</p>

<p>When the value of this property is <span class="prop-value">normal</span>,
the element is painted with the standard order of painting operations:
the fill is painted first, then its stroke and finally its markers.</p>

<p>When any of the other keywords are used, the order of the paint
operations for painting the element is as given, from left to right.  If any of
the three keywords are omitted, they are painted last, in the order they
would be painted with <span class="prop-value">paint-order: normal</span>.</p>

<p class="note">This mean that, for example,
<span class="prop-value">paint-order: stroke</span>
has the same rendering behavior as
<span class="prop-value">paint-order: stroke fill markers</span>.</p>

<div class="example">
  <p>The following example shows how the <a>'paint-order'</a> property can
  be used to render stroked text in a more aesthetically pleasing manner.</p>

  <pre><![CDATA[
<svg xmlns="http://www.w3.org/2000/svg"
     width="600" height="150" viewBox="0 0 600 150">

  <style>
    text {
      font: 80px bold sans-serif; stroke-linejoin: round;
      text-anchor: middle; fill: peachpuff; stroke: crimson;
    }
  </style>

  <text x="150" y="100" stroke-width="6px">pizazz</text>
  <text x="450" y="100" stroke-width="12px" paint-order="stroke">pizazz</text>
</svg>
]]></pre>

  <div class="figure">
    <img class="bordered" src="images/painting/paintorder.svg"
         alt="Image showing the effect of paint-order."/>
    <p class="caption">Text painted with its stroke below the fill.</p>
  </div>
</div>
</div>

<div class="ready-for-wider-review">
<h2 id="ColorInterpolation">Color space for interpolation: the
<span class="property">'color-interpolation'</span> property</h2>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="ColorInterpolationProperty">color-interpolation</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | sRGB | linearRGB</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>sRGB</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>container elements</a>, <a>graphics elements</a>,
    <a>gradient elements</a> and <a>'animate'</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The SVG user agent performs color interpolations and compositing
at various points as it processes SVG content.  The <a>'color-interpolation'</a>
property controls which color space is used for the following graphics operations:</p>

<ul>
  <li>interpolating between <a href="pservers.html#Gradients">gradient</a> stops,</li>

  <li>interpolating color when performing color animations with
  <a>'animate'</a>,</li>
  <li>and <a href="render.html#PaintersModel">compositing and blending</a> of
  <a>graphics elements</a> into the current background.</li>
</ul>

<p class="note">For <a href="http://www.w3.org/TR/filter-effects/">filter effects</a>, the
<a>'color-interpolation-filters'</a> property controls which color space is used.
[<a href="refs.html#ref-FILTERS">FILTERS</a>]</p>
</div>

<p>The <a>'color-interpolation'</a> property chooses between color operations
occurring in the sRGB color space or in a (light energy linear) linearized RGB
color space. Having chosen the appropriate color space, component-wise linear
interpolation is used.  Possible values for <a>'color-interpolation'</a> are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent can choose either the
  <span class='prop-value'>sRGB</span> or
  <span class='prop-value'>linearRGB</span> spaces for color interpolation.
  This option indicates that the author doesn't require that color
  interpolation occur in a particular color space.</dd>

  <dt><span class='prop-value'>sRGB</span></dt>
  <dd>Indicates that color interpolation occurs in the sRGB
  color space.</dd>

  <dt><span class='prop-value'>linearRGB</span></dt>
  <dd>Indicates that color interpolation occurs in the
  linearized RGB color space as described below.</dd>
</dl>

<p id="sRGBlinearRGBConversionFormulas">The conversion formulas between the
sRGB color space (i.e., nonlinear with 2.2 gamma curve) and the linearized RGB
color space (i.e., color values expressed as sRGB tristimulus values without a
gamma curve) can be found in <a href="https://webstore.iec.ch/publication/6168">the sRGB specification</a>
[<a href="refs.html#ref-SRGB">SRGB</a>].
For illustrative purposes, the following formula shows the conversion from
sRGB to linearized RGB, where <var>C<sub>srgb</sub></var> is one of the
three sRGB color components, <var>C<sub>linear</sub></var> is the corresponding
linearized RGB color component, and all color values are between 0 and 1:</p>

<div role="math" aria-describedby="math-linearRGB">
  <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
    <mrow>
      <msub>
        <mi>C</mi>
        <mi>linear</mi>
      </msub>
      <mo>=</mo>
      <mo>{</mo>
      <mtable columnalign="left">
        <mtr>
          <mtd>
            <mfrac>
              <msub>
                <mi>C</mi>
                <mi>srgb</mi>
              </msub>
              <mn>12.92</mn>
            </mfrac>
          </mtd>
          <mtd>
            <mtext>if&#160;</mtext>
            <msub>
              <mi>C</mi>
              <mi>srgb</mi>
            </msub>
            <mo>≤</mo>
            <mn>0.04045</mn>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msup>
              <mfenced>
                <mfrac>
                  <mrow>
                    <msub>
                      <mi>C</mi>
                      <mi>srgb</mi>
                    </msub>
                    <mo>+</mo>
                    <mn>0.055</mn>
                  </mrow>
                  <mn>1.055</mn>
                </mfrac>
              </mfenced>
              <mn>2.4</mn>
            </msup>
          </mtd>
          <mtd>
            <mtext>if&#160;</mtext>
            <msub>
              <mi>C</mi>
              <mi>srgb</mi>
            </msub>
            <mo>></mo>
            <mn>0.04045</mn>
          </mtd>
        </mtr>
      </mtable>
    </mrow>
  </math>
  <pre id="math-linearRGB">
if C_srgb &lt;= 0.04045
  C_linear = C_srgb / 12.92
else if c_srgb &gt; 0.04045
  C_linear = ((C_srgb + 0.055) / 1.055) ^ 2.4
</pre>
</div>

<p>Out-of-range color values, if supported by the user agent, also are
converted using the above formulas. (See
<a href="implnote.html#RangeClamping">Clamping values which are restricted to a particular range</a>.)</p>

<p>When a child element is blended into a background, the value of the
<a>'color-interpolation'</a> property on the child determines the type of
blending, not the value of the <a>'color-interpolation'</a> on the parent.
For <a href="pservers.html#Gradients">gradients</a> which make use of the
<span class='attr-name'>'href'</span> attribute to reference another
gradient, the gradient uses the <a>'color-interpolation'</a> property value
from the gradient element which is directly referenced by the <a>'fill'</a> or
<a>'stroke'</a> property. When animating colors, color interpolation is
performed according to the value of the <a>'color-interpolation'</a> property
on the element being animated.</p>

<h2 id="RenderingHints">Rendering hints</h2>

<h3 id="ColorRendering">The <span class="property">'color-rendering'</span> property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="ColorRenderingProperty">color-rendering</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | optimizeSpeed | optimizeQuality</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>auto</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>container elements</a>, <a>graphics elements</a>, <a>gradient elements</a> and <a>'animate'</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The creator of SVG content might want to provide a hint
to the implementation about how to make speed vs. quality
tradeoffs as it performs color interpolation and compositing. The
<a>'color-rendering'</a> property provides a hint to the SVG user
agent about how to optimize its color interpolation and compositing
operations.  Possible values are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent shall make appropriate
  tradeoffs to balance speed and quality, but quality shall be
  given more importance than speed.</dd>

  <dt><span class='prop-value'>optimizeSpeed</span></dt>
  <dd>Indicates that the user agent shall emphasize rendering
  speed over quality. For RGB display devices, this option will
  sometimes cause the user agent to perform color interpolation
  and compositing in the device RGB color space.</dd>

  <dt><span class='prop-value'>optimizeQuality</span></dt>
  <dd>Indicates that the user agent shall emphasize quality
  over rendering speed.</dd>
</dl>

<p><a>'color-rendering'</a> takes precedence over
<a>'color-interpolation-filters'</a>. For example, assume
<span class="prop-value">color-rendering: optimizeSpeed</span> and
<span class="prop-value">color-interpolation-filters: linearRGB</span>.
In this case, the SVG user agent should perform color operations in a way that
optimizes performance, which might mean sacrificing the color interpolation
precision as specified by <span class="prop-value">color-interpolation-filters: linearRGB</span>.</p>

<h3 id="ShapeRendering">The <span class="property">'shape-rendering'</span> property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="ShapeRenderingProperty">shape-rendering</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | optimizeSpeed | crispEdges | geometricPrecision</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>auto</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The creator of SVG content might want to provide a hint to the
implementation about what tradeoffs to make as it renders vector graphics
elements such as <a>'path'</a> elements and <a href="shapes.html">basic shapes</a>
such as circles and rectangles. The <a>'shape-rendering'</a> property provides
these hints.  Possible values are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent shall make appropriate
  tradeoffs to balance speed, crisp edges and geometric
  precision, but with geometric precision given more importance
  than speed and crisp edges.</dd>

  <dt><span class='prop-value'>optimizeSpeed</span></dt>
  <dd>Indicates that the user agent shall emphasize rendering
  speed over geometric precision and crisp edges. This option
  will sometimes cause the user agent to turn off shape
  anti-aliasing.</dd>

  <dt><span class='prop-value'>crispEdges</span></dt>
  <dd>Indicates that the user agent shall attempt to emphasize
  the contrast between clean edges of artwork over rendering
  speed and geometric precision. To achieve crisp edges, the
  user agent might turn off anti-aliasing for all lines and
  curves or possibly just for straight lines which are close to
  vertical or horizontal. Also, the user agent might adjust
  line positions and line widths to align edges with device
  pixels.</dd>

  <dt><span class='prop-value'>geometricPrecision</span></dt>
  <dd>Indicates that the user agent shall emphasize geometric
  precision over speed and crisp edges.</dd>
</dl>

<h3 id="TextRendering">The <span class="property">'text-rendering'</span> property</h3>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="TextRenderingProperty">text-rendering</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | optimizeSpeed | optimizeLegibility | geometricPrecision</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>auto</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>'text'</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The creator of SVG content might want to provide a hint to the
implementation about what tradeoffs to make as it renders text. The
<a>'text-rendering'</a> property provides these hints.  Possible
values are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent shall make appropriate
  tradeoffs to balance speed, legibility and geometric
  precision, but with legibility given more importance than
  speed and geometric precision.</dd>

  <dt><span class='prop-value'>optimizeSpeed</span></dt>
  <dd>Indicates that the user agent shall emphasize rendering
  speed over legibility and geometric precision. This option
  will sometimes cause the user agent to turn off text
  anti-aliasing.</dd>

  <dt><span class='prop-value'>optimizeLegibility</span></dt>
  <dd>Indicates that the user agent shall emphasize legibility
  over rendering speed and geometric precision. The user agent
  will often choose whether to apply anti-aliasing techniques,
  built-in font hinting or both to produce the most legible
  text.</dd>

  <dt><span class='prop-value'>geometricPrecision</span></dt>
  <dd>Indicates that the user agent shall emphasize geometric
  precision over legibility and rendering speed. This option
  will usually cause the user agent to suspend the use of
  hinting so that glyph outlines are drawn with comparable
  geometric precision to the rendering of path data.</dd>
</dl>

<h3 id="ImageRendering">The <span class="property">'image-rendering'</span> property</h3>

<p class="note">The <a href="http://dev.w3.org/csswg/css-images/#the-image-rendering">CSS Image Values and Replacement Conent Module Level 4</a> may in the future redefine this property. In particular it should allow the choice between smoothing and keeping a pixelated look when upscaling.</p>

<table class="propdef">
  <tr>
    <th>Name:</th>
    <td><dfn id="ImageRenderingProperty">image-rendering</dfn></td>
  </tr>
  <tr>
    <th>Value:</th>
    <td>auto | optimizeQuality | optimizeSpeed</td>
  </tr>
  <tr>
    <th>Initial:</th>
    <td>auto</td>
  </tr>
  <tr>
    <th>Applies to:</th>
    <td><a>shapes</a></td>
  </tr>
  <tr>
    <th>Inherited:</th>
    <td>yes</td>
  </tr>
  <tr>
    <th>Percentages:</th>
    <td>N/A</td>
  </tr>
  <tr>
    <th>Media:</th>
    <td>visual</td>
  </tr>
  <tr>
    <th>Computed&#160;value:</th>
    <td>as specified</td>
  </tr>
  <tr>
    <th><a>Animatable</a>:</th>
    <td>yes</td>
  </tr>
</table>

<p>The creator of SVG content might want to provide a hint to the
implementation about how to make speed vs. quality tradeoffs as it performs
image processing. The <a>'image-rendering'</a> property provides a hint to the
SVG user agent about how to optimize its image rendering.  Possible values are:</p>

<dl>
  <dt><span class='prop-value'>auto</span></dt>
  <dd>Indicates that the user agent shall make appropriate
  tradeoffs to balance speed and quality, but quality shall be
  given more importance than speed. The user agent shall employ
  a resampling algorithm at least as good as nearest neighbor
  resampling, but bilinear resampling is strongly preferred.
  For <a href="conform.html#ConformingHighQualitySVGViewers">Conforming
  High-Quality SVG Viewers</a>, the user agent shall employ a
  resampling algorithm at least as good as bilinear
  resampling.</dd>

  <dt><span class='prop-value'>optimizeQuality</span></dt>
  <dd>Indicates that the user agent shall emphasize quality
  over rendering speed. The user agent shall employ a
  resampling algorithm at least as good as bilinear
  resampling.</dd>

  <dt><span class='prop-value'>optimizeSpeed</span></dt>
  <dd>Indicates that the user agent shall emphasize rendering
  speed over quality. The user agent should use a resampling
  algorithm which achieves the goal of fast rendering, with the
  requirement that the resampling algorithm shall be at least
  as good as nearest neighbor resampling. If performance goals
  can be achieved with higher quality algorithms, then the user
  agent should use the higher quality algorithms instead of
  nearest neighbor resampling.</dd>
</dl>

<p>In all cases, resampling must be done in a truecolor (e.g.,
24-bit) color space even if the original data and/or the target
device is indexed color.  High quality SVG viewers should perform
image resampling using a linear color space.</p>


<h2 id="WillChange">The effect of the
<span class='prop-name'>'will-change'</span> property</h2>

<p class="note">See the CSS Will Change Module Level 1 specification for the
definition of <a>'will-change'</a>.</p>

<p>The <a>'will-change'</a> property is used to provide a hint to the user
agent as to the types of changes that will be made to content, giving
the user agent a better chance at performing rendering optimizations
for a given element.</p>

<p>The <a>'will-change'</a> property applies to all SVG <a>graphics elements</a>,
however since SVG elements do not support scrolling, the
<span class='prop-value'>scroll-position</span> value will have no effect
on them.</p>

<div class='example'>
  <p>The following example demonstrates how <a>'will-change'</a> can be used
  to forewarn the user agent that an element will have its <a>'transform'</a>
  property changed, with the potential result of the user agent rendering the
  element into its own GPU layer so that the scripted <a>'transform'</a>
  changes appear smooth.</p>

  <edit:includefile href="images/painting/will-change.svg"/>

  <div class="figure">
    <img class="bordered" src="images/painting/will-change-image.svg"
         width="200" height="150"
         alt='A blue star with the text "Drag the star!" above.'/>
    <p class="caption">In a user agent that supports <a>'will-change'</a>
    on SVG elements, the star might be rendered into a layer so that
    it can be composited quickly when it is dragged around the canvas.
    <a href="images/painting/will-change.svg">View interactive SVG document.</a></p>
  </div>
</div>

<p class="note">The <a>'will-change'</a> property subsumes the
<span class='prop-name'>'buffered-rendering'</span> property defined in
SVG Tiny 1.2.</p>


<h2 id="InheritanceOfPaintingProperties">Inheritance of painting properties</h2>

<p>The values of any of the painting properties defined in this chapter can
be inherited from a given object's parent.  Painting, however, is always done
on each <a>graphics element</a>
individually, never at the <a>container element</a>
(e.g., a <a>'g'</a>) level. Thus, for the following SVG, even though the
gradient fill is specified on the <a>'g'</a>, the gradient is simply inherited
through the <a>'g'</a> element down into each rectangle, each of which is
rendered such that its interior is painted with the gradient.</p>

<p>Any painting properties defined in terms of the
<a href="coords.html#ObjectBoundingBoxUnits">object's bounding box</a> use the
bounding box of the <a>graphics element</a>
to which the operation applies. Note that <a href="text.html">text elements</a>
are defined such that any painting operations defined in terms of the
<a href="coords.html#ObjectBoundingBoxUnits">object's bounding box</a> use the
bounding box of the entire <a>'text'</a> element. (See the discussion of
<a href="text.html#ObjectBoundingBoxUnitsTextObjects">object bounding box units and text elements</a>.)</p>

<div class="example">
  <p>The following example shows how painting properties are inherited
  from a <a>'g'</a> element to its child <a>'rect'</a> elements.</p>

  <edit:includefile href="images/painting/inheritance.svg"/>

  <div class="figure">
    <img class="bordered" src="images/painting/inheritance.svg"
         alt="Image demonstrating the inheritance of painting properties."/>
    <p class="caption">Both rectangles are filled with the same orange-to-yellow
    gradient.</p>
  </div>
</div>


<div class='ready-for-wider-review'>
<h2 id="DOMInterfaces">DOM interfaces</h2>

<h3 id="InterfaceSVGMarkerElement">Interface SVGMarkerElement</h3>

<edit:with element="marker">

<p>An <a>SVGMarkerElement</a> object represents a <a>'marker element'</a>
element in the DOM.</p>

<pre class="idl">interface <b>SVGMarkerElement</b> : <a>SVGElement</a> {

  // Marker Unit Types
  const unsigned short <a href="painting.html#__svg__SVGMarkerElement__SVG_MARKERUNITS_UNKNOWN">SVG_MARKERUNITS_UNKNOWN</a> = 0;
  const unsigned short <a href="painting.html#__svg__SVGMarkerElement__SVG_MARKERUNITS_USERSPACEONUSE">SVG_MARKERUNITS_USERSPACEONUSE</a> = 1;
  const unsigned short <a href="painting.html#__svg__SVGMarkerElement__SVG_MARKERUNITS_STROKEWIDTH">SVG_MARKERUNITS_STROKEWIDTH</a> = 2;

  // Marker Orientation Types
  const unsigned short <a href="painting.html#__svg__SVGMarkerElement__SVG_MARKER_ORIENT_UNKNOWN">SVG_MARKER_ORIENT_UNKNOWN</a> = 0;
  const unsigned short <a href="painting.html#__svg__SVGMarkerElement__SVG_MARKER_ORIENT_AUTO">SVG_MARKER_ORIENT_AUTO</a> = 1;
  const unsigned short <a href="painting.html#__svg__SVGMarkerElement__SVG_MARKER_ORIENT_ANGLE">SVG_MARKER_ORIENT_ANGLE</a> = 2;

  [SameObject] readonly attribute <a>SVGAnimatedLength</a> <a href="painting.html#__svg__SVGMarkerElement__refX">refX</a>;
  [SameObject] readonly attribute <a>SVGAnimatedLength</a> <a href="painting.html#__svg__SVGMarkerElement__refY">refY</a>;
  [SameObject] readonly attribute <a>SVGAnimatedEnumeration</a> <a href="painting.html#__svg__SVGMarkerElement__markerUnits">markerUnits</a>;
  [SameObject] readonly attribute <a>SVGAnimatedLength</a> <a href="painting.html#__svg__SVGMarkerElement__markerWidth">markerWidth</a>;
  [SameObject] readonly attribute <a>SVGAnimatedLength</a> <a href="painting.html#__svg__SVGMarkerElement__markerHeight">markerHeight</a>;
  [SameObject] readonly attribute <a>SVGAnimatedEnumeration</a> <a href="painting.html#__svg__SVGMarkerElement__orientType">orientType</a>;
  [SameObject] readonly attribute <a>SVGAnimatedAngle</a> <a href="painting.html#__svg__SVGMarkerElement__orientAngle">orientAngle</a>;
  attribute DOMString <a href="painting.html#__svg__SVGMarkerElement__orient">orient</a>;

  void <a href="painting.html#__svg__SVGMarkerElement__setOrientToAuto">setOrientToAuto</a>();
  void <a href="painting.html#__svg__SVGMarkerElement__setOrientToAngle">setOrientToAngle</a>(<a>SVGAngle</a> angle);
};

<a>SVGMarkerElement</a> implements <a>SVGFitToViewBox</a>;</pre>

<p>The numeric marker unit type constants defined on <a>SVGMarkerElement</a>
are used to represent the keyword values that the <a>'markerUnits'</a>
attribute can take.  Their meanings are as follows:</p>

<table class='vert'>
  <tr><th>Constant</th><th>Meaning</th></tr>
  <tr><td><b id="__svg__SVGMarkerElement__SVG_MARKERUNITS_USERSPACEONUSE">SVG_MARKERUNITS_USERSPACEONUSE</b></td><td>The <span class="attr-value">userSpaceOnUse</span> keyword.</td></tr>
  <tr><td><b id="__svg__SVGMarkerElement__SVG_MARKERUNITS_STROKEWIDTH">SVG_MARKERUNITS_STROKEWIDTH</b></td><td>The <span class="attr-value">strokeWidth</span> keyword.</td></tr>
  <tr><td><b id="__svg__SVGMarkerElement__SVG_MARKERUNITS_UNKNOWN">SVG_MARKERUNITS_UNKNOWN</b></td><td>Some other value.</td></tr>
</table>

<p>The numeric marker orientation type constants defined on <a>SVGMarkerElement</a>
are used to represent the types of values that the <a>'orient'</a>
attribute can take.  Their meanings are as follows:</p>

<table class='vert'>
  <tr><th>Constant</th><th>Meaning</th></tr>
  <tr><td><b id="__svg__SVGMarkerElement__SVG_MARKER_ORIENT_AUTO">SVG_MARKER_ORIENT_AUTO</b></td><td>The <span class="attr-value">auto</span> keyword.</td></tr>
  <tr><td><b id="__svg__SVGMarkerElement__SVG_MARKER_ORIENT_ANGLE">SVG_MARKER_ORIENT_ANGLE</b></td><td>An <a>&lt;angle&gt;</a> or <a>&lt;number&gt;</a> value indicating the orientation angle.</td></tr>
  <tr><td><b id="__svg__SVGMarkerElement__SVG_MARKER_ORIENT_UNKNOWN">SVG_MARKER_ORIENT_UNKNOWN</b></td><td>Some other value.</td></tr>
</table>

<p>The <b id="__svg__SVGMarkerElement__markerUnits">markerUnits</b> IDL attribute
<a>reflects</a> the <a>'markerUnits'</a> content attribute.  The
<a>numeric type values</a> for <a>'markerUnits'</a> are as
described above in the numeric marker unit type constant table.</p>

<p>The <b id="__svg__SVGMarkerElement__orientType">orientType</b>,
<b id="__svg__SVGMarkerElement__orientAngle">orientAngle</b> and
<b id="__svg__SVGMarkerElement__orient">orient</b> IDL attributes
all reflect the <a>'orient'</a> content attribute.
The <a>numeric type values</a> for <a>'orient'</a> are as follows:</p>

<table class="vert">
  <tr><th>Value</th><th>Numeric type value</th></tr>
  <tr>
    <td><span class='attr-value'>auto</span></td>
    <td><a href='painting.html#__svg__SVGMarkerElement__SVG_MARKER_ORIENT_AUTO'>SVG_MARKER_ORIENT_AUTO</a></td>
  </tr>
  <tr>
    <td><span class='attr-value'>auto-start-reverse</span></td>
    <td><a href='painting.html#__svg__SVGMarkerElement__SVG_MARKER_ORIENT_UNKNOWN'>SVG_MARKER_ORIENT_UNKNOWN</a></td>
  </tr>
  <tr>
    <td><a>&lt;angle&gt;</a> | <a>&lt;number&gt;</a></td>
    <td><a href='painting.html#__svg__SVGMarkerElement__SVG_MARKER_ORIENT_ANGLE'>SVG_MARKER_ORIENT_ANGLE</a></td>
  </tr>
</table>

<p>The <b id="__svg__SVGMarkerElement__refX">refX</b>,
<b id="__svg__SVGMarkerElement__refY">refY</b>,
<b id="__svg__SVGMarkerElement__markerWidth">markerWidth</b> and
<b id="__svg__SVGMarkerElement__markerHeight">markerHeight</b> IDL attributes
reflect the <a>'refX'</a>, <a>'refY'</a>, <a>'markerWidth'</a>
and <a>'markerHeight'</a> content attributes, respectively.</p>

<p>The <b id="__svg__SVGMarkerElement__setOrientToAuto">setOrientToAuto</b>
method is used to set the value of the <a>'orient'</a> attribute
to <span class='attr-value'>'auto'</span>.  When setOrientToAuto() is
called, the <a>'orient'</a> attribute is simply set to <span class='attr-value'>'auto'</span>.</p>

<p>The <b id="__svg__SVGMarkerElement__setOrientToAngle">setOrientToAngle</b>
method is used to set the value of the <a>'orient'</a> attribute
to a specific angle value.  When setOrientToAngle(<var>angle</var>) is
called, the <a>'orient'</a> attribute is <a>reserialized</a> using
<var>angle</var> as the value.</p>

</edit:with>
</div>

</body>
</html>
